!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).kokomi={})}(this,(function(e){"use strict";
/**
	 * @license
	 * Copyright 2010-2023 Three.js Authors
	 * SPDX-License-Identifier: MIT
	 */const t="158",n={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},i={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},r=1,s=100,a=204,o=205,l="attached",c="detached",h=300,u=301,d=302,p=303,f=304,m=306,A=1e3,g=1001,v=1002,y=1003,x=1004,_=1005,E=1006,w=1007,C=1008,b=1008,M=1009,S=1012,I=1013,B=1014,T=1015,R=1016,D=1017,L=1018,P=1020,F=1023,U=1026,O=1027,N=1028,k=1029,G=1030,Q=1031,z=1033,H=33776,V=33777,W=33778,j=33779,X=35840,J=35841,q=35842,Y=35843,K=36196,Z=37492,$=37496,ee=37808,te=37809,ne=37810,ie=37811,re=37812,se=37813,ae=37814,oe=37815,le=37816,ce=37817,he=37818,ue=37819,de=37820,pe=37821,fe=36492,me=36494,Ae=36495,ge=36284,ve=36285,ye=36286,xe=2300,_e=2301,Ee=2302,we=2400,Ce=2401,be=2402,Me=2500,Se=2501,Ie=3e3,Be=3001,Te=3201,Re="",De="srgb",Le="srgb-linear",Pe="display-p3",Fe="display-p3-linear",Ue="linear",Oe="srgb",Ne="rec709",ke="p3",Ge=7680,Qe=35044,ze="300 es",He=1035,Ve=2e3,We=2001;let je=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}};const Xe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Je=1234567;const qe=Math.PI/180,Ye=180/Math.PI;function Ke(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Xe[255&e]+Xe[e>>8&255]+Xe[e>>16&255]+Xe[e>>24&255]+"-"+Xe[255&t]+Xe[t>>8&255]+"-"+Xe[t>>16&15|64]+Xe[t>>24&255]+"-"+Xe[63&n|128]+Xe[n>>8&255]+"-"+Xe[n>>16&255]+Xe[n>>24&255]+Xe[255&i]+Xe[i>>8&255]+Xe[i>>16&255]+Xe[i>>24&255]).toLowerCase()}function Ze(e,t,n){return Math.max(t,Math.min(n,e))}function $e(e,t){return(e%t+t)%t}function et(e,t,n){return(1-n)*e+n*t}function tt(e){return 0==(e&e-1)&&0!==e}function nt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function it(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function rt(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function st(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const at={DEG2RAD:qe,RAD2DEG:Ye,generateUUID:Ke,clamp:Ze,euclideanModulo:$e,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:et,damp:function(e,t,n,i){return et(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs($e(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Je=e);let t=Je+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*qe},radToDeg:function(e){return e*Ye},isPowerOfTwo:tt,ceilPowerOfTwo:nt,floorPowerOfTwo:it,setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),h=a((t+i)/2),u=s((t-i)/2),d=a((t-i)/2),p=s((i-t)/2),f=a((i-t)/2);switch(r){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:st,denormalize:rt};let ot=class e{constructor(t=0,n=0){e.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ze(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};class lt{constructor(e,t,n,i,r,s,a,o,l){lt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l)}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],A=i[6],g=i[1],v=i[4],y=i[7],x=i[2],_=i[5],E=i[8];return r[0]=s*f+a*g+o*x,r[3]=s*m+a*v+o*_,r[6]=s*A+a*y+o*E,r[1]=l*f+c*g+h*x,r[4]=l*m+c*v+h*_,r[7]=l*A+c*y+h*E,r[2]=u*f+d*g+p*x,r[5]=u*m+d*v+p*_,r[8]=u*A+d*y+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=t*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=h*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*s)*f,e[3]=u*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(ct.makeScale(e,t)),this}rotate(e){return this.premultiply(ct.makeRotation(-e)),this}translate(e,t){return this.premultiply(ct.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ct=new lt;function ht(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const ut={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function dt(e,t){return new ut[e](t)}function pt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ft(){const e=pt("canvas");return e.style.display="block",e}const mt={};function At(e){e in mt||(mt[e]=!0,console.warn(e))}const gt=(new lt).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),vt=(new lt).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),yt={[Le]:{transfer:Ue,primaries:Ne,toReference:e=>e,fromReference:e=>e},[De]:{transfer:Oe,primaries:Ne,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Fe]:{transfer:Ue,primaries:ke,toReference:e=>e.applyMatrix3(vt),fromReference:e=>e.applyMatrix3(gt)},[Pe]:{transfer:Oe,primaries:ke,toReference:e=>e.convertSRGBToLinear().applyMatrix3(vt),fromReference:e=>e.applyMatrix3(gt).convertLinearToSRGB()}},xt=new Set([Le,Fe]),_t={enabled:!0,_workingColorSpace:Le,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!xt.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=yt[t].toReference;return(0,yt[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return yt[e].primaries},getTransfer:function(e){return e===Re?Ue:yt[e].transfer}};function Et(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function wt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Ct;class bt{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ct&&(Ct=pt("canvas")),Ct.width=e.width,Ct.height=e.height;const n=Ct.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ct}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=pt("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Et(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Et(t[e]/255)):t[e]=Et(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Mt=0;class St{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Mt++}),this.uuid=Ke(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(It(i[t].image)):e.push(It(i[t]))}else e=It(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function It(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?bt.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Bt=0;class Tt extends je{constructor(e=Tt.DEFAULT_IMAGE,t=Tt.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=Tt.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Bt++}),this.uuid=Ke(),this.name="",this.source=new St(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(At("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Be?De:Re),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==h)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case A:e.x=e.x-Math.floor(e.x);break;case g:e.x=e.x<0?0:1;break;case v:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case A:e.y=e.y-Math.floor(e.y);break;case g:e.y=e.y<0?0:1;break;case v:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return At("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===De?Be:Ie}set encoding(e){At("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Be?De:Re}}Tt.DEFAULT_IMAGE=null,Tt.DEFAULT_MAPPING=h,Tt.DEFAULT_ANISOTROPY=1;class Rt{constructor(e=0,t=0,n=0,i=1){Rt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],A=o[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+A-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,g=(A+1)/2,v=(c+u)/4,y=(h+f)/4,x=(p+m)/4;return e>o&&e>g?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=y/n):o>g?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=v/i,r=x/i):g<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(g),n=y/r,i=x/r),this.set(n,i,r,t),this}let g=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(g)<.001&&(g=1),this.x=(m-p)/g,this.y=(h-f)/g,this.z=(u-c)/g,this.w=Math.acos((l+d+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Dt extends je{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Rt(0,0,e,t),this.scissorTest=!1,this.viewport=new Rt(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&(At("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Be?De:Re),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:E,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Tt(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new St(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Lt extends Dt{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Pt extends Tt{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=y,this.minFilter=y,this.wrapR=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Ft=class extends Tt{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=y,this.minFilter=y,this.wrapR=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};let Ut=class{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==u||l!==d||c!==p){let e=1-a;const t=o*u+l*d+c*p+h*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*e+u*r,l=l*e+d*r,c=c*e+p*r,h=h*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-a*d,e[t+2]=l*p+c*d+a*u-o*h,e[t+3]=c*p-a*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=n+a+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>h){const e=2*Math.sqrt(1+n-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-n-h);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+h-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ze(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Ot{constructor(e=0,t=0,n=0){Ot.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(kt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(kt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*i-a*n),c=2*(a*t-r*i),h=2*(r*n-s*t);return this.x=t+o*l+s*h-a*c,this.y=n+o*c+a*l-r*h,this.z=i+o*h+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Nt.copy(this).projectOnVector(e),this.sub(Nt)}reflect(e){return this.sub(Nt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ze(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Nt=new Ot,kt=new Ut;class Gt{constructor(e=new Ot(1/0,1/0,1/0),t=new Ot(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(zt.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(zt.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=zt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,zt):zt.fromBufferAttribute(i,t),zt.applyMatrix4(e.matrixWorld),this.expandByPoint(zt);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Ht.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Ht.copy(n.boundingBox)),Ht.applyMatrix4(e.matrixWorld),this.union(Ht)}const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,zt),zt.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Yt),Kt.subVectors(this.max,Yt),Vt.subVectors(e.a,Yt),Wt.subVectors(e.b,Yt),jt.subVectors(e.c,Yt),Xt.subVectors(Wt,Vt),Jt.subVectors(jt,Wt),qt.subVectors(Vt,jt);let t=[0,-Xt.z,Xt.y,0,-Jt.z,Jt.y,0,-qt.z,qt.y,Xt.z,0,-Xt.x,Jt.z,0,-Jt.x,qt.z,0,-qt.x,-Xt.y,Xt.x,0,-Jt.y,Jt.x,0,-qt.y,qt.x,0];return!!en(t,Vt,Wt,jt,Kt)&&(t=[1,0,0,0,1,0,0,0,1],!!en(t,Vt,Wt,jt,Kt)&&(Zt.crossVectors(Xt,Jt),t=[Zt.x,Zt.y,Zt.z],en(t,Vt,Wt,jt,Kt)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,zt).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(zt).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Qt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qt)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Qt=[new Ot,new Ot,new Ot,new Ot,new Ot,new Ot,new Ot,new Ot],zt=new Ot,Ht=new Gt,Vt=new Ot,Wt=new Ot,jt=new Ot,Xt=new Ot,Jt=new Ot,qt=new Ot,Yt=new Ot,Kt=new Ot,Zt=new Ot,$t=new Ot;function en(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){$t.fromArray(e,s);const a=r.x*Math.abs($t.x)+r.y*Math.abs($t.y)+r.z*Math.abs($t.z),o=t.dot($t),l=n.dot($t),c=i.dot($t);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const tn=new Gt,nn=new Ot,rn=new Ot;let sn=class{constructor(e=new Ot,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):tn.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;nn.subVectors(e,this.center);const t=nn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(nn,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(rn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(nn.copy(e.center).add(rn)),this.expandByPoint(nn.copy(e.center).sub(rn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}};const an=new Ot,on=new Ot,ln=new Ot,cn=new Ot,hn=new Ot,un=new Ot,dn=new Ot;let pn=class{constructor(e=new Ot,t=new Ot(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,an)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=an.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(an.copy(this.origin).addScaledVector(this.direction,t),an.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){on.copy(e).add(t).multiplyScalar(.5),ln.copy(t).sub(e).normalize(),cn.copy(this.origin).sub(on);const r=.5*e.distanceTo(t),s=-this.direction.dot(ln),a=cn.dot(this.direction),o=-cn.dot(ln),l=cn.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const e=1/c;h*=e,u*=e,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(on).addScaledVector(ln,u),d}intersectSphere(e,t){an.subVectors(e.center,this.origin);const n=an.dot(this.direction),i=an.dot(an)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,an)}intersectTriangle(e,t,n,i,r){hn.subVectors(t,e),un.subVectors(n,e),dn.crossVectors(hn,un);let s,a=this.direction.dot(dn);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}cn.subVectors(this.origin,e);const o=s*this.direction.dot(un.crossVectors(cn,un));if(o<0)return null;const l=s*this.direction.dot(hn.cross(cn));if(l<0)return null;if(o+l>a)return null;const c=-s*cn.dot(dn);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}};class fn{constructor(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m){fn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m)}set(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m){const A=this.elements;return A[0]=e,A[4]=t,A[8]=n,A[12]=i,A[1]=r,A[5]=s,A[9]=a,A[13]=o,A[2]=l,A[6]=c,A[10]=h,A[14]=u,A[3]=d,A[7]=p,A[11]=f,A[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new fn).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/mn.setFromMatrixColumn(e,0).length(),r=1/mn.setFromMatrixColumn(e,1).length(),s=1/mn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=i*h+n,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-r*h}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(gn,e,vn)}lookAt(e,t,n){const i=this.elements;return _n.subVectors(e,t),0===_n.lengthSq()&&(_n.z=1),_n.normalize(),yn.crossVectors(n,_n),0===yn.lengthSq()&&(1===Math.abs(n.z)?_n.x+=1e-4:_n.z+=1e-4,_n.normalize(),yn.crossVectors(n,_n)),yn.normalize(),xn.crossVectors(_n,yn),i[0]=yn.x,i[4]=xn.x,i[8]=_n.x,i[1]=yn.y,i[5]=xn.y,i[9]=_n.y,i[2]=yn.z,i[6]=xn.z,i[10]=_n.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],A=n[14],g=n[3],v=n[7],y=n[11],x=n[15],_=i[0],E=i[4],w=i[8],C=i[12],b=i[1],M=i[5],S=i[9],I=i[13],B=i[2],T=i[6],R=i[10],D=i[14],L=i[3],P=i[7],F=i[11],U=i[15];return r[0]=s*_+a*b+o*B+l*L,r[4]=s*E+a*M+o*T+l*P,r[8]=s*w+a*S+o*R+l*F,r[12]=s*C+a*I+o*D+l*U,r[1]=c*_+h*b+u*B+d*L,r[5]=c*E+h*M+u*T+d*P,r[9]=c*w+h*S+u*R+d*F,r[13]=c*C+h*I+u*D+d*U,r[2]=p*_+f*b+m*B+A*L,r[6]=p*E+f*M+m*T+A*P,r[10]=p*w+f*S+m*R+A*F,r[14]=p*C+f*I+m*D+A*U,r[3]=g*_+v*b+y*B+x*L,r[7]=g*E+v*M+y*T+x*P,r[11]=g*w+v*S+y*R+x*F,r[15]=g*C+v*I+y*D+x*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+e[11]*(+t*l*h-t*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*h+t*a*u+i*s*h-n*s*u+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],A=e[15],g=h*m*l-f*u*l+f*o*d-a*m*d-h*o*A+a*u*A,v=p*u*l-c*m*l-p*o*d+s*m*d+c*o*A-s*u*A,y=c*f*l-p*h*l+p*a*d-s*f*d-c*a*A+s*h*A,x=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,_=t*g+n*v+i*y+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/_;return e[0]=g*E,e[1]=(f*u*r-h*m*r-f*i*d+n*m*d+h*i*A-n*u*A)*E,e[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*A+n*o*A)*E,e[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*E,e[4]=v*E,e[5]=(c*m*r-p*u*r+p*i*d-t*m*d-c*i*A+t*u*A)*E,e[6]=(p*o*r-s*m*r-p*i*l+t*m*l+s*i*A-t*o*A)*E,e[7]=(s*u*r-c*o*r+c*i*l-t*u*l-s*i*d+t*o*d)*E,e[8]=y*E,e[9]=(p*h*r-c*f*r-p*n*d+t*f*d+c*n*A-t*h*A)*E,e[10]=(s*f*r-p*a*r+p*n*l-t*f*l-s*n*A+t*a*A)*E,e[11]=(c*a*r-s*h*r-c*n*l+t*h*l+s*n*d-t*a*d)*E,e[12]=x*E,e[13]=(c*f*i-p*h*i+p*n*u-t*f*u-c*n*m+t*h*m)*E,e[14]=(p*a*i-s*f*i-p*n*o+t*f*o+s*n*m-t*a*m)*E,e[15]=(s*h*i-c*a*i+c*n*o-t*h*o-s*n*u+t*a*u)*E,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,A=a*h,g=o*l,v=o*c,y=o*h,x=n.x,_=n.y,E=n.z;return i[0]=(1-(f+A))*x,i[1]=(d+y)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-y)*_,i[5]=(1-(u+A))*_,i[6]=(m+g)*_,i[7]=0,i[8]=(p+v)*E,i[9]=(m-g)*E,i[10]=(1-(u+f))*E,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=mn.set(i[0],i[1],i[2]).length();const s=mn.set(i[4],i[5],i[6]).length(),a=mn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],An.copy(this);const o=1/r,l=1/s,c=1/a;return An.elements[0]*=o,An.elements[1]*=o,An.elements[2]*=o,An.elements[4]*=l,An.elements[5]*=l,An.elements[6]*=l,An.elements[8]*=c,An.elements[9]*=c,An.elements[10]*=c,t.setFromRotationMatrix(An),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(t-e),c=2*r/(n-i),h=(t+e)/(t-e),u=(n+i)/(n-i);let d,p;if(a===Ve)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==We)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,s,a=2e3){const o=this.elements,l=1/(t-e),c=1/(n-i),h=1/(s-r),u=(t+e)*l,d=(n+i)*c;let p,f;if(a===Ve)p=(s+r)*h,f=-2*h;else{if(a!==We)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,f=-1*h}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const mn=new Ot,An=new fn,gn=new Ot(0,0,0),vn=new Ot(1,1,1),yn=new Ot,xn=new Ot,_n=new Ot,En=new fn,wn=new Ut;class Cn{constructor(e=0,t=0,n=0,i=Cn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Ze(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ze(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ze(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Ze(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ze(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Ze(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return En.makeRotationFromQuaternion(e),this.setFromRotationMatrix(En,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return wn.setFromEuler(this),this.setFromQuaternion(wn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cn.DEFAULT_ORDER="XYZ";class bn{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Mn=0;const Sn=new Ot,In=new Ut,Bn=new fn,Tn=new Ot,Rn=new Ot,Dn=new Ot,Ln=new Ut,Pn=new Ot(1,0,0),Fn=new Ot(0,1,0),Un=new Ot(0,0,1),On={type:"added"},Nn={type:"removed"};class kn extends je{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Mn++}),this.uuid=Ke(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kn.DEFAULT_UP.clone();const e=new Ot,t=new Cn,n=new Ut,i=new Ot(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fn},normalMatrix:{value:new lt}}),this.matrix=new fn,this.matrixWorld=new fn,this.matrixAutoUpdate=kn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new bn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return In.setFromAxisAngle(e,t),this.quaternion.multiply(In),this}rotateOnWorldAxis(e,t){return In.setFromAxisAngle(e,t),this.quaternion.premultiply(In),this}rotateX(e){return this.rotateOnAxis(Pn,e)}rotateY(e){return this.rotateOnAxis(Fn,e)}rotateZ(e){return this.rotateOnAxis(Un,e)}translateOnAxis(e,t){return Sn.copy(e).applyQuaternion(this.quaternion),this.position.add(Sn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Pn,e)}translateY(e){return this.translateOnAxis(Fn,e)}translateZ(e){return this.translateOnAxis(Un,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Bn.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Tn.copy(e):Tn.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Rn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bn.lookAt(Rn,Tn,this.up):Bn.lookAt(Tn,Rn,this.up),this.quaternion.setFromRotationMatrix(Bn),i&&(Bn.extractRotation(i.matrixWorld),In.setFromRotationMatrix(Bn),this.quaternion.premultiply(In.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(On)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Nn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Bn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Bn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Bn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rn,e,Dn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rn,Ln,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}kn.DEFAULT_UP=new Ot(0,1,0),kn.DEFAULT_MATRIX_AUTO_UPDATE=!0,kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gn=new Ot,Qn=new Ot,zn=new Ot,Hn=new Ot,Vn=new Ot,Wn=new Ot,jn=new Ot,Xn=new Ot,Jn=new Ot,qn=new Ot;let Yn=!1;class Kn{constructor(e=new Ot,t=new Ot,n=new Ot){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Gn.subVectors(e,t),i.cross(Gn);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Gn.subVectors(i,t),Qn.subVectors(n,t),zn.subVectors(e,t);const s=Gn.dot(Gn),a=Gn.dot(Qn),o=Gn.dot(zn),l=Qn.dot(Qn),c=Qn.dot(zn),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Hn),Hn.x>=0&&Hn.y>=0&&Hn.x+Hn.y<=1}static getUV(e,t,n,i,r,s,a,o){return!1===Yn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Yn=!0),this.getInterpolation(e,t,n,i,r,s,a,o)}static getInterpolation(e,t,n,i,r,s,a,o){return this.getBarycoord(e,t,n,i,Hn),o.setScalar(0),o.addScaledVector(r,Hn.x),o.addScaledVector(s,Hn.y),o.addScaledVector(a,Hn.z),o}static isFrontFacing(e,t,n,i){return Gn.subVectors(n,t),Qn.subVectors(e,t),Gn.cross(Qn).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Gn.subVectors(this.c,this.b),Qn.subVectors(this.a,this.b),.5*Gn.cross(Qn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Kn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Kn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return!1===Yn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Yn=!0),Kn.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return Kn.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Kn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Kn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,a;Vn.subVectors(i,n),Wn.subVectors(r,n),Xn.subVectors(e,n);const o=Vn.dot(Xn),l=Wn.dot(Xn);if(o<=0&&l<=0)return t.copy(n);Jn.subVectors(e,i);const c=Vn.dot(Jn),h=Wn.dot(Jn);if(c>=0&&h<=c)return t.copy(i);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Vn,s);qn.subVectors(e,r);const d=Vn.dot(qn),p=Wn.dot(qn);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(Wn,a);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return jn.subVectors(r,i),a=(h-c)/(h-c+(d-p)),t.copy(i).addScaledVector(jn,a);const A=1/(m+f+u);return s=f*A,a=u*A,t.copy(n).addScaledVector(Vn,s).addScaledVector(Wn,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Zn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$n={h:0,s:0,l:0},ei={h:0,s:0,l:0};function ti(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}let ni=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=De){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,_t.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=_t.workingColorSpace){return this.r=e,this.g=t,this.b=n,_t.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=_t.workingColorSpace){if(e=$e(e,1),t=Ze(t,0,1),n=Ze(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=ti(r,i,e+1/3),this.g=ti(r,i,e),this.b=ti(r,i,e-1/3)}return _t.toWorkingColorSpace(this,i),this}setStyle(e,t=De){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=De){const n=Zn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Et(e.r),this.g=Et(e.g),this.b=Et(e.b),this}copyLinearToSRGB(e){return this.r=wt(e.r),this.g=wt(e.g),this.b=wt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=De){return _t.fromWorkingColorSpace(ii.copy(this),e),65536*Math.round(Ze(255*ii.r,0,255))+256*Math.round(Ze(255*ii.g,0,255))+Math.round(Ze(255*ii.b,0,255))}getHexString(e=De){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=_t.workingColorSpace){_t.fromWorkingColorSpace(ii.copy(this),t);const n=ii.r,i=ii.g,r=ii.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=_t.workingColorSpace){return _t.fromWorkingColorSpace(ii.copy(this),t),e.r=ii.r,e.g=ii.g,e.b=ii.b,e}getStyle(e=De){_t.fromWorkingColorSpace(ii.copy(this),e);const t=ii.r,n=ii.g,i=ii.b;return e!==De?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL($n),this.setHSL($n.h+e,$n.s+t,$n.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL($n),e.getHSL(ei);const n=et($n.h,ei.h,t),i=et($n.s,ei.s,t),r=et($n.l,ei.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const ii=new ni;ni.NAMES=Zn;let ri=0,si=class extends je{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ri++}),this.uuid=Ke(),this.name="",this.type="Material",this.blending=r,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=a,this.blendDst=o,this.blendEquation=s,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ni(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ge,this.stencilZFail=Ge,this.stencilZPass=Ge,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==r&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==a&&(n.blendSrc=this.blendSrc),this.blendDst!==o&&(n.blendDst=this.blendDst),this.blendEquation!==s&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ge&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Ge&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Ge&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}};class ai extends si{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const oi=li();function li(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(i[e]=0,i[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,r[e]=24,r[256|e]=24):(i[e]=31744,i[256|e]=64512,r[e]=13,r[256|e]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function ci(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Ze(e,-65504,65504),oi.floatView[0]=e;const t=oi.uint32View[0],n=t>>23&511;return oi.baseTable[n]+((8388607&t)>>oi.shiftTable[n])}function hi(e){const t=e>>10;return oi.uint32View[0]=oi.mantissaTable[oi.offsetTable[t]+(1023&e)]+oi.exponentTable[t],oi.floatView[0]}const ui={toHalfFloat:ci,fromHalfFloat:hi},di=new Ot,pi=new ot;class fi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Qe,this.updateRange={offset:0,count:-1},this.gpuType=T,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)pi.fromBufferAttribute(this,t),pi.applyMatrix3(e),this.setXY(t,pi.x,pi.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyMatrix3(e),this.setXYZ(t,di.x,di.y,di.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyMatrix4(e),this.setXYZ(t,di.x,di.y,di.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyNormalMatrix(e),this.setXYZ(t,di.x,di.y,di.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.transformDirection(e),this.setXYZ(t,di.x,di.y,di.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=rt(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=st(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=rt(t,this.array)),t}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=rt(t,this.array)),t}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=rt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=rt(t,this.array)),t}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array),r=st(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Qe&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class mi extends fi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Ai extends fi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class gi extends fi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let vi=0;const yi=new fn,xi=new kn,_i=new Ot,Ei=new Gt,wi=new Gt,Ci=new Ot;class bi extends je{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vi++}),this.uuid=Ke(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ht(e)?Ai:mi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new lt).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return yi.makeRotationFromQuaternion(e),this.applyMatrix4(yi),this}rotateX(e){return yi.makeRotationX(e),this.applyMatrix4(yi),this}rotateY(e){return yi.makeRotationY(e),this.applyMatrix4(yi),this}rotateZ(e){return yi.makeRotationZ(e),this.applyMatrix4(yi),this}translate(e,t,n){return yi.makeTranslation(e,t,n),this.applyMatrix4(yi),this}scale(e,t,n){return yi.makeScale(e,t,n),this.applyMatrix4(yi),this}lookAt(e){return xi.lookAt(e),xi.updateMatrix(),this.applyMatrix4(xi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_i).negate(),this.translate(_i.x,_i.y,_i.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new gi(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Gt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ot(-1/0,-1/0,-1/0),new Ot(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ei.setFromBufferAttribute(n),this.morphTargetsRelative?(Ci.addVectors(this.boundingBox.min,Ei.min),this.boundingBox.expandByPoint(Ci),Ci.addVectors(this.boundingBox.max,Ei.max),this.boundingBox.expandByPoint(Ci)):(this.boundingBox.expandByPoint(Ei.min),this.boundingBox.expandByPoint(Ei.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new sn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ot,1/0);if(e){const n=this.boundingSphere.center;if(Ei.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];wi.setFromBufferAttribute(n),this.morphTargetsRelative?(Ci.addVectors(Ei.min,wi.min),Ei.expandByPoint(Ci),Ci.addVectors(Ei.max,wi.max),Ei.expandByPoint(Ci)):(Ei.expandByPoint(wi.min),Ei.expandByPoint(wi.max))}Ei.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Ci.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Ci));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Ci.fromBufferAttribute(s,t),a&&(_i.fromBufferAttribute(e,t),Ci.add(_i)),i=Math.max(i,n.distanceToSquared(Ci))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new fi(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new Ot,c[e]=new Ot;const h=new Ot,u=new Ot,d=new Ot,p=new ot,f=new ot,m=new ot,A=new Ot,g=new Ot;function v(e,t,n){h.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(A.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(A),l[t].add(A),l[n].add(A),c[e].add(g),c[t].add(g),c[n].add(g))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)v(n[e+0],n[e+1],n[e+2])}const x=new Ot,_=new Ot,E=new Ot,w=new Ot;function C(e){E.fromArray(r,3*e),w.copy(E);const t=l[e];x.copy(t),x.sub(E.multiplyScalar(E.dot(t))).normalize(),_.crossVectors(w,t);const n=_.dot(c[e])<0?-1:1;o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)C(n[e+0]),C(n[e+1]),C(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new fi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Ot,r=new Ot,s=new Ot,a=new Ot,o=new Ot,l=new Ot,c=new Ot,h=new Ot;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ci.fromBufferAttribute(e,t),Ci.normalize(),e.setXYZ(t,Ci.x,Ci.y,Ci.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new fi(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new bi,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Mi=new fn,Si=new pn,Ii=new sn,Bi=new Ot,Ti=new Ot,Ri=new Ot,Di=new Ot,Li=new Ot,Pi=new Ot,Fi=new ot,Ui=new ot,Oi=new ot,Ni=new Ot,ki=new Ot,Gi=new Ot,Qi=new Ot,zi=new Ot;class Hi extends kn{constructor(e=new bi,t=new ai){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){Pi.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(Li.fromBufferAttribute(o,e),s?Pi.addScaledVector(Li,i):Pi.addScaledVector(Li.sub(t),i))}t.add(Pi)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ii.copy(n.boundingSphere),Ii.applyMatrix4(r),Si.copy(e.ray).recast(e.near),!1===Ii.containsPoint(Si.origin)){if(null===Si.intersectSphere(Ii,Bi))return;if(Si.origin.distanceToSquared(Bi)>(e.far-e.near)**2)return}Mi.copy(r).invert(),Si.copy(e.ray).applyMatrix4(Mi),null!==n.boundingBox&&!1===Si.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Si)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3){i=Vi(this,p,e,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=Vi(this,s,e,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=u.length;r<a;r++){const a=u[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3){i=Vi(this,p,e,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=Vi(this,s,e,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function Vi(e,t,n,i,r,s,a,o,l,c){e.getVertexPosition(o,Ti),e.getVertexPosition(l,Ri),e.getVertexPosition(c,Di);const h=function(e,t,n,i,r,s,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===t.side,o),null===l)return null;zi.copy(o),zi.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(zi);return c<n.near||c>n.far?null:{distance:c,point:zi.clone(),object:e}}(e,t,n,i,Ti,Ri,Di,Qi);if(h){r&&(Fi.fromBufferAttribute(r,o),Ui.fromBufferAttribute(r,l),Oi.fromBufferAttribute(r,c),h.uv=Kn.getInterpolation(Qi,Ti,Ri,Di,Fi,Ui,Oi,new ot)),s&&(Fi.fromBufferAttribute(s,o),Ui.fromBufferAttribute(s,l),Oi.fromBufferAttribute(s,c),h.uv1=Kn.getInterpolation(Qi,Ti,Ri,Di,Fi,Ui,Oi,new ot),h.uv2=h.uv1),a&&(Ni.fromBufferAttribute(a,o),ki.fromBufferAttribute(a,l),Gi.fromBufferAttribute(a,c),h.normal=Kn.getInterpolation(Qi,Ti,Ri,Di,Ni,ki,Gi,new Ot),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const e={a:o,b:l,c:c,normal:new Ot,materialIndex:0};Kn.getNormal(Ti,Ri,Di,e.normal),h.face=e}return h}class Wi extends bi{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(e,t,n,i,r,s,p,f,m,A,g){const v=s/m,y=p/A,x=s/2,_=p/2,E=f/2,w=m+1,C=A+1;let b=0,M=0;const S=new Ot;for(let s=0;s<C;s++){const a=s*y-_;for(let o=0;o<w;o++){const u=o*v-x;S[e]=u*i,S[t]=a*r,S[n]=E,l.push(S.x,S.y,S.z),S[e]=0,S[t]=0,S[n]=f>0?1:-1,c.push(S.x,S.y,S.z),h.push(o/m),h.push(1-s/A),b+=1}}for(let e=0;e<A;e++)for(let t=0;t<m;t++){const n=u+t+w*e,i=u+t+w*(e+1),r=u+(t+1)+w*(e+1),s=u+(t+1)+w*e;o.push(n,i,s),o.push(i,r,s),M+=6}a.addGroup(d,M,g),d+=M,u+=b}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new gi(l,3)),this.setAttribute("normal",new gi(c,3)),this.setAttribute("uv",new gi(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ji(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Xi(e){const t={};for(let n=0;n<e.length;n++){const i=ji(e[n]);for(const e in i)t[e]=i[e]}return t}function Ji(e){return null===e.getRenderTarget()?e.outputColorSpace:_t.workingColorSpace}const qi={clone:ji,merge:Xi};let Yi=class extends si{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ji(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};class Ki extends kn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fn,this.projectionMatrix=new fn,this.projectionMatrixInverse=new fn,this.coordinateSystem=Ve}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Zi extends Ki{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ye*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*qe*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ye*Math.atan(Math.tan(.5*qe*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*qe*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const $i=-90;class er extends kn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Zi($i,1,e,t);i.layers=this.layers,this.add(i);const r=new Zi($i,1,e,t);r.layers=this.layers,this.add(r);const s=new Zi($i,1,e,t);s.layers=this.layers,this.add(s);const a=new Zi($i,1,e,t);a.layers=this.layers,this.add(a);const o=new Zi($i,1,e,t);o.layers=this.layers,this.add(o);const l=new Zi($i,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,a,o]=t;for(const e of t)this.remove(e);if(e===Ve)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==We)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,h=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,o),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(h,u,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class tr extends Tt{constructor(e,t,n,i,r,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:u,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class nr extends Lt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&(At("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Be?De:Re),this.texture=new tr(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:E}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Wi(5,5,5),r=new Yi({name:"CubemapFromEquirect",uniforms:ji(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const s=new Hi(i,r),a=t.minFilter;t.minFilter===C&&(t.minFilter=E);return new er(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const ir=new Ot,rr=new Ot,sr=new lt;let ar=class{constructor(e=new Ot(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=ir.subVectors(n,t).cross(rr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ir),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||sr.getNormalMatrix(e),i=this.coplanarPoint(ir).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}};const or=new sn,lr=new Ot;class cr{constructor(e=new ar,t=new ar,n=new ar,i=new ar,r=new ar,s=new ar){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],A=i[12],g=i[13],v=i[14],y=i[15];if(n[0].setComponents(o-r,u-l,m-d,y-A).normalize(),n[1].setComponents(o+r,u+l,m+d,y+A).normalize(),n[2].setComponents(o+s,u+c,m+p,y+g).normalize(),n[3].setComponents(o-s,u-c,m-p,y-g).normalize(),n[4].setComponents(o-a,u-h,m-f,y-v).normalize(),t===Ve)n[5].setComponents(o+a,u+h,m+f,y+v).normalize();else{if(t!==We)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,h,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),or.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),or.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(or)}intersectsSprite(e){return or.center.set(0,0,0),or.radius=.7071067811865476,or.applyMatrix4(e.matrixWorld),this.intersectsSphere(or)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(lr.x=i.normal.x>0?e.max.x:e.min.x,lr.y=i.normal.y>0?e.max.y:e.min.y,lr.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(lr)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function hr(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ur(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const r=t.array,s=t.usage,a=e.createBuffer();let o;if(e.bindBuffer(i,a),e.bufferData(i,r,s),t.onUploadCallback(),r instanceof Float32Array)o=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=e.HALF_FLOAT}else o=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=e.SHORT;else if(r instanceof Uint32Array)o=e.UNSIGNED_INT;else if(r instanceof Int32Array)o=e.INT;else if(r instanceof Int8Array)o=e.BYTE;else if(r instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(!function(t,i,r){const s=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}class dr extends bi{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=e/a,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*u-s;for(let n=0;n<l;n++){const i=n*h-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new gi(p,3)),this.setAttribute("normal",new gi(f,3)),this.setAttribute("uv",new gi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dr(e.width,e.height,e.widthSegments,e.heightSegments)}}const pr={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},fr={common:{diffuse:{value:new ni(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new lt},alphaMap:{value:null},alphaMapTransform:{value:new lt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new lt}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new lt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new lt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new lt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new lt},normalScale:{value:new ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new lt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new lt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new lt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new lt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ni(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ni(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new lt},alphaTest:{value:0},uvTransform:{value:new lt}},sprite:{diffuse:{value:new ni(16777215)},opacity:{value:1},center:{value:new ot(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new lt},alphaMap:{value:null},alphaMapTransform:{value:new lt},alphaTest:{value:0}}},mr={basic:{uniforms:Xi([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.fog]),vertexShader:pr.meshbasic_vert,fragmentShader:pr.meshbasic_frag},lambert:{uniforms:Xi([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.fog,fr.lights,{emissive:{value:new ni(0)}}]),vertexShader:pr.meshlambert_vert,fragmentShader:pr.meshlambert_frag},phong:{uniforms:Xi([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.fog,fr.lights,{emissive:{value:new ni(0)},specular:{value:new ni(1118481)},shininess:{value:30}}]),vertexShader:pr.meshphong_vert,fragmentShader:pr.meshphong_frag},standard:{uniforms:Xi([fr.common,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.roughnessmap,fr.metalnessmap,fr.fog,fr.lights,{emissive:{value:new ni(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pr.meshphysical_vert,fragmentShader:pr.meshphysical_frag},toon:{uniforms:Xi([fr.common,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.gradientmap,fr.fog,fr.lights,{emissive:{value:new ni(0)}}]),vertexShader:pr.meshtoon_vert,fragmentShader:pr.meshtoon_frag},matcap:{uniforms:Xi([fr.common,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.fog,{matcap:{value:null}}]),vertexShader:pr.meshmatcap_vert,fragmentShader:pr.meshmatcap_frag},points:{uniforms:Xi([fr.points,fr.fog]),vertexShader:pr.points_vert,fragmentShader:pr.points_frag},dashed:{uniforms:Xi([fr.common,fr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pr.linedashed_vert,fragmentShader:pr.linedashed_frag},depth:{uniforms:Xi([fr.common,fr.displacementmap]),vertexShader:pr.depth_vert,fragmentShader:pr.depth_frag},normal:{uniforms:Xi([fr.common,fr.bumpmap,fr.normalmap,fr.displacementmap,{opacity:{value:1}}]),vertexShader:pr.meshnormal_vert,fragmentShader:pr.meshnormal_frag},sprite:{uniforms:Xi([fr.sprite,fr.fog]),vertexShader:pr.sprite_vert,fragmentShader:pr.sprite_frag},background:{uniforms:{uvTransform:{value:new lt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:pr.background_vert,fragmentShader:pr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:pr.backgroundCube_vert,fragmentShader:pr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:pr.cube_vert,fragmentShader:pr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pr.equirect_vert,fragmentShader:pr.equirect_frag},distanceRGBA:{uniforms:Xi([fr.common,fr.displacementmap,{referencePosition:{value:new Ot},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pr.distanceRGBA_vert,fragmentShader:pr.distanceRGBA_frag},shadow:{uniforms:Xi([fr.lights,fr.fog,{color:{value:new ni(0)},opacity:{value:1}}]),vertexShader:pr.shadow_vert,fragmentShader:pr.shadow_frag}};mr.physical={uniforms:Xi([mr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new lt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new lt},clearcoatNormalScale:{value:new ot(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new lt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new lt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new lt},sheen:{value:0},sheenColor:{value:new ni(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new lt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new lt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new lt},transmissionSamplerSize:{value:new ot},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new lt},attenuationDistance:{value:0},attenuationColor:{value:new ni(0)},specularColor:{value:new ni(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new lt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new lt},anisotropyVector:{value:new ot},anisotropyMap:{value:null},anisotropyMapTransform:{value:new lt}}]),vertexShader:pr.meshphysical_vert,fragmentShader:pr.meshphysical_frag};const Ar={r:0,b:0,g:0};function gr(e,t,n,i,r,s,a){const o=new ni(0);let l,c,h=!0===s?0:1,u=null,d=0,p=null;function f(t,n){t.getRGB(Ar,Ji(e)),i.buffers.color.setClear(Ar.r,Ar.g,Ar.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),h=t,f(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(o,h)},render:function(s,A){let g=!1,v=!0===A.isScene?A.background:null;if(v&&v.isTexture){v=(A.backgroundBlurriness>0?n:t).get(v)}null===v?f(o,h):v&&v.isColor&&(f(v,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,a),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===m)?(void 0===c&&(c=new Hi(new Wi(1,1,1),new Yi({name:"BackgroundCubeMaterial",uniforms:ji(mr.backgroundCube.uniforms),vertexShader:mr.backgroundCube.vertexShader,fragmentShader:mr.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,c.material.toneMapped=_t.getTransfer(v.colorSpace)!==Oe,u===v&&d===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,u=v,d=v.version,p=e.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new Hi(new dr(2,2),new Yi({name:"BackgroundMaterial",uniforms:ji(mr.background.uniforms),vertexShader:mr.background.vertexShader,fragmentShader:mr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,l.material.toneMapped=_t.getTransfer(v.colorSpace)!==Oe,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&d===v.version&&p===e.toneMapping||(l.material.needsUpdate=!0,u=v,d=v.version,p=e.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null))}}}function vr(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=p(null);let c=l,h=!1;function u(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){A(e,0)}function A(n,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==r){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r}}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,i,r,s,a,o){!0===o?e.vertexAttribIPointer(t,n,i,s,a):e.vertexAttribPointer(t,n,i,r,s,a)}function y(){x(),h=!0,c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,x){let _=!1;if(a){const t=function(t,n,r){const a=!0===r.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[a];void 0===h&&(h=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h}(y,d,l);c!==t&&(c=t,u(c.object)),_=function(e,t,n,i){const r=c.attributes,s=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){const n=r[t];let i=s[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;a++}}return c.attributesNum!==a||c.index!==i}(r,y,d,x),_&&function(e,t,n,i){const r={},s=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,a++}}c.attributes=r,c.attributesNum=a,c.index=i}(r,y,d,x)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,_=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(_||h)&&(h=!1,function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const t in c){const s=c[t];if(s.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const t=a.normalized,l=a.itemSize,c=n.get(a);if(void 0===c)continue;const h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===i.isWebGL2&&(u===e.INT||u===e.UNSIGNED_INT||a.gpuType===I);if(a.isInterleavedBufferAttribute){const n=a.data,i=n.stride,c=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)A(s.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,u,t,i*d,(c+l/s.locationSize*e)*d,p)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)A(s.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,u,t,l*d,l/s.locationSize*e*d,p)}}else if(void 0!==h){const n=h[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(s.location,n);break;case 3:e.vertexAttrib3fv(s.location,n);break;case 4:e.vertexAttrib4fv(s.location,n);break;default:e.vertexAttrib1fv(s.location,n)}}}}g()}(r,l,d,y),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function yr(e,t,n,i){const r=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),n.update(i,s,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,a,o),n.update(a,s,o)}}function xr(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let a=void 0!==n.precision?n.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),A=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:A,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function _r(e){const t=this;let n=null,i=0,r=!1,s=!1;const a=new ar,o=new lt,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(r,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,h){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===u||0===u.length||s&&!p)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=s?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(u,o,t,h);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Er(e){let t=new WeakMap;function n(e,t){return t===p?e.mapping=u:t===f&&(e.mapping=d),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===p||s===f){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new nr(s.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}let wr=class extends Ki{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}};const Cr=[.125,.215,.35,.446,.526,.582],br=20,Mr=new wr,Sr=new ni;let Ir=null,Br=0,Tr=0;const Rr=(1+Math.sqrt(5))/2,Dr=1/Rr,Lr=[new Ot(1,1,1),new Ot(-1,1,1),new Ot(1,1,-1),new Ot(-1,1,-1),new Ot(0,Rr,Dr),new Ot(0,Rr,-Dr),new Ot(Dr,0,Rr),new Ot(-Dr,0,Rr),new Ot(Rr,Dr,0),new Ot(-Rr,Dr,0)];class Pr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Ir=this._renderer.getRenderTarget(),Br=this._renderer.getActiveCubeFace(),Tr=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Nr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Or(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ir,Br,Tr),e.scissorTest=!1,Ur(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===u||e.mapping===d?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ir=this._renderer.getRenderTarget(),Br=this._renderer.getActiveCubeFace(),Tr=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:E,minFilter:E,generateMipmaps:!1,type:R,format:F,colorSpace:Le,depthBuffer:!1},i=Fr(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Fr(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+Cr.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>e-4?o=Cr[a-e+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,A=1,g=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(A*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,f*p*e),v.set(u,m*p*e);const r=[e,e,e,e,e,e];y.set(r,A*p*e)}const x=new bi;x.setAttribute("position",new fi(g,f)),x.setAttribute("uv",new fi(v,m)),x.setAttribute("faceIndex",new fi(y,A)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(br),r=new Ot(0,1,0),s=new Yi({name:"SphericalGaussianBlur",defines:{n:br,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:kr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,e,t)}return i}_compileMaterial(e){const t=new Hi(this._lodPlanes[0],e);this._renderer.compile(t,Mr)}_sceneToCubeUV(e,t,n,i){const r=new Zi(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Sr),o.toneMapping=0,o.autoClear=!1;const h=new ai({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Hi(new Wi,h);let d=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(Sr),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,s[t],0),r.lookAt(a[t],0,0)):1===n?(r.up.set(0,0,s[t]),r.lookAt(0,a[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,a[t]));const l=this._cubeSize;Ur(i,n*l,t>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(u,r),o.render(e,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===u||e.mapping===d;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Nr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Or());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Hi(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;Ur(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,Mr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Lr[(t-1)%Lr.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Hi(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):br;f>br&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let A=0;for(let e=0;e<br;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?A+=n:e<f&&(A+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/A;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:g}=this;h.dTheta.value=d,h.mipInt.value=g-n;const v=this._sizeLods[i];Ur(t,3*v*(i>g-4?i-g+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(t),o.render(c,Mr)}}function Fr(e,t,n){const i=new Lt(e,t,n);return i.texture.mapping=m,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ur(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Or(){return new Yi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:kr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Nr(){return new Yi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:kr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function kr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Gr(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===p||s===f,o=s===u||s===d;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new Pr(e)),i=a?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(a&&s&&s.height>0||o&&s&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(s)){null===n&&(n=new Pr(e));const s=a?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Qr(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function zr(e,t,n,i){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,i=n.length;e<i;e++)t.remove(n[e])}o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const o=new(ht(n)?Ai:mi)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function Hr(e,t,n,i){const r=i.isWebGL2;let s,a,o;this.setMode=function(e){s=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,a,t*o),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(r)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,i*o,c),n.update(l,s,c)}}function Vr(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Wr(e,t){return e[0]-t[0]}function jr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Xr(e,t,n){const i={},r=new Float32Array(8),s=new WeakMap,a=new Rt,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,h){const u=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=s.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const g=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,x=c.morphAttributes.position||[],_=c.morphAttributes.normal||[],E=c.morphAttributes.color||[];let w=0;!0===g&&(w=1),!0===v&&(w=2),!0===y&&(w=3);let C=c.attributes.position.count*w,b=1;C>t.maxTextureSize&&(b=Math.ceil(C/t.maxTextureSize),C=t.maxTextureSize);const M=new Float32Array(C*b*4*p),S=new Pt(M,C,b,p);S.type=T,S.needsUpdate=!0;const I=4*w;for(let R=0;R<p;R++){const D=x[R],L=_[R],P=E[R],F=C*b*4*R;for(let U=0;U<D.count;U++){const O=U*I;!0===g&&(a.fromBufferAttribute(D,U),M[F+O+0]=a.x,M[F+O+1]=a.y,M[F+O+2]=a.z,M[F+O+3]=0),!0===v&&(a.fromBufferAttribute(L,U),M[F+O+4]=a.x,M[F+O+5]=a.y,M[F+O+6]=a.z,M[F+O+7]=0),!0===y&&(a.fromBufferAttribute(P,U),M[F+O+8]=a.x,M[F+O+9]=a.y,M[F+O+10]=a.z,M[F+O+11]=4===P.itemSize?a.w:1)}}function B(){S.dispose(),s.delete(c),c.removeEventListener("dispose",B)}f={count:p,texture:S,size:new ot(C,b)},s.set(c,f),c.addEventListener("dispose",B)}let m=0;for(let N=0;N<u.length;N++)m+=u[N];const A=c.morphTargetsRelative?1:1-m;h.getUniforms().setValue(e,"morphTargetBaseInfluence",A),h.getUniforms().setValue(e,"morphTargetInfluences",u),h.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const k=void 0===u?0:u.length;let G=i[c.id];if(void 0===G||G.length!==k){G=[];for(let W=0;W<k;W++)G[W]=[W,0];i[c.id]=G}for(let j=0;j<k;j++){const X=G[j];X[0]=j,X[1]=u[j]}G.sort(jr);for(let J=0;J<8;J++)J<k&&G[J][1]?(o[J][0]=G[J][0],o[J][1]=G[J][1]):(o[J][0]=Number.MAX_SAFE_INTEGER,o[J][1]=0);o.sort(Wr);const Q=c.morphAttributes.position,z=c.morphAttributes.normal;let H=0;for(let q=0;q<8;q++){const Y=o[q],K=Y[0],Z=Y[1];K!==Number.MAX_SAFE_INTEGER&&Z?(Q&&c.getAttribute("morphTarget"+q)!==Q[K]&&c.setAttribute("morphTarget"+q,Q[K]),z&&c.getAttribute("morphNormal"+q)!==z[K]&&c.setAttribute("morphNormal"+q,z[K]),r[q]=Z,H+=Z):(Q&&!0===c.hasAttribute("morphTarget"+q)&&c.deleteAttribute("morphTarget"+q),z&&!0===c.hasAttribute("morphNormal"+q)&&c.deleteAttribute("morphNormal"+q),r[q]=0)}const V=c.morphTargetsRelative?1:1-H;h.getUniforms().setValue(e,"morphTargetBaseInfluence",V),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Jr(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}const qr=new Tt,Yr=new Pt,Kr=new Ft,Zr=new tr,$r=[],es=[],ts=new Float32Array(16),ns=new Float32Array(9),is=new Float32Array(4);function rs(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=$r[r];if(void 0===s&&(s=new Float32Array(r),$r[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function ss(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function as(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function os(e,t){let n=es[t];void 0===n&&(n=new Int32Array(t),es[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function ls(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function cs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ss(n,t))return;e.uniform2fv(this.addr,t),as(n,t)}}function hs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ss(n,t))return;e.uniform3fv(this.addr,t),as(n,t)}}function us(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ss(n,t))return;e.uniform4fv(this.addr,t),as(n,t)}}function ds(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ss(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),as(n,t)}else{if(ss(n,i))return;is.set(i),e.uniformMatrix2fv(this.addr,!1,is),as(n,i)}}function ps(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ss(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),as(n,t)}else{if(ss(n,i))return;ns.set(i),e.uniformMatrix3fv(this.addr,!1,ns),as(n,i)}}function fs(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ss(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),as(n,t)}else{if(ss(n,i))return;ts.set(i),e.uniformMatrix4fv(this.addr,!1,ts),as(n,i)}}function ms(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function As(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ss(n,t))return;e.uniform2iv(this.addr,t),as(n,t)}}function gs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ss(n,t))return;e.uniform3iv(this.addr,t),as(n,t)}}function vs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ss(n,t))return;e.uniform4iv(this.addr,t),as(n,t)}}function ys(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function xs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ss(n,t))return;e.uniform2uiv(this.addr,t),as(n,t)}}function _s(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ss(n,t))return;e.uniform3uiv(this.addr,t),as(n,t)}}function Es(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ss(n,t))return;e.uniform4uiv(this.addr,t),as(n,t)}}function ws(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||qr,r)}function Cs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Kr,r)}function bs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Zr,r)}function Ms(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Yr,r)}function Ss(e,t){e.uniform1fv(this.addr,t)}function Is(e,t){const n=rs(t,this.size,2);e.uniform2fv(this.addr,n)}function Bs(e,t){const n=rs(t,this.size,3);e.uniform3fv(this.addr,n)}function Ts(e,t){const n=rs(t,this.size,4);e.uniform4fv(this.addr,n)}function Rs(e,t){const n=rs(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ds(e,t){const n=rs(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ls(e,t){const n=rs(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ps(e,t){e.uniform1iv(this.addr,t)}function Fs(e,t){e.uniform2iv(this.addr,t)}function Us(e,t){e.uniform3iv(this.addr,t)}function Os(e,t){e.uniform4iv(this.addr,t)}function Ns(e,t){e.uniform1uiv(this.addr,t)}function ks(e,t){e.uniform2uiv(this.addr,t)}function Gs(e,t){e.uniform3uiv(this.addr,t)}function Qs(e,t){e.uniform4uiv(this.addr,t)}function zs(e,t,n){const i=this.cache,r=t.length,s=os(n,r);ss(i,s)||(e.uniform1iv(this.addr,s),as(i,s));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||qr,s[e])}function Hs(e,t,n){const i=this.cache,r=t.length,s=os(n,r);ss(i,s)||(e.uniform1iv(this.addr,s),as(i,s));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||Kr,s[e])}function Vs(e,t,n){const i=this.cache,r=t.length,s=os(n,r);ss(i,s)||(e.uniform1iv(this.addr,s),as(i,s));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||Zr,s[e])}function Ws(e,t,n){const i=this.cache,r=t.length,s=os(n,r);ss(i,s)||(e.uniform1iv(this.addr,s),as(i,s));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||Yr,s[e])}class js{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ls;case 35664:return cs;case 35665:return hs;case 35666:return us;case 35674:return ds;case 35675:return ps;case 35676:return fs;case 5124:case 35670:return ms;case 35667:case 35671:return As;case 35668:case 35672:return gs;case 35669:case 35673:return vs;case 5125:return ys;case 36294:return xs;case 36295:return _s;case 36296:return Es;case 35678:case 36198:case 36298:case 36306:case 35682:return ws;case 35679:case 36299:case 36307:return Cs;case 35680:case 36300:case 36308:case 36293:return bs;case 36289:case 36303:case 36311:case 36292:return Ms}}(t.type)}}class Xs{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ss;case 35664:return Is;case 35665:return Bs;case 35666:return Ts;case 35674:return Rs;case 35675:return Ds;case 35676:return Ls;case 5124:case 35670:return Ps;case 35667:case 35671:return Fs;case 35668:case 35672:return Us;case 35669:case 35673:return Os;case 5125:return Ns;case 36294:return ks;case 36295:return Gs;case 36296:return Qs;case 35678:case 36198:case 36298:case 36306:case 35682:return zs;case 35679:case 36299:case 36307:return Hs;case 35680:case 36300:case 36308:case 36293:return Vs;case 36289:case 36303:case 36311:case 36292:return Ws}}(t.type)}}class Js{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const qs=/(\w+)(\])?(\[|\.)?/g;function Ys(e,t){e.seq.push(t),e.map[t.id]=t}function Ks(e,t,n){const i=e.name,r=i.length;for(qs.lastIndex=0;;){const s=qs.exec(i),a=qs.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){Ys(n,void 0===c?new js(o,e,t):new Xs(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Js(o),Ys(n,e)),n=e}}}class Zs{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Ks(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function $s(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let ea=0;function ta(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=r;e<s;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function na(e,t){const n=function(e){const t=_t.getPrimaries(_t.workingColorSpace),n=_t.getPrimaries(e);let i;switch(t===n?i="":t===ke&&n===Ne?i="LinearDisplayP3ToLinearSRGB":t===Ne&&n===ke&&(i="LinearSRGBToLinearDisplayP3"),e){case Le:case Fe:return[i,"LinearTransferOETF"];case De:case Pe:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function ia(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ra(e){return""!==e}function sa(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function aa(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const oa=/^[ \t]*#include +<([\w\d./]+)>/gm;function la(e){return e.replace(oa,ha)}const ca=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function ha(e,t){let n=pr[t];if(void 0===n){const e=ca.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=pr[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return la(n)}const ua=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function da(e){return e.replace(ua,pa)}function pa(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function fa(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ma(e,t,n,i){const r=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case u:case d:t="ENVMAP_TYPE_CUBE";break;case m:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===d&&(t="ENVMAP_MODE_REFRACTION");return t}(n),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),f=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),A=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ra).join("\n")}(n),g=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),v=r.createProgram();let y,x,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g].filter(ra).join("\n"),y.length>0&&(y+="\n"),x=[A,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g].filter(ra).join("\n"),x.length>0&&(x+="\n")):(y=[fa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ra).join("\n"),x=[A,fa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?pr.tonemapping_pars_fragment:"",0!==n.toneMapping?ia("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",pr.colorspace_pars_fragment,na("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ra).join("\n")),a=la(a),a=sa(a,n),a=aa(a,n),o=la(o),o=sa(o,n),o=aa(o,n),a=da(a),o=da(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,x=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===ze?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ze?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const E=_+y+a,w=_+x+o,C=$s(r,r.VERTEX_SHADER,E),b=$s(r,r.FRAGMENT_SHADER,w);function M(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(v).trim(),i=r.getShaderInfoLog(C).trim(),s=r.getShaderInfoLog(b).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(v,r.LINK_STATUS))if(a=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,v,C,b);else{const e=ta(r,C,"vertex"),t=ta(r,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+t)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:y},fragmentShader:{log:s,prefix:x}})}r.deleteShader(C),r.deleteShader(b),S=new Zs(r,v),I=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(r,v)}let S,I;r.attachShader(v,C),r.attachShader(v,b),void 0!==n.index0AttributeName?r.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v),this.getUniforms=function(){return void 0===S&&M(this),S},this.getAttributes=function(){return void 0===I&&M(this),I};let B=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===B&&(B=r.getProgramParameter(v,37297)),B},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ea++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=C,this.fragmentShader=b,this}let Aa=0;class ga{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new va(e),t.set(e,n)),n}}class va{constructor(e){this.id=Aa++,this.code=e,this.usedTimes=0}}function ya(e,t,n,i,s,a,o){const l=new bn,c=new ga,h=[],u=s.isWebGL2,d=s.logarithmicDepthBuffer,p=s.vertexTextures;let f=s.precision;const A={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,l,h,v,y){const x=v.fog,_=y.geometry,E=a.isMeshStandardMaterial?v.environment:null,w=(a.isMeshStandardMaterial?n:t).get(a.envMap||E),C=w&&w.mapping===m?w.image.height:null,b=A[a.type];null!==a.precision&&(f=s.getMaxPrecision(a.precision),f!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));const M=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,S=void 0!==M?M.length:0;let I,B,T,R,D=0;if(void 0!==_.morphAttributes.position&&(D=1),void 0!==_.morphAttributes.normal&&(D=2),void 0!==_.morphAttributes.color&&(D=3),b){const e=mr[b];I=e.vertexShader,B=e.fragmentShader}else I=a.vertexShader,B=a.fragmentShader,c.update(a),T=c.getVertexShaderID(a),R=c.getFragmentShaderID(a);const L=e.getRenderTarget(),P=!0===y.isInstancedMesh,F=!!a.map,U=!!a.matcap,O=!!w,N=!!a.aoMap,k=!!a.lightMap,G=!!a.bumpMap,Q=!!a.normalMap,z=!!a.displacementMap,H=!!a.emissiveMap,V=!!a.metalnessMap,W=!!a.roughnessMap,j=a.anisotropy>0,X=a.clearcoat>0,J=a.iridescence>0,q=a.sheen>0,Y=a.transmission>0,K=j&&!!a.anisotropyMap,Z=X&&!!a.clearcoatMap,$=X&&!!a.clearcoatNormalMap,ee=X&&!!a.clearcoatRoughnessMap,te=J&&!!a.iridescenceMap,ne=J&&!!a.iridescenceThicknessMap,ie=q&&!!a.sheenColorMap,re=q&&!!a.sheenRoughnessMap,se=!!a.specularMap,ae=!!a.specularColorMap,oe=!!a.specularIntensityMap,le=Y&&!!a.transmissionMap,ce=Y&&!!a.thicknessMap,he=!!a.gradientMap,ue=!!a.alphaMap,de=a.alphaTest>0,pe=!!a.alphaHash,fe=!!a.extensions,me=!!_.attributes.uv1,Ae=!!_.attributes.uv2,ge=!!_.attributes.uv3;let ve=0;return a.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(ve=e.toneMapping)),{isWebGL2:u,shaderID:b,shaderType:a.type,shaderName:a.name,vertexShader:I,fragmentShader:B,defines:a.defines,customVertexShaderID:T,customFragmentShaderID:R,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:P,instancingColor:P&&null!==y.instanceColor,supportsVertexTextures:p,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Le,map:F,matcap:U,envMap:O,envMapMode:O&&w.mapping,envMapCubeUVHeight:C,aoMap:N,lightMap:k,bumpMap:G,normalMap:Q,displacementMap:p&&z,emissiveMap:H,normalMapObjectSpace:Q&&1===a.normalMapType,normalMapTangentSpace:Q&&0===a.normalMapType,metalnessMap:V,roughnessMap:W,anisotropy:j,anisotropyMap:K,clearcoat:X,clearcoatMap:Z,clearcoatNormalMap:$,clearcoatRoughnessMap:ee,iridescence:J,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:q,sheenColorMap:ie,sheenRoughnessMap:re,specularMap:se,specularColorMap:ae,specularIntensityMap:oe,transmission:Y,transmissionMap:le,thicknessMap:ce,gradientMap:he,opaque:!1===a.transparent&&a.blending===r,alphaMap:ue,alphaTest:de,alphaHash:pe,combine:a.combine,mapUv:F&&g(a.map.channel),aoMapUv:N&&g(a.aoMap.channel),lightMapUv:k&&g(a.lightMap.channel),bumpMapUv:G&&g(a.bumpMap.channel),normalMapUv:Q&&g(a.normalMap.channel),displacementMapUv:z&&g(a.displacementMap.channel),emissiveMapUv:H&&g(a.emissiveMap.channel),metalnessMapUv:V&&g(a.metalnessMap.channel),roughnessMapUv:W&&g(a.roughnessMap.channel),anisotropyMapUv:K&&g(a.anisotropyMap.channel),clearcoatMapUv:Z&&g(a.clearcoatMap.channel),clearcoatNormalMapUv:$&&g(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&g(a.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&g(a.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&g(a.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&g(a.sheenColorMap.channel),sheenRoughnessMapUv:re&&g(a.sheenRoughnessMap.channel),specularMapUv:se&&g(a.specularMap.channel),specularColorMapUv:ae&&g(a.specularColorMap.channel),specularIntensityMapUv:oe&&g(a.specularIntensityMap.channel),transmissionMapUv:le&&g(a.transmissionMap.channel),thicknessMapUv:ce&&g(a.thicknessMap.channel),alphaMapUv:ue&&g(a.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(Q||j),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,vertexUv1s:me,vertexUv2s:Ae,vertexUv3s:ge,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(F||ue),fog:!!x,useFog:!0===a.fog,fogExp2:x&&x.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:S,morphTextureStride:D,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:ve,useLegacyLights:e._useLegacyLights,decodeVideoTexture:F&&!0===a.map.isVideoTexture&&_t.getTransfer(a.map.colorSpace)===Oe,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:fe&&!0===a.extensions.derivatives,extensionFragDepth:fe&&!0===a.extensions.fragDepth,extensionDrawBuffers:fe&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:fe&&!0===a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){l.disableAll(),t.isWebGL2&&l.enable(0);t.supportsVertexTextures&&l.enable(1);t.instancing&&l.enable(2);t.instancingColor&&l.enable(3);t.matcap&&l.enable(4);t.envMap&&l.enable(5);t.normalMapObjectSpace&&l.enable(6);t.normalMapTangentSpace&&l.enable(7);t.clearcoat&&l.enable(8);t.iridescence&&l.enable(9);t.alphaTest&&l.enable(10);t.vertexColors&&l.enable(11);t.vertexAlphas&&l.enable(12);t.vertexUv1s&&l.enable(13);t.vertexUv2s&&l.enable(14);t.vertexUv3s&&l.enable(15);t.vertexTangents&&l.enable(16);t.anisotropy&&l.enable(17);t.alphaHash&&l.enable(18);e.push(l.mask),l.disableAll(),t.fog&&l.enable(0);t.useFog&&l.enable(1);t.flatShading&&l.enable(2);t.logarithmicDepthBuffer&&l.enable(3);t.skinning&&l.enable(4);t.morphTargets&&l.enable(5);t.morphNormals&&l.enable(6);t.morphColors&&l.enable(7);t.premultipliedAlpha&&l.enable(8);t.shadowMapEnabled&&l.enable(9);t.useLegacyLights&&l.enable(10);t.doubleSided&&l.enable(11);t.flipSided&&l.enable(12);t.useDepthPacking&&l.enable(13);t.dithering&&l.enable(14);t.transmission&&l.enable(15);t.sheen&&l.enable(16);t.opaque&&l.enable(17);t.pointsUvs&&l.enable(18);t.decodeVideoTexture&&l.enable(19);e.push(l.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=A[e.type];let n;if(t){const e=mr[t];n=qi.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=h.length;e<t;e++){const t=h[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new ma(e,n,t,a),h.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:h,dispose:function(){c.dispose()}}}function xa(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function _a(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ea(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function wa(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||_a),i.length>1&&i.sort(t||Ea),r.length>1&&r.sort(t||Ea)}}}function Ca(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new wa,e.set(t,[r])):n>=i.length?(r=new wa,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function ba(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Ot,color:new ni};break;case"SpotLight":n={position:new Ot,direction:new Ot,color:new ni,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ot,color:new ni,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ot,skyColor:new ni,groundColor:new ni};break;case"RectAreaLight":n={color:new ni,position:new Ot,halfWidth:new Ot,halfHeight:new Ot}}return e[t.id]=n,n}}}let Ma=0;function Sa(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ia(e,t){const n=new ba,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new Ot);const s=new Ot,a=new fn,o=new fn;return{setup:function(s,a){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,A=0,g=0,v=0,y=0,x=0;s.sort(Sa);const _=!0===a?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],a=t.color,E=t.intensity,w=t.distance,C=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*E*_,l+=a.g*E*_,c+=a.b*E*_;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],E);x++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[h]=n,r.directionalShadowMap[h]=C,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(E*_),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;const s=t.shadow;if(t.map&&(r.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,t.castShadow){const e=i.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=C,g++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(E),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=C,r.pointShadowMatrix[u]=t.shadow.matrix,A++}r.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(E*_),e.groundColor.copy(t.groundColor).multiplyScalar(E*_),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=fr.LTC_FLOAT_1,r.rectAreaLTC2=fr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=fr.LTC_HALF_1,r.rectAreaLTC2=fr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;const E=r.hash;E.directionalLength===h&&E.pointLength===u&&E.spotLength===d&&E.rectAreaLength===p&&E.hemiLength===f&&E.numDirectionalShadows===m&&E.numPointShadows===A&&E.numSpotShadows===g&&E.numSpotMaps===v&&E.numLightProbes===x||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=g+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,r.numLightProbes=x,E.directionalLength=h,E.pointLength=u,E.spotLength=d,E.rectAreaLength=p,E.hemiLength=f,E.numDirectionalShadows=m,E.numPointShadows=A,E.numSpotShadows=g,E.numSpotMaps=v,E.numLightProbes=x,r.version=Ma++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),h++}}},state:r}}function Ba(e,t){const n=new Ia(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Ta(e,t){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let a;return void 0===s?(a=new Ba(e,t),n.set(i,[a])):r>=s.length?(a=new Ba(e,t),s.push(a)):a=s[r],a},dispose:function(){n=new WeakMap}}}class Ra extends si{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Da extends si{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function La(e,t,n){let i=new cr;const r=new ot,s=new ot,a=new Rt,o=new Ra({depthPacking:Te}),l=new Da,c={},h=n.maxTextureSize,u={0:1,1:0,2:2},d=new Yi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ot},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new bi;f.setAttribute("position",new fi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Hi(f,d),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let g=this.type;function v(n,i){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Lt(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,m,null)}function x(t,n,i,r){let s=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=i}return s}function _(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=r[c.materialIndex];if(h&&h.visible){const t=x(n,h,a,o);e.renderBufferDirect(s,null,i,t,n,c)}}}else if(r.visible){const t=x(n,r,a,o);e.renderBufferDirect(s,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)_(l[e],r,s,a,o)}this.render=function(t,n,o){if(!1===A.enabled)return;if(!1===A.autoUpdate&&!1===A.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==g&&3===this.type,f=3===g&&3!==this.type;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const m=u.getFrameExtents();if(r.multiply(m),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/m.x),r.x=s.x*m.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/m.y),r.y=s.y*m.y,u.mapSize.y=s.y)),null===u.map||!0===p||!0===f){const e=3!==this.type?{minFilter:y,magFilter:y}:{};null!==u.map&&u.map.dispose(),u.map=new Lt(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const A=u.getViewportCount();for(let e=0;e<A;e++){const t=u.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),u.updateMatrices(c,e),i=u.getFrustum(),_(n,o,u.camera,c,this.type)}!0!==u.isPointLightShadow&&3===this.type&&v(u,o),u.needsUpdate=!1}g=this.type,A.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function Pa(e,t,n){const i=n.isWebGL2;const l=new function(){let t=!1;const n=new Rt;let i=null;const r=new Rt(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},c=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?j(e.DEPTH_TEST):X(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},h=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?j(e.STENCIL_TEST):X(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&s===a||(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},u=new WeakMap,d=new WeakMap;let p={},f={},m=new WeakMap,A=[],g=null,v=!1,y=null,x=null,_=null,E=null,w=null,C=null,b=null,M=new ni(0,0,0),S=0,I=!1,B=null,T=null,R=null,D=null,L=null;const P=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,U=0;const O=e.getParameter(e.VERSION);-1!==O.indexOf("WebGL")?(U=parseFloat(/^WebGL (\d)/.exec(O)[1]),F=U>=1):-1!==O.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),F=U>=2);let N=null,k={};const G=e.getParameter(e.SCISSOR_BOX),Q=e.getParameter(e.VIEWPORT),z=(new Rt).fromArray(G),H=(new Rt).fromArray(Q);function V(t,n,r,s){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const W={};function j(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function X(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}W[e.TEXTURE_2D]=V(e.TEXTURE_2D,e.TEXTURE_2D,1),W[e.TEXTURE_CUBE_MAP]=V(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(W[e.TEXTURE_2D_ARRAY]=V(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),W[e.TEXTURE_3D]=V(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),l.setClear(0,0,0,1),c.setClear(1),h.setClear(0),j(e.DEPTH_TEST),c.setFunc(3),K(!1),Z(1),j(e.CULL_FACE),Y(0);const J={[s]:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(i)J[103]=e.MIN,J[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(J[103]=e.MIN_EXT,J[104]=e.MAX_EXT)}const q={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,[a]:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,[o]:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA,211:e.CONSTANT_COLOR,212:e.ONE_MINUS_CONSTANT_COLOR,213:e.CONSTANT_ALPHA,214:e.ONE_MINUS_CONSTANT_ALPHA};function Y(t,n,i,a,o,l,c,h,u,d){if(0!==t){if(!1===v&&(j(e.BLEND),v=!0),5===t)o=o||n,l=l||i,c=c||a,n===x&&o===w||(e.blendEquationSeparate(J[n],J[o]),x=n,w=o),i===_&&a===E&&l===C&&c===b||(e.blendFuncSeparate(q[i],q[a],q[l],q[c]),_=i,E=a,C=l,b=c),!1!==h.equals(M)&&u===S||(e.blendColor(h.r,h.g,h.b,u),M.copy(h),S=u),y=t,I=!1;else if(t!==y||d!==I){if(x===s&&w===s||(e.blendEquation(e.FUNC_ADD),x=s,w=s),d)switch(t){case r:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case r:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,E=null,C=null,b=null,M.set(0,0,0),S=0,y=t,I=d}}else!0===v&&(X(e.BLEND),v=!1)}function K(t){B!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),B=t)}function Z(t){0!==t?(j(e.CULL_FACE),t!==T&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):X(e.CULL_FACE),T=t}function $(t,n,i){t?(j(e.POLYGON_OFFSET_FILL),D===n&&L===i||(e.polygonOffset(n,i),D=n,L=i)):X(e.POLYGON_OFFSET_FILL)}return{buffers:{color:l,depth:c,stencil:h},enable:j,disable:X,bindFramebuffer:function(t,n){return f[t]!==n&&(e.bindFramebuffer(t,n),f[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(f[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(f[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let s=A,a=!1;if(i)if(s=m.get(r),void 0===s&&(s=[],m.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)s[n]=e.COLOR_ATTACHMENT0+n;s.length=t.length,a=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,a=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,a=!0);a&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return g!==t&&(e.useProgram(t),g=t,!0)},setBlending:Y,setMaterial:function(t,n){2===t.side?X(e.CULL_FACE):j(e.CULL_FACE);let i=1===t.side;n&&(i=!i),K(i),t.blending===r&&!1===t.transparent?Y(0):Y(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),c.setFunc(t.depthFunc),c.setTest(t.depthTest),c.setMask(t.depthWrite),l.setMask(t.colorWrite);const s=t.stencilWrite;h.setTest(s),s&&(h.setMask(t.stencilWriteMask),h.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),h.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?j(e.SAMPLE_ALPHA_TO_COVERAGE):X(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:K,setCullFace:Z,setLineWidth:function(t){t!==R&&(F&&e.lineWidth(t),R=t)},setPolygonOffset:$,setScissorTest:function(t){t?j(e.SCISSOR_TEST):X(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+P-1),N!==t&&(e.activeTexture(t),N=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===N?e.TEXTURE0+P-1:N);let r=k[i];void 0===r&&(r={type:void 0,texture:void 0},k[i]=r),r.type===t&&r.texture===n||(N!==i&&(e.activeTexture(i),N=i),e.bindTexture(t,n||W[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=k[N];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=d.get(n);void 0===i&&(i=new WeakMap,d.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=d.get(n).get(t);u.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),u.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===z.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),z.copy(t))},viewport:function(t){!1===H.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),H.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),p={},N=null,k={},f={},m=new WeakMap,A=[],g=null,v=!1,y=null,x=null,_=null,E=null,w=null,C=null,b=null,M=new ni(0,0,0),S=0,I=!1,B=null,T=null,R=null,D=null,L=null,z.set(0,0,e.canvas.width,e.canvas.height),H.set(0,0,e.canvas.width,e.canvas.height),l.reset(),c.reset(),h.reset()}}}function Fa(e,t,n,i,r,s,a){const o=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const b=new WeakMap;let I=!1;try{I="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function D(e,t){return I?new OffscreenCanvas(e,t):pt("canvas")}function L(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?it:Math.floor,s=i(r*e.width),a=i(r*e.height);void 0===m&&(m=D(s,a));const o=n?D(s,a):m;o.width=s,o.height=a;return o.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function N(e){return tt(e.width)&&tt(e.height)}function k(e,t){return e.generateMipmaps&&t&&e.minFilter!==y&&e.minFilter!==E}function G(t){e.generateMipmap(t)}function Q(n,i,r,s,a=!1){if(!1===o)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.R8UI),r===e.UNSIGNED_SHORT&&(l=e.R16UI),r===e.UNSIGNED_INT&&(l=e.R32UI),r===e.BYTE&&(l=e.R8I),r===e.SHORT&&(l=e.R16I),r===e.INT&&(l=e.R32I)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA){const t=a?Ue:_t.getTransfer(s);r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=t===Oe?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function z(e,t,n){return!0===k(e,n)||e.isFramebufferTexture&&e.minFilter!==y&&e.minFilter!==E?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function H(t){return t===y||t===x||t===_?e.NEAREST:e.LINEAR}function V(e){const t=e.target;t.removeEventListener("dispose",V),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=b.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&j(e),0===Object.keys(r).length&&b.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function W(t){const n=t.target;n.removeEventListener("dispose",W),function(t){const n=t.texture,r=i.get(t),s=i.get(n);void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let n=0;n<r.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(r.__webglFramebuffer[t][n]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function j(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete b.get(r)[n.__cacheKey],a.memory.textures--}let X=0;function J(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void ee(s,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const q={[A]:e.REPEAT,[g]:e.CLAMP_TO_EDGE,[v]:e.MIRRORED_REPEAT},Y={[y]:e.NEAREST,[x]:e.NEAREST_MIPMAP_NEAREST,[_]:e.NEAREST_MIPMAP_LINEAR,[E]:e.LINEAR,[w]:e.LINEAR_MIPMAP_NEAREST,[C]:e.LINEAR_MIPMAP_LINEAR},K={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function Z(n,s,a){if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,q[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,q[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,q[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,Y[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,Y[s.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS===g&&s.wrapT===g||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,H(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,H(s.minFilter)),s.minFilter!==y&&s.minFilter!==E&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,K[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===y)return;if(s.minFilter!==_&&s.minFilter!==C)return;if(s.type===T&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&s.type===R&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function $(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",V));const r=n.source;let s=b.get(r);void 0===s&&(s={},b.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&j(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}function ee(t,r,a){let l=e.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(l=e.TEXTURE_3D);const c=$(t,r),u=r.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const d=i.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+a);const t=_t.getPrimaries(_t.workingColorSpace),i=r.colorSpace===Re?null:_t.getPrimaries(r.colorSpace),p=r.colorSpace===Re||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(e){return!o&&(e.wrapS!==g||e.wrapT!==g||e.minFilter!==y&&e.minFilter!==E)}(r)&&!1===N(r.image);let m=L(r.image,f,!1,h);m=ae(r,m);const A=N(m)||o,v=s.convert(r.format,r.colorSpace);let x,_=s.convert(r.type),w=Q(r.internalFormat,v,_,r.colorSpace,r.isVideoTexture);Z(l,r,A);const C=r.mipmaps,b=o&&!0!==r.isVideoTexture,M=void 0===d.__version||!0===c,I=z(r,m,A);if(r.isDepthTexture)w=e.DEPTH_COMPONENT,o?w=r.type===T?e.DEPTH_COMPONENT32F:r.type===B?e.DEPTH_COMPONENT24:r.type===P?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===T&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===U&&w===e.DEPTH_COMPONENT&&r.type!==S&&r.type!==B&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=B,_=s.convert(r.type)),r.format===O&&w===e.DEPTH_COMPONENT&&(w=e.DEPTH_STENCIL,r.type!==P&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=P,_=s.convert(r.type))),M&&(b?n.texStorage2D(e.TEXTURE_2D,1,w,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,w,m.width,m.height,0,v,_,null));else if(r.isDataTexture)if(C.length>0&&A){b&&M&&n.texStorage2D(e.TEXTURE_2D,I,w,C[0].width,C[0].height);for(let t=0,i=C.length;t<i;t++)x=C[t],b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,x.width,x.height,v,_,x.data):n.texImage2D(e.TEXTURE_2D,t,w,x.width,x.height,0,v,_,x.data);r.generateMipmaps=!1}else b?(M&&n.texStorage2D(e.TEXTURE_2D,I,w,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,v,_,m.data)):n.texImage2D(e.TEXTURE_2D,0,w,m.width,m.height,0,v,_,m.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){b&&M&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,w,C[0].width,C[0].height,m.depth);for(let t=0,i=C.length;t<i;t++)x=C[t],r.format!==F?null!==v?b?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,x.width,x.height,m.depth,v,x.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,w,x.width,x.height,m.depth,0,x.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,x.width,x.height,m.depth,v,_,x.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,w,x.width,x.height,m.depth,0,v,_,x.data)}else{b&&M&&n.texStorage2D(e.TEXTURE_2D,I,w,C[0].width,C[0].height);for(let t=0,i=C.length;t<i;t++)x=C[t],r.format!==F?null!==v?b?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,x.width,x.height,v,x.data):n.compressedTexImage2D(e.TEXTURE_2D,t,w,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,x.width,x.height,v,_,x.data):n.texImage2D(e.TEXTURE_2D,t,w,x.width,x.height,0,v,_,x.data)}else if(r.isDataArrayTexture)b?(M&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,w,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,v,_,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,w,m.width,m.height,m.depth,0,v,_,m.data);else if(r.isData3DTexture)b?(M&&n.texStorage3D(e.TEXTURE_3D,I,w,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,v,_,m.data)):n.texImage3D(e.TEXTURE_3D,0,w,m.width,m.height,m.depth,0,v,_,m.data);else if(r.isFramebufferTexture){if(M)if(b)n.texStorage2D(e.TEXTURE_2D,I,w,m.width,m.height);else{let t=m.width,i=m.height;for(let r=0;r<I;r++)n.texImage2D(e.TEXTURE_2D,r,w,t,i,0,v,_,null),t>>=1,i>>=1}}else if(C.length>0&&A){b&&M&&n.texStorage2D(e.TEXTURE_2D,I,w,C[0].width,C[0].height);for(let t=0,i=C.length;t<i;t++)x=C[t],b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,v,_,x):n.texImage2D(e.TEXTURE_2D,t,w,v,_,x);r.generateMipmaps=!1}else b?(M&&n.texStorage2D(e.TEXTURE_2D,I,w,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,v,_,m)):n.texImage2D(e.TEXTURE_2D,0,w,v,_,m);k(r,A)&&G(l),d.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function te(t,r,a,o,l,c){const h=s.convert(a.format,a.colorSpace),u=s.convert(a.type),p=Q(a.internalFormat,h,u,a.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,i,r.depth,0,h,u,null):n.texImage2D(l,c,p,t,i,0,h,u,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),se(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,0,re(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function ne(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=!0===o?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||se(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===T?r=e.DEPTH_COMPONENT32F:t.type===B&&(r=e.DEPTH_COMPONENT24));const i=re(n);se(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=re(n);i&&!1===se(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):se(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const a=t[r],o=s.convert(a.format,a.colorSpace),l=s.convert(a.type),c=Q(a.internalFormat,o,l,a.colorSpace),h=re(n);i&&!1===se(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,c,n.width,n.height):se(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function ie(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),J(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=re(r);if(r.depthTexture.format===U)se(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==O)throw new Error("Unknown depthTexture format");se(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),ne(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),ne(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function re(e){return Math.min(u,e.samples)}function se(e){const n=i.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ae(e,n){const i=e.colorSpace,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===He||i!==Le&&i!==Re&&(_t.getTransfer(i)===Oe?!1===o?!0===t.has("EXT_sRGB")&&r===F?(e.format=He,e.minFilter=E,e.generateMipmaps=!1):n=bt.sRGBToLinear(n):r===F&&s===M||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=X;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),X+=1,e},this.resetTextureUnits=function(){X=0},this.setTexture2D=J,this.setTexture2DArray=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?ee(s,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?ee(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;const l=$(t,r),h=r.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const u=i.get(h);if(h.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+a);const t=_t.getPrimaries(_t.workingColorSpace),i=r.colorSpace===Re?null:_t.getPrimaries(r.colorSpace),d=r.colorSpace===Re||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=r.isCompressedTexture||r.image[0].isCompressedTexture,f=r.image[0]&&r.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=p||f?f?r.image[e].image:r.image[e]:L(r.image[e],!1,!0,c),m[e]=ae(r,m[e]);const A=m[0],g=N(A)||o,v=s.convert(r.format,r.colorSpace),y=s.convert(r.type),x=Q(r.internalFormat,v,y,r.colorSpace),_=o&&!0!==r.isVideoTexture,E=void 0===u.__version||!0===l;let w,C=z(r,A,g);if(Z(e.TEXTURE_CUBE_MAP,r,g),p){_&&E&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,x,A.width,A.height);for(let t=0;t<6;t++){w=m[t].mipmaps;for(let i=0;i<w.length;i++){const s=w[i];r.format!==F?null!==v?_?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,v,s.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,x,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,v,y,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,x,s.width,s.height,0,v,y,s.data)}}}else{w=r.mipmaps,_&&E&&(w.length>0&&C++,n.texStorage2D(e.TEXTURE_CUBE_MAP,C,x,m[0].width,m[0].height));for(let t=0;t<6;t++)if(f){_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,v,y,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,x,m[t].width,m[t].height,0,v,y,m[t].data);for(let i=0;i<w.length;i++){const r=w[i].image[t].image;_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,v,y,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,x,r.width,r.height,0,v,y,r.data)}}else{_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,v,y,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,x,v,y,m[t]);for(let i=0;i<w.length;i++){const r=w[i];_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,v,y,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,x,v,y,r.image[t])}}}k(r,g)&&G(e.TEXTURE_CUBE_MAP),u.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,r):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+r)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&te(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&ie(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),h=i.get(l);t.addEventListener("dispose",W),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=l.version,a.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=N(t)||o;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===se(t)){const i=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const a=s.convert(r.format,r.colorSpace),o=s.convert(r.type),l=Q(r.internalFormat,a,o,r.colorSpace,!0===t.isXRRenderTarget),h=re(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),ne(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),Z(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)te(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else te(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);k(l,p)&&G(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const r=t.texture;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),Z(e.TEXTURE_2D,a,p),te(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),k(a,p)&&G(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,h.__webglTexture),Z(i,l,p),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)te(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else te(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);k(l,p)&&G(i),n.unbindTexture()}t.depthBuffer&&ie(t)},this.updateRenderTargetMipmap=function(t){const r=N(t)||o,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(k(o,r)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=i.get(o).__webglTexture;n.bindTexture(r,s),G(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===se(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=i.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),u&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),u){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),u)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=te,this.useMultisampledRTT=se}function Ua(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=""){let s;const a=_t.getTransfer(r);if(n===M)return e.UNSIGNED_BYTE;if(n===D)return e.UNSIGNED_SHORT_4_4_4_4;if(n===L)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===S)return e.UNSIGNED_SHORT;if(n===I)return e.INT;if(n===B)return e.UNSIGNED_INT;if(n===T)return e.FLOAT;if(n===R)return i?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===F)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===U)return e.DEPTH_COMPONENT;if(n===O)return e.DEPTH_STENCIL;if(n===He)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===N)return e.RED;if(n===k)return e.RED_INTEGER;if(n===G)return e.RG;if(n===Q)return e.RG_INTEGER;if(n===z)return e.RGBA_INTEGER;if(n===H||n===V||n===W||n===j)if(a===Oe){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===H)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===V)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===W)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===j)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===H)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===V)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===W)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===j)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===X||n===J||n===q||n===Y){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===X)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===J)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===q)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Y)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===K)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Z||n===$){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===Z)return a===Oe?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===$)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===ee||n===te||n===ne||n===ie||n===re||n===se||n===ae||n===oe||n===le||n===ce||n===he||n===ue||n===de||n===pe){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===ee)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===te)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ne)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ie)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===re)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===se)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ae)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===oe)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===le)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ce)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===he)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ue)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===de)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===pe)return a===Oe?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===fe||n===me||n===Ae){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(n===fe)return a===Oe?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===me)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Ae)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===ge||n===ve||n===ye){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===fe)return s.COMPRESSED_RED_RGTC1_EXT;if(n===ge)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===ve)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===ye)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===P?i?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Oa extends Zi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Na extends kn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ka={type:"move"};class Ga{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Na,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Na,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ot,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ot),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Na,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ot,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ot),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ka)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Na;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Qa extends Tt{constructor(e,t,n,i,r,s,a,o,l,c){if((c=void 0!==c?c:U)!==U&&c!==O)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===U&&(n=B),void 0===n&&c===O&&(n=P),super(null,i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:y,this.minFilter=void 0!==o?o:y,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class za extends je{constructor(e,t){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null;const f=t.getContextAttributes();let m=null,A=null;const g=[],v=[],y=new Zi;y.layers.enable(1),y.viewport=new Rt;const x=new Zi;x.layers.enable(2),x.viewport=new Rt;const _=[y,x],E=new Oa;E.layers.enable(1),E.layers.enable(2);let w=null,C=null;function b(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=g[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function S(){i.removeEventListener("select",b),i.removeEventListener("selectstart",b),i.removeEventListener("selectend",b),i.removeEventListener("squeeze",b),i.removeEventListener("squeezestart",b),i.removeEventListener("squeezeend",b),i.removeEventListener("end",S),i.removeEventListener("inputsourceschange",I);for(let e=0;e<g.length;e++){const t=v[e];null!==t&&(v[e]=null,g[e].disconnect(t))}w=null,C=null,e.setRenderTarget(m),d=null,u=null,h=null,i=null,A=null,N.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,g[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=v.indexOf(n);if(-1===i){for(let e=0;e<g.length;e++){if(e>=v.length){v.push(n),i=e;break}if(null===v[e]){v[e]=n,i=e;break}}if(-1===i)break}const r=g[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new Ga,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new Ga,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new Ga,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",b),i.addEventListener("selectstart",b),i.addEventListener("selectend",b),i.addEventListener("squeeze",b),i.addEventListener("squeezestart",b),i.addEventListener("squeezeend",b),i.addEventListener("end",S),i.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),A=new Lt(d.framebufferWidth,d.framebufferHeight,{format:F,type:M,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,s=null,a=null;f.depth&&(a=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?O:U,s=f.stencil?P:B);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(i,t),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),A=new Lt(u.textureWidth,u.textureHeight,{format:F,type:M,depthTexture:new Qa(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0});e.properties.get(A).__ignoreDepthValues=u.ignoreDepthValues}A.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),N.setContext(i),N.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const T=new Ot,R=new Ot;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;E.near=x.near=y.near=e.near,E.far=x.far=y.far=e.far,w===E.near&&C===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),w=E.near,C=E.far);const t=e.parent,n=E.cameras;D(E,t);for(let e=0;e<n.length;e++)D(n[e],t);2===n.length?function(e,t,n){T.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=T.distanceTo(R),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=i/(-h+u),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const A=a+f,g=o+f,v=d-m,y=p+(i-m),x=l*o/g*A,_=c*o/g*A;e.projectionMatrix.makePerspective(v,y,x,_,A,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,y,x):E.projectionMatrix.copy(y.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Ye*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,t)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let L=null;const N=new hr;N.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||s),p=i,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(A,d.framebuffer),e.setRenderTarget(A));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==d)s=d.getViewport(r);else{const t=h.getViewSubImage(u,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(A,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(A))}let a=_[i];void 0===a&&(a=new Zi,a.layers.enable(i),a.viewport=new Rt,_[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(E.matrix.copy(a.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(a)}}for(let e=0;e<g.length;e++){const t=v[e],n=g[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}L&&L(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}function Ha(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,1===r.side&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),1===r.side&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=t.get(r).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ji(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform));e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));const r=t.get(i).envMap;r&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Va(e,t,n,i){let r={},s={},a=[];const o=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){const n=t.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,u){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;let r=0;for(let e=0,s=t.length;e<s;e++){const s=t[e],a={boundary:0,storage:0},o=Array.isArray(s.value)?s.value:[s.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}if(s.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,e>0){r=n%i;0!==r&&i-r-a.boundary<0&&(n+=i-r,s.__offset=n)}n+=a.storage}r=n%i,r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",h));const p=u.program;i.updateUBOMapping(n,p);const f=t.render.frame;s[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,s)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let s=0;s<i.length;s++){const a=i[s],o=c(a);"number"==typeof a?(n.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,n.__data)):a.isMatrix3?(n.__data[0]=a.elements[0],n.__data[1]=a.elements[1],n.__data[2]=a.elements[2],n.__data[3]=a.elements[0],n.__data[4]=a.elements[3],n.__data[5]=a.elements[4],n.__data[6]=a.elements[5],n.__data[7]=a.elements[0],n.__data[8]=a.elements[6],n.__data[9]=a.elements[7],n.__data[10]=a.elements[8],n.__data[11]=a.elements[0]):(a.toArray(n.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}class Wa{constructor(e={}){const{canvas:n=ft(),context:i=null,depth:r=!0,stencil:s=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==i?i.getContextAttributes().alpha:a;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,A=null;const g=[],v=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=De,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,_=0,E=0,w=null,b=-1,I=null;const U=new Rt,O=new Rt;let N=null;const G=new ni(0);let H=0,V=n.width,W=n.height,j=1,X=null,J=null;const q=new Rt(0,0,V,W),Y=new Rt(0,0,V,W);let K=!1;const Z=new cr;let $=!1,ee=!1,te=null;const ne=new fn,ie=new ot,re=new Ot,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return null===w?j:1}let oe,le,ce,he,ue,de,pe,fe,me,Ae,ge,ve,ye,xe,_e,Ee,we,Ce,be,Me,Se,Ie,Be,Te,Re=i;function Pe(e,t){for(let i=0;i<e.length;i++){const r=e[i],s=n.getContext(r,t);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${t}`),n.addEventListener("webglcontextlost",Oe,!1),n.addEventListener("webglcontextrestored",Ne,!1),n.addEventListener("webglcontextcreationerror",ke,!1),null===Re){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),Re=Pe(t,e),null===Re)throw Pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&Re instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Re.getShaderPrecisionFormat&&(Re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Fe(){oe=new Qr(Re),le=new xr(Re,oe,e),oe.init(le),Ie=new Ua(Re,oe,le),ce=new Pa(Re,oe,le),he=new Vr(Re),ue=new xa,de=new Fa(Re,oe,ce,ue,le,Ie,he),pe=new Er(y),fe=new Gr(y),me=new ur(Re,le),Be=new vr(Re,oe,me,le),Ae=new zr(Re,me,he,Be),ge=new Jr(Re,Ae,me,he),be=new Xr(Re,le,de),Ee=new _r(ue),ve=new ya(y,pe,fe,oe,le,Be,Ee),ye=new Ha(y,ue),xe=new Ca,_e=new Ta(oe,le),Ce=new gr(y,pe,fe,ce,ge,d,l),we=new La(y,ge,le),Te=new Va(Re,he,le,ce),Me=new yr(Re,oe,he,le),Se=new Hr(Re,oe,he,le),he.programs=ve.programs,y.capabilities=le,y.extensions=oe,y.properties=ue,y.renderLists=xe,y.shadowMap=we,y.state=ce,y.info=he}Fe();const Ue=new za(y,Re);function Oe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=he.autoReset,t=we.enabled,n=we.autoUpdate,i=we.needsUpdate,r=we.type;Fe(),he.autoReset=e,we.enabled=t,we.autoUpdate=n,we.needsUpdate=i,we.type=r}function ke(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ge(e){const t=e.target;t.removeEventListener("dispose",Ge),function(e){(function(e){const t=ue.get(e).programs;void 0!==t&&(t.forEach((function(e){ve.releaseProgram(e)})),e.isShaderMaterial&&ve.releaseShaderCache(e))})(e),ue.remove(e)}(t)}function Qe(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ye(e,t,n),e.side=0,e.needsUpdate=!0,Ye(e,t,n),e.side=2):Ye(e,t,n)}this.xr=Ue,this.getContext=function(){return Re},this.getContextAttributes=function(){return Re.getContextAttributes()},this.forceContextLoss=function(){const e=oe.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=oe.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(e){void 0!==e&&(j=e,this.setSize(V,W,!1))},this.getSize=function(e){return e.set(V,W)},this.setSize=function(e,t,i=!0){Ue.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(V=e,W=t,n.width=Math.floor(e*j),n.height=Math.floor(t*j),!0===i&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(V*j,W*j).floor()},this.setDrawingBufferSize=function(e,t,i){V=e,W=t,j=i,n.width=Math.floor(e*i),n.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(U)},this.getViewport=function(e){return e.copy(q)},this.setViewport=function(e,t,n,i){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,n,i),ce.viewport(U.copy(q).multiplyScalar(j).floor())},this.getScissor=function(e){return e.copy(Y)},this.setScissor=function(e,t,n,i){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,n,i),ce.scissor(O.copy(Y).multiplyScalar(j).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(e){ce.setScissorTest(K=e)},this.setOpaqueSort=function(e){X=e},this.setTransparentSort=function(e){J=e},this.getClearColor=function(e){return e.copy(Ce.getClearColor())},this.setClearColor=function(){Ce.setClearColor.apply(Ce,arguments)},this.getClearAlpha=function(){return Ce.getClearAlpha()},this.setClearAlpha=function(){Ce.setClearAlpha.apply(Ce,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==w){const t=w.texture.format;e=t===z||t===Q||t===k}if(e){const e=w.texture.type,t=e===M||e===B||e===S||e===P||e===D||e===L,n=Ce.getClearColor(),i=Ce.getClearAlpha(),r=n.r,s=n.g,a=n.b;t?(p[0]=r,p[1]=s,p[2]=a,p[3]=i,Re.clearBufferuiv(Re.COLOR,0,p)):(f[0]=r,f[1]=s,f[2]=a,f[3]=i,Re.clearBufferiv(Re.COLOR,0,f))}else i|=Re.COLOR_BUFFER_BIT}t&&(i|=Re.DEPTH_BUFFER_BIT),n&&(i|=Re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Re.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Oe,!1),n.removeEventListener("webglcontextrestored",Ne,!1),n.removeEventListener("webglcontextcreationerror",ke,!1),xe.dispose(),_e.dispose(),ue.dispose(),pe.dispose(),fe.dispose(),ge.dispose(),Be.dispose(),Te.dispose(),ve.dispose(),Ue.dispose(),Ue.removeEventListener("sessionstart",He),Ue.removeEventListener("sessionend",Ve),te&&(te.dispose(),te=null),We.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=se);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=se);de.resetTextureUnits();const s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Le,l=(i.isMeshStandardMaterial?fe:pe).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=y.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,v=ue.get(i),x=A.state.lights;if(!0===$&&(!0===ee||e!==I)){const t=e===I&&i.id===b;Ee.setState(i,e,t)}let _=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==x.state.version||v.outputColorSpace!==o||r.isInstancedMesh&&!1===v.instancing?_=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?_=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||v.envMap!==l||!0===i.fog&&v.fog!==s?_=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===Ee.numPlanes&&v.numIntersection===Ee.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==h||v.morphTargets!==u||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||!0===le.isWebGL2&&v.morphTargetsCount!==g)&&(_=!0):_=!0:_=!0:_=!0:(_=!0,v.__version=i.version);let E=v.currentProgram;!0===_&&(E=Ye(i,t,r));let C=!1,M=!1,S=!1;const B=E.getUniforms(),T=v.uniforms;ce.useProgram(E.program)&&(C=!0,M=!0,S=!0);i.id!==b&&(b=i.id,M=!0);if(C||I!==e){B.setValue(Re,"projectionMatrix",e.projectionMatrix),B.setValue(Re,"viewMatrix",e.matrixWorldInverse);const t=B.map.cameraPosition;void 0!==t&&t.setValue(Re,re.setFromMatrixPosition(e.matrixWorld)),le.logarithmicDepthBuffer&&B.setValue(Re,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&B.setValue(Re,"isOrthographic",!0===e.isOrthographicCamera),I!==e&&(I=e,M=!0,S=!0)}if(r.isSkinnedMesh){B.setOptional(Re,r,"bindMatrix"),B.setOptional(Re,r,"bindMatrixInverse");const e=r.skeleton;e&&(le.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),B.setValue(Re,"boneTexture",e.boneTexture,de),B.setValue(Re,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=n.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===le.isWebGL2)&&be.update(r,n,E);(M||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,B.setValue(Re,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(T.envMap.value=l,T.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);M&&(B.setValue(Re,"toneMappingExposure",y.toneMappingExposure),v.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(T,S),s&&!0===i.fog&&ye.refreshFogUniforms(T,s),ye.refreshMaterialUniforms(T,i,j,W,te),Zs.upload(Re,Ke(v),T,de));i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Zs.upload(Re,Ke(v),T,de),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&B.setValue(Re,"center",r.center);if(B.setValue(Re,"modelViewMatrix",r.modelViewMatrix),B.setValue(Re,"normalMatrix",r.normalMatrix),B.setValue(Re,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(le.isWebGL2){const n=e[t];Te.update(n,E),Te.bind(n,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,n,i,r);ce.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=Ae.getWireframeAttribute(n),void 0===l)return;c=2}const h=n.drawRange,u=n.attributes.position;let d=h.start*c,p=(h.start+h.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let m;Be.setup(r,i,o,n,l);let g=Me;if(null!==l&&(m=me.get(l),g=Se,g.setIndex(m)),r.isMesh)!0===i.wireframe?(ce.setLineWidth(i.wireframeLinewidth*ae()),g.setMode(Re.LINES)):g.setMode(Re.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),ce.setLineWidth(e*ae()),r.isLineSegments?g.setMode(Re.LINES):r.isLineLoop?g.setMode(Re.LINE_LOOP):g.setMode(Re.LINE_STRIP)}else r.isPoints?g.setMode(Re.POINTS):r.isSprite&&g.setMode(Re.TRIANGLES);if(r.isInstancedMesh)g.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,f,t)}else g.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),A=_e.get(n),A.init(),v.push(A),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(A.pushLight(e),e.castShadow&&A.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(A.pushLight(e),e.castShadow&&A.pushShadow(e))})),A.setupLights(y._useLegacyLights);const i=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Qe(s,n,e),i.add(s)}else Qe(t,n,e),i.add(t)})),v.pop(),A=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){ue.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==oe.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let ze=null;function He(){We.stop()}function Ve(){We.start()}const We=new hr;function je(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)A.pushLight(e),e.castShadow&&A.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Z.intersectsSprite(e)){i&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne);const t=ge.update(e),r=e.material;r.visible&&m.push(e,t,r,n,re.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||Z.intersectsObject(e))){const t=ge.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),re.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),re.copy(t.boundingSphere.center)),re.applyMatrix4(e.matrixWorld).applyMatrix4(ne)),Array.isArray(r)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&m.push(e,t,o,n,re.z,a)}}else r.visible&&m.push(e,t,r,n,re.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)je(r[e],t,n,i)}function Xe(e,t,n,i){const r=e.opaque,s=e.transmissive,a=e.transparent;A.setupLightsView(n),!0===$&&Ee.setGlobalState(y.clippingPlanes,n),s.length>0&&function(e,t,n,i){const r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;const s=le.isWebGL2;null===te&&(te=new Lt(1,1,{generateMipmaps:!0,type:oe.has("EXT_color_buffer_half_float")?R:M,minFilter:C,samples:s?4:0}));y.getDrawingBufferSize(ie),s?te.setSize(ie.x,ie.y):te.setSize(it(ie.x),it(ie.y));const a=y.getRenderTarget();y.setRenderTarget(te),y.getClearColor(G),H=y.getClearAlpha(),H<1&&y.setClearColor(16777215,.5);y.clear();const o=y.toneMapping;y.toneMapping=0,Je(e,n,i),de.updateMultisampleRenderTarget(te),de.updateRenderTargetMipmap(te);let l=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.object,a=r.geometry,o=r.material,c=r.group;if(2===o.side&&s.layers.test(i.layers)){const e=o.side;o.side=1,o.needsUpdate=!0,qe(s,n,i,a,o,c),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(de.updateMultisampleRenderTarget(te),de.updateRenderTargetMipmap(te));y.setRenderTarget(a),y.setClearColor(G,H),y.toneMapping=o}(r,s,t,n),i&&ce.viewport(U.copy(i)),r.length>0&&Je(r,t,n),s.length>0&&Je(s,t,n),a.length>0&&Je(a,t,n),ce.buffers.depth.setTest(!0),ce.buffers.depth.setMask(!0),ce.buffers.color.setMask(!0),ce.setPolygonOffset(!1)}function Je(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;a.layers.test(n.layers)&&qe(a,t,n,o,l,c)}}function qe(e,t,n,i,r,s){e.onBeforeRender(y,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=2):y.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(y,t,n,i,r,s)}function Ye(e,t,n){!0!==t.isScene&&(t=se);const i=ue.get(e),r=A.state.lights,s=A.state.shadowsArray,a=r.state.version,o=ve.getParameters(e,r.state,s,t,n),l=ve.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?fe:pe).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Ge),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Ze(e,o),h}else o.uniforms=ve.getUniforms(e),e.onBuild(n,o,y),e.onBeforeCompile(o,y),h=ve.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const u=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=Ee.uniform),Ze(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h}function Ke(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Zs.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ze(e,t){const n=ue.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}We.setAnimationLoop((function(e){ze&&ze(e)})),"undefined"!=typeof self&&We.setContext(self),this.setAnimationLoop=function(e){ze=e,Ue.setAnimationLoop(e),null===e?We.stop():We.start()},Ue.addEventListener("sessionstart",He),Ue.addEventListener("sessionend",Ve),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ue.enabled&&!0===Ue.isPresenting&&(!0===Ue.cameraAutoUpdate&&Ue.updateCamera(t),t=Ue.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),A=_e.get(e,v.length),A.init(),v.push(A),ne.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromProjectionMatrix(ne),ee=this.localClippingEnabled,$=Ee.init(this.clippingPlanes,ee),m=xe.get(e,g.length),m.init(),g.push(m),je(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(X,J),this.info.render.frame++,!0===$&&Ee.beginShadows();const n=A.state.shadowsArray;if(we.render(n,e,t),!0===$&&Ee.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ce.render(m,e),A.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Xe(m,e,i,i.viewport)}}else Xe(m,e,t);null!==w&&(de.updateMultisampleRenderTarget(w),de.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),Be.resetDefaultState(),b=-1,I=null,v.pop(),A=v.length>0?v[v.length-1]:null,g.pop(),m=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){ue.get(e.texture).__webglTexture=t,ue.get(e.depthTexture).__webglTexture=n;const i=ue.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===oe.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=ue.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){w=e,_=t,E=n;let i=!0,r=null,s=!1,a=!1;if(e){const o=ue.get(e);void 0!==o.__useDefaultFramebuffer?(ce.bindFramebuffer(Re.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?de.setupRenderTarget(e):o.__hasExternalTextures&&de.rebindTextures(e,ue.get(e.texture).__webglTexture,ue.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=ue.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],s=!0):r=le.isWebGL2&&e.samples>0&&!1===de.useMultisampledRTT(e)?ue.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,U.copy(e.viewport),O.copy(e.scissor),N=e.scissorTest}else U.copy(q).multiplyScalar(j).floor(),O.copy(Y).multiplyScalar(j).floor(),N=K;if(ce.bindFramebuffer(Re.FRAMEBUFFER,r)&&le.drawBuffers&&i&&ce.drawBuffers(e,r),ce.viewport(U),ce.scissor(O),ce.setScissorTest(N),s){const i=ue.get(e.texture);Re.framebufferTexture2D(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(a){const i=ue.get(e.texture),r=t||0;Re.framebufferTextureLayer(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}b=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=ue.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){ce.bindFramebuffer(Re.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(o!==F&&Ie.convert(o)!==Re.getParameter(Re.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===R&&(oe.has("EXT_color_buffer_half_float")||le.isWebGL2&&oe.has("EXT_color_buffer_float"));if(!(l===M||Ie.convert(l)===Re.getParameter(Re.IMPLEMENTATION_COLOR_READ_TYPE)||l===T&&(le.isWebGL2||oe.has("OES_texture_float")||oe.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&Re.readPixels(t,n,i,r,Ie.convert(o),Ie.convert(l),s)}finally{const e=null!==w?ue.get(w).__webglFramebuffer:null;ce.bindFramebuffer(Re.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);de.setTexture2D(t,0),Re.copyTexSubImage2D(Re.TEXTURE_2D,n,0,0,e.x,e.y,r,s),ce.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,s=t.image.height,a=Ie.convert(n.format),o=Ie.convert(n.type);de.setTexture2D(n,0),Re.pixelStorei(Re.UNPACK_FLIP_Y_WEBGL,n.flipY),Re.pixelStorei(Re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Re.pixelStorei(Re.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Re.texSubImage2D(Re.TEXTURE_2D,i,e.x,e.y,r,s,a,o,t.image.data):t.isCompressedTexture?Re.compressedTexSubImage2D(Re.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):Re.texSubImage2D(Re.TEXTURE_2D,i,e.x,e.y,a,o,t.image),0===i&&n.generateMipmaps&&Re.generateMipmap(Re.TEXTURE_2D),ce.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=Ie.convert(i.format),c=Ie.convert(i.type);let h;if(i.isData3DTexture)de.setTexture3D(i,0),h=Re.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");de.setTexture2DArray(i,0),h=Re.TEXTURE_2D_ARRAY}Re.pixelStorei(Re.UNPACK_FLIP_Y_WEBGL,i.flipY),Re.pixelStorei(Re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Re.pixelStorei(Re.UNPACK_ALIGNMENT,i.unpackAlignment);const u=Re.getParameter(Re.UNPACK_ROW_LENGTH),d=Re.getParameter(Re.UNPACK_IMAGE_HEIGHT),p=Re.getParameter(Re.UNPACK_SKIP_PIXELS),f=Re.getParameter(Re.UNPACK_SKIP_ROWS),m=Re.getParameter(Re.UNPACK_SKIP_IMAGES),A=n.isCompressedTexture?n.mipmaps[0]:n.image;Re.pixelStorei(Re.UNPACK_ROW_LENGTH,A.width),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,A.height),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,e.min.x),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,e.min.y),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Re.texSubImage3D(h,r,t.x,t.y,t.z,s,a,o,l,c,A.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Re.compressedTexSubImage3D(h,r,t.x,t.y,t.z,s,a,o,l,A.data)):Re.texSubImage3D(h,r,t.x,t.y,t.z,s,a,o,l,c,A),Re.pixelStorei(Re.UNPACK_ROW_LENGTH,u),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,d),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,p),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,f),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&Re.generateMipmap(h),ce.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?de.setTextureCube(e,0):e.isData3DTexture?de.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?de.setTexture2DArray(e,0):de.setTexture2D(e,0),ce.unbindTexture()},this.resetState=function(){_=0,E=0,w=null,ce.reset(),Be.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ve}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Pe?"display-p3":"srgb",t.unpackColorSpace=_t.workingColorSpace===Fe?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===De?Be:Ie}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Be?De:Le}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class ja extends Wa{}ja.prototype.isWebGL1Renderer=!0;class Xa{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ni(e),this.density=t}clone(){return new Xa(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Ja{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ni(e),this.near=t,this.far=n}clone(){return new Ja(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class qa extends kn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class Ya{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Qe,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ke()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ke()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ke()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ka=new Ot;class Za{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Ka.fromBufferAttribute(this,t),Ka.applyMatrix4(e),this.setXYZ(t,Ka.x,Ka.y,Ka.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ka.fromBufferAttribute(this,t),Ka.applyNormalMatrix(e),this.setXYZ(t,Ka.x,Ka.y,Ka.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ka.fromBufferAttribute(this,t),Ka.transformDirection(e),this.setXYZ(t,Ka.x,Ka.y,Ka.z);return this}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=rt(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=rt(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=rt(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=rt(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array),r=st(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new fi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Za(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $a extends si{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ni(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let eo;const to=new Ot,no=new Ot,io=new Ot,ro=new ot,so=new ot,ao=new fn,oo=new Ot,lo=new Ot,co=new Ot,ho=new ot,uo=new ot,po=new ot;class fo extends kn{constructor(e=new $a){if(super(),this.isSprite=!0,this.type="Sprite",void 0===eo){eo=new bi;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Ya(e,5);eo.setIndex([0,1,2,0,2,3]),eo.setAttribute("position",new Za(t,3,0,!1)),eo.setAttribute("uv",new Za(t,2,3,!1))}this.geometry=eo,this.material=e,this.center=new ot(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),no.setFromMatrixScale(this.matrixWorld),ao.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),io.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&no.multiplyScalar(-io.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;mo(oo.set(-.5,-.5,0),io,s,no,i,r),mo(lo.set(.5,-.5,0),io,s,no,i,r),mo(co.set(.5,.5,0),io,s,no,i,r),ho.set(0,0),uo.set(1,0),po.set(1,1);let a=e.ray.intersectTriangle(oo,lo,co,!1,to);if(null===a&&(mo(lo.set(-.5,.5,0),io,s,no,i,r),uo.set(0,1),a=e.ray.intersectTriangle(oo,co,lo,!1,to),null===a))return;const o=e.ray.origin.distanceTo(to);o<e.near||o>e.far||t.push({distance:o,point:to.clone(),uv:Kn.getInterpolation(to,oo,lo,co,ho,uo,po,new ot),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function mo(e,t,n,i,r,s){ro.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(so.x=s*ro.x-r*ro.y,so.y=r*ro.x+s*ro.y):so.copy(ro),e.copy(t),e.x+=so.x,e.y+=so.y,e.applyMatrix4(ao)}const Ao=new Ot,go=new Ot;class vo extends kn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ao.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ao);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ao.setFromMatrixPosition(e.matrixWorld),go.setFromMatrixPosition(this.matrixWorld);const n=Ao.distanceTo(go)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,i=n.length;e<i;e++){const i=n[e];t.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return t}}const yo=new Ot,xo=new Rt,_o=new Rt,Eo=new Ot,wo=new fn,Co=new Ot,bo=new sn,Mo=new fn,So=new pn;class Io extends Hi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=l,this.bindMatrix=new fn,this.bindMatrixInverse=new fn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Gt),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Co),this.boundingBox.expandByPoint(Co)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new sn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Co),this.boundingSphere.expandByPoint(Co)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),bo.copy(this.boundingSphere),bo.applyMatrix4(i),!1!==e.ray.intersectsSphere(bo)&&(Mo.copy(i).invert(),So.copy(e.ray).applyMatrix4(Mo),null!==this.boundingBox&&!1===So.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,So)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Rt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===l?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===c?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;xo.fromBufferAttribute(i.attributes.skinIndex,e),_o.fromBufferAttribute(i.attributes.skinWeight,e),yo.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=_o.getComponent(e);if(0!==i){const r=xo.getComponent(e);wo.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Eo.copy(yo).applyMatrix4(wo),i)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Bo extends kn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class To extends Tt{constructor(e=null,t=1,n=1,i,r,s,a,o,l=1003,c=1003,h,u){super(null,s,a,o,l,c,i,r,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ro=new fn,Do=new fn;class Lo{constructor(e=[],t=[]){this.uuid=Ke(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new fn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new fn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:Do;Ro.multiplyMatrices(r,t[i]),Ro.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Lo(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=nt(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new To(t,e,e,F,T);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Bo),this.bones.push(r),this.boneInverses.push((new fn).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class Po extends fi{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Fo=new fn,Uo=new fn,Oo=[],No=new Gt,ko=new fn,Go=new Hi,Qo=new sn;class zo extends Hi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Po(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,ko)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Gt),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Fo),No.copy(e.boundingBox).applyMatrix4(Fo),this.boundingBox.union(No)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new sn),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Fo),Qo.copy(e.boundingSphere).applyMatrix4(Fo),this.boundingSphere.union(Qo)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Go.geometry=this.geometry,Go.material=this.material,void 0!==Go.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Qo.copy(this.boundingSphere),Qo.applyMatrix4(n),!1!==e.ray.intersectsSphere(Qo)))for(let r=0;r<i;r++){this.getMatrixAt(r,Fo),Uo.multiplyMatrices(n,Fo),Go.matrixWorld=Uo,Go.raycast(e,Oo);for(let e=0,n=Oo.length;e<n;e++){const n=Oo[e];n.instanceId=r,n.object=this,t.push(n)}Oo.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Po(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ho extends si{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ni(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Vo=new Ot,Wo=new Ot,jo=new fn,Xo=new pn,Jo=new sn;class qo extends kn{constructor(e=new bi,t=new Ho){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Vo.fromBufferAttribute(t,e-1),Wo.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Vo.distanceTo(Wo);e.setAttribute("lineDistance",new gi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Jo.copy(n.boundingSphere),Jo.applyMatrix4(i),Jo.radius+=r,!1===e.ray.intersectsSphere(Jo))return;jo.copy(i).invert(),Xo.copy(e.ray).applyMatrix4(jo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Ot,c=new Ot,h=new Ot,u=new Ot,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r);if(Xo.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(u);s<e.near||s>e.far||t.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1);if(Xo.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Yo=new Ot,Ko=new Ot;class Zo extends qo{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Yo.fromBufferAttribute(t,e),Ko.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Yo.distanceTo(Ko);e.setAttribute("lineDistance",new gi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $o extends qo{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class el extends si{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ni(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const tl=new fn,nl=new pn,il=new sn,rl=new Ot;class sl extends kn{constructor(e=new bi,t=new el){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),il.copy(n.boundingSphere),il.applyMatrix4(i),il.radius+=r,!1===e.ray.intersectsSphere(il))return;tl.copy(i).invert(),nl.copy(e.ray).applyMatrix4(tl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);rl.fromBufferAttribute(c,r),al(rl,r,o,i,e,t,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)rl.fromBufferAttribute(c,n),al(rl,n,o,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function al(e,t,n,i,r,s,a){const o=nl.distanceSqToPoint(e);if(o<n){const n=new Ot;nl.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:a})}}class ol extends Tt{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:E,this.magFilter=void 0!==r?r:E,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ll extends Tt{constructor(e,t,n,i,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,i,r,h,u),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class cl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new ot:new Ot);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Ot,i=[],r=[],s=[],a=new Ot,o=new fn;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new Ot)}r[0]=new Ot,s[0]=new Ot;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Ze(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(Ze(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class hl extends cl{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){const n=t||new ot,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+e*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ul extends hl{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function dl(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const pl=new Ot,fl=new dl,ml=new dl,Al=new dl;class gl extends cl{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new Ot){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(pl.subVectors(i[0],i[1]).add(i[0]),a=pl);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(pl.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=pl),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),fl.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,t,n,i),ml.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,t,n,i),Al.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,t,n,i)}else"catmullrom"===this.curveType&&(fl.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),ml.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),Al.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(fl.calc(c),ml.calc(c),Al.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Ot).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function vl(e,t,n,i,r){const s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function yl(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function xl(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class _l extends cl{constructor(e=new ot,t=new ot,n=new ot,i=new ot){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ot){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(xl(e,i.x,r.x,s.x,a.x),xl(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class El extends cl{constructor(e=new Ot,t=new Ot,n=new Ot,i=new Ot){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Ot){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(xl(e,i.x,r.x,s.x,a.x),xl(e,i.y,r.y,s.y,a.y),xl(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class wl extends cl{constructor(e=new ot,t=new ot){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ot){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ot){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Cl extends cl{constructor(e=new Ot,t=new Ot){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ot){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ot){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class bl extends cl{constructor(e=new ot,t=new ot,n=new ot){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ot){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(yl(e,i.x,r.x,s.x),yl(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ml extends cl{constructor(e=new Ot,t=new Ot,n=new Ot){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ot){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(yl(e,i.x,r.x,s.x),yl(e,i.y,r.y,s.y),yl(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Sl extends cl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ot){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(vl(a,o.x,l.x,c.x,h.x),vl(a,o.y,l.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ot).fromArray(n))}return this}}var Il=Object.freeze({__proto__:null,ArcCurve:ul,CatmullRomCurve3:gl,CubicBezierCurve:_l,CubicBezierCurve3:El,EllipseCurve:hl,LineCurve:wl,LineCurve3:Cl,QuadraticBezierCurve:bl,QuadraticBezierCurve3:Ml,SplineCurve:Sl});class Bl extends cl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Il[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Il[n.type]).fromJSON(n))}return this}}class Tl extends Bl{constructor(e){super(),this.type="Path",this.currentPoint=new ot,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new wl(this.currentPoint.clone(),new ot(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new bl(this.currentPoint.clone(),new ot(e,t),new ot(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const a=new _l(this.currentPoint.clone(),new ot(e,t),new ot(n,i),new ot(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Sl(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){const l=new hl(e,t,n,i,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Rl extends bi{constructor(e=[new ot(0,-.5),new ot(.5,0),new ot(0,.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Ze(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/t,h=new Ot,u=new ot,d=new Ot,p=new Ot,f=new Ot;let m=0,A=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,A=e[t+1].y-e[t].y,d.x=1*A,d.y=-m,d.z=0*A,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,A=e[t+1].y-e[t].y,d.x=1*A,d.y=-m,d.z=0*A,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=t;r++){const d=n+r*c*i,p=Math.sin(d),f=Math.cos(d);for(let n=0;n<=e.length-1;n++){h.x=e[n].x*p,h.y=e[n].y,h.z=e[n].x*f,s.push(h.x,h.y,h.z),u.x=r/t,u.y=n/(e.length-1),a.push(u.x,u.y);const i=o[3*n+0]*p,c=o[3*n+1],d=o[3*n+0]*f;l.push(i,c,d)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,s=i,a=i+e.length,o=i+e.length+1,l=i+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new gi(s,3)),this.setAttribute("uv",new gi(a,2)),this.setAttribute("normal",new gi(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rl(e.points,e.segments,e.phiStart,e.phiLength)}}class Dl extends Rl{constructor(e=1,t=1,n=4,i=8){const r=new Tl;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new Dl(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ll extends bi{constructor(e=1,t=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],s=[],a=[],o=[],l=new Ot,c=new ot;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){const u=n+r/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new gi(s,3)),this.setAttribute("normal",new gi(a,3)),this.setAttribute("uv",new gi(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ll(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Pl extends bi{constructor(e=1,t=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=n/2;let A=0;function g(n){const r=p,s=new ot,f=new Ot;let g=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=i;e++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const x=p;for(let e=0;e<=i;e++){const t=e/i*o+a,n=Math.cos(t),r=Math.sin(t);f.x=v*r,f.y=m*y,f.z=v*n,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),g+=3}l.addGroup(A,g,!0===n?1:2),A+=g}!function(){const s=new Ot,g=new Ot;let v=0;const y=(t-e)/n;for(let l=0;l<=r;l++){const c=[],A=l/r,v=A*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*o+a,l=Math.sin(r),f=Math.cos(r);g.x=v*l,g.y=-A*n+m,g.z=v*f,h.push(g.x,g.y,g.z),s.set(l,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-A),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(n,i,s),c.push(i,r,s),v+=6}l.addGroup(A,v,0),A+=v}(),!1===s&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new gi(h,3)),this.setAttribute("normal",new gi(u,3)),this.setAttribute("uv",new gi(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fl extends Pl{constructor(e=1,t=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,e,t,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new Fl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ul extends bi{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function a(e,t,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const a=e.clone().lerp(n,i/r),o=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)s[i][e]=0===e&&i===r?a:a.clone().lerp(o,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(s[e][n+1]),o(s[e+1][n]),o(s[e][n])):(o(s[e][n+1]),o(s[e+1][n+1]),o(s[e+1][n]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Ot,i=new Ot,r=new Ot;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),a(n,i,r,e)}(i),function(e){const t=new Ot;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new Ot;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=h(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-a)}var t;(function(){const e=new Ot,t=new Ot,n=new Ot,i=new Ot,a=new ot,o=new ot,l=new ot;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=h(i);c(a,d+0,e,p),c(o,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new gi(r,3)),this.setAttribute("normal",new gi(r.slice(),3)),this.setAttribute("uv",new gi(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ul(e.vertices,e.indices,e.radius,e.details)}}class Ol extends Ul{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ol(e.radius,e.detail)}}const Nl=new Ot,kl=new Ot,Gl=new Ot,Ql=new Kn;class zl extends bi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(qe*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let e=0;e<o;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=Ql;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Ql.getNormal(Gl),h[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,h[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,h[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=h[e],i=h[t],s=Ql[c[e]],a=Ql[c[t]],o=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(Gl.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[e],index1:l[t],normal:Gl.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];Nl.fromBufferAttribute(a,t),kl.fromBufferAttribute(a,n),d.push(Nl.x,Nl.y,Nl.z),d.push(kl.x,kl.y,kl.z)}this.setAttribute("position",new gi(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let Hl=class extends Tl{constructor(e){super(e),this.uuid=Ke(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Tl).fromJSON(n))}return this}};const Vl=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=Wl(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(i&&(s=function(e,t,n,i){const r=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:e.length,c=Wl(e,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(nc(c));for(r.sort(Zl),s=0;s<r.length;s++)n=$l(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=c=e[0],l=h=e[1];for(let t=n;t<r;t+=n)u=e[t],d=e[t+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?32767/p:0}return Xl(s,a,n,o,l,p,0),a};function Wl(e,t,n,i,r){let s,a;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)a=dc(s,e[s],e[s+1],a);else for(s=n-i;s>=t;s-=i)a=dc(s,e[s],e[s+1],a);return a&&ac(a,a.next)&&(pc(a),a=a.next),a}function jl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ac(i,i.next)&&0!==sc(i.prev,i,i.next))i=i.next;else{if(pc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Xl(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=tc(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?ql(e,i,r,s):Jl(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),pc(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Xl(e=Yl(jl(e),t,n),t,n,i,r,s,2):2===a&&Kl(e,t,n,i,r,s):Xl(jl(e),t,n,i,r,s,1);break}}function Jl(e){const t=e.prev,n=e,i=e.next;if(sc(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&ic(r,o,s,l,a,c,f.x,f.y)&&sc(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ql(e,t,n,i){const r=e.prev,s=e,a=e.next;if(sc(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,h=r.y,u=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=o>l?o>c?o:c:l>c?l:c,A=h>u?h>d?h:d:u>d?u:d,g=tc(p,f,t,n,i),v=tc(m,A,t,n,i);let y=e.prevZ,x=e.nextZ;for(;y&&y.z>=g&&x&&x.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=A&&y!==r&&y!==a&&ic(o,h,l,u,c,d,y.x,y.y)&&sc(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=A&&x!==r&&x!==a&&ic(o,h,l,u,c,d,x.x,x.y)&&sc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=A&&y!==r&&y!==a&&ic(o,h,l,u,c,d,y.x,y.y)&&sc(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=A&&x!==r&&x!==a&&ic(o,h,l,u,c,d,x.x,x.y)&&sc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Yl(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!ac(r,s)&&oc(r,i,i.next,s)&&hc(r,s)&&hc(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),pc(i),pc(i.next),i=e=s),i=i.next}while(i!==e);return jl(i)}function Kl(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&rc(a,e)){let o=uc(a,e);return a=jl(a,a.next),o=jl(o,o.next),Xl(a,t,n,i,r,s,0),void Xl(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Zl(e,t){return e.x-t.x}function $l(e,t){const n=function(e,t){let n,i=t,r=-1/0;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let h,u=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&ic(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),hc(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&ec(n,i)))&&(n=i,u=h)),i=i.next}while(i!==o);return n}(e,t);if(!n)return t;const i=uc(n,e);return jl(i,i.next),jl(n,n.next)}function ec(e,t){return sc(e.prev,e,t.prev)<0&&sc(t.next,e,e.next)<0}function tc(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function nc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ic(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function rc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&oc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(hc(e,t)&&hc(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(sc(e.prev,e,t.prev)||sc(e,t.prev,t))||ac(e,t)&&sc(e.prev,e,e.next)>0&&sc(t.prev,t,t.next)>0)}function sc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ac(e,t){return e.x===t.x&&e.y===t.y}function oc(e,t,n,i){const r=cc(sc(e,t,n)),s=cc(sc(e,t,i)),a=cc(sc(n,i,e)),o=cc(sc(n,i,t));return r!==s&&a!==o||(!(0!==r||!lc(e,n,t))||(!(0!==s||!lc(e,i,t))||(!(0!==a||!lc(n,e,i))||!(0!==o||!lc(n,t,i)))))}function lc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function cc(e){return e>0?1:e<0?-1:0}function hc(e,t){return sc(e.prev,e,e.next)<0?sc(e,t,e.next)>=0&&sc(e,e.prev,t)>=0:sc(e,t,e.prev)<0||sc(e,e.next,t)<0}function uc(e,t){const n=new fc(e.i,e.x,e.y),i=new fc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function dc(e,t,n,i){const r=new fc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function pc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class mc{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return mc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Ac(e),gc(n,e);let s=e.length;t.forEach(Ac);for(let e=0;e<t.length;e++)i.push(s),s+=t[e].length,gc(n,t[e]);const a=Vl(n,i);for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return r}}function Ac(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function gc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class vc extends bi{constructor(e=new Hl([new ot(.5,.5),new ot(-.5,.5),new ot(-.5,-.5),new ot(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++){s(e[t])}function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:.2,u=void 0!==t.bevelSize?t.bevelSize:h-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:yc;let A,g,v,y,x,_=!1;f&&(A=f.getSpacedPoints(o),_=!0,c=!1,g=f.computeFrenetFrames(o,!1),v=new Ot,y=new Ot,x=new Ot),c||(p=0,h=0,u=0,d=0);const E=e.extractPoints(a);let w=E.shape;const C=E.holes;if(!mc.isClockWise(w)){w=w.reverse();for(let e=0,t=C.length;e<t;e++){const t=C[e];mc.isClockWise(t)&&(C[e]=t.reverse())}}const b=mc.triangulateShape(w,C),M=w;for(let e=0,t=C.length;e<t;e++){const t=C[e];w=w.concat(t)}function S(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const I=w.length,B=b.length;function T(e,t,n){let i,r,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,f=t.y+a/u,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(a*c-o*l);i=p+a*m-e.x,r=f+o*m-e.y;const A=i*i+r*r;if(A<=2)return new ot(i,r);s=Math.sqrt(A/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new ot(i/s,r/s)}const R=[];for(let e=0,t=M.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),R[e]=T(M[e],M[n],M[i]);const D=[];let L,P=R.concat();for(let e=0,t=C.length;e<t;e++){const t=C[e];L=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[e]=T(t[e],t[i],t[r]);D.push(L),P=P.concat(L)}for(let e=0;e<p;e++){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=S(M[e],R[e],i);O(t.x,t.y,-n)}for(let e=0,t=C.length;e<t;e++){const t=C[e];L=D[e];for(let e=0,r=t.length;e<r;e++){const r=S(t[e],L[e],i);O(r.x,r.y,-n)}}}const F=u+d;for(let e=0;e<I;e++){const t=c?S(w[e],P[e],F):w[e];_?(y.copy(g.normals[0]).multiplyScalar(t.x),v.copy(g.binormals[0]).multiplyScalar(t.y),x.copy(A[0]).add(y).add(v),O(x.x,x.y,x.z)):O(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<I;t++){const n=c?S(w[t],P[t],F):w[t];_?(y.copy(g.normals[e]).multiplyScalar(n.x),v.copy(g.binormals[e]).multiplyScalar(n.y),x.copy(A[e]).add(y).add(v),O(x.x,x.y,x.z)):O(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=M.length;e<t;e++){const t=S(M[e],R[e],i);O(t.x,t.y,l+n)}for(let e=0,t=C.length;e<t;e++){const t=C[e];L=D[e];for(let e=0,r=t.length;e<r;e++){const r=S(t[e],L[e],i);_?O(r.x,r.y+A[o-1].y,A[o-1].x+n):O(r.x,r.y,l+n)}}}function U(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=I*e,s=I*(e+1);k(t+i+n,t+r+n,t+r+s,t+i+s)}}}function O(e,t,n){s.push(e),s.push(t),s.push(n)}function N(e,t,r){G(e),G(t),G(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);Q(a[0]),Q(a[1]),Q(a[2])}function k(e,t,r,s){G(e),G(t),G(s),G(t),G(r),G(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);Q(o[0]),Q(o[1]),Q(o[3]),Q(o[1]),Q(o[2]),Q(o[3])}function G(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function Q(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=I*e;for(let e=0;e<B;e++){const n=b[e];N(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=I*e;for(let e=0;e<B;e++){const n=b[e];N(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<B;e++){const t=b[e];N(t[2],t[1],t[0])}for(let e=0;e<B;e++){const t=b[e];N(t[0]+I*o,t[1]+I*o,t[2]+I*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;U(M,t),t+=M.length;for(let e=0,n=C.length;e<n;e++){const n=C[e];U(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new gi(i,3)),this.setAttribute("uv",new gi(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Il[i.type]).fromJSON(i)),new vc(n,e.options)}}const yc={generateTopUV:function(e,t,n,i,r){const s=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*r],h=t[3*r+1];return[new ot(s,a),new ot(o,l),new ot(c,h)]},generateSideWallUV:function(e,t,n,i,r,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],h=t[3*i+1],u=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],A=t[3*s+1],g=t[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new ot(a,1-l),new ot(c,1-u),new ot(d,1-f),new ot(m,1-g)]:[new ot(o,1-l),new ot(h,1-u),new ot(p,1-f),new ot(A,1-g)]}};class xc extends Ul{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xc(e.radius,e.detail)}}class _c extends Ul{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _c(e.radius,e.detail)}}class Ec extends bi{constructor(e=.5,t=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let h=e;const u=(t-e)/(i=Math.max(1,i)),d=new Ot,p=new ot;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=r+e/n*s;d.x=h*Math.cos(i),d.y=h*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new gi(o,3)),this.setAttribute("normal",new gi(l,3)),this.setAttribute("uv",new gi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ec(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class wc extends bi{constructor(e=new Hl([new ot(0,.5),new ot(-.5,-.5),new ot(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===mc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===mc.isClockWise(t)&&(h[e]=t.reverse())}const u=mc.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],i=t[0]+a,r=t[1]+a,s=t[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new gi(i,3)),this.setAttribute("normal",new gi(r,3)),this.setAttribute("uv",new gi(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new wc(n,e.curveSegments)}}class Cc extends bi{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new Ot,u=new Ot,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const A=[],g=d/n;let v=0;0===d&&0===s?v=.5/t:d===n&&o===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const o=n/t;h.x=-e*Math.cos(i+o*r)*Math.sin(s+g*a),h.y=e*Math.cos(s+g*a),h.z=e*Math.sin(i+o*r)*Math.sin(s+g*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+v,1-g),A.push(l++)}c.push(A)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=c[e][i+1],r=c[e][i],a=c[e+1][i],l=c[e+1][i+1];(0!==e||s>0)&&d.push(t,r,l),(e!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new gi(p,3)),this.setAttribute("normal",new gi(f,3)),this.setAttribute("uv",new gi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class bc extends Ul{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bc(e.radius,e.detail)}}class Mc extends bi{constructor(e=1,t=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new Ot,h=new Ot,u=new Ot;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,a=(i+1)*(e-1)+t,o=(i+1)*e+t;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new gi(a,3)),this.setAttribute("normal",new gi(o,3)),this.setAttribute("uv",new gi(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Sc extends bi{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new Ot,u=new Ot,d=new Ot,p=new Ot,f=new Ot,m=new Ot,A=new Ot;for(let a=0;a<=n;++a){const v=a/n*r*Math.PI*2;g(v,r,s,e,d),g(v+.01,r,s,e,p),m.subVectors(p,d),A.addVectors(p,d),f.crossVectors(m,A),A.crossVectors(f,m),f.normalize(),A.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,s=-t*Math.cos(r),p=t*Math.sin(r);h.x=d.x+(s*A.x+p*f.x),h.y=d.y+(s*A.y+p*f.y),h.z=d.z+(s*A.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/n),c.push(e/i)}}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,o=(i+1)*(e-1)+t;a.push(n,r,o),a.push(r,s,o)}function g(e,t,n,i,r){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new gi(o,3)),this.setAttribute("normal",new gi(l,3)),this.setAttribute("uv",new gi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ic extends bi{constructor(e=new Ml(new Ot(-1,-1,0),new Ot(-1,1,0),new Ot(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new Ot,o=new Ot,l=new ot;let c=new Ot;const h=[],u=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,a=(i+1)*(e-1)+t;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new gi(h,3)),this.setAttribute("normal",new gi(u,3)),this.setAttribute("uv",new gi(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ic((new Il[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Bc extends bi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new Ot,r=new Ot;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let o=0;o<3;o++){const l=a.getX(e+o),c=a.getX(e+(o+1)%3);i.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===Tc(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let e=0,a=s.count/3;e<a;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Tc(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new gi(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Tc(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Rc=Object.freeze({__proto__:null,BoxGeometry:Wi,CapsuleGeometry:Dl,CircleGeometry:Ll,ConeGeometry:Fl,CylinderGeometry:Pl,DodecahedronGeometry:Ol,EdgesGeometry:zl,ExtrudeGeometry:vc,IcosahedronGeometry:xc,LatheGeometry:Rl,OctahedronGeometry:_c,PlaneGeometry:dr,PolyhedronGeometry:Ul,RingGeometry:Ec,ShapeGeometry:wc,SphereGeometry:Cc,TetrahedronGeometry:bc,TorusGeometry:Mc,TorusKnotGeometry:Sc,TubeGeometry:Ic,WireframeGeometry:Bc});class Dc extends si{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ni(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}let Lc=class extends Yi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};class Pc extends si{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ni(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Fc extends Pc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ot(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ze(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ni(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ni(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ni(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Uc extends si{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ni(16777215),this.specular=new ni(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Oc extends si{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ni(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Nc extends si{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class kc extends si{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Gc extends si{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ni(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Qc extends Ho{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function zc(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Hc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vc(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function Wc(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function jc(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)}const Xc={convertArray:zc,isTypedArray:Hc,getKeyframeOrder:Vc,sortedArray:Wc,flattenJSON:jc,subclip:function(e,t,n,i,r=30){const s=e.clone();s.name=t;const a=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<n||s>=i)){l.push(t.times[e]);for(let n=0;n<o;++n)c.push(t.values[e*o+n])}}0!==l.length&&(t.times=zc(l,t.times.constructor),t.values=zc(c,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let e=0;e<s.tracks.length;++e)o>s.tracks[e].times[0]&&(o=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const e=o,t=l-o;d=i.values.slice(e,t)}else if(s>=i.times[u]){const e=u*l+o,t=e+l-o;d=i.values.slice(e,t)}else{const e=i.createInterpolant(),t=o,n=l-o;e.evaluate(s),d=e.resultBuffer.slice(t,n)}if("quaternion"===r){(new Ut).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===r)Ut.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=h-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=Se,e}};class Jc{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class qc extends Jc{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:we,endingEnd:we}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Ce:r=e,a=2*t-n;break;case be:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Ce:s=e,o=2*n-t;break;case be:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,A=-u*m+2*u*f-u*p,g=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let e=0;e!==a;++e)r[e]=A*s[c+e]+g*s[l+e]+v*s[o+e]+y*s[h+e];return r}}class Yc extends Jc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),h=1-c;for(let e=0;e!==a;++e)r[e]=s[l+e]*h+s[o+e]*c;return r}}class Kc extends Jc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Zc{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zc(t,this.TimeBufferType),this.values=zc(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:zc(e.times,Array),values:zc(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Kc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Yc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xe:t=this.InterpolantFactoryMethodDiscrete;break;case _e:t=this.InterpolantFactoryMethodLinear;break;case Ee:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xe;case this.InterpolantFactoryMethodLinear:return _e;case this.InterpolantFactoryMethodSmooth:return Ee}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,s),e=!1;break}s=i}if(void 0!==i&&Hc(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Ee,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Zc.prototype.TimeBufferType=Float32Array,Zc.prototype.ValueBufferType=Float32Array,Zc.prototype.DefaultInterpolation=_e;class $c extends Zc{}$c.prototype.ValueTypeName="bool",$c.prototype.ValueBufferType=Array,$c.prototype.DefaultInterpolation=xe,$c.prototype.InterpolantFactoryMethodLinear=void 0,$c.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends Zc{}eh.prototype.ValueTypeName="color";class th extends Zc{}th.prototype.ValueTypeName="number";class nh extends Jc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Ut.slerpFlat(r,0,s,l-a,s,l,o);return r}}class ih extends Zc{InterpolantFactoryMethodLinear(e){return new nh(this.times,this.values,this.getValueSize(),e)}}ih.prototype.ValueTypeName="quaternion",ih.prototype.DefaultInterpolation=_e,ih.prototype.InterpolantFactoryMethodSmooth=void 0;class rh extends Zc{}rh.prototype.ValueTypeName="string",rh.prototype.ValueBufferType=Array,rh.prototype.DefaultInterpolation=xe,rh.prototype.InterpolantFactoryMethodLinear=void 0,rh.prototype.InterpolantFactoryMethodSmooth=void 0;class sh extends Zc{}sh.prototype.ValueTypeName="vector";class ah{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Ke(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(oh(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Zc.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let e=0;e<r;e++){let a=[],o=[];a.push((e+r-1)%r,e,(e+1)%r),o.push(0,1,0);const l=Vc(a);a=Wc(a,1,l),o=Wc(o,1,l),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new th(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(r);if(s&&s.length>1){const e=s[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const s=[];for(const e in i)s.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],a=[];jc(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new th(".morphTargetInfluence["+n+"]",e,s))}o=e.length*s}else{const s=".bones["+t[e].name+"]";n(sh,s+".position",r,"pos",i),n(ih,s+".quaternion",r,"rot",i),n(sh,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function oh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return th;case"vector":case"vector2":case"vector3":case"vector4":return sh;case"color":return eh;case"quaternion":return ih;case"bool":case"boolean":return $c;case"string":return rh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];jc(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const lh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ch{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const hh=new ch;class uh{constructor(e){this.manager=void 0!==e?e:hh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}uh.DEFAULT_MATERIAL_NAME="__DEFAULT";const dh={};class ph extends Error{constructor(e,t){super(e),this.response=t}}class fh extends uh{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=lh.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==dh[e])return void dh[e].push({onLoad:t,onProgress:n,onError:i});dh[e]=[],dh[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=dh[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}});return new Response(l)}throw new ph(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{lh.add(e,t);const n=dh[e];delete dh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=dh[e];if(void 0===n)throw this.manager.itemError(e),t;delete dh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class mh extends uh{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=lh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a=pt("img");function o(){c(),lh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class Ah extends uh{constructor(e){super(e)}load(e,t,n,i){const r=new tr;r.colorSpace=De;const s=new mh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],(function(e){r.images[n]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let t=0;t<e.length;++t)o(t);return r}}class gh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new To,a=new fh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,(function(e){let n;try{n=r.parse(e)}catch(e){if(void 0===i)return void console.error(e);i(e)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:g,s.wrapT=void 0!==n.wrapT?n.wrapT:g,s.magFilter=void 0!==n.magFilter?n.magFilter:E,s.minFilter=void 0!==n.minFilter?n.minFilter:E,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=C),1===n.mipmapCount&&(s.minFilter=E),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)}),n,i),s}}class vh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=new Tt,s=new mh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class yh extends kn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ni(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class xh extends yh{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ni(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const _h=new fn,Eh=new Ot,wh=new Ot;class Ch{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ot(512,512),this.map=null,this.mapPass=null,this.matrix=new fn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cr,this._frameExtents=new ot(1,1),this._viewportCount=1,this._viewports=[new Rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Eh.setFromMatrixPosition(e.matrixWorld),t.position.copy(Eh),wh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wh),t.updateMatrixWorld(),_h.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_h),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(_h)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class bh extends Ch{constructor(){super(new Zi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Ye*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Mh extends yh{constructor(e,t,n=0,i=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new bh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Sh=new fn,Ih=new Ot,Bh=new Ot;class Th extends Ch{constructor(){super(new Zi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ot(4,2),this._viewportCount=6,this._viewports=[new Rt(2,1,1,1),new Rt(0,1,1,1),new Rt(3,1,1,1),new Rt(1,1,1,1),new Rt(3,0,1,1),new Rt(1,0,1,1)],this._cubeDirections=[new Ot(1,0,0),new Ot(-1,0,0),new Ot(0,0,1),new Ot(0,0,-1),new Ot(0,1,0),new Ot(0,-1,0)],this._cubeUps=[new Ot(0,1,0),new Ot(0,1,0),new Ot(0,1,0),new Ot(0,1,0),new Ot(0,0,1),new Ot(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ih.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ih),Bh.copy(n.position),Bh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Bh),n.updateMatrixWorld(),i.makeTranslation(-Ih.x,-Ih.y,-Ih.z),Sh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sh)}}class Rh extends yh{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Th}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Dh extends Ch{constructor(){super(new wr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Lh extends yh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.shadow=new Dh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ph extends yh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Fh extends yh{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Uh{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ot)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*i*1.092548),t.addScaledVector(s[5],i*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],n*r*1.092548),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*i),t.addScaledVector(s[5],.858086*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class Oh extends yh{constructor(e=new Uh,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Nh extends uh{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,s=new fh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=Nh.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new ni).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(i.uniforms[t]={},r.type){case"t":i.uniforms[t].value=n(r.value);break;case"c":i.uniforms[t].value=(new ni).setHex(r.value);break;case"v2":i.uniforms[t].value=(new ot).fromArray(r.value);break;case"v3":i.uniforms[t].value=(new Ot).fromArray(r.value);break;case"v4":i.uniforms[t].value=(new Rt).fromArray(r.value);break;case"m3":i.uniforms[t].value=(new lt).fromArray(r.value);break;case"m4":i.uniforms[t].value=(new fn).fromArray(r.value);break;default:i.uniforms[t].value=r.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new ot).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new ot).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Dc,SpriteMaterial:$a,RawShaderMaterial:Lc,ShaderMaterial:Yi,PointsMaterial:el,MeshPhysicalMaterial:Fc,MeshStandardMaterial:Pc,MeshPhongMaterial:Uc,MeshToonMaterial:Oc,MeshNormalMaterial:Nc,MeshLambertMaterial:kc,MeshDepthMaterial:Ra,MeshDistanceMaterial:Da,MeshBasicMaterial:ai,MeshMatcapMaterial:Gc,LineDashedMaterial:Qc,LineBasicMaterial:Ho,Material:si}[e]}}class kh{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Gh extends bi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Qh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],s=new Uint32Array(r).buffer;return n[t]=s,s}(e,r.buffer),a=dt(r.type,s),o=new Ya(a,r.stride);return o.uuid=r.uuid,t[i]=o,o}const r=e.isInstancedBufferGeometry?new Gh:new bi,s=e.data.index;if(void 0!==s){const e=dt(s.type,s.array);r.setIndex(new fi(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let s;if(n.isInterleavedBufferAttribute){const t=i(e.data,n.data);s=new Za(t,n.itemSize,n.offset,n.normalized)}else{const e=dt(n.type,n.array);s=new(n.isInstancedBufferAttribute?Po:fi)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),r.setAttribute(t,s)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];let a;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);a=new Za(t,r.itemSize,r.offset,r.normalized)}else{const e=dt(r.type,r.array);a=new fi(e,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[t]=s}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Ot;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new sn(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}const zh={UVMapping:h,CubeReflectionMapping:u,CubeRefractionMapping:d,EquirectangularReflectionMapping:p,EquirectangularRefractionMapping:f,CubeUVReflectionMapping:m},Hh={RepeatWrapping:A,ClampToEdgeWrapping:g,MirroredRepeatWrapping:v},Vh={NearestFilter:y,NearestMipmapNearestFilter:x,NearestMipmapLinearFilter:_,LinearFilter:E,LinearMipmapNearestFilter:w,LinearMipmapLinearFilter:C};class Wh extends uh{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=lh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){lh.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}let jh;class Xh{static getContext(){return void 0===jh&&(jh=new(window.AudioContext||window.webkitAudioContext)),jh}static setContext(e){jh=e}}class Jh extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(this.manager);function a(t){i?i(t):console.error(t),r.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){try{const n=e.slice(0);Xh.getContext().decodeAudioData(n,(function(e){t(e)}),a)}catch(e){a(e)}}),n,i)}}const qh=new fn,Yh=new fn,Kh=new fn;let Zh=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$h(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=$h();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function $h(){return("undefined"==typeof performance?Date:performance).now()}const eu=new Ot,tu=new Ut,nu=new Ot,iu=new Ot;class ru extends kn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const su=new Ot,au=new Ut,ou=new Ot,lu=new Ot;class cu{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){Ut.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;Ut.multiplyQuaternionsFlat(e,s,e,t,e,n),Ut.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const hu="\\[\\]\\.:\\/",uu=new RegExp("["+hu+"]","g"),du="[^"+hu+"]",pu="[^"+hu.replace("\\.","")+"]",fu=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",du)+/(WCOD+)?/.source.replace("WCOD",pu)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",du)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",du)+"$"),mu=["material","materials","bones","map"];class Au{constructor(e,t,n){this.path=t,this.parsedPath=n||Au.parseTrackName(t),this.node=Au.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Au.Composite(e,t,n):new Au(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(uu,"")}static parseTrackName(e){const t=fu.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==mu.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Au.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Au.Composite=class{constructor(e,t,n){const i=n||Au.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Au.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Au.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Au.prototype.GetterByBindingType=[Au.prototype._getValue_direct,Au.prototype._getValue_array,Au.prototype._getValue_arrayElement,Au.prototype._getValue_toArray],Au.prototype.SetterByBindingTypeAndVersioning=[[Au.prototype._setValue_direct,Au.prototype._setValue_direct_setNeedsUpdate,Au.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Au.prototype._setValue_array,Au.prototype._setValue_array_setNeedsUpdate,Au.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Au.prototype._setValue_arrayElement,Au.prototype._setValue_arrayElement_setNeedsUpdate,Au.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Au.prototype._setValue_fromArray,Au.prototype._setValue_fromArray_setNeedsUpdate,Au.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class gu{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:we,endingEnd:we};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Se)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=2202===n;if(0===e)return-1===r?i:s&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Ce,i.endingEnd=Ce):(i.endingStart=e?this.zeroSlopeAtStart?Ce:we:be,i.endingEnd=t?this.zeroSlopeAtEnd?Ce:we:be)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=n,this}}const vu=new Float32Array(1);class yu extends je{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[e]=h;else{if(h=s[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;h=new cu(Au.create(n,l,i),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[e]=h}a[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Yc(new Float32Array(2),new Float32Array(2),1,vu),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"==typeof e?ah.findByName(i,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Me),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new gu(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?ah.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(i,e,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class xu{constructor(e){this.value=e}clone(){return new xu(void 0===this.value.clone?this.value:this.value.clone())}}let _u=0;class Eu{constructor(e,t,n=0,i=1/0){this.ray=new pn(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new bn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Cu(e,this,n,t),n.sort(wu),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)Cu(e[i],this,n,t);return n.sort(wu),n}}function wu(e,t){return e.distance-t.distance}function Cu(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)Cu(i[e],t,n,!0)}}class bu{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ze(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Mu=new ot;class Su{constructor(e=new ot(1/0,1/0),t=new ot(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Mu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Mu).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Iu=new Ot,Bu=new Ot;const Tu=new Ot;const Ru=new Ot,Du=new fn,Lu=new fn;function Pu(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Pu(e.children[n]));return t}const Fu=new Ot,Uu=new ni,Ou=new ni;const Nu=new Ot,ku=new Ot,Gu=new Ot;const Qu=new Ot,zu=new Ki;function Hu(e,t,n,i,r,s,a){Qu.set(r,s,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Qu.x,Qu.y,Qu.z)}}const Vu=new Gt;const Wu=new Ot;let ju,Xu;class Ju{constructor(){this.type="ShapePath",this.color=new ni,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Tl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[r],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const n=mc.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new Hl,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],h=[];let u,d,p=[],f=0;h[f]=void 0,p[f]=[];for(let t=0,a=i.length;t<a;t++)s=i[t],u=s.getPoints(),r=n(u),r=e?!r:r,r?(!l&&h[f]&&f++,h[f]={s:new Hl,p:u},h[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!h[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new Hl;r.curves=i.curves,t.push(r)}return t}(i);if(h.length>1){let e=!1,n=0;for(let e=0,t=h.length;e<t;e++)c[e]=[];for(let i=0,r=h.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<h.length;r++)t(a.p,h[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):e=!0);o&&c[i].push(a)}}n>0&&!1===e&&(p=c)}for(let e=0,t=h.length;e<t;e++){a=h[e].s,o.push(a),d=p[e];for(let e=0,t=d.length;e<t;e++)a.holes.push(d[e].h)}return o}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);var qu=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:s,AddOperation:2,AdditiveAnimationBlendMode:Se,AdditiveBlending:2,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:Ph,AnimationAction:gu,AnimationClip:ah,AnimationLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new fh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=ah.parse(e[n]);t.push(i)}return t}},AnimationMixer:yu,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ke(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=t[u];if(void 0===d){d=o++,t[u]=d,e.push(h);for(let e=0,t=s;e!==t;++e)r[e].push(new Au(h,n[e],i[e]))}else if(d<l){a=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[u]=o,e[o]=h;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[o];let a=t[d];t[d]=s,void 0===a&&(a=new Au(h,n[e],i[e])),t[o]=a}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[o]=s,e[s]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[l]=i,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<r){const a=--r,o=e[a],c=--s,h=e[c];t[o.uuid]=l,e[l]=o,t[h.uuid]=a,e[a]=h,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],r=t[c];t[l]=i,t[a]=r,t.pop()}}else{const r=--s,a=e[r];r>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(h);for(let n=c,i=o.length;n!==i;++n){const i=o[n];h[n]=new Au(i,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}},AnimationUtils:Xc,ArcCurve:ul,ArrayCamera:Oa,ArrowHelper:class extends kn{constructor(e=new Ot(0,0,1),t=new Ot(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===ju&&(ju=new bi,ju.setAttribute("position",new gi([0,0,0,0,1,0],3)),Xu=new Pl(0,.5,1,5,1),Xu.translate(0,-.5,0)),this.position.copy(t),this.line=new qo(ju,new Ho({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Hi(Xu,new ai({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Wu.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Wu,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:l,Audio:ru,AudioAnalyser:class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},AudioContext:Xh,AudioListener:class extends kn{constructor(){super(),this.type="AudioListener",this.context=Xh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(eu,tu,nu),iu.set(0,0,-1).applyQuaternion(tu),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(eu.x,e),t.positionY.linearRampToValueAtTime(eu.y,e),t.positionZ.linearRampToValueAtTime(eu.z,e),t.forwardX.linearRampToValueAtTime(iu.x,e),t.forwardY.linearRampToValueAtTime(iu.y,e),t.forwardZ.linearRampToValueAtTime(iu.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(eu.x,eu.y,eu.z),t.setOrientation(iu.x,iu.y,iu.z,n.x,n.y,n.z)}},AudioLoader:Jh,AxesHelper:class extends Zo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new bi;n.setAttribute("position",new gi(t,3)),n.setAttribute("color",new gi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Ho({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new ni,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,Bone:Bo,BooleanKeyframeTrack:$c,Box2:Su,Box3:Gt,Box3Helper:class extends Zo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new bi;i.setIndex(new fi(n,1)),i.setAttribute("position",new gi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Ho({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxGeometry:Wi,BoxHelper:class extends Zo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new bi;r.setIndex(new fi(n,1)),r.setAttribute("position",new fi(i,3)),super(r,new Ho({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Vu.setFromObject(this.object),Vu.isEmpty())return;const t=Vu.min,n=Vu.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:fi,BufferGeometry:bi,BufferGeometryLoader:Qh,ByteType:1010,Cache:lh,Camera:Ki,CameraHelper:class extends Zo{constructor(e){const t=new bi,n=new Ho({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new gi(i,3)),t.setAttribute("color",new gi(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new ni(16755200),c=new ni(16711680),h=new ni(43775),u=new ni(16777215),d=new ni(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;zu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Hu("c",t,e,zu,0,0,-1),Hu("t",t,e,zu,0,0,1),Hu("n1",t,e,zu,-1,-1,-1),Hu("n2",t,e,zu,1,-1,-1),Hu("n3",t,e,zu,-1,1,-1),Hu("n4",t,e,zu,1,1,-1),Hu("f1",t,e,zu,-1,-1,1),Hu("f2",t,e,zu,1,-1,1),Hu("f3",t,e,zu,-1,1,1),Hu("f4",t,e,zu,1,1,1),Hu("u1",t,e,zu,.7,1.1,-1),Hu("u2",t,e,zu,-.7,1.1,-1),Hu("u3",t,e,zu,0,2,-1),Hu("cf1",t,e,zu,-1,0,1),Hu("cf2",t,e,zu,1,0,1),Hu("cf3",t,e,zu,0,-1,1),Hu("cf4",t,e,zu,0,1,1),Hu("cn1",t,e,zu,-1,0,-1),Hu("cn2",t,e,zu,1,0,-1),Hu("cn3",t,e,zu,0,-1,-1),Hu("cn4",t,e,zu,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:class extends Tt{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},CapsuleGeometry:Dl,CatmullRomCurve3:gl,CineonToneMapping:3,CircleGeometry:Ll,ClampToEdgeWrapping:g,Clock:Zh,Color:ni,ColorKeyframeTrack:eh,ColorManagement:_t,CompressedArrayTexture:class extends ll{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=g}},CompressedCubeTexture:class extends ll{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},CompressedTexture:ll,CompressedTextureLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=[],a=new ll,o=new fh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(e[c],(function(e){const n=r.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=E),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else o.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=E),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}},ConeGeometry:Fl,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:er,CubeReflectionMapping:u,CubeRefractionMapping:d,CubeTexture:tr,CubeTextureLoader:Ah,CubeUVReflectionMapping:m,CubicBezierCurve:_l,CubicBezierCurve3:El,CubicInterpolant:qc,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:cl,CurvePath:Bl,CustomBlending:5,CustomToneMapping:5,CylinderGeometry:Pl,Cylindrical:class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Data3DTexture:Ft,DataArrayTexture:Pt,DataTexture:To,DataTextureLoader:gh,DataUtils:ui,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:hh,DepthFormat:U,DepthStencilFormat:O,DepthTexture:Qa,DetachedBindMode:c,DirectionalLight:Lh,DirectionalLightHelper:class extends kn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new bi;i.setAttribute("position",new gi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Ho({fog:!1,toneMapped:!1});this.lightPlane=new qo(i,r),this.add(this.lightPlane),i=new bi,i.setAttribute("position",new gi([0,0,0,0,0,1],3)),this.targetLine=new qo(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Nu.setFromMatrixPosition(this.light.matrixWorld),ku.setFromMatrixPosition(this.light.target.matrixWorld),Gu.subVectors(ku,Nu),this.lightPlane.lookAt(ku),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ku),this.targetLine.scale.z=Gu.length()}},DiscreteInterpolant:Kc,DisplayP3ColorSpace:Pe,DodecahedronGeometry:Ol,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:zl,EllipseCurve:hl,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:p,EquirectangularRefractionMapping:f,Euler:Cn,EventDispatcher:je,ExtrudeGeometry:vc,FileLoader:fh,Float16BufferAttribute:class extends fi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=hi(this.array[e*this.itemSize]);return this.normalized&&(t=rt(t,this.array)),t}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize]=ci(t),this}getY(e){let t=hi(this.array[e*this.itemSize+1]);return this.normalized&&(t=rt(t,this.array)),t}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+1]=ci(t),this}getZ(e){let t=hi(this.array[e*this.itemSize+2]);return this.normalized&&(t=rt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+2]=ci(t),this}getW(e){let t=hi(this.array[e*this.itemSize+3]);return this.normalized&&(t=rt(t,this.array)),t}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+3]=ci(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array)),this.array[e+0]=ci(t),this.array[e+1]=ci(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array)),this.array[e+0]=ci(t),this.array[e+1]=ci(n),this.array[e+2]=ci(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),n=st(n,this.array),i=st(i,this.array),r=st(r,this.array)),this.array[e+0]=ci(t),this.array[e+1]=ci(n),this.array[e+2]=ci(i),this.array[e+3]=ci(r),this}},Float32BufferAttribute:gi,Float64BufferAttribute:class extends fi{constructor(e,t,n){super(new Float64Array(e),t,n)}},FloatType:T,Fog:Ja,FogExp2:Xa,FramebufferTexture:class extends Tt{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=y,this.minFilter=y,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:0,Frustum:cr,GLBufferAttribute:class{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},GLSL1:"100",GLSL3:ze,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:class extends Zo{constructor(e=10,t=10,n=4473924,i=8947848){n=new ni(n),i=new ni(i);const r=t/2,s=e/t,a=e/2,o=[],l=[];for(let e=0,c=0,h=-a;e<=t;e++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const t=e===r?n:i;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new bi;c.setAttribute("position",new gi(o,3)),c.setAttribute("color",new gi(l,3));super(c,new Ho({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Group:Na,HalfFloatType:R,HemisphereLight:xh,HemisphereLightHelper:class extends kn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new _c(t);i.rotateY(.5*Math.PI),this.material=new ai({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new fi(s,3)),this.add(new Hi(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Uu.copy(this.light.color),Ou.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?Uu:Ou;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Fu.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:xc,ImageBitmapLoader:Wh,ImageLoader:mh,ImageUtils:bt,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Po,InstancedBufferGeometry:Gh,InstancedInterleavedBuffer:class extends Ya{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},InstancedMesh:zo,Int16BufferAttribute:class extends fi{constructor(e,t,n){super(new Int16Array(e),t,n)}},Int32BufferAttribute:class extends fi{constructor(e,t,n){super(new Int32Array(e),t,n)}},Int8BufferAttribute:class extends fi{constructor(e,t,n){super(new Int8Array(e),t,n)}},IntType:I,InterleavedBuffer:Ya,InterleavedBufferAttribute:Za,Interpolant:Jc,InterpolateDiscrete:xe,InterpolateLinear:_e,InterpolateSmooth:Ee,InvertStencilOp:5386,KeepStencilOp:Ge,KeyframeTrack:Zc,LOD:vo,LatheGeometry:Rl,Layers:bn,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:yh,LightProbe:Oh,Line:qo,Line3:class{constructor(e=new Ot,t=new Ot){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Iu.subVectors(e,this.start),Bu.subVectors(this.end,this.start);const n=Bu.dot(Bu);let i=Bu.dot(Iu)/n;return t&&(i=Ze(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},LineBasicMaterial:Ho,LineCurve:wl,LineCurve3:Cl,LineDashedMaterial:Qc,LineLoop:$o,LineSegments:Zo,LinearDisplayP3ColorSpace:Fe,LinearEncoding:Ie,LinearFilter:E,LinearInterpolant:Yc,LinearMipMapLinearFilter:b,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:C,LinearMipmapNearestFilter:w,LinearSRGBColorSpace:Le,LinearToneMapping:1,LinearTransfer:Ue,Loader:uh,LoaderUtils:kh,LoadingManager:ch,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:n,Material:si,MaterialLoader:Nh,MathUtils:at,Matrix3:lt,Matrix4:fn,MaxEquation:104,Mesh:Hi,MeshBasicMaterial:ai,MeshDepthMaterial:Ra,MeshDistanceMaterial:Da,MeshLambertMaterial:kc,MeshMatcapMaterial:Gc,MeshNormalMaterial:Nc,MeshPhongMaterial:Uc,MeshPhysicalMaterial:Fc,MeshStandardMaterial:Pc,MeshToonMaterial:Oc,MinEquation:103,MirroredRepeatWrapping:v,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:y,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:_,NearestMipmapNearestFilter:x,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:Re,NoToneMapping:0,NormalAnimationBlendMode:Me,NormalBlending:r,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:th,Object3D:kn,ObjectLoader:class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?kh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new fh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let s=null;try{s=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(s,t)}),n,i)}async loadAsync(e,t){const n=""===this.path?kh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new fh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,s),o=this.parseObject(e.object,i,a,s,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new Hl).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new Lo).fromJSON(e[t],i);n[r.uuid]=r}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Qh;for(let r=0,s=e.length;r<s;r++){let s;const a=e[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;default:a.type in Rc?s=Rc[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new Nh;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=ah.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:dt(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new ch(t);r=new mh(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=s(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new To(n.data,n.width,n.height)))}i[n.uuid]=new St(e)}else{const e=s(n.url);i[n.uuid]=new St(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"==typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:dt(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new mh(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new To(i.data,i.width,i.height)))}n[i.uuid]=new St(e)}else{const e=await r(i.url);n[i.uuid]=new St(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=t[s.image],o=a.data;let l;Array.isArray(o)?(l=new tr,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new To:new Tt,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,zh)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Hh),l.wrapT=n(s.wrap[1],Hh)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Vh)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Vh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(e,t,n,i,r){let s,a,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function h(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":s=new qa,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new ni(e.background):s.background=h(e.background)),void 0!==e.environment&&(s.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Ja(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new Xa(e.fog.color,e.fog.density)),""!==e.fog.name&&(s.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new Zi(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new wr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Ph(e.color,e.intensity);break;case"DirectionalLight":s=new Lh(e.color,e.intensity);break;case"PointLight":s=new Rh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Fh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Mh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new xh(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Oh).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),o=c(e.material),s=new Io(a,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=c(e.material),s=new Hi(a,o);break;case"InstancedMesh":a=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;s=new zo(a,o,t),s.instanceMatrix=new Po(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Po(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new vo;break;case"Line":s=new qo(l(e.geometry),c(e.material));break;case"LineLoop":s=new $o(l(e.geometry),c(e.material));break;case"LineSegments":s=new Zo(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new sl(l(e.geometry),c(e.material));break;case"Sprite":s=new fo(c(e.material));break;case"Group":s=new Na;break;case"Bone":s=new Bo;break;default:s=new kn}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)s.add(this.parseObject(a[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}},ObjectSpaceNormalMap:1,OctahedronGeometry:_c,OneFactor:201,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:o,OneMinusSrcColorFactor:203,OrthographicCamera:wr,P3Primaries:ke,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Pr,Path:Tl,PerspectiveCamera:Zi,Plane:ar,PlaneGeometry:dr,PlaneHelper:class extends qo{constructor(e,t=1,n=16776960){const i=n,r=new bi;r.setAttribute("position",new gi([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Ho({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new bi;s.setAttribute("position",new gi([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Hi(s,new ai({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:Rh,PointLightHelper:class extends Hi{constructor(e,t,n){super(new Cc(t,4,2),new ai({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:sl,PointsMaterial:el,PolarGridHelper:class extends Zo{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new ni(r),s=new ni(s);const a=[],o=[];if(t>1)for(let n=0;n<t;n++){const i=n/t*(2*Math.PI),l=Math.sin(i)*e,c=Math.cos(i)*e;a.push(0,0,0),a.push(l,0,c);const h=1&n?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let t=0;t<n;t++){const l=1&t?r:s,c=e-e/n*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c;a.push(n,0,r),o.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c,a.push(n,0,r),o.push(l.r,l.g,l.b)}}const l=new bi;l.setAttribute("position",new gi(a,3)),l.setAttribute("color",new gi(o,3));super(l,new Ho({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:Ul,PositionalAudio:class extends ru{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(su,au,ou),lu.set(0,0,1).applyQuaternion(au);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(su.x,e),t.positionY.linearRampToValueAtTime(su.y,e),t.positionZ.linearRampToValueAtTime(su.z,e),t.orientationX.linearRampToValueAtTime(lu.x,e),t.orientationY.linearRampToValueAtTime(lu.y,e),t.orientationZ.linearRampToValueAtTime(lu.z,e)}else t.setPosition(su.x,su.y,su.z),t.setOrientation(lu.x,lu.y,lu.z)}},PropertyBinding:Au,PropertyMixer:cu,QuadraticBezierCurve:bl,QuadraticBezierCurve3:Ml,Quaternion:Ut,QuaternionKeyframeTrack:ih,QuaternionLinearInterpolant:nh,RED_GREEN_RGTC2_Format:ve,RED_RGTC1_Format:36283,REVISION:t,RGBADepthPacking:Te,RGBAFormat:F,RGBAIntegerFormat:z,RGBA_ASTC_10x10_Format:ue,RGBA_ASTC_10x5_Format:le,RGBA_ASTC_10x6_Format:ce,RGBA_ASTC_10x8_Format:he,RGBA_ASTC_12x10_Format:de,RGBA_ASTC_12x12_Format:pe,RGBA_ASTC_4x4_Format:ee,RGBA_ASTC_5x4_Format:te,RGBA_ASTC_5x5_Format:ne,RGBA_ASTC_6x5_Format:ie,RGBA_ASTC_6x6_Format:re,RGBA_ASTC_8x5_Format:se,RGBA_ASTC_8x6_Format:ae,RGBA_ASTC_8x8_Format:oe,RGBA_BPTC_Format:fe,RGBA_ETC2_EAC_Format:$,RGBA_PVRTC_2BPPV1_Format:Y,RGBA_PVRTC_4BPPV1_Format:q,RGBA_S3TC_DXT1_Format:V,RGBA_S3TC_DXT3_Format:W,RGBA_S3TC_DXT5_Format:j,RGB_BPTC_SIGNED_Format:me,RGB_BPTC_UNSIGNED_Format:Ae,RGB_ETC1_Format:K,RGB_ETC2_Format:Z,RGB_PVRTC_2BPPV1_Format:J,RGB_PVRTC_4BPPV1_Format:X,RGB_S3TC_DXT1_Format:H,RGFormat:G,RGIntegerFormat:Q,RawShaderMaterial:Lc,Ray:pn,Raycaster:Eu,Rec709Primaries:Ne,RectAreaLight:Fh,RedFormat:N,RedIntegerFormat:k,ReinhardToneMapping:2,RenderTarget:Dt,RepeatWrapping:A,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:Ec,SIGNED_RED_GREEN_RGTC2_Format:ye,SIGNED_RED_RGTC1_Format:ge,SRGBColorSpace:De,SRGBTransfer:Oe,Scene:qa,ShaderChunk:pr,ShaderLib:mr,ShaderMaterial:Yi,ShadowMaterial:Dc,Shape:Hl,ShapeGeometry:wc,ShapePath:Ju,ShapeUtils:mc,ShortType:1011,Skeleton:Lo,SkeletonHelper:class extends Zo{constructor(e){const t=Pu(e),n=new bi,i=[],r=[],s=new ni(0,0,1),a=new ni(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new gi(i,3)),n.setAttribute("color",new gi(r,3));super(n,new Ho({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Lu.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(Du.multiplyMatrices(Lu,r.matrixWorld),Ru.setFromMatrixPosition(Du),i.setXYZ(n,Ru.x,Ru.y,Ru.z),Du.multiplyMatrices(Lu,r.parent.matrixWorld),Ru.setFromMatrixPosition(Du),i.setXYZ(n+1,Ru.x,Ru.y,Ru.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:Io,Source:St,Sphere:sn,SphereGeometry:Cc,Spherical:bu,SphericalHarmonics3:Uh,SplineCurve:Sl,SpotLight:Mh,SpotLightHelper:class extends kn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new bi,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const r=e/n*Math.PI*2,s=t/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new gi(i,3));const r=new Ho({fog:!1,toneMapped:!1});this.cone=new Zo(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Tu.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Tu),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:fo,SpriteMaterial:$a,SrcAlphaFactor:a,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:Qe,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Kh.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(qe*t.fov*.5)/t.zoom;let s,a;Yh.elements[12]=-n,qh.elements[12]=n,s=-r*t.aspect+i,a=r*t.aspect+i,Kh.elements[0]=2*t.near/(a-s),Kh.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Kh),s=-r*t.aspect-i,a=r*t.aspect-i,Kh.elements[0]=2*t.near/(a-s),Kh.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Kh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Yh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(qh)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:rh,SubtractEquation:101,SubtractiveBlending:3,TOUCH:i,TangentSpaceNormalMap:0,TetrahedronGeometry:bc,Texture:Tt,TextureLoader:vh,TorusGeometry:Mc,TorusKnotGeometry:Sc,Triangle:Kn,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Ic,TwoPassDoubleSide:2,UVMapping:h,Uint16BufferAttribute:mi,Uint32BufferAttribute:Ai,Uint8BufferAttribute:class extends fi{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Uint8ClampedBufferAttribute:class extends fi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Uniform:xu,UniformsGroup:class extends je{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_u++}),this.name="",this.usage=Qe,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}},UniformsLib:fr,UniformsUtils:qi,UnsignedByteType:M,UnsignedInt248Type:P,UnsignedIntType:B,UnsignedShort4444Type:D,UnsignedShort5551Type:L,UnsignedShortType:S,VSMShadowMap:3,Vector2:ot,Vector3:Ot,Vector4:Rt,VectorKeyframeTrack:sh,VideoTexture:ol,WebGL1Renderer:ja,WebGL3DRenderTarget:class extends Lt{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Ft(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends Lt{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Pt(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:Ve,WebGLCubeRenderTarget:nr,WebGLMultipleRenderTargets:class extends Lt{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=r.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},WebGLRenderTarget:Lt,WebGLRenderer:Wa,WebGLUtils:Ua,WebGPUCoordinateSystem:We,WireframeGeometry:Bc,WrapAroundEnding:be,ZeroCurvatureEnding:we,ZeroFactor:200,ZeroSlopeEnding:Ce,ZeroStencilOp:0,_SRGBAFormat:He,createCanvasElement:ft,sRGBEncoding:Be}),Yu=class{target;name;intersected;wasIntersected=!1;distance;constructor(e,t){this.target=e,this.name=t,this.intersected=!1,this.distance=0}},Ku=class{type;cancelBubble;originalEvent;coords=new ot(0,0);distance=0;intersected=!1;constructor(e,t=null){this.cancelBubble=!1,this.type=e,this.originalEvent=t}stopPropagation(){this.cancelBubble=!0}};class Zu{base;emitter;container;constructor(e){var t;this.base=e,this.base.update((e=>this.update(e))),this.emitter={all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map((function(e){e(n)})),(i=t.get("*"))&&i.slice().map((function(t){t(e,n)}))}},this.container=this.base.scene}addExisting(){}update(e){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}emit(e,t={}){this.emitter.emit(e,t)}}class $u{base;tasks;autoRender;constructor(e,t={}){const{autoRender:n=!0}=t;this.autoRender=n,this.base=e,this.tasks=[]}add(e){this.tasks.push(e)}update(){this.base.renderer.setAnimationLoop((e=>{this.tick(e)}))}tick(e=0){this.tasks.forEach((t=>{t(e)})),this.autoRender&&this.base.render()}}function ed(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},i=e.getIndex(),r=e.getAttribute("position"),s=i?i.count:r.count;let a=0;const o=Object.keys(e.attributes),l={},c={},h=[],u=["getX","getY","getZ","getW"];for(let t=0,n=o.length;t<n;t++){const n=o[t];l[n]=[];const i=e.morphAttributes[n];i&&(c[n]=new Array(i.length).fill(0).map((()=>[])))}const d=Math.log10(1/t),p=Math.pow(10,d);for(let t=0;t<s;t++){const r=i?i.getX(t):t;let s="";for(let t=0,n=o.length;t<n;t++){const n=o[t],i=e.getAttribute(n),a=i.itemSize;for(let e=0;e<a;e++)s+=~~(i[u[e]](r)*p)+","}if(s in n)h.push(n[s]);else{for(let t=0,n=o.length;t<n;t++){const n=o[t],i=e.getAttribute(n),s=e.morphAttributes[n],a=i.itemSize,h=l[n],d=c[n];for(let e=0;e<a;e++){const t=u[e];if(h.push(i[t](r)),s)for(let e=0,n=s.length;e<n;e++)d[e].push(s[e][t](r))}}n[s]=a,h.push(a),a++}}const f=e.clone();for(let t=0,n=o.length;t<n;t++){const n=o[t],i=e.getAttribute(n),r=new i.array.constructor(l[n]),s=new fi(r,i.itemSize,i.normalized);if(f.setAttribute(n,s),n in c)for(let t=0;t<c[n].length;t++){const i=e.morphAttributes[n][t],r=new i.array.constructor(c[n][t]),s=new fi(r,i.itemSize,i.normalized);f.morphAttributes[n][t]=s}}return f.setIndex(h),f}function td(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(n)if(2===t)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}const nd=parseInt(t.replace(/\D+/g,""));var id=Object.defineProperty;async function rd(e){const t=await e.arrayBuffer(),n=btoa(String.fromCharCode(...new Uint8Array(t)));return`data:${e.type||""};base64,${n}`}let sd,ad,od,ld;function cd(e,t=1/0,n=null){ad||(ad=new dr(2,2,1,1)),od||(od=new Yi({uniforms:{blitTexture:new xu(e)},vertexShader:"\n        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = vec4(position.xy * 1.0,0.,.999999);\n        }\n      ",fragmentShader:"\n          uniform sampler2D blitTexture; \n          varying vec2 vUv;\n\n          void main(){ \n              gl_FragColor = vec4(vUv.xy, 0, 1);\n              \n              #ifdef IS_SRGB\n              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n              #else\n              gl_FragColor = texture2D( blitTexture, vUv);\n              #endif\n          }\n      "})),od.uniforms.blitTexture.value=e,od.defines.IS_SRGB="colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding,od.needsUpdate=!0,ld||(ld=new Hi(ad,od),ld.frustrumCulled=!1);const i=new Zi,r=new qa;r.add(ld),n||(n=sd=new Wa({antialias:!1})),n.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),n.clear(),n.render(r,i);const s=new Tt(n.domElement);return s.minFilter=e.minFilter,s.magFilter=e.magFilter,s.wrapS=e.wrapS,s.wrapT=e.wrapT,s.name=e.name,sd&&(sd.dispose(),sd=null),s}const hd={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class ud{constructor(){this.pluginCallbacks=[],this.register((function(e){return new jd(e)})),this.register((function(e){return new Xd(e)})),this.register((function(e){return new Yd(e)})),this.register((function(e){return new Kd(e)})),this.register((function(e){return new Zd(e)})),this.register((function(e){return new $d(e)})),this.register((function(e){return new Jd(e)})),this.register((function(e){return new qd(e)})),this.register((function(e){return new ep(e)})),this.register((function(e){return new tp(e)})),this.register((function(e){return new np(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){const r=new Wd,s=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)s.push(this.pluginCallbacks[e](r));r.setPlugins(s),r.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,i,r,t)}))}}var dd;dd={insertKeyframe:function(e,t){const n=.001,i=e.getValueSize(),r=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+i),a=e.createInterpolant(new e.ValueBufferType(i));let o;if(0===e.times.length){r[0]=t;for(let e=0;e<i;e++)s[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;r[0]=t,r.set(e.times,1),s.set(a.evaluate(t),0),s.set(e.values,i),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;r[r.length-1]=t,r.set(e.times,0),s.set(e.values,0),s.set(a.evaluate(t),e.values.length),o=r.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){r.set(e.times.slice(0,l+1),0),r[l+1]=t,r.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*i),0),s.set(a.evaluate(t),(l+1)*i),s.set(e.values.slice((l+1)*i),(l+2)*i),o=l+1;break}}return e.times=r,e.values=s,o},mergeMorphTargetTracks:function(e,t){const n=[],i={},r=e.tracks;for(let e=0;e<r.length;++e){let s=r[e];const a=Au.parseTrackName(s.name),o=Au.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){n.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),s=s.clone(),s.setInterpolation(_e)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[a.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(void 0===i[o.uuid]){h=s.clone();const e=new h.ValueBufferType(l*h.times.length);for(let t=0;t<h.times.length;t++)e[t*l+c]=h.values[t];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=e,i[o.uuid]=h,n.push(h);continue}const u=s.createInterpolant(new s.ValueBufferType(1));h=i[o.uuid];for(let e=0;e<h.times.length;e++)h.values[e*l+c]=u.evaluate(h.times[e]);for(let e=0;e<s.times.length;e++){const t=this.insertKeyframe(h,s.times[e]);h.values[t*l+c]=s.values[e]}}return e.tracks=n,e}},((e,t,n)=>{t in e?id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(ud,"Utils"+"",dd);const pd=0,fd=1,md=2,Ad=3,gd=4,vd=5120,yd=5121,xd=5122,_d=5123,Ed=5124,wd=5125,Cd=5126,bd=34962,Md=34963,Sd=9728,Id=9729,Bd=9984,Td=9985,Rd=9986,Dd=9987,Ld=33071,Pd=33648,Fd=10497,Ud="KHR_mesh_quantization",Od={};Od[1003]=Sd,Od[1004]=Bd,Od[1005]=Rd,Od[1006]=Id,Od[1007]=Td,Od[1008]=Dd,Od[1001]=Ld,Od[1e3]=Fd,Od[1002]=Pd;const Nd={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},kd=new ni;function Gd(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Qd(e){return 4*Math.ceil(e/4)}function zd(e,t=0){const n=Qd(e.byteLength);if(n!==e.byteLength){const i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(let r=e.byteLength;r<n;r++)i[r]=t;return i.buffer}return e}function Hd(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Vd(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class Wd{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,s=i.json;n=i.options;const a=i.extensionsUsed,o=i.extensionsRequired,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a),h=Object.keys(o);c.length>0&&(s.extensionsUsed=c),h.length>0&&(s.extensionsRequired=h),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===n.binary?l.arrayBuffer().then((e=>{const n=zd(e),i=new DataView(new ArrayBuffer(8));i.setUint32(0,n.byteLength,!0),i.setUint32(4,5130562,!0);const r=zd((a=JSON.stringify(s),(new TextEncoder).encode(a).buffer),32);var a;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,r.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const h=12+o.byteLength+r.byteLength+i.byteLength+n.byteLength;c.setUint32(8,h,!0);new Blob([l,o,r,i,n],{type:"application/octet-stream"}).arrayBuffer().then(t)})):s.buffers&&s.buffers.length>0?rd(l).then((e=>{s.buffers[0].uri=e,t(s)})):t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in r.gltfExtensions)t.extensions[e]=r.gltfExtensions[e],i[e]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new Ot;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new Ot;for(let e=0,t=n.count;e<t;e++)i.fromBufferAttribute(n,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(i.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(e){return("colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding)?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof ll&&(e=cd(e)),t instanceof ll&&(t=cd(t));const i=e?e.image:null,r=t?t.image:null,s=Math.max(i?i.width:0,r?r.width:0),a=Math.max(i?i.height:0,r?r.height:0),o=Hd();o.width=s,o.height=a;const l=o.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,s,a);const c=l.getImageData(0,0,s,a);if(i){l.drawImage(i,0,0,s,a);const t=n(e),r=l.getImageData(0,0,s,a).data;for(let e=2;e<r.length;e+=4)c.data[e]=256*t(r[e]/256)}if(r){l.drawImage(r,0,0,s,a);const e=n(t),i=l.getImageData(0,0,s,a).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}l.putImageData(c,0,0);const h=(e||t).clone();return h.source=new Tt(o).source,"colorSpace"in h?h.colorSpace="":h.encoding=3e3,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,r){const s=this.json;let a;switch(s.bufferViews||(s.bufferViews=[]),t){case vd:case yd:a=1;break;case xd:case _d:a=2;break;default:a=4}const o=Qd(i*e.itemSize*a),l=new DataView(new ArrayBuffer(o));let c=0;for(let r=n;r<n+i;r++)for(let n=0;n<e.itemSize;n++){let i;e.itemSize>4?i=e.array[r*e.itemSize+n]:(0===n?i=e.getX(r):1===n?i=e.getY(r):2===n?i=e.getZ(r):3===n&&(i=e.getW(r)),!0===e.normalized&&(i=at.normalize(i,e.array))),t===Cd?l.setFloat32(c,i,!0):t===Ed?l.setInt32(c,i,!0):t===wd?l.setUint32(c,i,!0):t===xd?l.setInt16(c,i,!0):t===_d?l.setUint16(c,i,!0):t===vd?l.setInt8(c,i):t===yd&&l.setUint8(c,i),c+=a}const h={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:o};void 0!==r&&(h.target=r),r===bd&&(h.byteStride=e.itemSize*a),this.byteOffset+=o,s.bufferViews.push(h);return{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),e.arrayBuffer().then((e=>{const i=zd(e),r={buffer:t.processBuffer(i),byteOffset:t.byteOffset,byteLength:i.byteLength};return t.byteOffset+=i.byteLength,n.bufferViews.push(r)-1}))}processAccessor(e,t,n,i){const r=this.json;let s;if(e.array.constructor===Float32Array)s=Cd;else if(e.array.constructor===Int32Array)s=Ed;else if(e.array.constructor===Uint32Array)s=wd;else if(e.array.constructor===Int16Array)s=xd;else if(e.array.constructor===Uint16Array)s=_d;else if(e.array.constructor===Int8Array)s=vd;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);s=yd}if(void 0===n&&(n=0),void 0===i&&(i=e.count),0===i)return null;const a=function(e,t,n){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=t;r<t+n;r++)for(let t=0;t<e.itemSize;t++){let n;e.itemSize>4?n=e.array[r*e.itemSize+t]:(0===t?n=e.getX(r):1===t?n=e.getY(r):2===t?n=e.getZ(r):3===t&&(n=e.getW(r)),!0===e.normalized&&(n=at.normalize(n,e.array))),i.min[t]=Math.min(i.min[t],n),i.max[t]=Math.max(i.max[t],n)}return i}(e,n,i);let o;void 0!==t&&(o=e===t.index?Md:bd);const l=this.processBufferView(e,s,n,i,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:s,count:i,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(c)-1}processImage(e,t,n,i="image/png"){if(null!==e){const r=this,s=r.cache,a=r.json,o=r.options,l=r.pending;s.images.has(e)||s.images.set(e,{});const c=s.images.get(e),h=i+":flipY/"+n.toString();if(void 0!==c[h])return c[h];a.images||(a.images=[]);const u={mimeType:i},d=Hd();d.width=Math.min(e.width,o.maxTextureSize),d.height=Math.min(e.height,o.maxTextureSize);const p=d.getContext("2d");if(!0===n&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){t!==F&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const n=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<n.length;t+=4)n[t+0]=e.data[t+0],n[t+1]=e.data[t+1],n[t+2]=e.data[t+2],n[t+3]=e.data[t+3];p.putImageData(new ImageData(n,e.width,e.height),0,0)}else p.drawImage(e,0,0,d.width,d.height);!0===o.binary?l.push(Vd(d,i).then((e=>r.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==d.toDataURL?u.uri=d.toDataURL(i):l.push(Vd(d,i).then(rd).then((e=>{u.uri=e})));const f=a.images.push(u)-1;return c[h]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Od[e.magFilter],minFilter:Od[e.minFilter],wrapS:Od[e.wrapS],wrapT:Od[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.options,n=this.cache,i=this.json;if(n.textures.has(e))return n.textures.get(e);i.textures||(i.textures=[]),e instanceof ll&&(e=cd(e,t.maxTextureSize));let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");const s={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(s.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,s)}));const a=i.textures.push(s)-1;return n.textures.set(e,a),a}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(Gd(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),i.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),2===e.side&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)}));const s=n.materials.push(i)-1;return t.materials.set(e,s),s}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,n=e.material.length;t<n;t++)i.push(e.material[t].uuid);else i.push(e.material.uuid);const r=i.join(":");if(t.meshes.has(r))return t.meshes.get(r);const s=e.geometry;let a;a=e.isLineSegments?fd:e.isLineLoop?md:e.isLine?Ad:e.isPoints?pd:e.material.wireframe?fd:gd;const o={},l={},c=[],h=[],u={...nd>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=s.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in s.attributes){if("morph"===e.slice(0,5))continue;const n=s.attributes[e];e=u[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(n))){l[e]=t.attributes.get(this.getUID(n));continue}p=null;const i=n.array;"JOINTS_0"!==e||i instanceof Uint16Array||i instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new fi(new Uint16Array(i),n.itemSize,n.normalized));const r=this.processAccessor(p||n,s);null!==r&&(e.startsWith("_")||this.detectMeshQuantization(e,n),l[e]=r,t.attributes.set(this.getUID(n),r))}if(void 0!==d&&s.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],i=[],r={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)r[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const o={};let l=!1;for(const e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const n=s.morphAttributes[e][a],i=e.toUpperCase(),r=s.attributes[e];if(t.attributes.has(this.getUID(n,!0))){o[i]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!s.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let t=0;t<n.itemSize;t++)0===t&&c.setX(e,n.getX(e)-r.getX(e)),1===t&&c.setY(e,n.getY(e)-r.getY(e)),2===t&&c.setZ(e,n.getZ(e)-r.getZ(e)),3===t&&c.setW(e,n.getW(e)-r.getW(e));o[i]=this.processAccessor(c,s),t.attributes.set(this.getUID(r,!0),o[i])}h.push(o),n.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&i.push(r[a])}o.weights=n,i.length>0&&(o.extras={},o.extras.targetNames=i)}const f=Array.isArray(e.material);if(f&&0===s.groups.length)return null;const m=f?e.material:[e.material],A=f?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,n=A.length;e<n;e++){const n={mode:a,attributes:l};if(this.serializeUserData(s,n),h.length>0&&(n.targets=h),null!==s.index){let i=this.getUID(s.index);void 0===A[e].start&&void 0===A[e].count||(i+=":"+A[e].start+":"+A[e].count),t.attributes.has(i)?n.indices=t.attributes.get(i):(n.indices=this.processAccessor(s.index,s,A[e].start,A[e].count),t.attributes.set(i,n.indices)),null===n.indices&&delete n.indices}const i=this.processMaterial(m[A[e].materialIndex]);null!==i&&(n.material=i),c.push(n)}o.primitives=c,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,o)}));const g=n.meshes.push(o)-1;return t.meshes.set(r,g),g}detectMeshQuantization(e,t){if(this.extensionsUsed[Ud])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];hd[i]&&hd[i].includes(n)&&(this.extensionsUsed[Ud]=!0,this.extensionsRequired[Ud]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:at.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);const r=(e=ud.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,s=[],a=[];for(let e=0;e<r.length;++e){const n=r[e],o=Au.parseTrackName(n.name);let l=Au.findNode(t,o.nodeName);const c=Nd[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',n.name),null;const h=1;let u,d=n.values.length/n.times.length;c===Nd.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(u="CUBICSPLINE",d/=3):u=n.getInterpolation()===xe?"STEP":"LINEAR",a.push({input:this.processAccessor(new fi(n.times,h)),output:this.processAccessor(new fi(n.values,d)),interpolation:u}),s.push({sampler:a.length-1,target:{node:i.get(l),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:a,channels:s}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],r=e.skeleton;if(void 0===r)return null;const s=e.skeleton.bones[0];if(void 0===s)return null;const a=[],o=new Float32Array(16*r.bones.length),l=new fn;for(let t=0;t<r.bones.length;++t)a.push(n.get(r.bones[t])),l.copy(r.boneInverses[t]),l.multiply(e.bindMatrix).toArray(o,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new fi(o,16)),joints:a,skeleton:n.get(s)});return i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();Gd(t,[0,0,0,1])||(r.rotation=t),Gd(n,[0,0,0])||(r.translation=n),Gd(i,[1,1,1])||(r.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Gd(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(r.mesh=t)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,r=e.children.length;i<r;i++){const r=e.children[i];if(r.visible||!1===n.onlyVisible){const e=this.processNode(r);null!==e&&t.push(e)}}t.length>0&&(r.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,r)}));const s=t.nodes.push(r)-1;return i.set(e,s),s}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const r=[];for(let t=0,i=e.children.length;t<i;t++){const i=e.children[t];if(i.visible||!1===n.onlyVisible){const e=this.processNode(i);null!==e&&r.push(e)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const t=new qa;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const n=[];for(let t=0;t<e.length;t++)e[t]instanceof qa?this.processScene(e[t]):n.push(e[t]);n.length>0&&this.processObjects(n);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class jd{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,i=n.json,r=n.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const a=i.extensions[this.name].lights;a.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}let Xd=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},Jd=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),r.clearcoatTexture=t}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(t,e.clearcoatNormalMap),r.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},qd=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),r.iridescenceTexture=t}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},Yd=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),r.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},Kd=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),r.thicknessTexture=t}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},Zd=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}},$d=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(kd)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.specularIntensityMap){const t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),r.specularTexture=t}if(e.specularColorMap){const t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),r.specularColorTexture=t}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},ep=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.sheenRoughnessMap){const t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),r.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),r.sheenColorTexture=t}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},tp=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.anisotropyMap){const t={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),r.anisotropyTexture=t}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}},np=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}};var ip=Uint8Array,rp=Uint16Array,sp=Uint32Array,ap=new ip([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),op=new ip([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lp=new ip([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cp=function(e,t){for(var n=new rp(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new sp(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},hp=cp(ap,2),up=hp[0],dp=hp[1];up[28]=258,dp[258]=28;for(var pp=cp(op,0)[0],fp=new rp(32768),mp=0;mp<32768;++mp){var Ap=(43690&mp)>>>1|(21845&mp)<<1;Ap=(61680&(Ap=(52428&Ap)>>>2|(13107&Ap)<<2))>>>4|(3855&Ap)<<4,fp[mp]=((65280&Ap)>>>8|(255&Ap)<<8)>>>1}var gp=function(e,t,n){for(var i=e.length,r=0,s=new rp(t);r<i;++r)++s[e[r]-1];var a,o=new rp(t);for(r=0;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new rp(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],h=t-e[r],u=o[e[r]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[fp[u]>>>l]=c}else for(a=new rp(i),r=0;r<i;++r)e[r]&&(a[r]=fp[o[e[r]-1]++]>>>15-e[r]);return a},vp=new ip(288);for(mp=0;mp<144;++mp)vp[mp]=8;for(mp=144;mp<256;++mp)vp[mp]=9;for(mp=256;mp<280;++mp)vp[mp]=7;for(mp=280;mp<288;++mp)vp[mp]=8;var yp=new ip(32);for(mp=0;mp<32;++mp)yp[mp]=5;var xp=gp(vp,9,1),_p=gp(yp,5,1),Ep=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},wp=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Cp=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},bp=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new ip(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new ip(3*i));var a,o=function(e){var n=t.length;if(e>n){var i=new ip(Math.max(2*n,e));i.set(t),t=i}},l=n.f||0,c=n.p||0,h=n.b||0,u=n.l,d=n.d,p=n.m,f=n.n,m=8*i;do{if(!u){n.f=l=wp(e,c,1);var A=wp(e,c+1,3);if(c+=3,!A){var g=e[(I=((a=c)/8|0)+(7&a&&1)+4)-4]|e[I-3]<<8,v=I+g;if(v>i){if(s)throw"unexpected EOF";break}r&&o(h+g),t.set(e.subarray(I,v),h),n.b=h+=g,n.p=c=8*v;continue}if(1==A)u=xp,d=_p,p=9,f=5;else{if(2!=A)throw"invalid block type";var y=wp(e,c,31)+257,x=wp(e,c+10,15)+4,_=y+wp(e,c+5,31)+1;c+=14;for(var E=new ip(_),w=new ip(19),C=0;C<x;++C)w[lp[C]]=wp(e,c+3*C,7);c+=3*x;var b=Ep(w),M=(1<<b)-1,S=gp(w,b,1);for(C=0;C<_;){var I,B=S[wp(e,c,M)];if(c+=15&B,(I=B>>>4)<16)E[C++]=I;else{var T=0,R=0;for(16==I?(R=3+wp(e,c,3),c+=2,T=E[C-1]):17==I?(R=3+wp(e,c,7),c+=3):18==I&&(R=11+wp(e,c,127),c+=7);R--;)E[C++]=T}}var D=E.subarray(0,y),L=E.subarray(y);p=Ep(D),f=Ep(L),u=gp(D,p,1),d=gp(L,f,1)}if(c>m){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var P=(1<<p)-1,F=(1<<f)-1,U=c;;U=c){var O=(T=u[Cp(e,c)&P])>>>4;if((c+=15&T)>m){if(s)throw"unexpected EOF";break}if(!T)throw"invalid length/literal";if(O<256)t[h++]=O;else{if(256==O){U=c,u=null;break}var N=O-254;if(O>264){var k=ap[C=O-257];N=wp(e,c,(1<<k)-1)+up[C],c+=k}var G=d[Cp(e,c)&F],Q=G>>>4;if(!G)throw"invalid distance";c+=15&G;L=pp[Q];if(Q>3){k=op[Q];L+=Cp(e,c)&(1<<k)-1,c+=k}if(c>m){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var z=h+N;h<z;h+=4)t[h]=t[h-L],t[h+1]=t[h+1-L],t[h+2]=t[h+2-L],t[h+3]=t[h+3-L];h=z}}n.l=u,n.p=U,n.b=h,u&&(l=1,n.m=p,n.d=d,n.n=f)}while(!l);return h==t.length?t:function(e,t,n){(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof rp?rp:e instanceof sp?sp:ip)(n-t);return i.set(e.subarray(t,n)),i}(t,0,h)},Mp=new ip(0);function Sp(e,t){return bp((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var Ip="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ip.decode(Mp,{stream:!0}),1}catch(e){}const Bp=new Kn,Tp=new Ot;class Rp{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let r=1;t&&(r=t.getX(i)+t.getX(i+1)+t.getX(i+2)),Bp.a.fromBufferAttribute(e,i),Bp.b.fromBufferAttribute(e,i+1),Bp.c.fromBufferAttribute(e,i+2),r*=Bp.getArea(),n[i/3]=r}this.distribution=new Float32Array(e.count/3);let i=0;for(let e=0;e<n.length;e++)i+=n[e],this.distribution[e]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const i=this.sampleFaceIndex();return this.sampleFace(i,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,i=t.length-1,r=-1;for(;n<=i;){const s=Math.ceil((n+i)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?i=s-1:n=s+1}return r}sampleFace(e,t,n,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),Bp.a.fromBufferAttribute(this.positionAttribute,3*e),Bp.b.fromBufferAttribute(this.positionAttribute,3*e+1),Bp.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Bp.a,r).addScaledVector(Bp.b,s).addScaledVector(Bp.c,1-(r+s)),void 0!==n&&Bp.getNormal(n),void 0!==i&&void 0!==this.colorAttribute&&(Bp.a.fromBufferAttribute(this.colorAttribute,3*e),Bp.b.fromBufferAttribute(this.colorAttribute,3*e+1),Bp.c.fromBufferAttribute(this.colorAttribute,3*e+2),Tp.set(0,0,0).addScaledVector(Bp.a,r).addScaledVector(Bp.b,s).addScaledVector(Bp.c,1-(r+s)),i.r=Tp.x,i.g=Tp.y,i.b=Tp.z),this}}var Dp=Object.defineProperty,Lp=(e,t,n)=>(((e,t,n)=>{t in e?Dp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Pp=new pn,Fp=new ar,Up=Math.cos(Math.PI/180*70),Op=(e,t)=>(e%t+t)%t;let Np=class extends je{constructor(e,t){super(),Lp(this,"object"),Lp(this,"domElement"),Lp(this,"enabled",!0),Lp(this,"target",new Ot),Lp(this,"minDistance",0),Lp(this,"maxDistance",1/0),Lp(this,"minZoom",0),Lp(this,"maxZoom",1/0),Lp(this,"minPolarAngle",0),Lp(this,"maxPolarAngle",Math.PI),Lp(this,"minAzimuthAngle",-1/0),Lp(this,"maxAzimuthAngle",1/0),Lp(this,"enableDamping",!1),Lp(this,"dampingFactor",.05),Lp(this,"enableZoom",!0),Lp(this,"zoomSpeed",1),Lp(this,"enableRotate",!0),Lp(this,"rotateSpeed",1),Lp(this,"enablePan",!0),Lp(this,"panSpeed",1),Lp(this,"screenSpacePanning",!0),Lp(this,"keyPanSpeed",7),Lp(this,"zoomToCursor",!1),Lp(this,"autoRotate",!1),Lp(this,"autoRotateSpeed",2),Lp(this,"reverseOrbit",!1),Lp(this,"reverseHorizontalOrbit",!1),Lp(this,"reverseVerticalOrbit",!1),Lp(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Lp(this,"mouseButtons",{LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN}),Lp(this,"touches",{ONE:i.ROTATE,TWO:i.DOLLY_PAN}),Lp(this,"target0"),Lp(this,"position0"),Lp(this,"zoom0"),Lp(this,"_domElementKeyEvents",null),Lp(this,"getPolarAngle"),Lp(this,"getAzimuthalAngle"),Lp(this,"setPolarAngle"),Lp(this,"setAzimuthalAngle"),Lp(this,"getDistance"),Lp(this,"listenToKeyEvents"),Lp(this,"stopListenToKeyEvents"),Lp(this,"saveState"),Lp(this,"reset"),Lp(this,"update"),Lp(this,"connect"),Lp(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=e=>{let t=Op(e,2*Math.PI),n=u.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),d.phi=t-n,r.update()},this.setAzimuthalAngle=e=>{let t=Op(e,2*Math.PI),n=u.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),d.theta=t-n,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",K),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",K),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(s),r.update(),c=l.NONE},this.update=(()=>{const t=new Ot,n=new Ot(0,1,0),i=(new Ut).setFromUnitVectors(e.up,n),a=i.clone().invert(),o=new Ot,m=new Ut,A=2*Math.PI;return function(){const g=r.object.position;i.setFromUnitVectors(e.up,n),a.copy(i).invert(),t.copy(g).sub(r.target),t.applyQuaternion(i),u.setFromVector3(t),r.autoRotate&&c===l.NONE&&T(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(u.theta+=d.theta*r.dampingFactor,u.phi+=d.phi*r.dampingFactor):(u.theta+=d.theta,u.phi+=d.phi);let v=r.minAzimuthAngle,y=r.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=A:v>Math.PI&&(v-=A),y<-Math.PI?y+=A:y>Math.PI&&(y-=A),u.theta=v<=y?Math.max(v,Math.min(y,u.theta)):u.theta>(v+y)/2?Math.max(v,u.theta):Math.min(y,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.zoomToCursor&&M||r.object.isOrthographicCamera?u.radius=N(u.radius):u.radius=N(u.radius*p),t.setFromSpherical(u),t.applyQuaternion(a),g.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(d.theta*=1-r.dampingFactor,d.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(d.set(0,0,0),f.set(0,0,0));let x=!1;if(r.zoomToCursor&&M){let n=null;if(r.object instanceof Zi&&r.object.isPerspectiveCamera){const e=t.length();n=N(e*p);const i=e-n;r.object.position.addScaledVector(C,i),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const e=new Ot(b.x,b.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/p)),r.object.updateProjectionMatrix(),x=!0;const i=new Ot(b.x,b.y,0);i.unproject(r.object),r.object.position.sub(i).add(e),r.object.updateMatrixWorld(),n=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==n&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(n).add(r.object.position):(Pp.origin.copy(r.object.position),Pp.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Pp.direction))<Up?e.lookAt(r.target):(Fp.setFromNormalAndCoplanarPoint(r.object.up,r.target),Pp.intersectPlane(Fp,r.target))))}else r.object instanceof wr&&r.object.isOrthographicCamera&&(x=1!==p,x&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/p)),r.object.updateProjectionMatrix()));return p=1,M=!1,!!(x||o.distanceToSquared(r.object.position)>h||8*(1-m.dot(r.object.quaternion))>h)&&(r.dispatchEvent(s),o.copy(r.object.position),m.copy(r.object.quaternion),x=!1,!0)}})(),this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",Z),r.domElement.addEventListener("pointerdown",X),r.domElement.addEventListener("pointercancel",q),r.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var e,t,n,i,s,a;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",Z),null==(t=r.domElement)||t.removeEventListener("pointerdown",X),null==(n=r.domElement)||n.removeEventListener("pointercancel",q),null==(i=r.domElement)||i.removeEventListener("wheel",Y),null==(s=r.domElement)||s.ownerDocument.removeEventListener("pointermove",J),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointerup",q),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",K)};const r=this,s={type:"change"},a={type:"start"},o={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=l.NONE;const h=1e-6,u=new bu,d=new bu;let p=1;const f=new Ot,m=new ot,A=new ot,g=new ot,v=new ot,y=new ot,x=new ot,_=new ot,E=new ot,w=new ot,C=new Ot,b=new ot;let M=!1;const S=[],I={};function B(){return Math.pow(.95,r.zoomSpeed)}function T(e){r.reverseOrbit||r.reverseHorizontalOrbit?d.theta+=e:d.theta-=e}function R(e){r.reverseOrbit||r.reverseVerticalOrbit?d.phi+=e:d.phi-=e}const D=(()=>{const e=new Ot;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),f.add(e)}})(),L=(()=>{const e=new Ot;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),f.add(e)}})(),P=(()=>{const e=new Ot;return function(t,n){const i=r.domElement;if(i&&r.object instanceof Zi&&r.object.isPerspectiveCamera){const s=r.object.position;e.copy(s).sub(r.target);let a=e.length();a*=Math.tan(r.object.fov/2*Math.PI/180),D(2*t*a/i.clientHeight,r.object.matrix),L(2*n*a/i.clientHeight,r.object.matrix)}else i&&r.object instanceof wr&&r.object.isOrthographicCamera?(D(t*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),L(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function F(e){r.object instanceof Zi&&r.object.isPerspectiveCamera||r.object instanceof wr&&r.object.isOrthographicCamera?p/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function U(e){r.object instanceof Zi&&r.object.isPerspectiveCamera||r.object instanceof wr&&r.object.isOrthographicCamera?p*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){if(!r.zoomToCursor||!r.domElement)return;M=!0;const t=r.domElement.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,s=t.width,a=t.height;b.x=n/s*2-1,b.y=-i/a*2+1,C.set(b.x,b.y,1).unproject(r.object).sub(r.object.position).normalize()}function N(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function k(e){m.set(e.clientX,e.clientY)}function G(e){v.set(e.clientX,e.clientY)}function Q(){if(1==S.length)m.set(S[0].pageX,S[0].pageY);else{const e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);m.set(e,t)}}function z(){if(1==S.length)v.set(S[0].pageX,S[0].pageY);else{const e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);v.set(e,t)}}function H(){const e=S[0].pageX-S[1].pageX,t=S[0].pageY-S[1].pageY,n=Math.sqrt(e*e+t*t);_.set(0,n)}function V(e){if(1==S.length)A.set(e.pageX,e.pageY);else{const t=ee(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);A.set(n,i)}g.subVectors(A,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(T(2*Math.PI*g.x/t.clientHeight),R(2*Math.PI*g.y/t.clientHeight)),m.copy(A)}function W(e){if(1==S.length)y.set(e.pageX,e.pageY);else{const t=ee(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);y.set(n,i)}x.subVectors(y,v).multiplyScalar(r.panSpeed),P(x.x,x.y),v.copy(y)}function j(e){const t=ee(e),n=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(n*n+i*i);E.set(0,s),w.set(0,Math.pow(E.y/_.y,r.zoomSpeed)),F(w.y),_.copy(E)}function X(e){var t,s;!1!==r.enabled&&(0===S.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",J),null==(s=r.domElement)||s.ownerDocument.addEventListener("pointerup",q)),function(e){S.push(e)}(e),"touch"===e.pointerType?function(e){switch($(e),S.length){case 1:switch(r.touches.ONE){case i.ROTATE:if(!1===r.enableRotate)return;Q(),c=l.TOUCH_ROTATE;break;case i.PAN:if(!1===r.enablePan)return;z(),c=l.TOUCH_PAN;break;default:c=l.NONE}break;case 2:switch(r.touches.TWO){case i.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&H(),r.enablePan&&z(),c=l.TOUCH_DOLLY_PAN;break;case i.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&H(),r.enableRotate&&Q(),c=l.TOUCH_DOLLY_ROTATE;break;default:c=l.NONE}break;default:c=l.NONE}c!==l.NONE&&r.dispatchEvent(a)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.DOLLY:if(!1===r.enableZoom)return;!function(e){O(e),_.set(e.clientX,e.clientY)}(e),c=l.DOLLY;break;case n.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;G(e),c=l.PAN}else{if(!1===r.enableRotate)return;k(e),c=l.ROTATE}break;case n.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;k(e),c=l.ROTATE}else{if(!1===r.enablePan)return;G(e),c=l.PAN}break;default:c=l.NONE}c!==l.NONE&&r.dispatchEvent(a)}(e))}function J(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch($(e),c){case l.TOUCH_ROTATE:if(!1===r.enableRotate)return;V(e),r.update();break;case l.TOUCH_PAN:if(!1===r.enablePan)return;W(e),r.update();break;case l.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&j(e),r.enablePan&&W(e)}(e),r.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&j(e),r.enableRotate&&V(e)}(e),r.update();break;default:c=l.NONE}}(e):function(e){if(!1===r.enabled)return;switch(c){case l.ROTATE:if(!1===r.enableRotate)return;!function(e){A.set(e.clientX,e.clientY),g.subVectors(A,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(T(2*Math.PI*g.x/t.clientHeight),R(2*Math.PI*g.y/t.clientHeight)),m.copy(A),r.update()}(e);break;case l.DOLLY:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),w.subVectors(E,_),w.y>0?F(B()):w.y<0&&U(B()),_.copy(E),r.update()}(e);break;case l.PAN:if(!1===r.enablePan)return;!function(e){y.set(e.clientX,e.clientY),x.subVectors(y,v).multiplyScalar(r.panSpeed),P(x.x,x.y),v.copy(y),r.update()}(e)}}(e))}function q(e){var t,n,i;!function(e){delete I[e.pointerId];for(let t=0;t<S.length;t++)if(S[t].pointerId==e.pointerId)return void S.splice(t,1)}(e),0===S.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointermove",J),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointerup",q)),r.dispatchEvent(o),c=l.NONE}function Y(e){!1===r.enabled||!1===r.enableZoom||c!==l.NONE&&c!==l.ROTATE||(e.preventDefault(),r.dispatchEvent(a),function(e){O(e),e.deltaY<0?U(B()):e.deltaY>0&&F(B()),r.update()}(e),r.dispatchEvent(o))}function K(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:P(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:P(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:P(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:P(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function Z(e){!1!==r.enabled&&e.preventDefault()}function $(e){let t=I[e.pointerId];void 0===t&&(t=new ot,I[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ee(e){const t=e.pointerId===S[0].pointerId?S[1]:S[0];return I[t.pointerId]}void 0!==t&&this.connect(t),this.update()}};var kp=Object.defineProperty,Gp=(e,t,n)=>(((e,t,n)=>{t in e?kp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Qp{constructor(){Gp(this,"enabled",!0),Gp(this,"needsSwap",!0),Gp(this,"clear",!1),Gp(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,i,r){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class zp{constructor(e){Gp(this,"camera",new wr(-1,1,1,-1,0,1)),Gp(this,"geometry",new dr(2,2)),Gp(this,"mesh"),this.mesh=new Hi(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var Hp=Object.defineProperty,Vp=(e,t,n)=>(((e,t,n)=>{t in e?Hp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Wp extends Qp{constructor(e,t="tDiffuse"){super(),Vp(this,"textureID"),Vp(this,"uniforms"),Vp(this,"material"),Vp(this,"fsQuad"),this.textureID=t,e instanceof Yi?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=qi.clone(e.uniforms),this.material=new Yi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new zp(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}const jp={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};var Xp=Object.defineProperty,Jp=(e,t,n)=>(((e,t,n)=>{t in e?Xp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class qp extends Qp{constructor(e,t){super(),Jp(this,"scene"),Jp(this,"camera"),Jp(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;let s,a;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,a=1):(s=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class Yp extends Qp{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var Kp=Object.defineProperty,Zp=(e,t,n)=>(((e,t,n)=>{t in e?Kp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class $p{constructor(e,t){if(Zp(this,"renderer"),Zp(this,"_pixelRatio"),Zp(this,"_width"),Zp(this,"_height"),Zp(this,"renderTarget1"),Zp(this,"renderTarget2"),Zp(this,"writeBuffer"),Zp(this,"readBuffer"),Zp(this,"renderToScreen"),Zp(this,"passes",[]),Zp(this,"copyPass"),Zp(this,"clock"),this.renderer=e,void 0===t){const n={minFilter:E,magFilter:E,format:F},i=e.getSize(new ot);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new Lt(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===jp&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Wp&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Wp(jp),this.copyPass.material.blending=0,this.clock=new Zh}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const i=this.passes.length;for(let t=0;t<i;t++){const i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==qp&&(i instanceof qp?n=!0:i instanceof Yp&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new ot);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}var ef=Object.defineProperty,tf=(e,t,n)=>(((e,t,n)=>{t in e?ef(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class nf extends Qp{constructor(e,t,n,i,r=0){super(),tf(this,"scene"),tf(this,"camera"),tf(this,"overrideMaterial"),tf(this,"clearColor"),tf(this,"clearAlpha"),tf(this,"clearDepth",!1),tf(this,"_oldClearColor",new ni),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=r,this.clear=!0,this.needsSwap=!1}render(e,t,n){let i,r=e.autoClear;e.autoClear=!1;let s=null;void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=r}}function rf(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}const sf="srgb",af="srgb-linear";class of extends uh{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new pf(e)})),this.register((function(e){return new ff(e)})),this.register((function(e){return new wf(e)})),this.register((function(e){return new Cf(e)})),this.register((function(e){return new bf(e)})),this.register((function(e){return new Af(e)})),this.register((function(e){return new gf(e)})),this.register((function(e){return new vf(e)})),this.register((function(e){return new yf(e)})),this.register((function(e){return new df(e)})),this.register((function(e){return new xf(e)})),this.register((function(e){return new mf(e)})),this.register((function(e){return new Ef(e)})),this.register((function(e){return new _f(e)})),this.register((function(e){return new hf(e)})),this.register((function(e){return new Mf(e)})),this.register((function(e){return new Sf(e)}))}load(e,t,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=kh.extractUrlBase(e);s=kh.resolveURL(t,this.path)}else s=kh.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},o=new fh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{r.parse(n,s,(function(n){t(n),r.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const s={},a={};if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(rf(new Uint8Array(e.slice(0,4)))===If){try{s[cf.KHR_BINARY_GLTF]=new Rf(e)}catch(e){return void(i&&i(e))}r=JSON.parse(s[cf.KHR_BINARY_GLTF].content)}else r=JSON.parse(rf(new Uint8Array(e)))}else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const o=new nm(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](o);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[t.name]=t,s[t.name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){const t=r.extensionsUsed[e],n=r.extensionsRequired||[];switch(t){case cf.KHR_MATERIALS_UNLIT:s[t]=new uf;break;case cf.KHR_DRACO_MESH_COMPRESSION:s[t]=new Df(r,this.dracoLoader);break;case cf.KHR_TEXTURE_TRANSFORM:s[t]=new Lf;break;case cf.KHR_MESH_QUANTIZATION:s[t]=new Pf;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}o.setExtensions(s),o.setPlugins(a),o.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}function lf(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const cf={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class hf{constructor(e){this.parser=e,this.name=cf.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let a;const o=new ni(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],af);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new Lh(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Rh(o),a.distance=l;break;case"spot":a=new Mh(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,Yf(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class uf{constructor(){this.name=cf.KHR_MATERIALS_UNLIT}getMaterialType(){return ai}extendParams(e,t,n){const i=[];e.color=new ni(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],af),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,sf))}return Promise.all(i)}}class df{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class pf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ot(e,e)}return Promise.all(r)}}class ff{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class mf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class Af{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ni(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],af)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,sf)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class gf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class vf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new ni).setRGB(a[0],a[1],a[2],af),Promise.all(r)}}class yf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class xf{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new ni).setRGB(a[0],a[1],a[2],af),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,sf)),Promise.all(r)}}class _f{constructor(e){this.parser=e,this.name=cf.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class Ef{constructor(e){this.parser=e,this.name=cf.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fc:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class wf{constructor(e){this.parser=e,this.name=cf.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class Cf{constructor(e){this.parser=e,this.name=cf.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class bf{constructor(e){this.parser=e,this.name=cf.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Mf{constructor(e){this.name=cf.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,a=e.byteStride,o=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,a,o,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(s*a);return r.decodeGltfBuffer(new Uint8Array(t),s,a,o,e.mode,e.filter),t}))}))}return null}}class Sf{constructor(e){this.name=cf.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const e of i.primitives)if(e.mode!==Nf.TRIANGLES&&e.mode!==Nf.TRIANGLE_STRIP&&e.mode!==Nf.TRIANGLE_FAN&&void 0!==e.mode)return null;const r=n.extensions[this.name].attributes,s=[],a={};for(const e in r)s.push(this.parser.getDependency("accessor",r[e]).then((t=>(a[e]=t,a[e]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const e of n){const t=new fn,n=new Ot,s=new Ut,o=new Ot(1,1,1),l=new zo(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(n,s,o));for(const t in a)if("_COLOR_0"===t){const e=a[t];l.instanceColor=new Po(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);kn.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]})))}}const If="glTF",Bf=1313821514,Tf=5130562;class Rf{constructor(e){this.name=cf.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:rf(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==If)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let r=0;for(;r<n;){const t=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,n===Bf){const n=new Uint8Array(e,12+r,t);this.content=rf(n)}else if(n===Tf){const n=12+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Df{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=cf.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(const e in s){const t=Hf[e]||e.toLowerCase();a[t]=s[e]}for(const t in e.attributes){const i=Hf[t]||t.toLowerCase();if(void 0!==s[t]){const r=n.accessors[e.attributes[t]],s=kf[r.componentType];l[i]=s.name,o[i]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t,n){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=o[t];void 0!==i&&(n.normalized=i)}t(e)}),a,l,af,n)}))}))}}class Lf{constructor(){this.name=cf.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Pf{constructor(){this.name=cf.KHR_MESH_QUANTIZATION}}class Ff extends Jc{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=i-t,h=(n-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,A=d-u,g=1-m,v=A-u+h;for(let e=0;e!==a;e++){const t=s[f+e+a],n=s[f+e+o]*c,i=s[p+e+a],l=s[p+e]*c;r[e]=g*t+v*n+m*i+A*l}return r}}const Uf=new Ut;class Of extends Ff{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Uf.fromArray(r).normalize().toArray(r),r}}const Nf={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},kf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Gf={9728:y,9729:E,9984:x,9985:w,9986:_,9987:C},Qf={33071:g,33648:v,10497:A},zf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...nd>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Vf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Wf={CUBICSPLINE:void 0,LINEAR:_e,STEP:xe},jf="OPAQUE",Xf="MASK",Jf="BLEND";function qf(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Yf(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Kf(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zf(e){let t;const n=e.extensions&&e.extensions[cf.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+$f(n.attributes):e.indices+":"+$f(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,i=e.targets.length;n<i;n++)t+=":"+$f(e.targets[n]);return t}function $f(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function em(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const tm=new fn;class nm{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new lf,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new vh(this.options.manager):this.textureLoader=new Wh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new fh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return qf(r,s,i),Yf(s,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())r(i,t.children[n])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[cf.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,r){n.load(kh.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=zf[i.type],t=kf[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new fi(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],s=zf[i.type],a=kf[i.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,c=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(h&&h!==l){const e=Math.floor(c/h),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new a(r,e*h,i.count*h/o),l=new Ya(d,h/o),t.cache.add(n,l)),p=new Za(l,s,c%h/o,u)}else d=null===r?new a(i.count*s):new a(r,c,i.count*s),p=new fi(d,s,u);if(void 0!==i.sparse){const t=zf.SCALAR,n=kf[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],o,i.sparse.count*t),h=new a(e[2],l,i.sparse.count*s);null!==r&&(p=new fi(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,h[e*s]),s>=2&&p.setY(t,h[e*s+1]),s>=3&&p.setZ(t,h[e*s+2]),s>=4&&p.setW(t,h[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,n){const i=this,r=this.json,s=r.textures[e],a=r.images[t],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const n=(r.samplers||{})[s.sampler]||{};return t.magFilter=Gf[n.magFilter]||E,t.minFilter=Gf[n.minFilter]||C,t.wrapS=Qf[n.wrapS]||A,t.wrapT=Qf[n.wrapT]||A,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const s=i.images[e],a=self.URL||self.webkitURL;let o=s.uri||"",l=!1;if(void 0!==s.bufferView)o=n.getDependency("bufferView",s.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:s.mimeType});return o=a.createObjectURL(t),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then((function(e){return new Promise((function(n,i){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new Tt(e);t.needsUpdate=!0,n(t)}),t.load(kh.resolveURL(e,r.path),s,void 0,i)}))})).then((function(e){var t;return!0===l&&a.revokeObjectURL(o),Yf(e,s),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[cf.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[cf.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[cf.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&("number"==typeof i&&(i=3001===i?sf:af),"colorSpace"in s?s.colorSpace=i:s.encoding=i===sf?3001:3e3),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new el,si.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Ho,si.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||s){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Pc}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let s;const a={},o=[];if((r.extensions||{})[cf.KHR_MATERIALS_UNLIT]){const e=i[cf.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),o.push(e.extendParams(a,r,t))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new ni(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],af),a.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(a,"map",n.baseColorTexture,sf)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=2);const l=r.alphaMode||jf;if(l===Jf?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===Xf&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==ai&&(o.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ot(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&s!==ai&&(o.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==ai){const e=r.emissiveFactor;a.emissive=(new ni).setRGB(e[0],e[1],e[2],af)}return void 0!==r.emissiveTexture&&s!==ai&&o.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,sf)),Promise.all(o).then((function(){const n=new s(a);return r.name&&(n.name=r.name),Yf(n,r),t.associations.set(n,{materials:e}),r.extensions&&qf(i,n,r),n}))}createUniqueName(e){const t=Au.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[cf.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return im(n,e,t)}))}const s=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=Zf(a),l=i[o];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[cf.KHR_DRACO_MESH_COMPRESSION]?r(a):im(new bi,a,t),i[o]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,a=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new Pc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),o.DefaultMaterial):this.getDependency("material",s[e].material);a.push(t)}var o;return a.push(t.loadGeometries(s)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,c=o.length;n<c;n++){const c=o[n],h=s[n];let u;const d=a[n];if(h.mode===Nf.TRIANGLES||h.mode===Nf.TRIANGLE_STRIP||h.mode===Nf.TRIANGLE_FAN||void 0===h.mode)u=!0===r.isSkinnedMesh?new Io(c,d):new Hi(c,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===Nf.TRIANGLE_STRIP?u.geometry=td(u.geometry,1):h.mode===Nf.TRIANGLE_FAN&&(u.geometry=td(u.geometry,2));else if(h.mode===Nf.LINES)u=new Zo(c,d);else if(h.mode===Nf.LINE_STRIP)u=new qo(c,d);else if(h.mode===Nf.LINE_LOOP)u=new $o(c,d);else{if(h.mode!==Nf.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new sl(c,d)}Object.keys(u.geometry.morphAttributes).length>0&&Kf(u,r),u.name=t.createUniqueName(r.name||"mesh_"+e),Yf(u,r),h.extensions&&qf(i,u,h),t.assignFinalMaterial(u),l.push(u)}for(let n=0,i=l.length;n<i;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return r.extensions&&qf(i,l[0],r),l[0];const c=new Na;r.extensions&&qf(i,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Zi(at.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new wr(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Yf(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,i=t.joints.length;e<i;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),i=e,r=[],s=[];for(let e=0,a=i.length;e<a;e++){const a=i[e];if(a){r.push(a);const t=new fn;null!==n&&t.fromArray(n.array,16*e),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new Lo(r,s)}))}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let e=0,t=i.channels.length;e<t;e++){const t=i.channels[e],n=i.samplers[t.sampler],r=t.target,h=r.node,u=void 0!==i.parameters?i.parameters[n.input]:n.input,d=void 0!==i.parameters?i.parameters[n.output]:n.output;void 0!==r.node&&(s.push(this.getDependency("node",h)),a.push(this.getDependency("accessor",u)),o.push(this.getDependency("accessor",d)),l.push(n),c.push(r))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],c=i[e],h=s[e],u=a[e],d=o[e];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();const p=n._createAnimationTracks(r,c,h,u,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new ah(r,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],s=n.children||[];for(let e=0,n=s.length;e<n;e++)r.push(t.getDependency("node",s[e]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),a]).then((function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,tm)}));for(let e=0,i=n.length;e<i;e++)t.add(n[e]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"",a=[],o=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&a.push(o),void 0!==r.camera&&a.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===r.isBone?new Bo:t.length>1?new Na:1===t.length?t[0]:new kn,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=s),Yf(a,r),r.extensions&&qf(n,a,r),void 0!==r.matrix){const e=new fn;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new Na;n.name&&(r.name=i.createUniqueName(n.name)),Yf(r,n),n.extensions&&qf(t,r,n);const s=n.nodes||[],a=[];for(let e=0,t=s.length;e<t;e++)a.push(i.getDependency("node",s[e]));return Promise.all(a).then((function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,n]of i.associations)(e instanceof si||e instanceof Tt)&&t.set(e,n);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(r),r}))}_createAnimationTracks(e,t,n,i,r){const s=[],a=e.name?e.name:e.uuid,o=[];let l;switch(Vf[r.path]===Vf.weights?e.traverse((function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)})):o.push(a),Vf[r.path]){case Vf.weights:l=th;break;case Vf.rotation:l=ih;break;case Vf.position:case Vf.scale:l=sh;break;default:if(1===n.itemSize)l=th;else l=sh}const c=void 0!==i.interpolation?Wf[i.interpolation]:_e,h=this._getArrayFromAccessor(n);for(let e=0,n=o.length;e<n;e++){const n=new l(o[e]+"."+Vf[r.path],t.array,h,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(n),s.push(n)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=em(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof ih?Of:Ff)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function im(e,t,n){const i=t.attributes,r=[];function s(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const n=Hf[t]||t.toLowerCase();n in e.attributes||r.push(s(i[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(i)}return Yf(e,t),function(e,t,n){const i=t.attributes,r=new Gt;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Ot(t[0],t[1],t[2]),new Ot(s[0],s[1],s[2])),e.normalized){const t=em(kf[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new Ot,t=new Ot;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,a=i.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),i.normalized){const e=em(kf[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new sn;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(i){const t=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):e.attributes.position;a.push(t)}if(r){const t=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(t)}if(s){const t=void 0!==h.COLOR_0?n.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then((function(t){const n=t[0],a=t[1],o=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}class rm{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class sm extends vc{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:i=8,bevelThickness:r=10,font:s,height:a=50,size:o=100,lineHeight:l=1,letterSpacing:c=0,...h}=t;if(void 0===s)super();else{super(s.generateShapes(e,o,{lineHeight:l,letterSpacing:c}),{...h,bevelEnabled:n,bevelSize:i,bevelThickness:r,depth:a})}this.type="TextGeometry"}}const am={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},om={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "};function lm(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,a=Math.floor((r+s)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?s=a:r=a,a=Math.floor((r+s)/2);return a}function cm(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let n=2;n<=e-t;++n)i*=n;return n/i}function hm(e,t,n,i,r){const s=function(e,t,n,i,r){const s=r<e?r:e,a=[],o=lm(e,i,t),l=function(e,t,n,i,r){const s=[];for(let e=0;e<=n;++e)s[e]=0;const a=[];for(let e=0;e<=i;++e)a[e]=s.slice(0);const o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);o[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let i=1;i<=n;++i){l[i]=t-r[e+1-i],c[i]=r[e+i]-t;let n=0;for(let e=0;e<i;++e){const t=c[e+1],r=l[i-e];o[i][e]=t+r;const s=o[e][i-1]/o[i][e];o[e][i]=n+t*s,n=r*s}o[i][i]=n}for(let e=0;e<=n;++e)a[0][e]=o[e][n];for(let e=0;e<=n;++e){let t=0,r=1;const l=[];for(let e=0;e<=n;++e)l[e]=s.slice(0);l[0][0]=1;for(let s=1;s<=i;++s){let i=0;const c=e-s,h=n-s;e>=s&&(l[r][0]=l[t][0]/o[h+1][c],i=l[r][0]*o[c][h]);const u=e-1<=h?s-1:n-e;for(let e=c>=-1?1:-c;e<=u;++e)l[r][e]=(l[t][e]-l[t][e-1])/o[h+1][c+e],i+=l[r][e]*o[c+e][h];e<=h&&(l[r][s]=-l[t][s-1]/o[h+1][e],i+=l[r][s]*o[e][h]),a[s][e]=i;const d=t;t=r,r=d}}let h=n;for(let e=1;e<=i;++e){for(let t=0;t<=n;++t)a[e][t]*=h;h*=n-e}return a}(o,i,e,s,t),c=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let t=0;t<=s;++t){const n=c[o-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)n.add(c[o-e+i].clone().multiplyScalar(l[t][i]));a[t]=n}for(let e=s+1;e<=r+1;++e)a[e]=new Rt(0,0,0);return a}(e,t,n,i,r);return function(e){const t=e.length,n=[],i=[];for(let r=0;r<t;++r){const t=e[r];n[r]=new Ot(t.x,t.y,t.z),i[r]=t.w}const r=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(r[e-n].clone().multiplyScalar(cm(e,n)*i[n]));r[e]=t.divideScalar(i[0])}return r}(s)}let um,dm,pm,fm=class extends cl{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new Rt(t.x,t.y,t.z,t.w)}}getPoint(e,t){const n=t||new Ot,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=lm(e,i,t),s=function(e,t,n,i){const r=[],s=[],a=[];r[0]=1;for(let o=1;o<=n;++o){s[o]=t-i[e+1-o],a[o]=i[e+o]-t;let n=0;for(let e=0;e<o;++e){const t=a[e+1],i=s[o-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[o]=n}return r}(r,i,e,t),a=new Rt(0,0,0,0);for(let t=0;t<=e;++t){const i=n[r-e+t],o=s[t],l=i.w*o;a.x+=i.x*l,a.y+=i.y*l,a.z+=i.z*l,a.w+=i.w*o}return a}(this.degree,this.knots,this.controlPoints,i);return 1!=r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t){const n=t||new Ot,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=hm(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}},mm=class extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===r.path?kh.extractUrlBase(e):r.path,a=new fh(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Dm(e,0,t.length)}(e))um=(new xm).parse(e);else{const t=Dm(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let e=0;e<t.length;++e){if(i(1)===t[e])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(wm(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+wm(t));um=(new ym).parse(t)}const n=new vh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Am(n,this.manager).parse(um)}},Am=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){dm=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new gm).parse(i);return this.parseScene(i,r,n),pm}parseConnections(){const e=new Map;if("Connections"in um){um.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};e.get(n).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(i).children.push(a)}))}return e}parseImages(){const e={},t={};if("Video"in um.Objects){const n=um.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in um.Objects){const n=um.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,s=void 0!==i?i.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===s?A:g,n.wrapT=0===a?A:g,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,r=dm.get(e.id).children;let s;void 0!==r&&r.length>0&&void 0!==t[r[0].ID]&&(n=t[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Tt):(t.setPath(this.textureLoader.path),s=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Tt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){const t=new Map;if("Material"in um.Objects){const n=um.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!dm.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new Uc;break;case"lambert":a=new kc;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Uc}return a.setValues(s),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new ni).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new ni).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new ni).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new ni).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new ni).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new ni).fromArray(e.SpecularColor.value));const r=this;return dm.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=p,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}getTexture(e,t){return"LayeredTexture"in um.Objects&&t in um.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=dm.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in um.Objects){const n=um.Objects.Deformer;for(const i in n){const r=n[i],s=dm.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,n),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new fn).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],s=t[r.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=dm.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}parseScene(e,t,n){pm=new Na;const i=this.parseModels(e.skeletons,t,n),r=um.Objects.Model,s=this;i.forEach((function(e){const t=r[e.ID];s.setLookAtProperties(e,t);dm.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&pm.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),pm.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Bm(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new vm).parse();1===pm.children.length&&pm.children[0].isGroup&&(pm.children[0].animations=a,pm=pm.children[0]),pm.animations=a}parseModels(e,t,n){const i=new Map,r=um.Objects.Model;for(const s in r){const a=parseInt(s),o=r[s],l=dm.get(a);let c=this.buildSkeleton(l,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,n);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new Bo;break;default:c=new Na}c.name=o.attrName?Au.sanitizeNodeName(o.attrName):"",c.ID=a}this.getTransformData(c,o),i.set(a,c)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=r;r=new Bo,r.matrixWorld.copy(t.transformLink),r.name=i?Au.sanitizeNodeName(i):"",r.ID=n,a.bones[s]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=um.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new kn;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const o=s/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Zi(l,o,i,r),null!==c&&t.setFocalLength(c);break;case 1:t=new wr(-s/2,s/2,a/2,-a/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new kn}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=um.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new kn;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new ni).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new Rh(i,r,s,a);break;case 1:t=new Lh(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=at.degToRad(n.InnerAngle.value));let o=0;void 0!==n.OuterAngle&&(o=at.degToRad(n.OuterAngle.value),o=Math.max(o,1)),t=new Mh(i,r,s,e,o,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Rh(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new Uc({color:13421772}),a.push(s)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(i=new Io(r,s),i.normalizeSkinWeights()):i=new Hi(r,s),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new Ho({color:3342591,linewidth:1});return new qo(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Tm(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){dm.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=um.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),pm.add(e.target)):e.lookAt((new Ot).fromArray(t))}}}))}}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const s=e[r];dm.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;dm.get(t).parents.forEach((function(e){if(n.has(e.ID)){n.get(e.ID).bind(new Lo(s.bones),i[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in um.Objects){const t=um.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new fn).fromArray(t.Matrix.a)})):e[i.Node]=(new fn).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in um&&"AmbientColor"in um.GlobalSettings){const e=um.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new ni(t,n,i);pm.add(new Ph(e,1))}}}},gm=class{parse(e){const t=new Map;if("Geometry"in um.Objects){const n=um.Objects.Geometry;for(const i in n){const r=dm.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],s=e.parents.map((function(e){return um.Objects.Model[e.ID]}));if(0===s.length)return;const a=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const o=s[0],l={};"RotationOrder"in o&&(l.eulerOrder=Tm(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);const c=Bm(l);return this.genGeometry(t,a,r,c)}genGeometry(e,t,n,i){const r=new bi;e.attrName&&(r.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),o=new gi(a.vertex,3);if(o.applyMatrix4(i),r.setAttribute("position",o),a.colors.length>0&&r.setAttribute("color",new gi(a.colors,3)),t&&(r.setAttribute("skinIndex",new mi(a.weightsIndices,4)),r.setAttribute("skinWeight",new gi(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const e=(new lt).getNormalMatrix(i),t=new gi(a.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new gi(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&r.addGroup(n,a.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],a=[],o=[],l=[],c=[],h=[];const u=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let A=[],g=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=Mm(p,n,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){g.push(e.weight),A.push(e.id)})),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];g.forEach((function(n,i){let r=n,s=A[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const a=e[n];e[n]=s,s=a}}))})),A=e,g=t}for(;g.length<4;)g.push(0),A.push(0);for(let e=0;e<4;++e)c.push(g[e]),h.push(A[e])}if(e.normal){const t=Mm(p,n,d,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=Mm(p,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const i=Mm(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(u.genFace(t,e,s,f,a,o,l,c,h,i),n++,i=0,s=[],a=[],o=[],l=[],c=[],h=[])})),t}genFace(e,t,n,i,r,s,a,o,l,c){for(let h=2;h<c;h++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(h-1)]]),e.vertex.push(t.vertexPositions[n[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[n[3*h]]),e.vertex.push(t.vertexPositions[n[3*h+1]]),e.vertex.push(t.vertexPositions[n[3*h+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(h-1)]),e.vertexWeights.push(o[4*(h-1)+1]),e.vertexWeights.push(o[4*(h-1)+2]),e.vertexWeights.push(o[4*(h-1)+3]),e.vertexWeights.push(o[4*h]),e.vertexWeights.push(o[4*h+1]),e.vertexWeights.push(o[4*h+2]),e.vertexWeights.push(o[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(h-1)]),e.colors.push(s[3*(h-1)+1]),e.colors.push(s[3*(h-1)+2]),e.colors.push(s[3*h]),e.colors.push(s[3*h+1]),e.colors.push(s[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(h-1)]),e.normal.push(r[3*(h-1)+1]),e.normal.push(r[3*(h-1)+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(h-1)]),e.uvs[n].push(a[n][2*(h-1)+1]),e.uvs[n].push(a[n][2*h]),e.uvs[n].push(a[n][2*h+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=um.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,i,n.name)}))}))}genMorphGeometry(e,t,n,i,r){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],o=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let e=0;e<o.length;e++){const t=3*o[e];c[t]=a[3*e],c[t+1]=a[3*e+1],c[t+2]=a[3*e+2]}const h={vertexIndices:s,vertexPositions:c},u=this.genBuffers(h),d=new gi(u.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let e=0;e<i.length;++e)r.push(e);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===fm)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new bi;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new bi;const n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)r.push((new Rt).fromArray(s,e));let a,o;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){a=n,o=i.length-1-a;for(let e=0;e<n;++e)r.push(r[e])}const l=new fm(n,i,r,a,o).getPoints(12*r.length);return(new bi).setFromPoints(l)}},vm=class{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===um.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=um.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=um.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Cm),values:t[n].KeyValueFloat.a},r=dm.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=um.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=dm.get(parseInt(i));if(void 0!==r){r.children.forEach((function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=dm.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=um.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?Au.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};pm.traverse((function(e){e.ID===r.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new fn),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),t[i]=s}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=dm.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=dm.get(e).parents[0].ID,s=dm.get(r).parents[0].ID,a=dm.get(s).parents[0].ID,o=um.Objects.Model[a],l={modelName:o.attrName?Au.sanitizeNodeName(o.attrName):"",morphName:um.Objects.Deformer[e].attrName};t[i]=l}t[i][r.attr]=r}}})),n.set(parseInt(i),t)}}return n}parseAnimStacks(e){const t=um.Objects.AnimationStack,n={};for(const i in t){const r=dm.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new ah(e.name,-1,t)}generateTracks(e){const t=[];let n=new Ot,i=new Ut,r=new Ot;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new Cn).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new sh(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(at.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(at.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(at.degToRad));const a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,n);void 0!==i&&((i=i.map(at.degToRad)).push(s),i=(new Cn).fromArray(i),i=(new Ut).setFromEuler(i)),void 0!==r&&((r=r.map(at.degToRad)).push(s),r=(new Cn).fromArray(r),r=(new Ut).setFromEuler(r).invert());const l=new Ut,c=new Cn,h=[];for(let e=0;e<o.length;e+=3)c.set(o[e],o[e+1],o[e+2],s),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==r&&l.multiply(r),l.toArray(h,e/3*4);return new ih(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=pm.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new th(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let s=-1,a=-1,o=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==a){const e=t.y.values[a];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==o){const e=t.z.values[o];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const s=r/180,a=i/s;let o=n+a;const l=e.times[t-1],c=(e.times[t]-l)/s;let h=l+c;const u=[],d=[];for(;h<e.times[t];)u.push(h),h+=c,d.push(o),o+=a;e.times=Lm(e.times,t,u),e.values=Lm(e.values,t,d)}}}},ym=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Em,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):o?t.parseNodeProperty(e,o,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==s.id&&(a[n][s.id]=r)):"number"==typeof s.id?(a[n]={},a[n][s.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=r.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,a),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=Rm(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Rm(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],a=i[2],o=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Rm(l)}this.getPrevNode()[r]={type:s,type2:a,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),r)}},xm=class{parse(e){const t=new _m(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Em;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),a=e.getString(s);if(0===i)return null;const o=[];for(let t=0;t<r;t++)o.push(this.parseProperty(e));const l=o.length>0?o[0]:"",c=o.length>1?o[1]:"",h=o.length>2?o[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(a,n,i)}return n.propertyList=o,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),a="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:s,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=Sp(new Uint8Array(e.getArrayBuffer(s))),o=new _m(a.buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},_m=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),rf(new Uint8Array(t))}},Em=class{add(e,t){this[e]=t}};function wm(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Cm(e){return e/46186158e3}const bm=[];function Mm(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,a=s+i.dataSize;return function(e,t,n,i){for(let r=n,s=0;r<i;r++,s++)e[s]=t[r];return e}(bm,i.buffer,s,a)}const Sm=new Cn,Im=new Ot;function Bm(e){const t=new fn,n=new fn,i=new fn,r=new fn,s=new fn,a=new fn,o=new fn,l=new fn,c=new fn,h=new fn,u=new fn,d=new fn,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Im.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(at.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(Sm.fromArray(t))}if(e.rotation){const t=e.rotation.map(at.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(Sm.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(at.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(Sm.fromArray(t)),r.invert()}e.scale&&s.scale(Im.fromArray(e.scale)),e.scalingOffset&&o.setPosition(Im.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(Im.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Im.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Im.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const f=n.clone().multiply(i).multiply(r),m=new fn;m.extractRotation(h);const A=new fn;A.copyPosition(h);const g=A.clone().invert().multiply(h),v=m.clone().invert().multiply(g),y=s,x=new fn;if(0===p)x.copy(m).multiply(f).multiply(v).multiply(y);else if(1===p)x.copy(m).multiply(v).multiply(f).multiply(y);else{const e=(new fn).scale((new Ot).setFromMatrixScale(u)).clone().invert(),t=v.clone().multiply(e);x.copy(m).multiply(f).multiply(t).multiply(y)}const _=c.clone().invert(),E=a.clone().invert();let w=t.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(_).multiply(o).multiply(a).multiply(s).multiply(E);const C=(new fn).copyPosition(w),b=h.clone().multiply(C);return d.copyPosition(b),w=d.clone().multiply(x),w.premultiply(h.invert()),w}function Tm(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Rm(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Dm(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),rf(new Uint8Array(e,t,n))}function Lm(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var Pm=Object.defineProperty,Fm=(e,t,n)=>(((e,t,n)=>{t in e?Pm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Um extends uh{constructor(e){super(e)}load(e,t,n,i){const r=new fh(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{if("string"!=typeof e)throw new Error("unsupported data type");const n=JSON.parse(e),i=this.parse(n);t&&t(i)}),n,i)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new Om(e)}}class Om{constructor(e){Fm(this,"data"),this.data=e}generateShapes(e,t=100,n){const i=[],r={letterSpacing:0,lineHeight:1,...n},s=function(e,t,n,i){const r=Array.from(e),s=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,o=[];let l=0,c=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)l=0,c-=a*i.lineHeight;else{const e=Nm(t,s,l,c,n);e&&(l+=e.offsetX+i.letterSpacing,o.push(e.path))}}return o}(e,t,this.data,r);for(let e=0,t=s.length;e<t;e++)Array.prototype.push.apply(i,s[e].toShapes(!1));return i}}function Nm(e,t,n,i,r){const s=r.glyphs[e]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const a=new Ju;let o,l,c,h,u,d,p,f;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=e.length;r<s;){switch(e[r++]){case"m":o=parseInt(e[r++])*t+n,l=parseInt(e[r++])*t+i,a.moveTo(o,l);break;case"l":o=parseInt(e[r++])*t+n,l=parseInt(e[r++])*t+i,a.lineTo(o,l);break;case"q":c=parseInt(e[r++])*t+n,h=parseInt(e[r++])*t+i,u=parseInt(e[r++])*t+n,d=parseInt(e[r++])*t+i,a.quadraticCurveTo(u,d,c,h);break;case"b":c=parseInt(e[r++])*t+n,h=parseInt(e[r++])*t+i,u=parseInt(e[r++])*t+n,d=parseInt(e[r++])*t+i,p=parseInt(e[r++])*t+n,f=parseInt(e[r++])*t+i,a.bezierCurveTo(u,d,p,f,c,h)}}}return{offsetX:s.ha*t,path:a}}Fm(Om,"isFont"),Fm(Om,"type");class km extends Tt{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=y,this.minFilter=y,this.wrapR=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Gm{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((n=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class Qm{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class zm{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const Hm=[171,75,84,88,32,50,48,187,13,10,26,10];function Vm(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let Wm,jm,Xm;const Jm={env:{emscripten_notify_memory_growth:function(e){Xm=new Uint8Array(jm.exports.memory.buffer)}}};class qm{init(){return Wm||(Wm="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ym).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Jm))).then(this._init):WebAssembly.instantiate(Buffer.from(Ym,"base64"),Jm).then(this._init),Wm)}_init(e){jm=e.instance,Jm.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!jm)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=jm.exports.malloc(n);Xm.set(e,i),t=t||Number(jm.exports.ZSTD_findDecompressedSize(i,n));const r=jm.exports.malloc(t),s=jm.exports.ZSTD_decompress(r,t,i,n),a=Xm.slice(r,r+s);return jm.exports.free(i),jm.exports.free(r),a}}const Ym="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class Km extends ll{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Zm extends ll{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=g}}var $m=Object.defineProperty,eA=(e,t,n)=>(((e,t,n)=>{t in e?$m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const tA=3e3,nA=3001,iA="srgb",rA=new WeakMap;let sA,aA=0;const oA=class extends uh{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Gm,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new fh(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new fh(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then((([e,t])=>{const n=oA.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(oA.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(oA.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(oA.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),aA>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),aA++}return this.transcoderPending}load(e,t,n,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new fh(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{if(rA.has(e)){return rA.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}),n,i)}_createTextureFrom(e,t){const{faces:n,width:i,height:r,format:s,type:a,error:o,dfdFlags:l}=e;if("error"===a)return Promise.reject(o);let c;if(6===t.faceCount)c=new Km(n,s,M);else{const e=n[0].mipmaps;c=t.layerCount>1?new Zm(e,i,r,t.layerCount,s,M):new ll(e,i,r,s,M)}c.minFilter=1===n[0].mipmaps.length?E:C,c.magFilter=E,c.generateMipmaps=!1,c.needsUpdate=!0;const h=dA(t);return"colorSpace"in c?c.colorSpace=h:c.encoding=h===iA?3001:3e3,c.premultiplyAlpha=!!(1&l),c}async _createTexture(e,t={}){const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,Hm.length);if(t[0]!==Hm[0]||t[1]!==Hm[1]||t[2]!==Hm[2]||t[3]!==Hm[3]||t[4]!==Hm[4]||t[5]!==Hm[5]||t[6]!==Hm[6]||t[7]!==Hm[7]||t[8]!==Hm[8]||t[9]!==Hm[9]||t[10]!==Hm[10]||t[11]!==Hm[11])throw new Error("Missing KTX 2.0 identifier.");const n=new Qm,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new zm(e,Hm.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),o=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),h=r._nextUint64(),u=r._nextUint64(),d=new zm(e,Hm.length+i,3*s*8,!0);for(let t=0;t<s;t++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new zm(e,a,o,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){const t={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=p._nextInt32(),t.sampleUpper=p._nextInt32()):(t.sampleLower=p._nextUint32(),t.sampleUpper=p._nextUint32()),f.samples[e]=t}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const A=new zm(e,l,c,!0);for(;A._offset<c;){const e=A._nextUint32(),t=A._scan(e),i=Vm(t);if(n.keyValue[i]=A._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=Vm(n.keyValue[i]);n.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}const r=e%4?4-e%4:0;A._skip(r)}if(u<=0)return n;const g=new zm(e,h,u,!0),v=g._nextUint16(),y=g._nextUint16(),x=g._nextUint32(),_=g._nextUint32(),E=g._nextUint32(),w=g._nextUint32(),C=[];for(let e=0;e<s;e++)C.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});const b=h+g._offset,M=b+x,S=M+_,I=S+E,B=new Uint8Array(e.buffer,e.byteOffset+b,x),T=new Uint8Array(e.buffer,e.byteOffset+M,_),R=new Uint8Array(e.buffer,e.byteOffset+S,E),D=new Uint8Array(e.buffer,e.byteOffset+I,w);return n.globalData={endpointCount:v,selectorCount:y,imageDescs:C,endpointsData:B,selectorsData:T,tablesData:R,extendedData:D},n}(new Uint8Array(e));if(0!==n.vkFormat)return async function(e){const{vkFormat:t}=e;if(void 0===hA[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===e.supercompressionScheme&&(sA||(sA=new Promise((async e=>{const t=new qm;await t.init(),e(t)}))),n=await sA);const i=[];for(let r=0;r<e.levels.length;r++){const s=Math.max(1,e.pixelWidth>>r),a=Math.max(1,e.pixelHeight>>r),o=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,l=e.levels[r];let c,h;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=n.decode(l.levelData,l.uncompressedByteLength)}h=uA[t]===T?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):uA[t]===R?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,i.push({data:h,width:s,height:a,depth:o})}let r;if(cA.has(hA[t]))r=0===e.pixelDepth?new To(i[0].data,e.pixelWidth,e.pixelHeight):new km(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new ll(i,e.pixelWidth,e.pixelHeight)}r.mipmaps=i,r.type=uA[t],r.format=hA[t],r.needsUpdate=!0;const s=dA(e);"colorSpace"in r?r.colorSpace=s:r.encoding=s===iA?nA:tA;return Promise.resolve(r)}(n);const i=t,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e]))).then((e=>this._createTextureFrom(e.data,n)));return rA.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),aA--,this}};let lA=oA;eA(lA,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),eA(lA,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),eA(lA,"EngineFormat",{RGBAFormat:F,RGBA_ASTC_4x4_Format:ee,RGBA_BPTC_Format:fe,RGBA_ETC2_EAC_Format:$,RGBA_PVRTC_4BPPV1_Format:q,RGBA_S3TC_DXT5_Format:j,RGB_ETC1_Format:K,RGB_ETC2_Format:Z,RGB_PVRTC_4BPPV1_Format:X,RGB_S3TC_DXT1_Format:H}),eA(lA,"BasisWorker",(function(){let e,t,n;const i=oA.EngineFormat,r=oA.TranscoderFormat,s=oA.BasisFormat;self.addEventListener("message",(function(a){const u=a.data;switch(u.type){case"init":e=u.config,d=u.transcoderBinary,t=new Promise((e=>{n={wasmBinary:d,onRuntimeInitialized:e},BASIS(n)})).then((()=>{n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:a,width:d,height:p,hasAlpha:f,format:m,dfdFlags:A}=function(t){const a=new n.KTX2File(new Uint8Array(t));function u(){a.close(),a.delete()}if(!a.isValid())throw u(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const d=a.isUASTC()?s.UASTC_4x4:s.ETC1S,p=a.getWidth(),f=a.getHeight(),m=a.getLayers()||1,A=a.getLevels(),g=a.getFaces(),v=a.getHasAlpha(),y=a.getDFDFlags(),{transcoderFormat:x,engineFormat:_}=function(t,n,a,h){let u,d;const p=t===s.ETC1S?o:l;for(let i=0;i<p.length;i++){const r=p[i];if(e[r.if]&&(r.basisFormat.includes(t)&&!(h&&r.transcoderFormat.length<2)&&(!r.needsPowerOfTwo||c(n)&&c(a))))return u=r.transcoderFormat[h?1:0],d=r.engineFormat[h?1:0],{transcoderFormat:u,engineFormat:d}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),u=r.RGBA32,d=i.RGBAFormat,{transcoderFormat:u,engineFormat:d}}(d,p,f,v);if(!p||!f||!A)throw u(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!a.startTranscoding())throw u(),new Error("THREE.KTX2Loader: .startTranscoding failed");const E=[],w=[];for(let e=0;e<g;e++){const t=[];for(let n=0;n<A;n++){const i=[];let r,s;for(let t=0;t<m;t++){const o=a.getImageLevelInfo(n,t,e);0!==e||0!==n||0!==t||o.origWidth%4==0&&o.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),A>1?(r=o.origWidth,s=o.origHeight):(r=o.width,s=o.height);const l=new Uint8Array(a.getImageTranscodedSizeInBytes(n,t,0,x));if(!a.transcodeImage(l,n,t,e,x,0,-1,-1))throw u(),new Error("THREE.KTX2Loader: .transcodeImage failed.");i.push(l)}const o=h(i);t.push({data:o,width:r,height:s}),w.push(o.buffer)}E.push({mipmaps:t,width:p,height:f,format:_})}return u(),{faces:E,buffers:w,width:p,height:f,hasAlpha:v,format:_,dfdFlags:y}}(u.buffer);self.postMessage({type:"transcode",id:u.id,faces:t,width:d,height:p,hasAlpha:f,format:m,dfdFlags:A},a)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}}))}var d}));const a=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=a.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),l=a.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(e){return e<=2||0==(e&e-1)&&0!==e}function h(e){if(1===e.length)return e[0];let t=0;for(let n=0;n<e.length;n++){t+=e[n].byteLength}const n=new Uint8Array(t);let i=0;for(let t=0;t<e.length;t++){const r=e[t];n.set(r,i),i+=r.byteLength}return n}}));const cA=new Set([F,G,N]),hA={109:F,97:F,37:F,43:F,103:G,83:G,16:G,22:G,100:N,76:N,15:N,9:N,166:re,165:re},uA={109:T,97:R,37:M,43:M,103:T,83:R,16:M,22:M,100:T,76:R,15:M,9:M,166:M,165:M};function dA(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?iA:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),"")}class pA extends gh{constructor(e){super(e),this.type=R}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let i=e.pos,r=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(r=o.indexOf("\n"))&&s<t&&i<e.byteLength;)a+=o,s+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(e.pos+=s+r+1,a+o.slice(0,r))},i=function(e,t,n,i){const r=e[t+3],s=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*s,n[i+1]=e[t+1]*s,n[i+2]=e[t+2]*s,n[i+3]=1},r=function(e,t,n,i){const r=e[t+3],s=Math.pow(2,r-128)/255;n[i+0]=ui.toHalfFloat(Math.min(e[t+0]*s,65504)),n[i+1]=ui.toHalfFloat(Math.min(e[t+1]*s,65504)),n[i+2]=ui.toHalfFloat(Math.min(e[t+2]*s,65504)),n[i+3]=ui.toHalfFloat(1)},s=new Uint8Array(e);s.pos=0;const a=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=n(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=n(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(i))&&(o.gamma=parseFloat(c[1])),(c=l.match(r))&&(o.exposure=parseFloat(c[1])),(c=l.match(s))&&(o.valid|=2,o.format=c[1]),(c=l.match(a))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||t(3,"missing format specifier"),4&o.valid||t(3,"missing image size specifier"),o}(s),o=a.width,l=a.height,c=function(e,n,i){const r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);r!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*n*i);s.length||t(4,"unable to allocate buffer space");let a=0,o=0;const l=4*r,c=new Uint8Array(4),h=new Uint8Array(l);let u=i;for(;u>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==r||t(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&o<e.byteLength;){n=e[o++];const r=n>128;if(r&&(n-=128),(0===n||i+n>l)&&t(3,"bad scanline data"),r){const t=e[o++];for(let e=0;e<n;e++)h[i++]=t}else h.set(e.subarray(o,o+n),i),i+=n,o+=n}const d=r;for(let e=0;e<d;e++){let t=0;s[a]=h[e+t],t+=r,s[a+1]=h[e+t],t+=r,s[a+2]=h[e+t],t+=r,s[a+3]=h[e+t],a+=4}u--}return s}(s.subarray(s.pos),o,l);let h,u,d;switch(this.type){case T:d=c.length/4;const e=new Float32Array(4*d);for(let t=0;t<d;t++)i(c,4*t,e,4*t);h=e,u=T;break;case R:d=c.length/4;const t=new Uint16Array(4*d);for(let e=0;e<d;e++)r(c,4*e,t,4*e);h=t,u=R;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:l,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,type:u}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){switch(e.type){case T:case R:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=E,e.magFilter=E,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}}const fA="colorSpace"in new Tt;class mA extends gh{constructor(e){super(e),this.type=R}parse(e){const t=65536,n=14,i=65537,r=16384,s=Math.pow(2.7182818,2.2);const a={l:0,c:0,lc:0};function o(e,t,n,i,r){for(;n<e;)t=t<<8|W(i,r),n+=8;n-=e,a.l=t>>n&(1<<e)-1,a.c=t,a.lc=n}const l=new Array(59);function c(e,t,n,r,s,c,h){for(var u=n,d=0,p=0;s<=c;s++){if(u.value-n.value>r)return!1;o(6,d,p,e,u);var f=a.l;if(d=a.c,p=a.lc,h[s]=f,63==f){if(u.value-n.value>r)throw"Something wrong with hufUnpackEncTable";o(8,d,p,e,u);var m=a.l+6;if(d=a.c,p=a.lc,s+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)h[s++]=0;s--}else if(f>=59){if(s+(m=f-59+2)>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)h[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<i;++t)l[e[t]]+=1;var n=0;for(t=58;t>0;--t){var r=n+l[t]>>1;l[t]=n,n=r}for(t=0;t<i;++t){var s=e[t];s>0&&(e[t]=s|l[s]++<<6)}}(h)}function h(e){return 63&e}function u(e){return e>>6}const d={c:0,lc:0};function p(e,t,n,i){e=e<<8|W(n,i),t+=8,d.c=e,d.lc=t}const f={c:0,lc:0};function m(e,t,n,i,r,s,a,o,l,c){if(e==t){i<8&&(p(n,i,r,a),n=d.c,i=d.lc);var h=n>>(i-=8);h=new Uint8Array([h])[0];if(l.value+h>c)return!1;for(var u=o[l.value-1];h-- >0;)o[l.value++]=u}else{if(!(l.value<c))return!1;o[l.value++]=e}f.c=n,f.lc=i}function A(e){return 65535&e}function g(e){var t=A(e);return t>32767?t-65536:t}const v={a:0,b:0};function y(e,t){var n=g(e),i=g(t),r=n+(1&i)+(i>>1),s=r,a=r-i;v.a=s,v.b=a}function x(e,t){var n=A(e),i=A(t),r=n-(i>>1)&65535,s=i+r-32768&65535;v.a=s,v.b=r}function _(e,t,n,i,r,s,a){for(var o,l=a<16384,c=n>r?r:n,h=1;h<=c;)h<<=1;for(o=h>>=1,h>>=1;h>=1;){for(var u,d,p,f,m=0,A=m+s*(r-o),g=s*h,_=s*o,E=i*h,w=i*o;m<=A;m+=_){for(var C=m,b=m+i*(n-o);C<=b;C+=w){var M=C+E,S=(I=C+g)+E;l?(y(e[C+t],e[I+t]),u=v.a,p=v.b,y(e[M+t],e[S+t]),d=v.a,f=v.b,y(u,d),e[C+t]=v.a,e[M+t]=v.b,y(p,f),e[I+t]=v.a,e[S+t]=v.b):(x(e[C+t],e[I+t]),u=v.a,p=v.b,x(e[M+t],e[S+t]),d=v.a,f=v.b,x(u,d),e[C+t]=v.a,e[M+t]=v.b,x(p,f),e[I+t]=v.a,e[S+t]=v.b)}if(n&h){var I=C+g;l?y(e[C+t],e[I+t]):x(e[C+t],e[I+t]),u=v.a,e[I+t]=v.b,e[C+t]=u}}if(r&h)for(C=m,b=m+i*(n-o);C<=b;C+=w){M=C+E;l?y(e[C+t],e[M+t]):x(e[C+t],e[M+t]),u=v.a,e[M+t]=v.b,e[C+t]=u}o=h,h>>=1}return m}function E(e,t,s,a,o,l){var A=s.value,g=V(t,s),v=V(t,s);s.value+=4;var y=V(t,s);if(s.value+=4,g<0||g>=i||v<0||v>=i)throw"Something wrong with HUF_ENCSIZE";var x=new Array(i),_=new Array(r);if(function(e){for(var t=0;t<r;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(_),c(e,0,s,a-(s.value-A),g,v,x),y>8*(a-(s.value-A)))throw"Something wrong with hufUncompress";!function(e,t,i,r){for(;t<=i;t++){var s=u(e[t]),a=h(e[t]);if(s>>a)throw"Invalid table entry";if(a>n){if((d=r[s>>a-n]).len)throw"Invalid table entry";if(d.lit++,d.p){var o=d.p;d.p=new Array(d.lit);for(var l=0;l<d.lit-1;++l)d.p[l]=o[l]}else d.p=new Array(1);d.p[d.lit-1]=t}else if(a){var c=0;for(l=1<<n-a;l>0;l--){var d;if((d=r[(s<<n-a)+c]).len||d.p)throw"Invalid table entry";d.len=a,d.lit=t,c++}}}}(x,g,v,_),function(e,t,i,r,s,a,o,l,c,A){for(var g=0,v=0,y=l,x=Math.trunc(s.value+(a+7)/8);s.value<x;)for(p(g,v,i,s),g=d.c,v=d.lc;v>=n;)if((C=t[g>>v-n&16383]).len)v-=C.len,m(C.lit,o,g,v,i,0,s,c,A,y),g=f.c,v=f.lc;else{if(!C.p)throw"hufDecode issues";var _;for(_=0;_<C.lit;_++){for(var E=h(e[C.p[_]]);v<E&&s.value<x;)p(g,v,i,s),g=d.c,v=d.lc;if(v>=E&&u(e[C.p[_]])==(g>>v-E&(1<<E)-1)){v-=E,m(C.p[_],o,g,v,i,0,s,c,A,y),g=f.c,v=f.lc;break}}if(_==C.lit)throw"hufDecode issues"}var w=8-a&7;for(g>>=w,v-=w;v>0;){var C;if(!(C=t[g<<n-v&16383]).len)throw"hufDecode issues";v-=C.len,m(C.lit,o,g,v,i,0,s,c,A,y),g=f.c,v=f.lc}}(x,_,e,0,s,y,v,l,o,{value:0})}function w(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function C(e,t){for(var n=0,i=Math.floor((e.length+1)/2),r=0,s=e.length-1;!(r>s||(t[r++]=e[n++],r>s));)t[r++]=e[i++]}function b(e){for(var t=e.byteLength,n=new Array,i=0,r=new DataView(e);t>0;){var s=r.getInt8(i++);if(s<0){t-=(o=-s)+1;for(var a=0;a<o;a++)n.push(r.getUint8(i++))}else{var o=s;t-=2;var l=r.getUint8(i++);for(a=0;a<o+1;a++)n.push(l)}}return n}function M(e,t,n){for(var i,r=1;r<64;)65280==(i=t[e.value])?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),e.value++}function S(e,t){t[0]=Y(e[0]),t[1]=Y(e[1]),t[2]=Y(e[5]),t[3]=Y(e[6]),t[4]=Y(e[14]),t[5]=Y(e[15]),t[6]=Y(e[27]),t[7]=Y(e[28]),t[8]=Y(e[2]),t[9]=Y(e[4]),t[10]=Y(e[7]),t[11]=Y(e[13]),t[12]=Y(e[16]),t[13]=Y(e[26]),t[14]=Y(e[29]),t[15]=Y(e[42]),t[16]=Y(e[3]),t[17]=Y(e[8]),t[18]=Y(e[12]),t[19]=Y(e[17]),t[20]=Y(e[25]),t[21]=Y(e[30]),t[22]=Y(e[41]),t[23]=Y(e[43]),t[24]=Y(e[9]),t[25]=Y(e[11]),t[26]=Y(e[18]),t[27]=Y(e[24]),t[28]=Y(e[31]),t[29]=Y(e[40]),t[30]=Y(e[44]),t[31]=Y(e[53]),t[32]=Y(e[10]),t[33]=Y(e[19]),t[34]=Y(e[23]),t[35]=Y(e[32]),t[36]=Y(e[39]),t[37]=Y(e[45]),t[38]=Y(e[52]),t[39]=Y(e[54]),t[40]=Y(e[20]),t[41]=Y(e[22]),t[42]=Y(e[33]),t[43]=Y(e[38]),t[44]=Y(e[46]),t[45]=Y(e[51]),t[46]=Y(e[55]),t[47]=Y(e[60]),t[48]=Y(e[21]),t[49]=Y(e[34]),t[50]=Y(e[37]),t[51]=Y(e[47]),t[52]=Y(e[50]),t[53]=Y(e[56]),t[54]=Y(e[59]),t[55]=Y(e[61]),t[56]=Y(e[35]),t[57]=Y(e[36]),t[58]=Y(e[48]),t[59]=Y(e[49]),t[60]=Y(e[57]),t[61]=Y(e[58]),t[62]=Y(e[62]),t[63]=Y(e[63])}function I(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),h=new Array(4),u=new Array(4),d=0;d<8;++d){var p=8*d;l[0]=i*e[p+2],l[1]=a*e[p+2],l[2]=i*e[p+6],l[3]=a*e[p+6],c[0]=n*e[p+1]+r*e[p+3]+s*e[p+5]+o*e[p+7],c[1]=r*e[p+1]-o*e[p+3]-n*e[p+5]-s*e[p+7],c[2]=s*e[p+1]-n*e[p+3]+o*e[p+5]+r*e[p+7],c[3]=o*e[p+1]-s*e[p+3]+r*e[p+5]-n*e[p+7],h[0]=t*(e[p+0]+e[p+4]),h[3]=t*(e[p+0]-e[p+4]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],u[0]=h[0]+h[1],u[1]=h[3]+h[2],u[2]=h[3]-h[2],u[3]=h[0]-h[1],e[p+0]=u[0]+c[0],e[p+1]=u[1]+c[1],e[p+2]=u[2]+c[2],e[p+3]=u[3]+c[3],e[p+4]=u[3]-c[3],e[p+5]=u[2]-c[2],e[p+6]=u[1]-c[1],e[p+7]=u[0]-c[0]}for(var f=0;f<8;++f)l[0]=i*e[16+f],l[1]=a*e[16+f],l[2]=i*e[48+f],l[3]=a*e[48+f],c[0]=n*e[8+f]+r*e[24+f]+s*e[40+f]+o*e[56+f],c[1]=r*e[8+f]-o*e[24+f]-n*e[40+f]-s*e[56+f],c[2]=s*e[8+f]-n*e[24+f]+o*e[40+f]+r*e[56+f],c[3]=o*e[8+f]-s*e[24+f]+r*e[40+f]-n*e[56+f],h[0]=t*(e[f]+e[32+f]),h[3]=t*(e[f]-e[32+f]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],u[0]=h[0]+h[1],u[1]=h[3]+h[2],u[2]=h[3]-h[2],u[3]=h[0]-h[1],e[0+f]=u[0]+c[0],e[8+f]=u[1]+c[1],e[16+f]=u[2]+c[2],e[24+f]=u[3]+c[3],e[32+f]=u[3]-c[3],e[40+f]=u[2]-c[2],e[48+f]=u[1]-c[1],e[56+f]=u[0]-c[0]}function B(e){for(var t=0;t<64;++t){var n=e[0][t],i=e[1][t],r=e[2][t];e[0][t]=n+1.5747*r,e[1][t]=n-.1873*i-.4682*r,e[2][t]=n+1.8556*i}}function D(e,t,n){for(var i=0;i<64;++i)t[n+i]=ui.toHalfFloat(L(e[i]))}function L(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(s,Math.abs(e)-1)}function P(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function U(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(b(t)),i=new Uint8Array(n.length);return w(n),C(n,i),new DataView(i.buffer)}function O(e){var t=Sp(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return w(t),C(t,n),new DataView(n.buffer)}function k(e){for(var n=e.viewer,i={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),a=0,o=new Array(e.channels),l=0;l<e.channels;l++)o[l]={},o[l].start=a,o[l].end=o[l].start,o[l].nx=e.width,o[l].ny=e.lines,o[l].size=e.type,a+=o[l].nx*o[l].ny*o[l].size;var c=K(n,i),h=K(n,i);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=h)for(l=0;l<h-c+1;l++)s[l+c]=j(n,i);var u=new Uint16Array(t),d=function(e,n){for(var i=0,r=0;r<t;++r)(0==r||e[r>>3]&1<<(7&r))&&(n[i++]=r);for(var s=i-1;i<t;)n[i++]=0;return s}(s,u),p=V(n,i);E(e.array,n,i,p,r,a);for(l=0;l<e.channels;++l)for(var f=o[l],m=0;m<o[l].size;++m)_(r,f.start+m,f.nx,f.size,f.ny,f.nx*f.size,d);!function(e,t,n){for(var i=0;i<n;++i)t[i]=e[t[i]]}(u,r,a);for(var A=0,g=new Uint8Array(r.buffer.byteLength),v=0;v<e.lines;v++)for(var y=0;y<e.channels;y++){var x=(f=o[y]).nx*f.size,w=new Uint8Array(r.buffer,2*f.end,2*x);g.set(w,A),A+=2*x,f.end+=x}return new DataView(g.buffer)}function G(e){var t=Sp(e.array.slice(e.offset.value,e.offset.value+e.size));const n=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(n):new Uint32Array(n);let r=0,s=0;const a=new Array(4);for(let n=0;n<e.lines;n++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:a[0]=r,a[1]=a[0]+e.width,r=a[1]+e.width;for(let r=0;r<e.width;++r){n+=t[a[0]++]<<8|t[a[1]++],i[s]=n,s++}break;case 2:a[0]=r,a[1]=a[0]+e.width,a[2]=a[1]+e.width,r=a[2]+e.width;for(let r=0;r<e.width;++r){n+=t[a[0]++]<<24|t[a[1]++]<<16|t[a[2]++]<<8,i[s]=n,s++}}}return new DataView(i.buffer)}function Q(e){var t=e.viewer,n={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),r={version:X(t,n),unknownUncompressedSize:X(t,n),unknownCompressedSize:X(t,n),acCompressedSize:X(t,n),dcCompressedSize:X(t,n),rleCompressedSize:X(t,n),rleUncompressedSize:X(t,n),rleRawSize:X(t,n),totalAcUncompressedCount:X(t,n),totalDcUncompressedCount:X(t,n),acCompression:X(t,n)};if(r.version<2)throw"EXRLoader.parse: "+ie.compression+" version "+r.version+" is unsupported";for(var s=new Array,a=K(t,n)-2;a>0;){var o=z(t.buffer,n),l=j(t,n),c=l>>2&3,h=new Int8Array([(l>>4)-1])[0],u=j(t,n);s.push({name:o,index:h,type:u,compression:c}),a-=o.length+3}for(var d=ie.channels,p=new Array(e.channels),f=0;f<e.channels;++f){var m=p[f]={},A=d[f];m.name=A.name,m.compression=0,m.decoded=!1,m.type=A.pixelType,m.pLinear=A.pLinear,m.width=e.width,m.height=e.lines}for(var g={idx:new Array(3)},v=0;v<e.channels;++v)for(m=p[v],f=0;f<s.length;++f){var y=s[f];m.name==y.name&&(m.compression=y.compression,y.index>=0&&(g.idx[y.index]=v),m.offset=v)}if(r.acCompressedSize>0)switch(r.acCompression){case 0:var x=new Uint16Array(r.totalAcUncompressedCount);E(e.array,t,n,r.acCompressedSize,x,r.totalAcUncompressedCount);break;case 1:var _=Sp(e.array.slice(n.value,n.value+r.totalAcUncompressedCount));x=new Uint16Array(_.buffer);n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){var w={array:e.array,offset:n,size:r.dcCompressedSize},C=new Uint16Array(O(w).buffer);n.value+=r.dcCompressedSize}if(r.rleRawSize>0){var T=b((_=Sp(e.array.slice(n.value,n.value+r.rleCompressedSize))).buffer);n.value+=r.rleCompressedSize}var R=0,L=new Array(p.length);for(f=0;f<L.length;++f)L[f]=new Array;for(var P=0;P<e.lines;++P)for(var F=0;F<p.length;++F)L[F].push(R),R+=p[F].width*e.type*2;!function(e,t,n,i,r,s){var a=new DataView(s.buffer),o=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(o/8),h=Math.ceil(o/8),u=Math.ceil(l/8),d=o-8*(h-1),p=l-8*(u-1),f={value:0},m=new Array(3),A=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3);for(let n=0;n<3;++n)y[n]=t[e.idx[n]],m[n]=n<1?0:m[n-1]+h*u,A[n]=new Float32Array(64),g[n]=new Uint16Array(64),v[n]=new Uint16Array(64*h);for(let t=0;t<u;++t){var x=8;t==u-1&&(x=p);var _=8;for(let e=0;e<h;++e){e==h-1&&(_=d);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=r[m[e]++],M(f,i,g[e]),S(g[e],A[e]),I(A[e]);B(A);for(let t=0;t<3;++t)D(A[t],v[t],64*e)}let s=0;for(let i=0;i<3;++i){const r=n[e.idx[i]].type;for(let e=8*t;e<8*t+x;++e){s=y[i][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);a.setUint16(s+0*r,v[i][n+0],!0),a.setUint16(s+2*r,v[i][n+1],!0),a.setUint16(s+4*r,v[i][n+2],!0),a.setUint16(s+6*r,v[i][n+3],!0),a.setUint16(s+8*r,v[i][n+4],!0),a.setUint16(s+10*r,v[i][n+5],!0),a.setUint16(s+12*r,v[i][n+6],!0),a.setUint16(s+14*r,v[i][n+7],!0),s+=16*r}}if(c!=h)for(let e=8*t;e<8*t+x;++e){const t=y[i][e]+8*c*2*r,n=64*c+8*(7&e);for(let e=0;e<_;++e)a.setUint16(t+2*e*r,v[i][n+e],!0)}}}for(var E=new Uint16Array(o),w=(a=new DataView(s.buffer),0);w<3;++w){n[e.idx[w]].decoded=!0;var C=n[e.idx[w]].type;if(2==n[w].type)for(var b=0;b<l;++b){const e=y[w][b];for(var T=0;T<o;++T)E[T]=a.getUint16(e+2*T*C,!0);for(T=0;T<o;++T)a.setFloat32(e+2*T*C,Y(E[T]),!0)}}}(g,L,p,x,C,i);for(f=0;f<p.length;++f){if(!(m=p[f]).decoded){if(2!==m.compression)throw"EXRLoader.parse: unsupported channel compression";var U=0,N=0;for(P=0;P<e.lines;++P){for(var k=L[f][U],G=0;G<m.width;++G){for(var Q=0;Q<2*m.type;++Q)i[k++]=T[N+Q*m.width*m.height];N++}U++}}}return new DataView(i.buffer)}function z(e,t){for(var n=new Uint8Array(e),i=0;0!=n[t.value+i];)i+=1;var r=(new TextDecoder).decode(n.slice(t.value,t.value+i));return t.value=t.value+i+1,r}function H(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function V(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function W(e,t){var n=e[t.value];return t.value=t.value+1,n}function j(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const X=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function J(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function q(e,t){return ui.toHalfFloat(J(e,t))}function Y(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function K(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function Z(e,t){return Y(K(e,t))}function $(e,t,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,n){var i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,i}(t,n,r):"chlist"===i?function(e,t,n,i){for(var r=n.value,s=[];n.value<r+i-1;){var a=z(t,n),o=H(e,n),l=j(e,n);n.value+=3;var c=H(e,n),h=H(e,n);s.push({name:a,pixelType:o,pLinear:l,xSampling:c,ySampling:h})}return n.value+=1,s}(e,t,n,r):"chromaticities"===i?function(e,t){return{redX:J(e,t),redY:J(e,t),greenX:J(e,t),greenY:J(e,t),blueX:J(e,t),blueY:J(e,t),whiteX:J(e,t),whiteY:J(e,t)}}(e,n):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][j(e,t)]}(e,n):"box2i"===i?function(e,t){return{xMin:V(e,t),yMin:V(e,t),xMax:V(e,t),yMax:V(e,t)}}(e,n):"lineOrder"===i?function(e,t){return["INCREASING_Y"][j(e,t)]}(e,n):"float"===i?J(e,n):"v2f"===i?function(e,t){return[J(e,t),J(e,t)]}(e,n):"v3f"===i?function(e,t){return[J(e,t),J(e,t),J(e,t)]}(e,n):"int"===i?H(e,n):"rational"===i?function(e,t){return[H(e,t),V(e,t)]}(e,n):"timecode"===i?function(e,t){return[V(e,t),V(e,t)]}(e,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}const ee=new DataView(e),te=new Uint8Array(e),ne={value:0},ie=function(e,t,n){const i={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);const r=e.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;for(var s=!0;s;){var a=z(t,n);if(0==a)s=!1;else{var o=z(t,n),l=$(e,t,n,o,V(e,n));void 0===l?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${o}'.`):i[a]=l}}if(0!=(-5&r))throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(ee,e,ne),re=function(e,t,n,i,r){const s={size:0,viewer:t,array:n,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[fA?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=P;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=U;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=O;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=O;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=k;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=G;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=Q;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=Q;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,1==s.type)switch(r){case T:s.getter=Z,s.inputSize=2;break;case R:s.getter=K,s.inputSize=2}else{if(2!=s.type)throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";switch(r){case T:s.getter=J,s.inputSize=4;break;case R:s.getter=q,s.inputSize=4}}s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var a=0;a<s.blockCount;a++)X(t,i);s.outputChannels=3==s.channels?4:s.channels;const o=s.width*s.height*s.outputChannels;switch(r){case T:s.byteArray=new Float32Array(o),s.channels<s.outputChannels&&s.byteArray.fill(1,0,o);break;case R:s.byteArray=new Uint16Array(o),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,o);break;default:console.error("THREE.EXRLoader: unsupported type: ",r)}return s.bytesPerLine=s.width*s.inputSize*s.channels,4==s.outputChannels?s.format=F:s.format=N,fA?s.colorSpace="srgb-linear":s.encoding=3e3,s}(ie,ee,te,ne,this.type),se={value:0},ae={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<re.height/re.scanlineBlockSize;e++){const t=V(ee,ne);re.size=V(ee,ne),re.lines=t+re.scanlineBlockSize>re.height?re.height-t:re.scanlineBlockSize;const n=re.size<re.lines*re.bytesPerLine?re.uncompress(re):P(re);ne.value+=re.size;for(let t=0;t<re.scanlineBlockSize;t++){const i=t+e*re.scanlineBlockSize;if(i>=re.height)break;for(let e=0;e<re.channels;e++){const r=ae[ie.channels[e].name];for(let s=0;s<re.width;s++){se.value=(t*(re.channels*re.width)+e*re.width+s)*re.inputSize;const a=(re.height-1-i)*(re.width*re.outputChannels)+s*re.outputChannels+r;re.byteArray[a]=re.getter(n,se)}}}}return{header:ie,width:re.width,height:re.height,data:re.byteArray,format:re.format,[fA?"colorSpace":"encoding"]:re[fA?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){fA?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=E,e.magFilter=E,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)}),n,i)}}class AA extends uh{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,i){const r=this,s=new fh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(n))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this;function n(e,t,n,r,s,a,o,l){if(0==t||0==n)return void e.lineTo(l.x,l.y);r=r*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const c=(o.x-l.x)/2,h=(o.y-l.y)/2,u=Math.cos(r)*c+Math.sin(r)*h,d=-Math.sin(r)*c+Math.cos(r)*h;let p=t*t,f=n*n;const m=u*u,A=d*d,g=m/p+A/f;if(g>1){const e=Math.sqrt(g);p=(t*=e)*t,f=(n*=e)*n}const v=p*A+f*m,y=(p*f-v)/v;let x=Math.sqrt(Math.max(0,y));s===a&&(x=-x);const _=x*t*d/n,E=-x*n*u/t,w=Math.cos(r)*_-Math.sin(r)*E+(o.x+l.x)/2,C=Math.sin(r)*_+Math.cos(r)*E+(o.y+l.y)/2,b=i(1,0,(u-_)/t,(d-E)/n),M=i((u-_)/t,(d-E)/n,(-u-_)/t,(-d-E)/n)%(2*Math.PI);e.currentPath.absellipse(w,C,t,n,b,b+M,0===a,r)}function i(e,t,n,i){const r=e*n+t*i,s=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+i*i);let a=Math.acos(Math.max(-1,Math.min(1,r/s)));return e*i-t*n<0&&(a=-a),a}function r(e,t){t=Object.assign({},t);let n={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)n=Object.assign(n,m["."+t[e]])}function i(i,r,s){void 0===s&&(s=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(i)&&(t[r]=s(e.getAttribute(i))),n[i]&&(t[r]=s(n[i])),e.style&&""!==e.style[i]&&(t[r]=s(e.style[i]))}function r(e){return Math.max(0,Math.min(1,c(e)))}function s(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(n=Object.assign(n,m["#"+e.getAttribute("id")])),i("fill","fill"),i("fill-opacity","fillOpacity",r),i("fill-rule","fillRule"),i("opacity","opacity",r),i("stroke","stroke"),i("stroke-opacity","strokeOpacity",r),i("stroke-width","strokeWidth",s),i("stroke-linejoin","strokeLineJoin"),i("stroke-linecap","strokeLineCap"),i("stroke-miterlimit","strokeMiterLimit",s),i("visibility","visibility"),t}function s(e,t){return e-(t-e)}function a(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let r=0,s=!0,a="",o="";const l=[];function c(e,t,n){const i=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw i.partial=n,i}function h(){""!==a&&(""===o?l.push(Number(a)):l.push(Number(a)*Math.pow(10,Number(o)))),a="",o=""}let u;const d=e.length;for(let p=0;p<d;p++)if(u=e[p],Array.isArray(t)&&t.includes(l.length%n)&&i.FLAGS.test(u))r=1,a=u,h();else{if(0===r){if(i.WHITESPACE.test(u))continue;if(i.DIGIT.test(u)||i.SIGN.test(u)){r=1,a=u;continue}if(i.POINT.test(u)){r=2,a=u;continue}i.COMMA.test(u)&&(s&&c(u,p,l),s=!0)}if(1===r){if(i.DIGIT.test(u)){a+=u;continue}if(i.POINT.test(u)){a+=u,r=2;continue}if(i.EXP.test(u)){r=3;continue}i.SIGN.test(u)&&1===a.length&&i.SIGN.test(a[0])&&c(u,p,l)}if(2===r){if(i.DIGIT.test(u)){a+=u;continue}if(i.EXP.test(u)){r=3;continue}i.POINT.test(u)&&"."===a[a.length-1]&&c(u,p,l)}if(3===r){if(i.DIGIT.test(u)){o+=u;continue}if(i.SIGN.test(u)){if(""===o){o+=u;continue}1===o.length&&i.SIGN.test(o)&&c(u,p,l)}}i.WHITESPACE.test(u)?(h(),r=0,s=!1):i.COMMA.test(u)?(h(),r=0,s=!0):i.SIGN.test(u)?(h(),r=1,a=u):i.POINT.test(u)?(h(),r=2,a=u):c(u,p,l)}return h(),l}const o=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let n,i="px";if("string"==typeof e||e instanceof String)for(let t=0,n=o.length;t<n;t++){const n=o[t];if(e.endsWith(n)){i=n,e=e.substring(0,e.length-n.length);break}}return"px"===i&&"px"!==t.defaultUnit?n=l.in[t.defaultUnit]/t.defaultDPI:(n=l[i][t.defaultUnit],n<0&&(n=l[i].in*t.defaultDPI)),n*parseFloat(e)}function h(e){const t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function u(e){const t=e.elements,n=t[0]*t[3]+t[1]*t[4];if(0===n)return!1;const i=d(e),r=p(e);return Math.abs(n/(i*r))>Number.EPSILON}function d(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function p(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const f=[],m={},A=[],g=new lt,v=new lt,y=new lt,x=new lt,_=new ot,E=new Ot,w=new lt,C=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,i){if(1!==t.nodeType)return;const o=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new lt,n=g;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const n=c(e.getAttribute("x")),i=c(e.getAttribute("y"));t.translate(n,i)}if(e.hasAttribute("transform")){const i=e.getAttribute("transform").split(")");for(let e=i.length-1;e>=0;e--){const r=i[e].trim();if(""===r)continue;const s=r.indexOf("("),o=r.length;if(s>0&&s<o){const e=r.slice(0,s),t=a(r.slice(s+1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let i=0;t.length>=2&&(i=t[1]),n.translate(e,i)}break;case"rotate":if(t.length>=1){let e=0,i=0,r=0;e=t[0]*Math.PI/180,t.length>=3&&(i=t[1],r=t[2]),v.makeTranslation(-i,-r),y.makeRotation(e),x.multiplyMatrices(y,v),v.makeTranslation(i,r),n.multiplyMatrices(v,x)}break;case"scale":if(t.length>=1){const e=t[0];let i=e;t.length>=2&&(i=t[1]),n.scale(e,i)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(n)}}return t}(e);A.length>0&&t.premultiply(A[A.length-1]);return w.copy(t),A.push(t),t}(t);let l=!1,C=null;switch(t.nodeName){case"svg":case"g":i=r(t,i);break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const n=e.sheet.cssRules[t];if(1!==n.type)continue;const i=n.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<i.length;e++){const t=Object.fromEntries(Object.entries(n.style).filter((([,e])=>""!==e)));m[i[e]]=Object.assign(m[i[e]]||{},t)}}}(t);break;case"path":i=r(t,i),t.hasAttribute("d")&&(C=function(e){const t=new Ju,i=new ot,r=new ot,o=new ot;let l=!0,c=!1;const h=e.getAttribute("d");if(""===h||"none"===h)return null;const u=h.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,h=u.length;e<h;e++){const h=u[e],d=h.charAt(0),p=h.slice(1).trim();let f;switch(!0===l&&(c=!0,l=!1),d){case"M":f=a(p);for(let e=0,n=f.length;e<n;e+=2)i.x=f[e+0],i.y=f[e+1],r.x=i.x,r.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"H":f=a(p);for(let e=0,n=f.length;e<n;e++)i.x=f[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"V":f=a(p);for(let e=0,n=f.length;e<n;e++)i.y=f[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"L":f=a(p);for(let e=0,n=f.length;e<n;e+=2)i.x=f[e+0],i.y=f[e+1],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"C":f=a(p);for(let e=0,n=f.length;e<n;e+=6)t.bezierCurveTo(f[e+0],f[e+1],f[e+2],f[e+3],f[e+4],f[e+5]),r.x=f[e+2],r.y=f[e+3],i.x=f[e+4],i.y=f[e+5],0===e&&!0===c&&o.copy(i);break;case"S":f=a(p);for(let e=0,n=f.length;e<n;e+=4)t.bezierCurveTo(s(i.x,r.x),s(i.y,r.y),f[e+0],f[e+1],f[e+2],f[e+3]),r.x=f[e+0],r.y=f[e+1],i.x=f[e+2],i.y=f[e+3],0===e&&!0===c&&o.copy(i);break;case"Q":f=a(p);for(let e=0,n=f.length;e<n;e+=4)t.quadraticCurveTo(f[e+0],f[e+1],f[e+2],f[e+3]),r.x=f[e+0],r.y=f[e+1],i.x=f[e+2],i.y=f[e+3],0===e&&!0===c&&o.copy(i);break;case"T":f=a(p);for(let e=0,n=f.length;e<n;e+=2){const n=s(i.x,r.x),a=s(i.y,r.y);t.quadraticCurveTo(n,a,f[e+0],f[e+1]),r.x=n,r.y=a,i.x=f[e+0],i.y=f[e+1],0===e&&!0===c&&o.copy(i)}break;case"A":f=a(p,[3,4],7);for(let e=0,s=f.length;e<s;e+=7){if(f[e+5]==i.x&&f[e+6]==i.y)continue;const s=i.clone();i.x=f[e+5],i.y=f[e+6],r.x=i.x,r.y=i.y,n(t,f[e],f[e+1],f[e+2],f[e+3],f[e+4],s,i),0===e&&!0===c&&o.copy(i)}break;case"m":f=a(p);for(let e=0,n=f.length;e<n;e+=2)i.x+=f[e+0],i.y+=f[e+1],r.x=i.x,r.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"h":f=a(p);for(let e=0,n=f.length;e<n;e++)i.x+=f[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"v":f=a(p);for(let e=0,n=f.length;e<n;e++)i.y+=f[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"l":f=a(p);for(let e=0,n=f.length;e<n;e+=2)i.x+=f[e+0],i.y+=f[e+1],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&o.copy(i);break;case"c":f=a(p);for(let e=0,n=f.length;e<n;e+=6)t.bezierCurveTo(i.x+f[e+0],i.y+f[e+1],i.x+f[e+2],i.y+f[e+3],i.x+f[e+4],i.y+f[e+5]),r.x=i.x+f[e+2],r.y=i.y+f[e+3],i.x+=f[e+4],i.y+=f[e+5],0===e&&!0===c&&o.copy(i);break;case"s":f=a(p);for(let e=0,n=f.length;e<n;e+=4)t.bezierCurveTo(s(i.x,r.x),s(i.y,r.y),i.x+f[e+0],i.y+f[e+1],i.x+f[e+2],i.y+f[e+3]),r.x=i.x+f[e+0],r.y=i.y+f[e+1],i.x+=f[e+2],i.y+=f[e+3],0===e&&!0===c&&o.copy(i);break;case"q":f=a(p);for(let e=0,n=f.length;e<n;e+=4)t.quadraticCurveTo(i.x+f[e+0],i.y+f[e+1],i.x+f[e+2],i.y+f[e+3]),r.x=i.x+f[e+0],r.y=i.y+f[e+1],i.x+=f[e+2],i.y+=f[e+3],0===e&&!0===c&&o.copy(i);break;case"t":f=a(p);for(let e=0,n=f.length;e<n;e+=2){const n=s(i.x,r.x),a=s(i.y,r.y);t.quadraticCurveTo(n,a,i.x+f[e+0],i.y+f[e+1]),r.x=n,r.y=a,i.x=i.x+f[e+0],i.y=i.y+f[e+1],0===e&&!0===c&&o.copy(i)}break;case"a":f=a(p,[3,4],7);for(let e=0,s=f.length;e<s;e+=7){if(0==f[e+5]&&0==f[e+6])continue;const s=i.clone();i.x+=f[e+5],i.y+=f[e+6],r.x=i.x,r.y=i.y,n(t,f[e],f[e+1],f[e+2],f[e+3],f[e+4],s,i),0===e&&!0===c&&o.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(o),t.currentPath.currentPoint.copy(i),l=!0);break;default:console.warn(h)}c=!1}return t}(t));break;case"rect":i=r(t,i),C=function(e){const t=c(e.getAttribute("x")||0),n=c(e.getAttribute("y")||0),i=c(e.getAttribute("rx")||e.getAttribute("ry")||0),r=c(e.getAttribute("ry")||e.getAttribute("rx")||0),s=c(e.getAttribute("width")),a=c(e.getAttribute("height")),o=.448084975506,l=new Ju;l.moveTo(t+i,n),l.lineTo(t+s-i,n),(0!==i||0!==r)&&l.bezierCurveTo(t+s-i*o,n,t+s,n+r*o,t+s,n+r);l.lineTo(t+s,n+a-r),(0!==i||0!==r)&&l.bezierCurveTo(t+s,n+a-r*o,t+s-i*o,n+a,t+s-i,n+a);l.lineTo(t+i,n+a),(0!==i||0!==r)&&l.bezierCurveTo(t+i*o,n+a,t,n+a-r*o,t,n+a-r);l.lineTo(t,n+r),(0!==i||0!==r)&&l.bezierCurveTo(t,n+r*o,t+i*o,n,t+i,n);return l}(t);break;case"polygon":i=r(t,i),C=function(e){function t(e,t,n){const s=c(t),a=c(n);0===r?i.moveTo(s,a):i.lineTo(s,a),r++}const n=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,i=new Ju;let r=0;return e.getAttribute("points").replace(n,t),i.currentPath.autoClose=!0,i}(t);break;case"polyline":i=r(t,i),C=function(e){function t(e,t,n){const s=c(t),a=c(n);0===r?i.moveTo(s,a):i.lineTo(s,a),r++}const n=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,i=new Ju;let r=0;return e.getAttribute("points").replace(n,t),i.currentPath.autoClose=!1,i}(t);break;case"circle":i=r(t,i),C=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),i=c(e.getAttribute("r")||0),r=new Tl;r.absarc(t,n,i,0,2*Math.PI);const s=new Ju;return s.subPaths.push(r),s}(t);break;case"ellipse":i=r(t,i),C=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),i=c(e.getAttribute("rx")||0),r=c(e.getAttribute("ry")||0),s=new Tl;s.absellipse(t,n,i,r,0,2*Math.PI);const a=new Ju;return a.subPaths.push(s),a}(t);break;case"line":i=r(t,i),C=function(e){const t=c(e.getAttribute("x1")||0),n=c(e.getAttribute("y1")||0),i=c(e.getAttribute("x2")||0),r=c(e.getAttribute("y2")||0),s=new Ju;return s.moveTo(t,n),s.lineTo(i,r),s.currentPath.autoClose=!1,s}(t);break;case"defs":l=!0;break;case"use":i=r(t,i);const o=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),h=t.viewportElement.getElementById(o);h?e(h,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+o)}C&&(void 0!==i.fill&&"none"!==i.fill&&C.color.setStyle(i.fill,"srgb"),function(e,t){function n(e){E.set(e.x,e.y,1).applyMatrix3(t),e.set(E.x,E.y)}function i(e){const n=e.xRadius,i=e.yRadius,r=Math.cos(e.aRotation),s=Math.sin(e.aRotation),a=new Ot(n*r,n*s,0),o=new Ot(-i*s,i*r,0),l=a.applyMatrix3(t),c=o.applyMatrix3(t),u=g.set(l.x,c.x,0,l.y,c.y,0,0,0,1),d=v.copy(u).invert(),p=y.copy(d).transpose().multiply(d).elements,f=function(e,t,n){let i,r,s,a,o;const l=e+n,c=e-n,h=Math.sqrt(c*c+4*t*t);l>0?(i=.5*(l+h),o=1/i,r=e*o*n-t*o*t):l<0?r=.5*(l-h):(i=.5*h,r=-.5*h);s=c>0?c+h:c-h;Math.abs(s)>2*Math.abs(t)?(o=-2*t/s,a=1/Math.sqrt(1+o*o),s=o*a):0===Math.abs(t)?(s=1,a=0):(o=-.5*s/t,s=1/Math.sqrt(1+o*o),a=o*s);c>0&&(o=s,s=-a,a=o);return{rt1:i,rt2:r,cs:s,sn:a}}(p[0],p[1],p[4]),m=Math.sqrt(f.rt1),A=Math.sqrt(f.rt2);e.xRadius=1/m,e.yRadius=1/A,e.aRotation=Math.atan2(f.sn,f.cs);if(!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const n=v.set(m,0,0,0,A,0,0,0,1),i=y.set(f.cs,f.sn,0,-f.sn,f.cs,0,0,0,1),r=n.multiply(i).multiply(u),s=e=>{const{x:t,y:n}=new Ot(Math.cos(e),Math.sin(e),0).applyMatrix3(r);return Math.atan2(n,t)};e.aStartAngle=s(e.aStartAngle),e.aEndAngle=s(e.aEndAngle),h(t)&&(e.aClockwise=!e.aClockwise)}}function r(e){const n=d(t),i=p(t);e.xRadius*=n,e.yRadius*=i;const r=n>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=r,h(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}const s=e.subPaths;for(let e=0,a=s.length;e<a;e++){const a=s[e].curves;for(let e=0;e<a.length;e++){const s=a[e];s.isLineCurve?(n(s.v1),n(s.v2)):s.isCubicBezierCurve?(n(s.v0),n(s.v1),n(s.v2),n(s.v3)):s.isQuadraticBezierCurve?(n(s.v0),n(s.v1),n(s.v2)):s.isEllipseCurve&&(_.set(s.aX,s.aY),n(_),s.aX=_.x,s.aY=_.y,u(t)?i(s):r(s))}}}(C,w),f.push(C),C.userData={node:t,style:i});const b=t.childNodes;for(let t=0;t<b.length;t++){const n=b[t];l&&"style"!==n.nodeName&&"defs"!==n.nodeName||e(n,i)}o&&(A.pop(),A.length>0?w.copy(A[A.length-1]):w.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:f,xml:C.documentElement}}static createShapes(e){const t=999999999,n=0,i=1,r=2,s=3,a=4,o=5,l=6,c={loc:n,t:0};function h(e,t,i,s){const a=e.x,o=t.x,l=i.x,h=s.x,d=e.y,p=t.y,f=i.y,m=s.y,A=(h-l)*(d-f)-(m-f)*(a-l),g=(m-f)*(o-a)-(h-l)*(p-d),v=A/g,y=((o-a)*(d-f)-(p-d)*(a-l))/g;if(0===g&&0!==A||v<=0||v>=1||y<0||y>1)return null;if(0===A&&0===g){for(let l=0;l<2;l++){if(u(0===l?i:s,e,t),c.loc==n){const e=0===l?i:s;return{x:e.x,y:e.y,t:c.t}}if(c.loc==r){return{x:+(a+c.t*(o-a)).toPrecision(10),y:+(d+c.t*(p-d)).toPrecision(10),t:c.t}}}return null}for(let r=0;r<2;r++)if(u(0===r?i:s,e,t),c.loc==n){const e=0===r?i:s;return{x:e.x,y:e.y,t:c.t}}return{x:+(a+v*(o-a)).toPrecision(10),y:+(d+v*(p-d)).toPrecision(10),t:v}}function u(e,t,h){const u=h.x-t.x,d=h.y-t.y,p=e.x-t.x,f=e.y-t.y,m=u*f-p*d;if(e.x===t.x&&e.y===t.y)return c.loc=n,void(c.t=0);if(e.x===h.x&&e.y===h.y)return c.loc=i,void(c.t=1);if(m<-Number.EPSILON)return void(c.loc=s);if(m>Number.EPSILON)return void(c.loc=a);if(u*p<0||d*f<0)return void(c.loc=o);if(Math.sqrt(u*u+d*d)<Math.sqrt(p*p+f*f))return void(c.loc=l);let A;A=0!==u?p/u:f/d,c.loc=r,c.t=A}function d(e,t,n){const i=new ot;t.getCenter(i);const r=[];return n.forEach((t=>{if(t.boundingBox.containsPoint(i)){const n=function(e,t){const n=[],i=[];for(let r=1;r<e.length;r++){const s=e[r-1],a=e[r];for(let e=1;e<t.length;e++){const r=h(s,a,t[e-1],t[e]);null!==r&&void 0===n.find((e=>e.t<=r.t+Number.EPSILON&&e.t>=r.t-Number.EPSILON))&&(n.push(r),i.push(new ot(r.x,r.y)))}}return i}(e,t.points);n.forEach((e=>{r.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),r.sort(((e,t)=>e.point.x-t.point.x)),r}let p=t,f=-999999999,m=e.subPaths.map((e=>{const n=e.getPoints();let i=-999999999,r=t,s=-999999999,a=t;for(let e=0;e<n.length;e++){const t=n[e];t.y>i&&(i=t.y),t.y<r&&(r=t.y),t.x>s&&(s=t.x),t.x<a&&(a=t.x)}return f<=s&&(f=s+1),p>=a&&(p=a-1),{curves:e.curves,points:n,isCW:mc.isClockWise(n),identifier:-1,boundingBox:new Su(new ot(a,r),new ot(s,i))}}));m=m.filter((e=>e.points.length>1));for(let e=0;e<m.length;e++)m[e].identifier=e;const A=m.map((t=>function(e,t,n,i,r){null!=r&&""!==r||(r="nonzero");const s=new ot;e.boundingBox.getCenter(s);const a=d([new ot(n,s.y),new ot(i,s.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));const o=[],l=[];a.forEach((t=>{t.identifier===e.identifier?o.push(t):l.push(t)}));const c=o[0].point.x,h=[];let u=0;for(;u<l.length&&l[u].point.x<c;)h.length>0&&h[h.length-1]===l[u].identifier?h.pop():h.push(l[u].identifier),u++;if(h.push(e.identifier),"evenodd"===r){const t=h.length%2==0,n=h[h.length-2];return{identifier:e.identifier,isHole:t,for:n}}if("nonzero"===r){let n=!0,i=null,r=null;for(let e=0;e<h.length;e++){const s=h[e];n?(r=t[s].isCW,n=!1,i=s):r!==t[s].isCW&&(r=t[s].isCW,n=!0)}return{identifier:e.identifier,isHole:n,for:i}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(t,m,p,f,e.userData?e.userData.style.fillRule:void 0))),g=[];return m.forEach((e=>{if(!A[e.identifier].isHole){const t=new Hl;t.curves=e.curves;A.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const n=m[e.identifier],i=new Tl;i.curves=n.curves,t.holes.push(i)})),g.push(t)}})),g}static getStrokeStyle(e,t,n,i,r){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:i=void 0!==i?i:"butt",strokeMiterLimit:r=void 0!==r?r:4}}static pointsToStroke(e,t,n,i){const r=[],s=[],a=[];if(0===AA.pointsToStrokeWithBuffers(e,t,n,i,r,s,a))return null;const o=new bi;return o.setAttribute("position",new gi(r,3)),o.setAttribute("normal",new gi(s,3)),o.setAttribute("uv",new gi(a,2)),o}static pointsToStrokeWithBuffers(e,t,n,i,r,s,a,o){const l=new ot,c=new ot,h=new ot,u=new ot,d=new ot,p=new ot,f=new ot,m=new ot,A=new ot,g=new ot,v=new ot,y=new ot,x=new ot,_=new ot,E=new ot,w=new ot,C=new ot;n=void 0!==n?n:12,i=void 0!==i?i:.001,o=void 0!==o?o:0,e=function(e){let t=!1;for(let n=1,r=e.length-1;n<r;n++)if(e[n].distanceTo(e[n+1])<i){t=!0;break}if(!t)return e;const n=[];n.push(e[0]);for(let t=1,r=e.length-1;t<r;t++)e[t].distanceTo(e[t+1])>=i&&n.push(e[t]);return n.push(e[e.length-1]),n}(e);const b=e.length;if(b<2)return 0;const M=e[0].equals(e[b-1]);let S,I,B=e[0];const T=t.strokeWidth/2,R=1/(b-1);let D,L,P,F,U=0,O=!1,N=0,k=3*o,G=2*o;Q(e[0],e[1],l).multiplyScalar(T),m.copy(e[0]).sub(l),A.copy(e[0]).add(l),g.copy(m),v.copy(A);for(let n=1;n<b;n++){S=e[n],I=n===b-1?M?e[1]:void 0:e[n+1];const i=l;if(Q(B,S,i),h.copy(i).multiplyScalar(T),y.copy(S).sub(h),x.copy(S).add(h),D=U+R,L=!1,void 0!==I){Q(S,I,c),h.copy(c).multiplyScalar(T),_.copy(S).sub(h),E.copy(S).add(h),P=!0,h.subVectors(I,B),i.dot(h)<0&&(P=!1),1===n&&(O=P),h.subVectors(I,S),h.normalize();const e=Math.abs(i.dot(h));if(e>Number.EPSILON){const n=T/e;h.multiplyScalar(-n),u.subVectors(S,B),d.copy(u).setLength(n).add(h),w.copy(d).negate();const i=d.length(),r=u.length();u.divideScalar(r),p.subVectors(I,S);const s=p.length();switch(p.divideScalar(s),u.dot(w)<r&&p.dot(w)<s&&(L=!0),C.copy(d).add(S),w.add(S),F=!1,L?P?(E.copy(w),x.copy(w)):(_.copy(w),y.copy(w)):V(),t.strokeLineJoin){case"bevel":W(P,L,D);break;case"round":j(P,L),P?H(S,y,_,D,0):H(S,E,x,D,1);break;default:const e=T*t.strokeMiterLimit/i;if(e<1){if("miter-clip"!==t.strokeLineJoin){W(P,L,D);break}j(P,L),P?(p.subVectors(C,y).multiplyScalar(e).add(y),f.subVectors(C,_).multiplyScalar(e).add(_),z(y,D,0),z(p,D,0),z(S,D,.5),z(S,D,.5),z(p,D,0),z(f,D,0),z(S,D,.5),z(f,D,0),z(_,D,0)):(p.subVectors(C,x).multiplyScalar(e).add(x),f.subVectors(C,E).multiplyScalar(e).add(E),z(x,D,1),z(p,D,1),z(S,D,.5),z(S,D,.5),z(p,D,1),z(f,D,1),z(S,D,.5),z(f,D,1),z(E,D,1))}else L?(P?(z(A,U,1),z(m,U,0),z(C,D,0),z(A,U,1),z(C,D,0),z(w,D,1)):(z(A,U,1),z(m,U,0),z(C,D,1),z(m,U,0),z(w,D,0),z(C,D,1)),P?_.copy(C):E.copy(C)):P?(z(y,D,0),z(C,D,0),z(S,D,.5),z(S,D,.5),z(C,D,0),z(_,D,0)):(z(x,D,1),z(C,D,1),z(S,D,.5),z(S,D,.5),z(C,D,1),z(E,D,1)),F=!0}}else V()}else V();M||n!==b-1||X(e[0],g,v,P,!0,U),U=D,B=S,m.copy(_),A.copy(E)}if(M){if(L&&r){let e=C,t=w;O!==P&&(e=w,t=C),P?(F||O)&&(t.toArray(r,0),t.toArray(r,9),F&&e.toArray(r,3)):!F&&O||(t.toArray(r,3),t.toArray(r,9),F&&e.toArray(r,0))}}else X(S,y,x,P,!1,D);return N;function Q(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function z(e,t,n){r&&(r[k]=e.x,r[k+1]=e.y,r[k+2]=0,s&&(s[k]=0,s[k+1]=0,s[k+2]=1),k+=3,a&&(a[G]=t,a[G+1]=n,G+=2)),N+=3}function H(e,t,i,r,s){l.copy(t).sub(e).normalize(),c.copy(i).sub(e).normalize();let a=Math.PI;const o=l.dot(c);Math.abs(o)<1&&(a=Math.abs(Math.acos(o))),a/=n,h.copy(t);for(let t=0,i=n-1;t<i;t++)u.copy(h).rotateAround(e,a),z(h,r,s),z(u,r,s),z(e,r,.5),h.copy(u);z(u,r,s),z(i,r,s),z(e,r,.5)}function V(){z(A,U,1),z(m,U,0),z(y,D,0),z(A,U,1),z(y,D,0),z(x,D,1)}function W(e,t,n){t?e?(z(A,U,1),z(m,U,0),z(y,D,0),z(A,U,1),z(y,D,0),z(w,D,1),z(y,n,0),z(_,n,0),z(w,n,.5)):(z(A,U,1),z(m,U,0),z(x,D,1),z(m,U,0),z(w,D,0),z(x,D,1),z(x,n,1),z(w,n,0),z(E,n,1)):e?(z(y,n,0),z(_,n,0),z(S,n,.5)):(z(x,n,1),z(E,n,0),z(S,n,.5))}function j(e,t){t&&(e?(z(A,U,1),z(m,U,0),z(y,D,0),z(A,U,1),z(y,D,0),z(w,D,1),z(y,U,0),z(S,D,.5),z(w,D,1),z(S,D,.5),z(_,U,0),z(w,D,1)):(z(A,U,1),z(m,U,0),z(x,D,1),z(m,U,0),z(w,D,0),z(x,D,1),z(x,U,1),z(w,D,0),z(S,D,.5),z(S,D,.5),z(w,D,0),z(E,U,1)))}function X(e,n,i,s,o,d){switch(t.strokeLineCap){case"round":o?H(e,i,n,d,.5):H(e,n,i,d,.5);break;case"square":if(o)l.subVectors(n,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),u.subVectors(c,l).add(e),s?(h.toArray(r,3),u.toArray(r,0),u.toArray(r,9)):(h.toArray(r,3),1===a[7]?u.toArray(r,9):h.toArray(r,9),u.toArray(r,0));else{l.subVectors(i,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),u.subVectors(c,l).add(e);const t=r.length;s?(h.toArray(r,t-3),u.toArray(r,t-6),u.toArray(r,t-12)):(u.toArray(r,t-6),h.toArray(r,t-3),u.toArray(r,t-12))}}}}}const gA=/^[og]\s*(.+)?/,vA=/^mtllib /,yA=/^usemtl /,xA=/^usemap /,_A=new Ot,EA=new Ot,wA=new Ot,CA=new Ot,bA=new Ot;function MA(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,r=this.object.geometry.normals;_A.fromArray(i,e),EA.fromArray(i,t),wA.fromArray(i,n),bA.subVectors(wA,EA),CA.subVectors(_A,EA),bA.cross(CA),bA.normalize(),r.push(bA.x,bA.y,bA.z),r.push(bA.x,bA.y,bA.z),r.push(bA.x,bA.y,bA.z)},addColor:function(e,t,n){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,s,a,o,l){const c=this.vertices.length;let h=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(h,u,d),this.addColor(h,u,d),void 0!==a&&""!==a){const e=this.normals.length;h=this.parseNormalIndex(a,e),u=this.parseNormalIndex(o,e),d=this.parseNormalIndex(l,e),this.addNormal(h,u,d)}else this.addFaceNormal(h,u,d);if(void 0!==i&&""!==i){const e=this.uvs.length;h=this.parseUVIndex(i,e),u=this.parseUVIndex(r,e),d=this.parseUVIndex(s,e),this.addUV(h,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let t=0,i=e.length;t<i;t++)this.addVertexLine(this.parseVertexIndex(e[t],n));for(let e=0,n=t.length;e<n;e++)this.addUVLine(this.parseUVIndex(t[e],i))}};return e.startObject("",!1),e}class SA extends uh{constructor(e){super(e),this.materials=null}load(e,t,n,i){const r=this,s=new fh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(n))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new MA;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const n=e.split("\n");let i="",r="",s=0,a=[];const o="function"==typeof"".trimLeft;for(let e=0,l=n.length;e<l;e++)if(i=n[e],i=o?i.trimLeft():i.trim(),s=i.length,0!==s&&(r=i.charAt(0),"#"!==r))if("v"===r){const e=i.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===r){const e=i.substr(1).trim().split(/\s+/),n=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];if(i.length>0){const e=i.split("/");n.push(e)}}const r=n[0];for(let e=1,i=n.length-1;e<i;e++){const i=n[e],s=n[e+1];t.addFace(r[0],i[0],s[0],r[1],i[1],s[1],r[2],i[2],s[2])}}else if("l"===r){const e=i.substring(1).trim().split(" ");let n=[];const r=[];if(-1===i.indexOf("/"))n=e;else for(let t=0,i=e.length;t<i;t++){const i=e[t].split("/");""!==i[0]&&n.push(i[0]),""!==i[1]&&r.push(i[1])}t.addLineGeometry(n,r)}else if("p"===r){const e=i.substr(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(a=gA.exec(i))){const e=(" "+a[0].substr(1).trim()).substr(1);t.startObject(e)}else if(yA.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(vA.test(i))t.materialLibraries.push(i.substring(7).trim());else if(xA.test(i))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===r){if(a=i.split(" "),a.length>1){const e=a[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===i)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+i+'"')}t.finalize();const l=new Na;l.materialLibraries=[].concat(t.materialLibraries);if(!0===!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,n=t.objects.length;e<n;e++){const n=t.objects[e],i=n.geometry,r=n.materials,s="Line"===i.type,a="Points"===i.type;let o=!1;if(0===i.vertices.length)continue;const c=new bi;c.setAttribute("position",new gi(i.vertices,3)),i.normals.length>0&&c.setAttribute("normal",new gi(i.normals,3)),i.colors.length>0&&(o=!0,c.setAttribute("color",new gi(i.colors,3))),!0===i.hasUVIndices&&c.setAttribute("uv",new gi(i.uvs,2));const h=[];for(let e=0,n=r.length;e<n;e++){const n=r[e],i=n.name+"_"+n.smooth+"_"+o;let l=t.materials[i];if(null!==this.materials)if(l=this.materials.create(n.name),!s||!l||l instanceof Ho){if(a&&l&&!(l instanceof el)){const e=new el({size:10,sizeAttenuation:!1});si.prototype.copy.call(e,l),e.color.copy(l.color),e.map=l.map,l=e}}else{const e=new Ho;si.prototype.copy.call(e,l),e.color.copy(l.color),l=e}void 0===l&&(l=s?new Ho:a?new el({size:1,sizeAttenuation:!1}):new Uc,l.name=n.name,l.flatShading=!n.smooth,l.vertexColors=o,t.materials[i]=l),h.push(l)}let u;if(h.length>1){for(let e=0,t=r.length;e<t;e++){const t=r[e];c.addGroup(t.groupStart,t.groupCount,e)}u=s?new Zo(c,h):a?new sl(c,h):new Hi(c,h)}else u=s?new Zo(c,h[0]):a?new sl(c,h[0]):new Hi(c,h[0]);u.name=n.name,l.add(u)}else if(t.vertices.length>0){const e=new el({size:1,sizeAttenuation:!1}),n=new bi;n.setAttribute("position",new gi(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(n.setAttribute("color",new gi(t.colors,3)),e.vertexColors=!0);const i=new sl(n,e);l.add(i)}return l}}const IA=new WeakMap;class BA extends uh{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new fh(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(i)}),n,i)}decodeDracoFile(e,t,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const e in t.attributeTypes){const n=t.attributeTypes[e];void 0!==n.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=n.name)}const n=JSON.stringify(t);if(IA.has(e)){const t=IA.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),IA.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new bi;e.index&&t.setIndex(new fi(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,s=i.array,a=i.itemSize;t.setAttribute(r,new fi(s,a))}return t}_loadLibrary(e,t){const n=new fh(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=TA.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function TA(){let e,t;function n(e,t,n,i,r,s){const a=s.num_components(),o=n.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,h);const u=new r(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:i,array:u,itemSize:a}}onmessage=function(i){const r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=r.buffer,s=r.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(i),i.byteLength);try{const e=function(e,t,i,r){const s=r.attributeIDs,a=r.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeBufferToMesh(i,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeBufferToPointCloud(i,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const i in s){const l=self[a[i]];let c,u;if(r.useUniqueIDs)u=s[i],c=t.GetAttributeByUniqueId(o,u);else{if(u=t.GetAttributeId(o,e[s[i]]),-1===u)continue;c=t.GetAttribute(o,u)}h.attributes.push(n(e,t,o,i,l,c))}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,n){const i=n.num_faces(),r=3*i,s=4*r,a=e._malloc(s);t.GetTrianglesUInt32Array(n,s,a);const o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),h}(t,a,o,s),i=e.attributes.map((e=>e.array.buffer));e.index&&i.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},i)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(o),t.destroy(a)}}))}}}let RA;function DA(e){const t={...e};return"defines"in e&&(t.defines={...e.defines}),"uniforms"in e&&(t.uniforms=qi.clone(e.uniforms)),t}const LA={defines:{X_IS_EVEN:1,Y_IS_EVEN:1},uniforms:{map:{value:null},originalMapSize:{value:new ot},parentMapSize:{value:new ot},parentLevel:{value:0}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <project_vertex>\n\t\t\tvUv = uv;\n\n\t\t}\n\t",fragmentShader:'\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D map;\n\t\tuniform int parentLevel;\n\t\tuniform vec2 parentMapSize;\n\t\tuniform vec2 originalMapSize;\n\n\t\t\n\n\t// Without original size argument for power of two targets\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level ) {\n\n\t\t// the fraction of the uv space used by the target mip\n\t\tfloat targetSubview = 1.0 / pow( 2.0, float( level ) );\n\t\tfloat widthRatio = 2.0 / 3.0;\n\t\tvec2 scaledDimensions = vec2( targetSubview * widthRatio, targetSubview );\n\n\t\t// all levels > 0 are on the right third of the texture\n\t\t// y is offset from the bottom\n\t\tvec2 offset = vec2(\n\t\t\tlevel > 0 ? widthRatio : 0.0,\n\t\t\tlevel > 0 ? targetSubview : 0.0\n\t\t);\n\n\t\tvec2 samplePoint = mix( offset, offset + scaledDimensions, uv );\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\t// With original size argument\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level, vec2 originalPixelSize ) {\n\n\t\tfloat floatLevel = float( level );\n\t\tvec2 atlasSize;\n\t\tatlasSize.x = floor( originalPixelSize.x * 1.5 );\n\t\tatlasSize.y = originalPixelSize.y;\n\n\t\t// we stop making mip maps when one dimension == 1\n\t\tfloat maxLevel = min( floor( log2( originalPixelSize.x ) ), floor( log2( originalPixelSize.y ) ) );\n\t\tfloatLevel = min( floatLevel, maxLevel );\n\n\t\t// use inverse pow of 2 to simulate right bit shift operator\n\t\tvec2 currentPixelDimensions = floor( originalPixelSize / pow( 2.0, floatLevel ) );\n\t\tvec2 pixelOffset = vec2(\n\t\t\tfloatLevel > 0.0 ? originalPixelSize.x : 0.0,\n\t\t\tfloatLevel > 0.0 ? currentPixelDimensions.y : 0.0\n\t\t);\n\n\t\t// "minPixel / atlasSize" samples the top left piece of the first pixel\n\t\t// "maxPixel / atlasSize" samples the bottom right piece of the last pixel\n\t\tvec2 minPixel = pixelOffset;\n\t\tvec2 maxPixel = pixelOffset + currentPixelDimensions;\n\t\tvec2 samplePoint = mix( minPixel, maxPixel, uv );\n\t\tsamplePoint /= atlasSize;\n\n\t\tvec2 halfPixelSize = 1.0 / ( 2.0 * atlasSize );\n\t\tsamplePoint = min( samplePoint, maxPixel / atlasSize - halfPixelSize );\n\t\tsamplePoint = max( samplePoint, minPixel / atlasSize + halfPixelSize );\n\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level, vec2 originalPixelSize ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel, originalPixelSize );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel, originalPixelSize );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\n\n\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t#define SAMPLES 4\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 2\n\n\t\t#elif X_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 3\n\n\t\t#elif Y_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 2\n\n\t\t#else\n\n\t\t#define SAMPLES 9\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 3\n\n\t\t#endif\n\n\t\tvec4 sampleAt( vec2 uv ) {\n\n\t\t\treturn packedTexture2DLOD( map, uv, parentLevel, originalMapSize );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec2 childMapSize = parentMapSize / 2.0;\n\t\t\t// vec2 childPixelSize = 1.0 / childMapSize;\n\t\t\t// vec2 halfChildPixelSize = childPixelSize / 2.0;\n\t\t\tvec2 childPixelPos = floor( vUv * childMapSize );\n\n\t\t\tvec2 parentPixelSize = 1.0 / parentMapSize;\n\t\t\tvec2 halfParentPixelSize = parentPixelSize / 2.0;\n\t\t\tvec2 parentPixelPos = childPixelPos * 2.0;\n\n\t\t\tvec2 baseUv = ( parentPixelPos / parentMapSize ) + halfParentPixelSize;\n\n\t\t\tvec4 samples[ SAMPLES ];\n\t\t\tfloat weights[ SAMPLES ];\n\n\t\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = 0.25;\n\t\t\tweights[ 1 ] = 0.25;\n\t\t\tweights[ 2 ] = 0.25;\n\t\t\tweights[ 3 ] = 0.25;\n\n\t\t\t#elif X_IS_EVEN\n\n\t\t\tfloat wx0 = 0.5;\n\t\t\tfloat wx1 = 0.5;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\n\t\t\tweights[ 2 ] = wx0 * wy1;\n\t\t\tweights[ 3 ] = wx1 * wy1;\n\n\t\t\tweights[ 4 ] = wx0 * wy2;\n\t\t\tweights[ 5 ] = wx1 * wy2;\n\n\t\t\t#elif Y_IS_EVEN\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat wy0 = 0.5;\n\t\t\tfloat wy1 = 0.5;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\t#else\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 6 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 7 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 8 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\tweights[ 6 ] = wx0 * wy2;\n\t\t\tweights[ 7 ] = wx1 * wy2;\n\t\t\tweights[ 8 ] = wx2 * wy2;\n\n\t\t\t#endif\n\n\t\t\t<mipmap_logic>\n\n\t\t}\n\t'},PA=new ni;class FA extends Pc{_tDepth;_distortionMap;_tDiffuse;_tDiffuseBlur;_textureMatrix;_hasBlur;_mirror;_mixBlur;_blurStrength;_minDepthThreshold;_maxDepthThreshold;_depthScale;_depthToBlurRatioBias;_distortion;_mixContrast;constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){e.defines?.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){return this._tDiffuse?.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth?.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap?.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur?.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix?.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur?.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror?.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur?.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength?.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold?.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold?.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale?.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias?.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion?.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast?.value}set mixContrast(e){this._mixContrast.value=e}}var UA="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function OA(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var NA={exports:{}};!function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,i,r,s,a){return n((o=n(n(t,e),n(r,a)))<<(l=s)|o>>>32-l,i);var o,l}function r(e,t,n,r,s,a,o){return i(t&n|~t&r,e,t,s,a,o)}function s(e,t,n,r,s,a,o){return i(t&r|n&~r,e,t,s,a,o)}function a(e,t,n,r,s,a,o){return i(t^n^r,e,t,s,a,o)}function o(e,t,n,r,s,a,o){return i(n^(t|~r),e,t,s,a,o)}function l(e,t){var i,l,c,h,u;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var d=1732584193,p=-271733879,f=-1732584194,m=271733878;for(i=0;i<e.length;i+=16)l=d,c=p,h=f,u=m,d=r(d,p,f,m,e[i],7,-680876936),m=r(m,d,p,f,e[i+1],12,-389564586),f=r(f,m,d,p,e[i+2],17,606105819),p=r(p,f,m,d,e[i+3],22,-1044525330),d=r(d,p,f,m,e[i+4],7,-176418897),m=r(m,d,p,f,e[i+5],12,1200080426),f=r(f,m,d,p,e[i+6],17,-1473231341),p=r(p,f,m,d,e[i+7],22,-45705983),d=r(d,p,f,m,e[i+8],7,1770035416),m=r(m,d,p,f,e[i+9],12,-1958414417),f=r(f,m,d,p,e[i+10],17,-42063),p=r(p,f,m,d,e[i+11],22,-1990404162),d=r(d,p,f,m,e[i+12],7,1804603682),m=r(m,d,p,f,e[i+13],12,-40341101),f=r(f,m,d,p,e[i+14],17,-1502002290),d=s(d,p=r(p,f,m,d,e[i+15],22,1236535329),f,m,e[i+1],5,-165796510),m=s(m,d,p,f,e[i+6],9,-1069501632),f=s(f,m,d,p,e[i+11],14,643717713),p=s(p,f,m,d,e[i],20,-373897302),d=s(d,p,f,m,e[i+5],5,-701558691),m=s(m,d,p,f,e[i+10],9,38016083),f=s(f,m,d,p,e[i+15],14,-660478335),p=s(p,f,m,d,e[i+4],20,-405537848),d=s(d,p,f,m,e[i+9],5,568446438),m=s(m,d,p,f,e[i+14],9,-1019803690),f=s(f,m,d,p,e[i+3],14,-187363961),p=s(p,f,m,d,e[i+8],20,1163531501),d=s(d,p,f,m,e[i+13],5,-1444681467),m=s(m,d,p,f,e[i+2],9,-51403784),f=s(f,m,d,p,e[i+7],14,1735328473),d=a(d,p=s(p,f,m,d,e[i+12],20,-1926607734),f,m,e[i+5],4,-378558),m=a(m,d,p,f,e[i+8],11,-2022574463),f=a(f,m,d,p,e[i+11],16,1839030562),p=a(p,f,m,d,e[i+14],23,-35309556),d=a(d,p,f,m,e[i+1],4,-1530992060),m=a(m,d,p,f,e[i+4],11,1272893353),f=a(f,m,d,p,e[i+7],16,-155497632),p=a(p,f,m,d,e[i+10],23,-1094730640),d=a(d,p,f,m,e[i+13],4,681279174),m=a(m,d,p,f,e[i],11,-358537222),f=a(f,m,d,p,e[i+3],16,-722521979),p=a(p,f,m,d,e[i+6],23,76029189),d=a(d,p,f,m,e[i+9],4,-640364487),m=a(m,d,p,f,e[i+12],11,-421815835),f=a(f,m,d,p,e[i+15],16,530742520),d=o(d,p=a(p,f,m,d,e[i+2],23,-995338651),f,m,e[i],6,-198630844),m=o(m,d,p,f,e[i+7],10,1126891415),f=o(f,m,d,p,e[i+14],15,-1416354905),p=o(p,f,m,d,e[i+5],21,-57434055),d=o(d,p,f,m,e[i+12],6,1700485571),m=o(m,d,p,f,e[i+3],10,-1894986606),f=o(f,m,d,p,e[i+10],15,-1051523),p=o(p,f,m,d,e[i+1],21,-2054922799),d=o(d,p,f,m,e[i+8],6,1873313359),m=o(m,d,p,f,e[i+15],10,-30611744),f=o(f,m,d,p,e[i+6],15,-1560198380),p=o(p,f,m,d,e[i+13],21,1309151649),d=o(d,p,f,m,e[i+4],6,-145523070),m=o(m,d,p,f,e[i+11],10,-1120210379),f=o(f,m,d,p,e[i+2],15,718787259),p=o(p,f,m,d,e[i+9],21,-343485551),d=n(d,l),p=n(p,c),f=n(f,h),m=n(m,u);return[d,p,f,m]}function c(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function h(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function u(e){var t,n,i="0123456789abcdef",r="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),r+=i.charAt(t>>>4&15)+i.charAt(15&t);return r}function d(e){return unescape(encodeURIComponent(e))}function p(e){return function(e){return c(l(h(e),8*e.length))}(d(e))}function f(e,t){return function(e,t){var n,i,r=h(e),s=[],a=[];for(s[15]=a[15]=void 0,r.length>16&&(r=l(r,8*e.length)),n=0;n<16;n+=1)s[n]=909522486^r[n],a[n]=1549556828^r[n];return i=l(s.concat(h(t)),512+8*t.length),c(l(a.concat(i),640))}(d(e),d(t))}function m(e,t,n){return t?n?f(t,e):u(f(t,e)):n?p(e):u(p(e))}e.exports?e.exports=m:t.md5=m}(UA)}(NA);var kA=OA(NA.exports),GA="csm_Position",QA="csm_PositionRaw",zA="csm_PointSize",HA="csm_FragColor",VA="csm_DiffuseColor",WA="csm_Normal",jA="csm_Roughness",XA="csm_Metalness",JA="csm_Emissive";const qA={[`${WA}`]:{"#include <beginnormal_vertex>":`\n    vec3 objectNormal = ${WA};\n    #ifdef USE_TANGENT\n\t    vec3 objectTangent = vec3( tangent.xyz );\n    #endif\n    `},[`${GA}`]:{"#include <begin_vertex>":`\n    vec3 transformed = ${GA};\n  `},[`${QA}`]:{"#include <begin_vertex>":`\n    vec4 csm_positionUnprojected = ${QA};\n    mat4x4 csm_unprojectMatrix = projectionMatrix * modelViewMatrix;\n    #ifdef USE_INSTANCING\n      csm_unprojectMatrix = csm_unprojectMatrix * instanceMatrix;\n    #endif\n    csm_positionUnprojected = inverse(csm_unprojectMatrix) * csm_positionUnprojected;\n    vec3 transformed = csm_positionUnprojected.xyz;\n  `},[`${zA}`]:{"gl_PointSize = size;":`\n    gl_PointSize = ${zA};\n    `},[`${VA}`]:{"#include <color_fragment>":`\n    #include <color_fragment>\n    diffuseColor = ${VA};\n  `},[`${HA}`]:{"#include <dithering_fragment>":`\n    #include <dithering_fragment>\n    gl_FragColor  = ${HA};\n  `},[`${JA}`]:{"vec3 totalEmissiveRadiance = emissive;":`\n    vec3 totalEmissiveRadiance = ${JA};\n    `},[`${jA}`]:{"#include <roughnessmap_fragment>":`\n    #include <roughnessmap_fragment>\n    roughnessFactor = ${jA};\n    `},[`${XA}`]:{"#include <metalnessmap_fragment>":`\n    #include <metalnessmap_fragment>\n    metalnessFactor = ${XA};\n    `}},YA={[`${GA}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( ${GA}, 1.0 );\n  `},[`${QA}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`\n    gl_Position = ${GA};\n  `},[`${VA}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${VA};\n  `},[`${HA}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`\n    gl_FragColor = ${HA};\n  `}};var KA=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],ZA=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],$A=KA.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),eg=ZA;eg=eg.slice().filter((function(e){return!/^(gl\_|texture)/.test(e)}));var tg=eg.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),ng=function(e){var t,n,i,r=0,s=0,a=lg,o=[],l=[],c=1,h=0,u=0,d=!1,p=!1,f="",m=sg,A=ig;"300 es"===(e=e||{}).version&&(m=og,A=ag);var g={},v={};for(r=0;r<m.length;r++)g[m[r]]=!0;for(r=0;r<A.length;r++)v[A[r]]=!0;return function(e){return l=[],null!==e?function(e){r=0,e.toString&&(e=e.toString());var n;f+=e.replace(/\r\n/g,"\n"),i=f.length;for(;t=f[r],r<i;){switch(n=r,a){case 0:r=C();break;case 1:r=w();break;case 2:r=E();break;case 3:r=b();break;case 4:r=I();break;case 11:r=S();break;case 5:r=B();break;case cg:r=T();break;case 9:r=_();break;case lg:r=x()}if(n!==r)if("\n"===f[n])h=0,++c;else++h}return s+=r,f=f.slice(r),l}(e):function(e){o.length&&y(o.join(""));return a=10,y("(eof)"),l}()};function y(e){e.length&&l.push({type:hg[a],data:e,position:u,line:c,column:h})}function x(){return o=o.length?[]:o,"/"===n&&"*"===t?(u=s+r-1,a=0,n=t,r+1):"/"===n&&"/"===t?(u=s+r-1,a=1,n=t,r+1):"#"===t?(a=2,u=s+r,r):/\s/.test(t)?(a=9,u=s+r,r):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=s+r,a=d?4:p?3:cg,r)}function _(){return/[^\s]/g.test(t)?(y(o.join("")),a=lg,r):(o.push(t),n=t,r+1)}function E(){return"\r"!==t&&"\n"!==t||"\\"===n?(o.push(t),n=t,r+1):(y(o.join("")),a=lg,r)}function w(){return E()}function C(){return"/"===t&&"*"===n?(o.push(t),y(o.join("")),a=lg,r+1):(o.push(t),n=t,r+1)}function b(){if("."===n&&/\d/.test(t))return a=5,r;if("/"===n&&"*"===t)return a=0,r;if("/"===n&&"/"===t)return a=1,r;if("."===t&&o.length){for(;M(o););return a=5,r}if(";"===t||")"===t||"("===t){if(o.length)for(;M(o););return y(t),a=lg,r+1}var e=2===o.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;M(o););return a=lg,r}return o.push(t),n=t,r+1}function M(e){for(var t,n,i=0;;){if(t=rg.indexOf(e.slice(0,e.length+i).join("")),n=rg[t],-1===t){if(i--+e.length>0)continue;n=e.slice(0,1).join("")}return y(n),u+=n.length,(o=o.slice(n.length)).length}}function S(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),a=lg,r):(o.push(t),n=t,r+1)}function I(){return"."===t||/[eE]/.test(t)?(o.push(t),a=5,n=t,r+1):"x"===t&&1===o.length&&"0"===o[0]?(a=11,o.push(t),n=t,r+1):/[^\d]/.test(t)?(y(o.join("")),a=lg,r):(o.push(t),n=t,r+1)}function B(){return"f"===t&&(o.push(t),n=t,r+=1),/[eE]/.test(t)?(o.push(t),n=t,r+1):("-"!==t&&"+"!==t||!/[eE]/.test(n))&&/[^\d]/.test(t)?(y(o.join("")),a=lg,r):(o.push(t),n=t,r+1)}function T(){if(/[^\d\w_]/.test(t)){var e=o.join("");return a=v[e]?8:g[e]?7:6,y(o.join("")),a=lg,r}return o.push(t),n=t,r+1}},ig=KA,rg=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],sg=ZA,ag=$A,og=tg,lg=999,cg=9999,hg=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];var ug=ng;var dg=OA((function(e,t){var n=ug(t),i=[];return i=(i=i.concat(n(e))).concat(n(null))})),pg=function(e){for(var t=[],n=0;n<e.length;n++)"eof"!==e[n].type&&t.push(e[n].data);return t.join("")};var fg=OA(pg),mg=function(e){var t,n,i,r=null,s=null,a=0,o=0,l=0,c=0,h=0,u=[];for(t=0;t<e.length;t++)if("{"===(i=e[t]).data){if(a&&a++)continue;if((n=p(t,Ag(")"),Ag()))<0)continue;if(c=n,(n=p(n,Ag("("),Ag(")")))<0)continue;if(h=n,(n=p(n,gg))<0)continue;if("ident"!==e[n].type)continue;if(s=e[n].data,(n=p(n,gg))<0)continue;a=1,o=t,r=e[n].data,l=n;var d=p(n,gg);switch(e[d]&&e[d].data){case"lowp":case"highp":case"mediump":l=d}}else if(a&&"}"===i.data){if(--a)continue;u.push({name:s,type:r,body:[o+1,t],args:[h,c+1],outer:[l,t+1]})}for(t=0;t<e.length;t++)if(";"===(i=e[t]).data){if((n=p(t,Ag(")"),Ag()))<0)continue;if(c=n,(n=p(n,Ag("("),Ag(")")))<0)continue;if(h=n,(n=p(n,gg))<0)continue;if("ident"!==e[n].type)continue;if(s=e[n].data,(n=p(n,gg))<0)continue;if("operator"===e[n].type)continue;if("return"===e[n].data)continue;r=e[n].data,u.push({name:s,type:r,body:!1,args:[h,c+1],outer:[n,t+1]})}return u.sort((function(e,t){return e.outer[0]-t.outer[0]}));function p(t,n,i){for(var r=t-1;r>=0;r--){if(n(e[r]))return r;if(i&&i(e[r]))return-1}return-1}};function Ag(e){return function(t){return"operator"===t.type&&(!e||t.data===e)}}function gg(e){return"whitespace"!==e.type}var vg=OA(mg);class yg extends si{uniforms;_customPatchMap;_fs;_vs;_cacheKey;_base;_instanceID;_type;constructor({baseMaterial:e,fragmentShader:t,vertexShader:n,uniforms:i,patchMap:r,cacheKey:s,...a}){let o;if(!function(e){try{new e}catch(e){if(e.message.indexOf("is not a constructor")>=0)return!1}return!0}(e)?(o=e,Object.assign(o,a)):o=new e(a),"RawShaderMaterial"===o.type)throw new Error("CustomShaderMaterial does not support RawShaderMaterial");super(),this.uniforms=i||{},this._customPatchMap=r||{},this._fs=t||"",this._vs=n||"",this._cacheKey=s,this._base=e,this._type=o.type,this._instanceID=at.generateUUID();for(const e in o){let t=e;e.startsWith("_")&&(t=e.split("_")[1]),void 0===this[t]&&(this[t]=0),this[t]=o[t]}this.update({fragmentShader:t,vertexShader:n,uniforms:i,cacheKey:s})}update(e){const t=e?.uniforms||{},n=e?.fragmentShader||this._fs,i=e?.vertexShader||this._vs,r=Object.values(t).reduce(((e,{value:t})=>e+JSON.stringify(t)),"");var s;this.uuid=e?.cacheKey?.()||(s=[n,i,r,this._instanceID],kA(JSON.stringify(s))),this.generateMaterial({fragmentShader:n,vertexShader:i,uniforms:t})}clone(){const e=new this.constructor({baseMaterial:this._base,fragmentShader:this._fs,vertexShader:this._vs,patchMap:this._customPatchMap,uniforms:this.uniforms,cacheKey:this._cacheKey});for(const t in this)"uuid"!==t&&(e[t]=this[t]);return e}generateMaterial({fragmentShader:e,vertexShader:t,uniforms:n}){const i=this.parseShader(e),r=this.parseShader(t);this.uniforms=n||{},this.customProgramCacheKey=()=>this.uuid,this.onBeforeCompile=e=>{if(i){const t=this.patchShader(i,e.fragmentShader);e.fragmentShader=this.getMaterialDefine()+t}if(r){const t=this.patchShader(r,e.vertexShader);e.vertexShader="#define IS_VERTEX;\n"+t,e.vertexShader=this.getMaterialDefine()+e.vertexShader}e.uniforms={...e.uniforms,...this.uniforms},this.uniforms=e.uniforms},this.needsUpdate=!0}getMaterialDefine(){return`#define IS_${this._type.toUpperCase()};\n`}getPatchMapForMaterial(){return"ShaderMaterial"===this._type?YA:qA}patchShader(e,t){let n=t;const i={...this.getPatchMapForMaterial(),...this._customPatchMap};return Object.keys(i).forEach((t=>{Object.keys(i[t]).forEach((r=>{var s,a;s=e.main,new RegExp(`\\b${a=t,a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}\\b`).test(s)&&(n=((e,t,n)=>e.split(t).join(n))(n,r,i[t][r]))}))})),n=n.replace("void main() {",`\n          ${e.header}\n          void main() {\n            \n\n#ifdef IS_VERTEX\n    vec3 csm_Position = position;\n    vec4 csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n    vec3 csm_Normal = normal;\n#else\n    #if defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL\n        vec4 csm_DiffuseColor = vec4(1., 0., 1., 1.);\n        vec4 csm_FragColor = vec4(1., 0., 1., 1.);\n    #else\n        #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL\n            vec3 csm_Emissive = emissive;\n            float csm_Roughness = roughness;\n            float csm_Metalness = metalness;\n        #endif\n        \n        #ifdef USE_MAP\n            vec4 _csm_sampledDiffuseColor = texture2D(map, vUv);\n\n            #ifdef DECODE_VIDEO_TEXTURE\n            // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)\n            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);\n            #endif\n\n            vec4 csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n            vec4 csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;\n        #else\n            vec4 csm_DiffuseColor = vec4(diffuse, opacity);\n            vec4 csm_FragColor = vec4(diffuse, opacity);\n        #endif\n    #endif\n#endif\n\n            ${e.main}\n          `),n=e.defines+n,n}parseShader(e){if(!e)return;const t=e.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,""),n=dg(t),i=vg(n),r=i.map((e=>e.name)).indexOf("main");return{defines:"",header:fg(n.slice(0,r>=0?i[r].outer[0]:void 0)),main:r>=0?this.getShaderFromIndex(n,i[r].body):""}}getShaderFromIndex(e,t){return fg(e.slice(t[0],t[1]))}}const{ShaderChunk:xg,UniformsLib:_g,Vector2:Eg,Color:wg,EventDispatcher:Cg,TangentSpaceNormalMap:bg,MultiplyOperation:Mg,Material:Sg,ShaderMaterial:Ig,RawShaderMaterial:Bg}=qu;const Tg=_g;Tg.clearcoatnormalmap={clearcoatNormalScale:{value:new Eg(1,1)}};const Rg=["MeshDistanceMaterial","MeshMatcapMaterial","ShadowMaterial","SpriteMaterial","RawShaderMaterial","ShaderMaterial","PointsMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshPhongMaterial","MeshToonMaterial","MeshNormalMaterial","MeshLambertMaterial","MeshDepthMaterial","MeshBasicMaterial","LineDashedMaterial","LineBasicMaterial","Material","MeshFaceMaterial","MultiMaterial","PointCloudMaterial","ParticleBasicMaterial","ParticleSystemMaterial"];for(let e of Rg)if(void 0!==qu[e]){const t=qu[e].prototype;t.type=e,t.customDepthMaterial=null,t.customDistanceMaterial=null,t.templates=[]}const Dg=Ig.prototype.clone;function Lg(){const e=Dg.call(this);return e.templates=this.templates,e}function Pg(e){if(e&&e.uniforms)for(let t in e.uniforms)e.uniforms[t].linked&&(this.uniforms[t]=e.uniforms[t]);return this}function Fg(e){Sg.prototype.copy.call(this,e);for(let t of Hg)e[t]&&(this[t]=e[t]);for(let t of Qg)e[t]&&(this[t]=e[t]);return this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$g(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,e.customDepthMaterial&&(this.customDepthMaterial=e.customDepthMaterial.clone().link(this)),e.customDistanceMaterial&&(this.customDistanceMaterial=e.customDistanceMaterial.clone().link(this)),this}function Ug(e){return void 0===this.uniforms[e]&&(this.uniforms[e]={value:null}),this.uniforms[e]}function Og(e,t){let n={},i="",r="";const s=(t=t||{}).template||t.extends,a=new(t.class||(e.isMaterial&&e.constructor?e.constructor:null)||Ng),o=t.material=t.material||{},l=Object.assign({},o.defines);let c;if(a.templates=[t],e.templates instanceof Array&&(a.templates=e.templates.concat(a.templates)),e instanceof Function){c=e.prototype.type;const s=Vg[c];if(void 0===s)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',c),a;o.lights=void 0===o.lights||o.lights,n=rv(s.name,n,t),i=xg[s.id+"_vert"],r=xg[s.id+"_frag"]}else if((h=e)&&h.isShaderMaterial)c=e.type,n=$g(e.uniforms,n),i=e.vertexShader,r=e.fragmentShader,a.copy(e,!1),e.defines&&Object.assign(l,e.defines);else{c=e.type;const s=Vg[c];if(void 0===s)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',c),a;o.lights=void 0===o.lights||o.lights,n=rv(s.name,n,t),i=xg[s.id+"_vert"],r=xg[s.id+"_frag"];const l=mr[s.name].uniforms;for(let i in l)void 0!==n[i]||void 0===e[i]||null===e[i]&&!1!==t.explicit||(n[i]=n[i]||{value:null},n[i].value=e[i])}var h;t.defines&&Object.assign(l,t.defines);let u=(t.header||"")+"\n";if(void 0!==t.vertex&&(i=ev(i,t.vertex)),void 0!==t.fragment&&(r=ev(r,t.fragment)),o.defines=l,o.uniforms=n,o.vertexShader=u+(t.vertexHeader||"")+"\n"+i,o.fragmentShader=u+(t.fragmentHeader||"")+"\n"+r,t.vertexEnd&&(o.vertexShader=o.vertexShader.replace(/\}(?=[^.]*$)/g,t.vertexEnd+"\n}")),t.fragmentEnd&&(o.fragmentShader=o.fragmentShader.replace(/\}(?=[^.]*$)/g,t.fragmentEnd+"\n}")),t.override)for(let e in t.override){const i=t.override[e],r=n[e]=n[e]||{value:null};for(let e in i)r[e]=i[e];r.mixed&&(t.uniforms||(t.uniforms={}),t.uniforms[e]=r)}if(s&&s.templates&&s.templates.length){t.class=t.class||s.class;for(let e of s.templates)sv(o,e,iv,l);for(let e in s.uniforms){const t=s.uniforms[e];t.linked&&(n[e]=t)}}if(nv(a,t,o),a.setValues(o),a.isCustomMaterial)for(let e in n)qg[e]&&n[e].value&&(a[e]=n[e].value);for(let e in l)!1===l[e]&&delete l[e];return function(e){return e&&e.isMeshDepthMaterial||e===Ra}(e)&&void 0===l.DEPTH_PACKING&&(l.DEPTH_PACKING=Te),a}if(Object.assign(Bg.prototype,{extend:Og,uniform:Ug,clone:Lg,link:Pg,copy:Fg}),Object.assign(Ig.prototype,{extend:Og,uniform:Ug,clone:Lg,link:Pg,copy:Fg}),void 0!==Ig.prototype.customDepthMaterial){const e={_customDepthMaterial:{enumerable:!0,value:void 0,writable:!0},_customDistanceMaterial:{enumerable:!0,value:void 0,writable:!0},customDepthMaterial:{get:function(){return this._customDepthMaterial||(this.material&&this.material.customDepthMaterial?this.material.customDepthMaterial:void 0)},set:function(e){this._customDepthMaterial=e}},customDistanceMaterial:{get:function(){return this._customDistanceMaterial||(this.material&&this.material.customDistanceMaterial?this.material.customDistanceMaterial:void 0)},set:function(e){this._customDistanceMaterial=e}}};Object.defineProperties(Hi.prototype,e),Object.defineProperties(Io.prototype,e)}Og.CustomMaterial=function(e){Ig.call(this,e),this.type="CustomMaterial"},Object.assign(Og.CustomMaterial.prototype,Sg.prototype,Ig.prototype,Cg.prototype,{isShaderMaterial:!0,isCustomMaterial:!0,isMeshPhongMaterial:!1,isMeshDistanceMaterial:!1,isMeshMatcapMaterial:!1,isShadowMaterial:!1,isSpriteMaterial:!1,isRawShaderMaterial:!1,isPointsMaterial:!1,isMeshPhysicalMaterial:!1,isMeshStandardMaterial:!1,isMeshToonMaterial:!1,isMeshNormalMaterial:!1,isMeshLambertMaterial:!1,isMeshDepthMaterial:!1,isMeshBasicMaterial:!1,isLineDashedMaterial:!1,isLineBasicMaterial:!1,isMaterial:!1,isMeshFaceMaterial:!1,isMultiMaterial:!1,isPointCloudMaterial:!1,isParticleBasicMaterial:!1,isParticleSystemMaterial:!1,constructor:Og.CustomMaterial,map:null,aoMap:null,envMap:null,bumpMap:null,normalMap:null,lightMap:null,emissiveMap:null,specularMap:null,roughnessMap:null,metalnessMap:null,alphaMap:null,displacementMap:null,clearcoatMap:null,clearcoatRoughnessMap:null,clearcoatNormalMap:null,normalMapType:bg,combine:Mg,clone:function(e){const t=Dg.call(this);return this.map&&(t.map=this.map),this.aoMap&&(t.aoMap=this.aoMap),this.envMap&&(t.envMap=this.envMap),this.bumpMap&&(t.bumpMap=this.bumpMap),this.normalMap&&(t.normalMap=this.normalMap),this.lightMap&&(t.lightMap=this.lightMap),this.emissiveMap&&(t.emissiveMap=this.emissiveMap),this.specularMap&&(t.specularMap=this.specularMap),this.roughnessMap&&(t.roughnessMap=this.roughnessMap),this.metalnessMap&&(t.metalnessMap=this.metalnessMap),this.alphaMap&&(t.alphaMap=this.alphaMap),this.displacementMap&&(t.displacementMap=this.displacementMap),this.clearcoatMap&&(t.clearcoatMap=this.clearcoatMap),this.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap=this.clearcoatRoughnessMap),this.clearcoatNormalMap&&(t.clearcoatNormalMap=this.clearcoatNormalMap),t.templates=this.templates,t}}),Object.defineProperties(Og.CustomMaterial.prototype,{reflectivity:{get:function(){return this.uniforms.reflectivity?this.uniforms.reflectivity.value:0},set:function(e){this.uniforms.reflectivity.value=e}},specular:{get:function(){return void 0===this.uniforms.specular&&(this.uniforms.specular={value:new ni("white")}),this.uniforms.specular.value},set:function(e){void 0===this.uniforms.specular&&(this.uniforms.specular={value:e}),this.uniforms.specular.value=e}},shininess:{get:function(){return this.uniforms.shininess?this.uniforms.shininess.value:0},set:function(e){void 0===this.uniforms.shininess&&(this.uniforms.shininess={value:e}),this.uniforms.shininess.value=e}}});class Ng extends Yi{constructor(e){super(e),this.type="CustomMaterial"}get specular(){return void 0===this.uniforms.specular&&(this.uniforms.specular={value:new ni("white")}),this.uniforms.specular.value}set specular(e){void 0===this.uniforms.specular&&(this.uniforms.specular={value:e}),this.uniforms.specular.value=e}get shininess(){return this.uniforms.shininess?this.uniforms.shininess.value:0}set shininess(e){void 0===this.uniforms.shininess&&(this.uniforms.shininess={value:e}),this.uniforms.shininess.value=e}get reflectivity(){return this.uniforms.reflectivity?this.uniforms.reflectivity.value:0}set reflectivity(e){this.uniforms.reflectivity.value=e}}Object.assign(Ng,Og.CustomMaterial),Object.assign(Ng.prototype,Og.CustomMaterial.prototype,{copy:Fg,clone:Lg});const kg=Og;let Gg;const Qg=["bumpScale","roughness","metalness","shininess","envMapIntensity","opacity","dashSize","totalSize"],zg={bumpScale:"bumpScale",roughness:"roughness",metalness:"metalness",shininess:"shininess",envMapIntensity:"envMapIntensity",opacity:"opacity",dashSize:"dashSize",totalSize:"totalSize"},Hg=["map","aoMap","envMap","bumpMap","normalMap","lightMap","emissiveMap","specularMap","roughnessMap","metalnessMap","alphaMap","displacementMap"],Vg={MeshLambertMaterial:{id:"meshlambert",name:"lambert"},MeshBasicMaterial:{id:"meshbasic",name:"basic"},MeshStandardMaterial:{id:"meshphysical",name:"physical"},MeshPhongMaterial:{id:"meshphong",name:"phong"},MeshMatcapMaterial:{id:"meshmatcap",name:"matcap"},MeshToonMaterial:{id:"meshtoon",name:"toon"},PointsMaterial:{id:"points",name:"points"},LineDashedMaterial:{id:"dashed",name:"linedashed"},MeshDepthMaterial:{id:"depth",name:"depth"},MeshNormalMaterial:{id:"normal",name:"normal"},MeshDistanceMaterial:{id:"distanceRGBA",name:"distanceRGBA"},SpriteMaterial:{id:"sprite",name:"sprite"}},Wg={lightsBegin:"?#include <lights_fragment_maps>",lightsEnd:"?#include <aomap_fragment>",colorBegin:"?#include <logdepthbuf_fragment>",colorEnd:"?#include <tonemapping_fragment>",transformBegin:"?#include <morphtarget_vertex>",transformEnd:"?#include <project_vertex>"},jg={alphaTest:{as:"ALPHATEST",not:0}},Xg={opacity:{value:1},specular:{value:new wg(1118481)}},Jg={points:Tg.points,sprite:Tg.sprite,dashed:{scale:{value:1},dashSize:{value:1},totalSize:{value:2}},normal:{opacity:Xg.opacity},toon:{specular:Xg.specular,shininess:{value:30}},standard:{shininess:{value:30},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}},physical:{shininess:{value:30},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}},phong:{specular:Xg.specular,shininess:{value:30}},cube:{opacity:Xg.opacity},distanceRGBA:{nearDistance:{value:1},farDistance:{value:1e3}},shadow:{opacity:Xg.opacity}},qg={map:"USE_MAP",aoMap:"USE_AOMAP",envMap:"USE_ENVMAP",bumpMap:"USE_BUMPMAP",normalMap:"USE_NORMALMAP",lightMap:"USE_LIGHTMAP",emissiveMap:"USE_EMISSIVEMAP",specularMap:"USE_SPECULARMAP",roughnessMap:"USE_ROUGHNESSMAP",metalnessMap:"USE_METALNESSMAP",alphaMap:"USE_ALPHAMAP",displacementMap:"USE_DISPLACEMENTMAP"};function Yg(e,t,n){!function(e,t){e&&(e.envMap&&$g(Tg.envmap,t),e.aoMap&&$g(Tg.aomap,t),e.lightMap&&$g(Tg.lightmap,t),e.bumpMap&&$g(Tg.bumpmap,t),e.normalMap&&$g(Tg.normalmap,t),e.displacementMap&&$g(Tg.displacementmap,t),e.clearcoatNormalMap&&$g(Tg.clearcoatnormalmap,t))}(t.uniforms,n),!1!==t.common&&$g(Tg.common,n),void 0!==Jg[e]&&$g(Jg[e],n);const i=t.fog||(t.material?t.material.fog||t.material.useFog:null),r=t.lights||(t.material?t.material.lights:null);if(i&&$g(Tg.fog,n),r)if(t.use){const e=t.use;e.indexOf("sharedLights");const i=e.indexOf("shadows")>-1;e.indexOf("PointLight")>-1&&($g(Tg.lights.pointLights,n),i&&($g(Tg.pointLightShadows,n),$g(Tg.pointShadowMap,n),$g(Tg.pointShadowMatrix,n))),e.indexOf("SpotLight")>-1&&($g(Tg.lights.spotLights,n),i&&($g(Tg.spotLightShadows,n),$g(Tg.spotShadowMap,n),$g(Tg.spotShadowMatrix,n))),e.indexOf("DirectionalLight")>-1&&($g(Tg.lights.directionalLights,n),i&&($g(Tg.directionalLightShadows,n),$g(Tg.directionalShadowMap,n),$g(Tg.directionalShadowMatrix,n))),e.indexOf("LightProbe")>-1&&$g(Tg.lights.lightProbe,n),e.indexOf("AmbientLight")>-1&&$g(Tg.lights.ambientLightColor,n),e.indexOf("ReactAreaLight")>-1&&$g(Tg.lights.rectAreaLights,n),e.indexOf("HemisphereLight")>-1&&$g(Tg.lights.hemisphereLights,n)}else $g(Gg,n);return n}function Kg(e,t={}){for(let n in e){const i=e[n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n]=i.clone():Array.isArray(i)?t[n]=i.slice():t[n]=i}return t}function Zg(e){return e&&void 0!==e.value?e:{value:e}}function $g(e,t={},n=!1,i=!1,r=!1,s=!1){for(let a in e){const o=e[a];o&&((!n||null!==o.value&&0!==o.value)&&(o.shared||o.linked&&s?t[a]=o:(t[a]=Kg(o),!0===i&&(t[a].shared=!0),!0===r&&(t[a].mixed=!0))))}return t}function ev(e,t){for(let n in t){const i=t[n];if(void 0!==Wg[n]&&(n=Wg[n]),i instanceof Object)void 0===xg[n]?console.error('ShaderMaterial.extend: ShaderChunk "%s" not found',n):e=e.replace("#include <"+n+">",ev(xg[n],i));else if("@"===n[0]){const t=n.substr(1);e=e.replace(t,i)}else if("?"===n[0]){const t=n.substr(1);e=e.replace(t,i+"\n"+t)}else e?e=e.replace(n,n+"\n"+i):console.error("THREE.patchShader: chunk not found '%s'",n)}return e}function tv(e,t,n,i,r){t&&t.value&&void 0!==zg[e]&&(r[e]=t.value),void 0!==qg[e]&&t&&void 0!==t.value&&(r[e]=t.value);const s=jg[e];void 0===s||void 0!==s.not&&s.not===t.value||(n[s.as]=t.value)}function nv(e,t,n,i){if(t.uniforms&&n)for(let e in t.uniforms){n.uniforms[e]||(n.uniforms[e]={});let i=Zg(t.uniforms[e]);n.uniforms[e]=i}}function iv(e,t,n){if(e.uniforms)for(let i in e.uniforms){let r=e.uniforms[i];r&&(r=Zg(r),r.mixed&&void 0===t.uniforms[i]&&(t.uniforms[i]=r.shared?r:Kg(r),n&&tv(i,r,n,0,e)))}}function rv(e,t,n){return!1===n.explicit?$g(mr[e].uniforms,t):Yg(e,n,t)}function sv(e,t,n=nv,i=null){let r=(t.header||"")+"\n",s=(t.vertexHeader||"")+"\n"+e.vertexShader,a=(t.fragmentHeader||"")+"\n"+e.fragmentShader;return t.vertexEnd&&(s=s.replace(/\}(?=[^.]*$)/g,t.vertexEnd+"\n}")),t.fragmentEnd&&(a=a.replace(/\}(?=[^.]*$)/g,t.fragmentEnd+"\n}")),void 0!==t.vertex&&(s=ev(s,t.vertex)),void 0!==t.fragment&&(a=ev(a,t.fragment)),e.vertexShader=r+s,e.fragmentShader=r+a,n instanceof Function&&n(t,e,i,i),e}Gg=$g(Tg.lights,{},!1,!0);
/*!
	fflate - fast JavaScript compression/decompression
	<https://101arrowz.github.io/fflate>
	Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
	version 0.6.9
	*/
var av=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(av(""))}catch(e){av=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var ov=Uint8Array,lv=Uint16Array,cv=Uint32Array,hv=new ov([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uv=new ov([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dv=new ov([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pv=function(e,t){for(var n=new lv(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new cv(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},fv=pv(hv,2),mv=fv[0],Av=fv[1];mv[28]=258,Av[258]=28;for(var gv=pv(uv,0)[0],vv=new lv(32768),yv=0;yv<32768;++yv){var xv=(43690&yv)>>>1|(21845&yv)<<1;xv=(61680&(xv=(52428&xv)>>>2|(13107&xv)<<2))>>>4|(3855&xv)<<4,vv[yv]=((65280&xv)>>>8|(255&xv)<<8)>>>1}var _v=function(e,t,n){for(var i=e.length,r=0,s=new lv(t);r<i;++r)++s[e[r]-1];var a,o=new lv(t);for(r=0;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new lv(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],h=t-e[r],u=o[e[r]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[vv[u]>>>l]=c}else for(a=new lv(i),r=0;r<i;++r)e[r]&&(a[r]=vv[o[e[r]-1]++]>>>15-e[r]);return a},Ev=new ov(288);for(yv=0;yv<144;++yv)Ev[yv]=8;for(yv=144;yv<256;++yv)Ev[yv]=9;for(yv=256;yv<280;++yv)Ev[yv]=7;for(yv=280;yv<288;++yv)Ev[yv]=8;var wv=new ov(32);for(yv=0;yv<32;++yv)wv[yv]=5;var Cv=_v(Ev,9,1),bv=_v(wv,5,1),Mv=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Sv=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Iv=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Bv=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new ov(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new ov(3*i));var a,o=function(e){var n=t.length;if(e>n){var i=new ov(Math.max(2*n,e));i.set(t),t=i}},l=n.f||0,c=n.p||0,h=n.b||0,u=n.l,d=n.d,p=n.m,f=n.n,m=8*i;do{if(!u){n.f=l=Sv(e,c,1);var A=Sv(e,c+1,3);if(c+=3,!A){var g=e[(I=((a=c)/8|0)+(7&a&&1)+4)-4]|e[I-3]<<8,v=I+g;if(v>i){if(s)throw"unexpected EOF";break}r&&o(h+g),t.set(e.subarray(I,v),h),n.b=h+=g,n.p=c=8*v;continue}if(1==A)u=Cv,d=bv,p=9,f=5;else{if(2!=A)throw"invalid block type";var y=Sv(e,c,31)+257,x=Sv(e,c+10,15)+4,_=y+Sv(e,c+5,31)+1;c+=14;for(var E=new ov(_),w=new ov(19),C=0;C<x;++C)w[dv[C]]=Sv(e,c+3*C,7);c+=3*x;var b=Mv(w),M=(1<<b)-1,S=_v(w,b,1);for(C=0;C<_;){var I,B=S[Sv(e,c,M)];if(c+=15&B,(I=B>>>4)<16)E[C++]=I;else{var T=0,R=0;for(16==I?(R=3+Sv(e,c,3),c+=2,T=E[C-1]):17==I?(R=3+Sv(e,c,7),c+=3):18==I&&(R=11+Sv(e,c,127),c+=7);R--;)E[C++]=T}}var D=E.subarray(0,y),L=E.subarray(y);p=Mv(D),f=Mv(L),u=_v(D,p,1),d=_v(L,f,1)}if(c>m){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var P=(1<<p)-1,F=(1<<f)-1,U=c;;U=c){var O=(T=u[Iv(e,c)&P])>>>4;if((c+=15&T)>m){if(s)throw"unexpected EOF";break}if(!T)throw"invalid length/literal";if(O<256)t[h++]=O;else{if(256==O){U=c,u=null;break}var N=O-254;if(O>264){var k=hv[C=O-257];N=Sv(e,c,(1<<k)-1)+mv[C],c+=k}var G=d[Iv(e,c)&F],Q=G>>>4;if(!G)throw"invalid distance";c+=15&G;L=gv[Q];if(Q>3){k=uv[Q];L+=Iv(e,c)&(1<<k)-1,c+=k}if(c>m){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var z=h+N;h<z;h+=4)t[h]=t[h-L],t[h+1]=t[h+1-L],t[h+2]=t[h+2-L],t[h+3]=t[h+3-L];h=z}}n.l=u,n.p=U,n.b=h,u&&(l=1,n.m=p,n.d=d,n.n=f)}while(!l);return h==t.length?t:function(e,t,n){(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof lv?lv:e instanceof cv?cv:ov)(n-t);return i.set(e.subarray(t,n)),i}(t,0,h)},Tv=new ov(0);var Rv="undefined"!=typeof TextDecoder&&new TextDecoder;try{Rv.decode(Tv,{stream:!0}),1}catch(e){}function Dv(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,a=Math.floor((r+s)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?s=a:r=a,a=Math.floor((r+s)/2);return a}function Lv(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let n=2;n<=e-t;++n)i*=n;return n/i}function Pv(e,t,n,i,r){const s=function(e,t,n,i,r){const s=r<e?r:e,a=[],o=Dv(e,i,t),l=function(e,t,n,i,r){const s=[];for(let e=0;e<=n;++e)s[e]=0;const a=[];for(let e=0;e<=i;++e)a[e]=s.slice(0);const o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);o[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let i=1;i<=n;++i){l[i]=t-r[e+1-i],c[i]=r[e+i]-t;let n=0;for(let e=0;e<i;++e){const t=c[e+1],r=l[i-e];o[i][e]=t+r;const s=o[e][i-1]/o[i][e];o[e][i]=n+t*s,n=r*s}o[i][i]=n}for(let e=0;e<=n;++e)a[0][e]=o[e][n];for(let e=0;e<=n;++e){let t=0,r=1;const l=[];for(let e=0;e<=n;++e)l[e]=s.slice(0);l[0][0]=1;for(let s=1;s<=i;++s){let i=0;const c=e-s,h=n-s;e>=s&&(l[r][0]=l[t][0]/o[h+1][c],i=l[r][0]*o[c][h]);const u=e-1<=h?s-1:n-e;for(let e=c>=-1?1:-c;e<=u;++e)l[r][e]=(l[t][e]-l[t][e-1])/o[h+1][c+e],i+=l[r][e]*o[c+e][h];e<=h&&(l[r][s]=-l[t][s-1]/o[h+1][e],i+=l[r][s]*o[e][h]),a[s][e]=i;const d=t;t=r,r=d}}let h=n;for(let e=1;e<=i;++e){for(let t=0;t<=n;++t)a[e][t]*=h;h*=n-e}return a}(o,i,e,s,t),c=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let t=0;t<=s;++t){const n=c[o-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)n.add(c[o-e+i].clone().multiplyScalar(l[t][i]));a[t]=n}for(let e=s+1;e<=r+1;++e)a[e]=new Rt(0,0,0);return a}(e,t,n,i,r);return function(e){const t=e.length,n=[],i=[];for(let r=0;r<t;++r){const t=e[r];n[r]=new Ot(t.x,t.y,t.z),i[r]=t.w}const r=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(r[e-n].clone().multiplyScalar(Lv(e,n)*i[n]));r[e]=t.divideScalar(i[0])}return r}(s)}class Fv extends cl{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new Rt(t.x,t.y,t.z,t.w)}}getPoint(e,t=new Ot){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=Dv(e,i,t),s=function(e,t,n,i){const r=[],s=[],a=[];r[0]=1;for(let o=1;o<=n;++o){s[o]=t-i[e+1-o],a[o]=i[e+o]-t;let n=0;for(let e=0;e<o;++e){const t=a[e+1],i=s[o-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[o]=n}return r}(r,i,e,t),a=new Rt(0,0,0,0);for(let t=0;t<=e;++t){const i=n[r-e+t],o=s[t],l=i.w*o;a.x+=i.x*l,a.y+=i.y*l,a.z+=i.z*l,a.w+=i.w*o}return a}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new Ot){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Pv(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let Uv,Ov,Nv;class kv extends uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===r.path?kh.extractUrlBase(e):r.path,a=new fh(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ny(e,0,t.length)}(e))Uv=(new Vv).parse(e);else{const t=ny(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let e=0;e<t.length;++e){if(i(1)===t[e])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Xv(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Xv(t));Uv=(new Hv).parse(t)}const n=new vh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Gv(n,this.manager).parse(Uv)}}class Gv{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Ov=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Qv).parse(i);return this.parseScene(i,r,n),Nv}parseConnections(){const e=new Map;if("Connections"in Uv){Uv.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};e.get(n).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(i).children.push(a)}))}return e}parseImages(){const e={},t={};if("Video"in Uv.Objects){const n=Uv.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Uv.Objects){const n=Uv.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,s=void 0!==i?i.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===s?A:g,n.wrapT=0===a?A:g,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,r=Ov.get(e.id).children;let s;void 0!==r&&r.length>0&&void 0!==t[r[0].ID]&&(n=t[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Tt):(t.setPath(this.textureLoader.path),s=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Tt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){const t=new Map;if("Material"in Uv.Objects){const n=Uv.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!Ov.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new Uc;break;case"lambert":a=new kc;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Uc}return a.setValues(s),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new ni).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new ni).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new ni).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new ni).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new ni).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new ni).fromArray(e.SpecularColor.value));const r=this;return Ov.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=p,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}getTexture(e,t){return"LayeredTexture"in Uv.Objects&&t in Uv.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Ov.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Uv.Objects){const n=Uv.Objects.Deformer;for(const i in n){const r=n[i],s=Ov.get(parseInt(i));if(s)if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,n),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e?.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new fn).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],s=t[r.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=Ov.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}parseScene(e,t,n){Nv=new Na;const i=this.parseModels(e.skeletons,t,n),r=Uv.Objects.Model,s=this;i.forEach((function(e){const t=r[e.ID];s.setLookAtProperties(e,t);Ov.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Nv.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Nv.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=$v(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new zv).parse();1===Nv.children.length&&Nv.children[0].isGroup&&(Nv.children[0].animations=a,Nv=Nv.children[0]),Nv.animations=a}parseModels(e,t,n){const i=new Map,r=Uv.Objects.Model;for(const s in r){const a=parseInt(s),o=r[s],l=Ov.get(a);let c=this.buildSkeleton(l,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,n);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new Bo;break;default:c=new Na}c.name=o.attrName?Au.sanitizeNodeName(o.attrName):"",c.ID=a}this.getTransformData(c,o),i.set(a,c)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=r;r=new Bo,r.matrixWorld.copy(t.transformLink),r.name=i?Au.sanitizeNodeName(i):"",r.ID=n,a.bones[s]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=Uv.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new kn;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const o=s/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Zi(l,o,i,r),null!==c&&t.setFocalLength(c);break;case 1:t=new wr(-s/2,s/2,a/2,-a/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new kn}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=Uv.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new kn;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new ni).fromArray(n.Color.value).convertSRGBToLinear());let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new Rh(i,r,s,a);break;case 1:t=new Lh(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=at.degToRad(n.InnerAngle.value));let o=0;void 0!==n.OuterAngle&&(o=at.degToRad(n.OuterAngle.value),o=Math.max(o,1)),t=new Mh(i,r,s,e,o,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Rh(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new Uc({color:13421772}),a.push(s)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(i=new Io(r,s),i.normalizeSkinWeights()):i=new Hi(r,s),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new Ho({color:3342591,linewidth:1});return new qo(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?ey(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){Ov.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=Uv.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Nv.add(e.target)):e.lookAt((new Ot).fromArray(t))}}}))}}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const s=e[r];Ov.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;Ov.get(t).parents.forEach((function(e){if(n.has(e.ID)){n.get(e.ID).bind(new Lo(s.bones),i[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in Uv.Objects){const t=Uv.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new fn).fromArray(t.Matrix.a)})):e[i.Node]=(new fn).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Uv&&"AmbientColor"in Uv.GlobalSettings){const e=Uv.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new ni(t,n,i).convertSRGBToLinear();Nv.add(new Ph(e,1))}}}}class Qv{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Uv.Objects){const n=Uv.Objects.Geometry;for(const i in n){const r=Ov.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],s=e.parents.map((function(e){return Uv.Objects.Model[e.ID]}));if(0===s.length)return;const a=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const o=s[0],l={};"RotationOrder"in o&&(l.eulerOrder=ey(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);const c=$v(l);return this.genGeometry(t,a,r,c)}genGeometry(e,t,n,i){const r=new bi;e.attrName&&(r.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),o=new gi(a.vertex,3);if(o.applyMatrix4(i),r.setAttribute("position",o),a.colors.length>0&&r.setAttribute("color",new gi(a.colors,3)),t&&(r.setAttribute("skinIndex",new mi(a.weightsIndices,4)),r.setAttribute("skinWeight",new gi(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const e=(new lt).getNormalMatrix(i),t=new gi(a.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new gi(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&r.addGroup(n,a.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],a=[],o=[],l=[],c=[],h=[];const u=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let A=[],g=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=Yv(p,n,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){g.push(e.weight),A.push(e.id)})),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];g.forEach((function(n,i){let r=n,s=A[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const a=e[n];e[n]=s,s=a}}))})),A=e,g=t}for(;g.length<4;)g.push(0),A.push(0);for(let e=0;e<4;++e)c.push(g[e]),h.push(A[e])}if(e.normal){const t=Yv(p,n,d,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=Yv(p,n,d,e.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const i=Yv(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),u.genFace(t,e,s,f,a,o,l,c,h,i),n++,i=0,s=[],a=[],o=[],l=[],c=[],h=[])})),t}genFace(e,t,n,i,r,s,a,o,l,c){for(let h=2;h<c;h++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(h-1)]]),e.vertex.push(t.vertexPositions[n[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[n[3*h]]),e.vertex.push(t.vertexPositions[n[3*h+1]]),e.vertex.push(t.vertexPositions[n[3*h+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(h-1)]),e.vertexWeights.push(o[4*(h-1)+1]),e.vertexWeights.push(o[4*(h-1)+2]),e.vertexWeights.push(o[4*(h-1)+3]),e.vertexWeights.push(o[4*h]),e.vertexWeights.push(o[4*h+1]),e.vertexWeights.push(o[4*h+2]),e.vertexWeights.push(o[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(h-1)]),e.colors.push(s[3*(h-1)+1]),e.colors.push(s[3*(h-1)+2]),e.colors.push(s[3*h]),e.colors.push(s[3*h+1]),e.colors.push(s[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(h-1)]),e.normal.push(r[3*(h-1)+1]),e.normal.push(r[3*(h-1)+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(h-1)]),e.uvs[n].push(a[n][2*(h-1)+1]),e.uvs[n].push(a[n][2*h]),e.uvs[n].push(a[n][2*h+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=Uv.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,i,n.name)}))}))}genMorphGeometry(e,t,n,i,r){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],o=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let e=0;e<o.length;e++){const t=3*o[e];c[t]=a[3*e],c[t+1]=a[3*e+1],c[t+2]=a[3*e+2]}const h={vertexIndices:s,vertexPositions:c},u=this.genBuffers(h),d=new gi(u.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];"IndexToDirect"===n&&(r=e.ColorIndex.a);for(let e=0,t=new ni;e<i.length;e+=4)t.fromArray(i,e).convertSRGBToLinear().toArray(i,e);return{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let e=0;e<i.length;++e)r.push(e);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new bi;const n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)r.push((new Rt).fromArray(s,e));let a,o;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){a=n,o=i.length-1-a;for(let e=0;e<n;++e)r.push(r[e])}const l=new Fv(n,i,r,a,o).getPoints(12*r.length);return(new bi).setFromPoints(l)}}class zv{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Uv.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Uv.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Uv.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Jv),values:t[n].KeyValueFloat.a},r=Ov.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Uv.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=Ov.get(parseInt(i));if(void 0!==r){r.children.forEach((function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=Ov.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=Uv.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?Au.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Nv.traverse((function(e){e.ID===r.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new fn),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),t[i]=s}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=Ov.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=Ov.get(e).parents[0].ID,s=Ov.get(r).parents[0].ID,a=Ov.get(s).parents[0].ID,o=Uv.Objects.Model[a],l={modelName:o.attrName?Au.sanitizeNodeName(o.attrName):"",morphName:Uv.Objects.Deformer[e].attrName};t[i]=l}t[i][r.attr]=r}}})),n.set(parseInt(i),t)}}return n}parseAnimStacks(e){const t=Uv.Objects.AnimationStack,n={};for(const i in t){const r=Ov.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new ah(e.name,-1,t)}generateTracks(e){const t=[];let n=new Ot,i=new Ut,r=new Ot;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new Cn).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new sh(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(at.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(at.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(at.degToRad));const a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,n);void 0!==i&&((i=i.map(at.degToRad)).push(s),i=(new Cn).fromArray(i),i=(new Ut).setFromEuler(i)),void 0!==r&&((r=r.map(at.degToRad)).push(s),r=(new Cn).fromArray(r),r=(new Ut).setFromEuler(r).invert());const l=new Ut,c=new Cn,h=[];for(let e=0;e<o.length;e+=3)c.set(o[e],o[e+1],o[e+2],s),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==r&&l.multiply(r),l.toArray(h,e/3*4);return new ih(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=Nv.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new th(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let s=-1,a=-1,o=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==a){const e=t.y.values[a];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==o){const e=t.z.values[o];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const s=r/180,a=i/s;let o=n+a;const l=e.times[t-1],c=(e.times[t]-l)/s;let h=l+c;const u=[],d=[];for(;h<e.times[t];)u.push(h),h+=c,d.push(o),o+=a;e.times=iy(e.times,t,u),e.values=iy(e.values,t,d)}}}}class Hv{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new jv,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):o?t.parseNodeProperty(e,o,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==s.id&&(a[n][s.id]=r)):"number"==typeof s.id?(a[n]={},a[n][s.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=r.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,a),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=ty(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ty(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],a=i[2],o=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=ty(l)}this.getPrevNode()[r]={type:s,type2:a,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Vv{parse(e){const t=new Wv(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new jv;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),a=e.getString(s);if(0===i)return null;const o=[];for(let t=0;t<r;t++)o.push(this.parseProperty(e));const l=o.length>0?o[0]:"",c=o.length>1?o[1]:"",h=o.length>2?o[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(a,n,i)}return n.propertyList=o,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),a="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:s,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=function(e,t){return Bv((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}(new Uint8Array(e.getArrayBuffer(s))),o=new Wv(a.buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Wv{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class jv{add(e,t){this[e]=t}}function Xv(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Jv(e){return e/46186158e3}const qv=[];function Yv(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,a=s+i.dataSize;return function(e,t,n,i){for(let r=n,s=0;r<i;r++,s++)e[s]=t[r];return e}(qv,i.buffer,s,a)}const Kv=new Cn,Zv=new Ot;function $v(e){const t=new fn,n=new fn,i=new fn,r=new fn,s=new fn,a=new fn,o=new fn,l=new fn,c=new fn,h=new fn,u=new fn,d=new fn,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Zv.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(at.degToRad);t.push(e.eulerOrder||Cn.DEFAULT_ORDER),n.makeRotationFromEuler(Kv.fromArray(t))}if(e.rotation){const t=e.rotation.map(at.degToRad);t.push(e.eulerOrder||Cn.DEFAULT_ORDER),i.makeRotationFromEuler(Kv.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(at.degToRad);t.push(e.eulerOrder||Cn.DEFAULT_ORDER),r.makeRotationFromEuler(Kv.fromArray(t)),r.invert()}e.scale&&s.scale(Zv.fromArray(e.scale)),e.scalingOffset&&o.setPosition(Zv.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(Zv.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Zv.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Zv.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const f=n.clone().multiply(i).multiply(r),m=new fn;m.extractRotation(h);const A=new fn;A.copyPosition(h);const g=A.clone().invert().multiply(h),v=m.clone().invert().multiply(g),y=s,x=new fn;if(0===p)x.copy(m).multiply(f).multiply(v).multiply(y);else if(1===p)x.copy(m).multiply(v).multiply(f).multiply(y);else{const e=(new fn).scale((new Ot).setFromMatrixScale(u)).clone().invert(),t=v.clone().multiply(e);x.copy(m).multiply(f).multiply(t).multiply(y)}const _=c.clone().invert(),E=a.clone().invert();let w=t.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(_).multiply(o).multiply(a).multiply(s).multiply(E);const C=(new fn).copyPosition(w),b=h.clone().multiply(C);return d.copyPosition(b),w=d.clone().multiply(x),w.premultiply(h.invert()),w}function ey(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function ty(e){return e.split(",").map((function(e){return parseFloat(e)}))}function ny(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}function iy(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}class ry extends Hi{ignoreObjects;isReflector;camera;material;getRenderTarget;dispose;constructor(e,t={}){super(e);const n=t.ignoreObjects||[];this.ignoreObjects=n,this.isReflector=!0,this.type="Reflector",this.camera=new Zi;const i=this,r=void 0!==t.color?new ni(t.color):new ni(8355711),s=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,l=t.shader||ry.ReflectorShader,c=void 0!==t.multisample?t.multisample:4,h=new ar,u=new Ot,d=new Ot,p=new Ot,f=new fn,m=new Ot(0,0,-1),A=new Rt,g=new Ot,v=new Ot,y=new Rt,x=new fn,_=this.camera,E=new Lt(s,a,{samples:c,type:R}),w=new Yi({uniforms:qi.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});w.uniforms.tDiffuse.value=E.texture,w.uniforms.color.value=r,w.uniforms.textureMatrix.value=x,this.material=w,this.onBeforeRender=function(e,t,r){if(d.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(r.matrixWorld),f.extractRotation(i.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),g.subVectors(d,p),g.dot(u)>0)return;g.reflect(u).negate(),g.add(d),f.extractRotation(r.matrixWorld),m.set(0,0,-1),m.applyMatrix4(f),m.add(p),v.subVectors(d,m),v.reflect(u).negate(),v.add(d),_.position.copy(g),_.up.set(0,1,0),_.up.applyMatrix4(f),_.up.reflect(u),_.lookAt(v),_.far=r.far,_.updateMatrixWorld(),_.projectionMatrix.copy(r.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(_.projectionMatrix),x.multiply(_.matrixWorldInverse),x.multiply(i.matrixWorld),h.setFromNormalAndCoplanarPoint(u,d),h.applyMatrix4(_.matrixWorldInverse),A.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const s=_.projectionMatrix;y.x=(Math.sign(A.x)+s.elements[8])/s.elements[0],y.y=(Math.sign(A.y)+s.elements[9])/s.elements[5],y.z=-1,y.w=(1+s.elements[10])/s.elements[14],A.multiplyScalar(2/A.dot(y)),s.elements[2]=A.x,s.elements[6]=A.y,s.elements[10]=A.z+1-o,s.elements[14]=A.w,i.visible=!1,n.forEach((e=>{e.visible=!1}));const a=e.getRenderTarget(),l=e.xr.enabled,c=e.shadowMap.autoUpdate,w=e.outputEncoding,C=e.toneMapping;let b=!1;b="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace=b?"srgb":"srgb-linear":e.outputEncoding=b?3001:3e3,e.toneMapping=0,e.setRenderTarget(E),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,_),e.xr.enabled=l,e.shadowMap.autoUpdate=c,e.outputEncoding=w,e.toneMapping=C,e.setRenderTarget(a);const M=r.viewport;void 0!==M&&e.state.viewport(M),i.visible=!0,n.forEach((e=>{e.visible=!0}))},this.getRenderTarget=function(){return E},this.dispose=function(){E.dispose(),i.material.dispose()}}}ry.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};class sy{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new oy);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new oy);const n=this.elements,i=e.x,r=e.y,s=e.z;return t.x=n[0]*i+n[1]*r+n[2]*s,t.y=n[3]*i+n[4]*r+n[5]*s,t.z=n[6]*i+n[7]*r+n[8]*s,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new sy);const n=this.elements,i=e.elements,r=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],h=n[5],u=n[6],d=n[7],p=n[8],f=i[0],m=i[1],A=i[2],g=i[3],v=i[4],y=i[5],x=i[6],_=i[7],E=i[8];return r[0]=s*f+a*g+o*x,r[1]=s*m+a*v+o*_,r[2]=s*A+a*y+o*E,r[3]=l*f+c*g+h*x,r[4]=l*m+c*v+h*_,r[5]=l*A+c*y+h*E,r[6]=u*f+d*g+p*x,r[7]=u*m+d*v+p*_,r[8]=u*A+d*y+p*E,t}scale(e,t){void 0===t&&(t=new sy);const n=this.elements,i=t.elements;for(let t=0;3!==t;t++)i[3*t+0]=e.x*n[3*t+0],i[3*t+1]=e.y*n[3*t+1],i[3*t+2]=e.z*n[3*t+2];return t}solve(e,t){void 0===t&&(t=new oy);const n=[];let i,r;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)n[i+4*r]=this.elements[i+3*r];n[3]=e.x,n[7]=e.y,n[11]=e.z;let s=3;const a=s;let o;let l;do{if(i=a-s,0===n[i+4*i])for(r=i+1;r<a;r++)if(0!==n[i+4*r]){o=4;do{l=4-o,n[l+4*i]+=n[l+4*r]}while(--o);break}if(0!==n[i+4*i])for(r=i+1;r<a;r++){const e=n[i+4*r]/n[i+4*i];o=4;do{l=4-o,n[l+4*r]=l<=i?0:n[l+4*r]-n[l+4*i]*e}while(--o)}}while(--s);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){void 0===e&&(e=new sy);const t=ay;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let r=3;const s=r;let a;let o;do{if(n=s-r,0===t[n+6*n])for(i=n+1;i<s;i++)if(0!==t[n+6*i]){a=6;do{o=6-a,t[o+6*n]+=t[o+6*i]}while(--a);break}if(0!==t[n+6*n])for(i=n+1;i<s;i++){const e=t[n+6*i]/t[n+6*n];a=6;do{o=6-a,t[o+6*i]=o<=n?0:t[o+6*i]-t[o+6*n]*e}while(--a)}}while(--r);n=2;do{i=n-1;do{const e=t[n+6*i]/t[n+6*n];a=6;do{o=6-a,t[o+6*i]=t[o+6*i]-t[o+6*n]*e}while(--a)}while(i--)}while(--n);n=2;do{const e=1/t[n+6*n];a=6;do{o=6-a,t[o+6*n]=t[o+6*n]*e}while(--a)}while(n--);n=2;do{i=2;do{if(o=t[3+i+6*n],isNaN(o)||o===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,i,o)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,r=e.w,s=t+t,a=n+n,o=i+i,l=t*s,c=t*a,h=t*o,u=n*a,d=n*o,p=i*o,f=r*s,m=r*a,A=r*o,g=this.elements;return g[0]=1-(u+p),g[1]=c-A,g[2]=h+m,g[3]=c+A,g[4]=1-(l+p),g[5]=d-f,g[6]=h-m,g[7]=d+f,g[8]=1-(l+u),this}transpose(e){void 0===e&&(e=new sy);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const ay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class oy{constructor(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){void 0===t&&(t=new oy);const n=e.x,i=e.y,r=e.z,s=this.x,a=this.y,o=this.z;return t.x=a*r-o*i,t.y=o*n-s*r,t.z=s*i-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new oy(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new oy(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new sy([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const e=1/i;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return i}unit(e){void 0===e&&(e=new oy);const t=this.x,n=this.y,i=this.z;let r=Math.sqrt(t*t+n*n+i*i);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z;return Math.sqrt((r-t)*(r-t)+(s-n)*(s-n)+(a-i)*(a-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z;return(r-t)*(r-t)+(s-n)*(s-n)+(a-i)*(a-i)}scale(e,t){void 0===t&&(t=new oy);const n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t){return void 0===t&&(t=new oy),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return void 0===n&&(n=new oy),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new oy),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=ly,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const s=cy;Math.abs(i.x)<.9?(s.set(1,0,0),i.cross(s,e)):(s.set(0,1,0),i.cross(s,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,r=this.y,s=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=s+(e.z-s)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(hy),hy.almostEquals(e,t)}clone(){return new oy(this.x,this.y,this.z)}}oy.ZERO=new oy(0,0,0),oy.UNIT_X=new oy(1,0,0),oy.UNIT_Y=new oy(0,1,0),oy.UNIT_Z=new oy(0,0,1);const ly=new oy,cy=new oy,hy=new oy;class uy{constructor(e){void 0===e&&(e={}),this.lowerBound=new oy,this.upperBound=new oy,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const r=this.lowerBound,s=this.upperBound,a=n;r.copy(e[0]),a&&a.vmult(r,r),s.copy(r);for(let t=1;t<e.length;t++){let n=e[t];a&&(a.vmult(n,dy),n=dy),n.x>s.x&&(s.x=n.x),n.x<r.x&&(r.x=n.x),n.y>s.y&&(s.y=n.y),n.y<r.y&&(r.y=n.y),n.z>s.z&&(s.z=n.z),n.z<r.z&&(r.z=n.z)}return t&&(t.vadd(r,r),t.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new uy).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,s=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,a=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,o=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return s&&a&&o}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}getCorners(e,t,n,i,r,s,a,o){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),s.set(l.x,c.y,l.z),a.set(l.x,l.y,c.z),o.copy(c)}toLocalFrame(e,t){const n=py,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=n[5],c=n[6],h=n[7];this.getCorners(i,r,s,a,o,l,c,h);for(let t=0;8!==t;t++){const i=n[t];e.pointToLocal(i,i)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=py,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=n[5],c=n[6],h=n[7];this.getCorners(i,r,s,a,o,l,c,h);for(let t=0;8!==t;t++){const i=n[t];e.pointToWorld(i,i)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,r=1/t.y,s=1/t.z,a=(this.lowerBound.x-n.x)*i,o=(this.upperBound.x-n.x)*i,l=(this.lowerBound.y-n.y)*r,c=(this.upperBound.y-n.y)*r,h=(this.lowerBound.z-n.z)*s,u=(this.upperBound.z-n.z)*s,d=Math.max(Math.max(Math.min(a,o),Math.min(l,c)),Math.min(h,u)),p=Math.min(Math.min(Math.max(a,o),Math.max(l,c)),Math.max(h,u));return!(p<0)&&!(d>p)}}const dy=new oy,py=[new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy];class fy{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const e=i;i=n,n=e}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:r}=t;if(r>i){const e=r;r=i,i=e}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class my{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}hasAnyEventListener(e){if(void 0===this._listeners)return!1;return void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[e])return this;const i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class Ay{constructor(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new oy),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=gy,n=vy;e.tangents(t,n),this.setFromAxisAngle(t,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new Ay);const n=this.x,i=this.y,r=this.z,s=this.w,a=e.x,o=e.y,l=e.z,c=e.w;return t.x=n*c+s*a+i*l-r*o,t.y=i*c+s*o+r*a-n*l,t.z=r*c+s*l+n*o-i*a,t.w=s*c-n*a-i*o-r*l,t}inverse(e){void 0===e&&(e=new Ay);const t=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(e);const s=1/(t*t+n*n+i*i+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return void 0===e&&(e=new Ay),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new oy);const n=e.x,i=e.y,r=e.z,s=this.x,a=this.y,o=this.z,l=this.w,c=l*n+a*r-o*i,h=l*i+o*n-s*r,u=l*r+s*i-a*n,d=-s*n-a*i-o*r;return t.x=c*l+d*-s+h*-o-u*-a,t.y=h*l+d*-a+u*-s-c*-o,t.z=u*l+d*-o+c*-a-h*-s,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,r;void 0===t&&(t="YZX");const s=this.x,a=this.y,o=this.z,l=this.w;if("YZX"!==t)throw new Error(`Euler order ${t} not supported yet.`);{const e=s*a+o*l;if(e>.499&&(n=2*Math.atan2(s,l),i=Math.PI/2,r=0),e<-.499&&(n=-2*Math.atan2(s,l),i=-Math.PI/2,r=0),void 0===n){const t=s*s,c=a*a,h=o*o;n=Math.atan2(2*a*l-2*s*o,1-2*c-2*h),i=Math.asin(2*e),r=Math.atan2(2*s*l-2*a*o,1-2*t-2*h)}}e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i){void 0===i&&(i="XYZ");const r=Math.cos(e/2),s=Math.cos(t/2),a=Math.cos(n/2),o=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=o*s*a+r*l*c,this.y=r*l*a-o*s*c,this.z=r*s*c+o*l*a,this.w=r*s*a-o*l*c):"YXZ"===i?(this.x=o*s*a+r*l*c,this.y=r*l*a-o*s*c,this.z=r*s*c-o*l*a,this.w=r*s*a+o*l*c):"ZXY"===i?(this.x=o*s*a-r*l*c,this.y=r*l*a+o*s*c,this.z=r*s*c+o*l*a,this.w=r*s*a-o*l*c):"ZYX"===i?(this.x=o*s*a-r*l*c,this.y=r*l*a+o*s*c,this.z=r*s*c-o*l*a,this.w=r*s*a+o*l*c):"YZX"===i?(this.x=o*s*a+r*l*c,this.y=r*l*a+o*s*c,this.z=r*s*c-o*l*a,this.w=r*s*a-o*l*c):"XZY"===i&&(this.x=o*s*a-r*l*c,this.y=r*l*a-o*s*c,this.z=r*s*c+o*l*a,this.w=r*s*a+o*l*c),this}clone(){return new Ay(this.x,this.y,this.z,this.w)}slerp(e,t,n){void 0===n&&(n=new Ay);const i=this.x,r=this.y,s=this.z,a=this.w;let o,l,c,h,u,d=e.x,p=e.y,f=e.z,m=e.w;return l=i*d+r*p+s*f+a*m,l<0&&(l=-l,d=-d,p=-p,f=-f,m=-m),1-l>1e-6?(o=Math.acos(l),c=Math.sin(o),h=Math.sin((1-t)*o)/c,u=Math.sin(t*o)/c):(h=1-t,u=t),n.x=h*i+u*d,n.y=h*r+u*p,n.z=h*s+u*f,n.w=h*a+u*m,n}integrate(e,t,n,i){void 0===i&&(i=new Ay);const r=e.x*n.x,s=e.y*n.y,a=e.z*n.z,o=this.x,l=this.y,c=this.z,h=this.w,u=.5*t;return i.x+=u*(r*h+s*c-a*l),i.y+=u*(s*h+a*o-r*c),i.z+=u*(a*h+r*l-s*o),i.w+=u*(-r*o-s*l-a*c),i}}const gy=new oy,vy=new oy;class yy{constructor(e){void 0===e&&(e={}),this.id=yy.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}yy.idCounter=0,yy.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class xy{constructor(e){void 0===e&&(e={}),this.position=new oy,this.quaternion=new Ay,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return xy.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return xy.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new oy),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return void 0===i&&(i=new oy),n.vsub(e,i),t.conjugate(_y),_y.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return void 0===i&&(i=new oy),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return void 0===n&&(n=new oy),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return void 0===i&&(i=new oy),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const _y=new Ay;class Ey extends yy{constructor(e){void 0===e&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:s}=e;super({type:yy.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new oy;for(let r=0;r!==e.length;r++){const s=e[r],a=s.length;for(let e=0;e!==a;e++){const r=(e+1)%a;t[s[e]].vsub(t[s[r]],i),i.normalize();let o=!1;for(let e=0;e!==n.length;e++)if(n[e].almostEquals(i)||n[e].almostEquals(i)){o=!0;break}o||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error(`Vertex ${this.faces[e][t]} not found!`);const t=this.faceNormals[e]||new oy;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let t=0;t<this.faces[e].length;t++)console.warn(`.vertices[${this.faces[e][t]}] = Vec3(${this.vertices[this.faces[e][t]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],r=this.vertices[n[1]],s=this.vertices[n[2]];Ey.computeNormal(i,r,s,t)}static computeNormal(e,t,n,i){const r=new oy,s=new oy;t.vsub(e,s),n.vsub(t,r),r.cross(s,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,s,a,o,l){const c=new oy;let h=-1,u=-Number.MAX_VALUE;for(let e=0;e<n.faces.length;e++){c.copy(n.faceNormals[e]),r.vmult(c,c);const t=c.dot(s);t>u&&(u=t,h=e)}const d=[];for(let e=0;e<n.faces[h].length;e++){const t=n.vertices[n.faces[h][e]],s=new oy;s.copy(t),r.vmult(s,s),i.vadd(s,s),d.push(s)}h>=0&&this.clipFaceAgainstHull(s,e,t,d,a,o,l)}findSeparatingAxis(e,t,n,i,r,s,a,o){const l=new oy,c=new oy,h=new oy,u=new oy,d=new oy,p=new oy;let f=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let a=0;a!==m.uniqueAxes.length;a++){n.vmult(m.uniqueAxes[a],l);const o=m.testSepAxis(l,e,t,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(l))}else{const o=a?a.length:m.faces.length;for(let c=0;c<o;c++){const o=a?a[c]:c;l.copy(m.faceNormals[o]),n.vmult(l,l);const h=m.testSepAxis(l,e,t,n,i,r);if(!1===h)return!1;h<f&&(f=h,s.copy(l))}}if(e.uniqueAxes)for(let a=0;a!==e.uniqueAxes.length;a++){r.vmult(e.uniqueAxes[a],c);const o=m.testSepAxis(c,e,t,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(c))}else{const a=o?o.length:e.faces.length;for(let l=0;l<a;l++){const a=o?o[l]:l;c.copy(e.faceNormals[a]),r.vmult(c,c);const h=m.testSepAxis(c,e,t,n,i,r);if(!1===h)return!1;h<f&&(f=h,s.copy(c))}}for(let a=0;a!==m.uniqueEdges.length;a++){n.vmult(m.uniqueEdges[a],u);for(let a=0;a!==e.uniqueEdges.length;a++)if(r.vmult(e.uniqueEdges[a],d),u.cross(d,p),!p.almostZero()){p.normalize();const a=m.testSepAxis(p,e,t,n,i,r);if(!1===a)return!1;a<f&&(f=a,s.copy(p))}}return i.vsub(t,h),h.dot(s)>0&&s.negate(s),!0}testSepAxis(e,t,n,i,r,s){Ey.project(this,e,n,i,wy),Ey.project(t,e,r,s,Cy);const a=wy[0],o=wy[1],l=Cy[0],c=Cy[1];if(a<c||l<o)return!1;const h=a-c,u=l-o;return h<u?h:u}calculateLocalInertia(e,t){const n=new oy,i=new oy;this.computeLocalAABB(i,n);const r=n.x-i.x,s=n.y-i.y,a=n.z-i.z;t.x=1/12*e*(2*s*2*s+2*a*2*a),t.y=1/12*e*(2*r*2*r+2*a*2*a),t.z=1/12*e*(2*s*2*s+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,r,s,a){const o=new oy,l=new oy,c=new oy,h=new oy,u=new oy,d=new oy,p=new oy,f=new oy,m=this,A=i,g=[];let v=-1,y=Number.MAX_VALUE;for(let t=0;t<m.faces.length;t++){o.copy(m.faceNormals[t]),n.vmult(o,o);const i=o.dot(e);i<y&&(y=i,v=t)}if(v<0)return;const x=m.faces[v];x.connectedFaces=[];for(let e=0;e<m.faces.length;e++)for(let t=0;t<m.faces[e].length;t++)-1!==x.indexOf(m.faces[e][t])&&e!==v&&-1===x.connectedFaces.indexOf(e)&&x.connectedFaces.push(e);const _=x.length;for(let e=0;e<_;e++){const i=m.vertices[x[e]],r=m.vertices[x[(e+1)%_]];i.vsub(r,l),c.copy(l),n.vmult(c,c),t.vadd(c,c),h.copy(this.faceNormals[v]),n.vmult(h,h),t.vadd(h,h),c.cross(h,u),u.negate(u),d.copy(i),n.vmult(d,d),t.vadd(d,d);const s=x.connectedFaces[e];p.copy(this.faceNormals[s]);const a=this.getPlaneConstantOfFace(s);f.copy(p),n.vmult(f,f);const o=a-f.dot(t);for(this.clipFaceAgainstPlane(A,g,f,o);A.length;)A.shift();for(;g.length;)A.push(g.shift())}p.copy(this.faceNormals[v]);const E=this.getPlaneConstantOfFace(v);f.copy(p),n.vmult(f,f);const w=E-f.dot(t);for(let e=0;e<A.length;e++){let t=f.dot(A[e])+w;if(t<=r&&(console.log(`clamped: depth=${t} to minDist=${r}`),t=r),t<=s){const n=A[e];if(t<=1e-6){const e={point:n,normal:f,depth:t};a.push(e)}}}}clipFaceAgainstPlane(e,t,n,i){let r,s;const a=e.length;if(a<2)return t;let o=e[e.length-1],l=e[0];r=n.dot(o)+i;for(let c=0;c<a;c++){if(l=e[c],s=n.dot(l)+i,r<0)if(s<0){const e=new oy;e.copy(l),t.push(e)}else{const e=new oy;o.lerp(l,r/(r-s),e),t.push(e)}else if(s<0){const e=new oy;o.lerp(l,r/(r-s),e),t.push(e),t.push(l)}o=l,r=s}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new oy);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new oy);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=this.vertices;let s,a,o,l,c,h,u=new oy;for(let n=0;n<r.length;n++){u.copy(r[n]),t.vmult(u,u),e.vadd(u,u);const i=u;(void 0===s||i.x<s)&&(s=i.x),(void 0===l||i.x>l)&&(l=i.x),(void 0===a||i.y<a)&&(a=i.y),(void 0===c||i.y>c)&&(c=i.y),(void 0===o||i.z<o)&&(o=i.z),(void 0===h||i.z>h)&&(h=i.z)}n.set(s,a,o),i.set(l,c,h)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new oy);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let e=0;e<n;e++){const n=i[e];t.vmult(n,n)}for(let e=0;e<this.faceNormals.length;e++){const n=this.faceNormals[e];t.vmult(n,n)}}if(e)for(let t=0;t<n;t++){const n=i[t];n.vadd(e,n)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,r=new oy;this.getAveragePointLocal(r);for(let s=0;s<this.faces.length;s++){let a=i[s];const o=t[n[s][0]],l=new oy;e.vsub(o,l);const c=a.dot(l),h=new oy;r.vsub(o,h);const u=a.dot(h);if(c<0&&u>0||c>0&&u<0)return!1}return-1}static project(e,t,n,i,r){const s=e.vertices.length,a=by;let o=0,l=0;const c=My,h=e.vertices;c.setZero(),xy.vectorToLocalFrame(n,i,t,a),xy.pointToLocalFrame(n,i,c,c);const u=c.dot(a);l=o=h[0].dot(a);for(let e=1;e<s;e++){const t=h[e].dot(a);t>o&&(o=t),t<l&&(l=t)}if(l-=u,o-=u,l>o){const e=l;l=o,o=e}r[0]=o,r[1]=l}}const wy=[],Cy=[],by=(new oy,new oy),My=new oy;let Sy=class e extends yy{constructor(e){super({type:yy.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=oy,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],s=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],a=new Ey({vertices:r,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(t,n){return void 0===n&&(n=new oy),e.calculateInertia(this.halfExtents,t,n),n}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(let e=0;e!==n.length;e++)t.vmult(n[e],n[e]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let i=0;i<r.length;i++)Iy.set(r[i][0],r[i][1],r[i][2]),t.vmult(Iy,Iy),e.vadd(Iy,Iy),n(Iy.x,Iy.y,Iy.z)}calculateWorldAABB(e,t,n,i){const r=this.halfExtents;By[0].set(r.x,r.y,r.z),By[1].set(-r.x,r.y,r.z),By[2].set(-r.x,-r.y,r.z),By[3].set(-r.x,-r.y,-r.z),By[4].set(r.x,-r.y,-r.z),By[5].set(r.x,r.y,-r.z),By[6].set(-r.x,r.y,-r.z),By[7].set(r.x,-r.y,r.z);const s=By[0];t.vmult(s,s),e.vadd(s,s),i.copy(s),n.copy(s);for(let r=1;r<8;r++){const s=By[r];t.vmult(s,s),e.vadd(s,s);const a=s.x,o=s.y,l=s.z;a>i.x&&(i.x=a),o>i.y&&(i.y=o),l>i.z&&(i.z=l),a<n.x&&(n.x=a),o<n.y&&(n.y=o),l<n.z&&(n.z=l)}}};const Iy=new oy,By=[new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy],Ty=1,Ry=2,Dy=4,Ly=0,Py=1,Fy=2;class Uy extends my{constructor(e){void 0===e&&(e={}),super(),this.id=Uy.idCounter++,this.index=-1,this.world=null,this.vlambda=new oy,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new oy,this.previousPosition=new oy,this.interpolatedPosition=new oy,this.initPosition=new oy,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new oy,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new oy,this.force=new oy;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?Uy.STATIC:Uy.DYNAMIC,typeof e.type==typeof Uy.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=Uy.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new oy,this.quaternion=new Ay,this.initQuaternion=new Ay,this.previousQuaternion=new Ay,this.interpolatedQuaternion=new Ay,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new oy,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new oy,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new oy,this.invInertia=new oy,this.invInertiaWorld=new sy,this.invMassSolve=0,this.invInertiaSolve=new oy,this.invInertiaWorldSolve=new sy,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new oy(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new oy(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new uy,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new oy,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=Uy.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Uy.SLEEPING&&this.dispatchEvent(Uy.wakeupEvent)}sleep(){this.sleepState=Uy.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===Uy.AWAKE&&n<i?(this.sleepState=Uy.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Uy.sleepyEvent)):t===Uy.SLEEPY&&n>i?this.wakeUp():t===Uy.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Uy.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Uy.SLEEPING||this.type===Uy.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new oy),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new oy),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new oy),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new oy),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new oy,r=new Ay;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let r=0;r!==n;r++){const n=e[r];n.updateBoundingSphereRadius();const s=t[r].length(),a=n.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=Oy,s=Ny,a=this.quaternion,o=this.aabb,l=ky;for(let c=0;c!==i;c++){const i=e[c];a.vmult(t[c],r),r.vadd(this.position,r),a.mult(n[c],s),i.calculateWorldAABB(r,s,l.lowerBound,l.upperBound),0===c?o.copy(l):o.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=Gy,n=Qy;e.setRotationFromQuaternion(this.quaternion),e.transpose(n),e.scale(t,e),e.mmult(n,this.invInertiaWorld)}else;}applyForce(e,t){if(void 0===t&&(t=new oy),this.type!==Uy.DYNAMIC)return;this.sleepState===Uy.SLEEPING&&this.wakeUp();const n=zy;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(void 0===t&&(t=new oy),this.type!==Uy.DYNAMIC)return;const n=Hy,i=Vy;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===Uy.DYNAMIC&&(this.sleepState===Uy.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new oy),this.type!==Uy.DYNAMIC)return;this.sleepState===Uy.SLEEPING&&this.wakeUp();const n=t,i=Wy;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=jy;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t){if(void 0===t&&(t=new oy),this.type!==Uy.DYNAMIC)return;const n=Xy,i=Jy;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=qy;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Sy.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new oy;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Uy.DYNAMIC&&this.type!==Uy.KINEMATIC||this.sleepState===Uy.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,s=this.position,a=this.force,o=this.torque,l=this.quaternion,c=this.invMass,h=this.invInertiaWorld,u=this.linearFactor,d=c*e;i.x+=a.x*d*u.x,i.y+=a.y*d*u.y,i.z+=a.z*d*u.z;const p=h.elements,f=this.angularFactor,m=o.x*f.x,A=o.y*f.y,g=o.z*f.z;r.x+=e*(p[0]*m+p[1]*A+p[2]*g),r.y+=e*(p[3]*m+p[4]*A+p[5]*g),r.z+=e*(p[6]*m+p[7]*A+p[8]*g),s.x+=i.x*e,s.y+=i.y*e,s.z+=i.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Uy.idCounter=0,Uy.COLLIDE_EVENT_NAME="collide",Uy.DYNAMIC=Ty,Uy.STATIC=Ry,Uy.KINEMATIC=Dy,Uy.AWAKE=Ly,Uy.SLEEPY=Py,Uy.SLEEPING=Fy,Uy.wakeupEvent={type:"wakeup"},Uy.sleepyEvent={type:"sleepy"},Uy.sleepEvent={type:"sleep"};const Oy=new oy,Ny=new Ay,ky=new uy,Gy=new sy,Qy=new sy;new sy;const zy=new oy,Hy=new oy,Vy=new oy,Wy=new oy,jy=new oy,Xy=new oy,Jy=new oy,qy=new oy;class Yy{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&Uy.STATIC)&&e.sleepState!==Uy.SLEEPING||0==(t.type&Uy.STATIC)&&t.sleepState!==Uy.SLEEPING)}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const r=Ky;t.position.vsub(e.position,r);const s=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<s&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=Zy,i=$y,r=ex,s=e.length;for(let n=0;n!==s;n++)i[n]=e[n],r[n]=t[n];e.length=0,t.length=0;for(let e=0;e!==s;e++){const t=i[e].id,s=r[e].id,a=t<s?`${t},${s}`:`${s},${t}`;n[a]=e,n.keys.push(a)}for(let s=0;s!==n.keys.length;s++){const s=n.keys.pop(),a=n[s];e.push(i[a]),t.push(r[a]),delete n[s]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new oy;e.position.vsub(t.position,n);const i=e.shapes[0],r=t.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Ky=new oy;new oy,new Ay,new oy;const Zy={keys:[]},$y=[],ex=[];new oy,new oy,new oy;class tx extends Yy{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,r=i.length;let s,a;for(let e=0;e!==r;e++)for(let r=0;r!==e;r++)s=i[e],a=i[r],this.needBroadphaseCollision(s,a)&&this.intersectionTest(s,a,t,n)}aabbQuery(e,t,n){void 0===n&&(n=[]);for(let i=0;i<e.bodies.length;i++){const r=e.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class nx{constructor(){this.rayFromWorld=new oy,this.rayToWorld=new oy,this.hitNormalWorld=new oy,this.hitPointWorld=new oy,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,s,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=s,this.distance=a}}let ix,rx,sx,ax,ox,lx,cx;const hx=1,ux=2,dx=4;ix=yy.types.SPHERE,rx=yy.types.PLANE,sx=yy.types.BOX,ax=yy.types.CYLINDER,ox=yy.types.CONVEXPOLYHEDRON,lx=yy.types.HEIGHTFIELD,cx=yy.types.TRIMESH;class px{get[ix](){return this._intersectSphere}get[rx](){return this._intersectPlane}get[sx](){return this._intersectBox}get[ax](){return this._intersectConvex}get[ox](){return this._intersectConvex}get[lx](){return this._intersectHeightfield}get[cx](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new oy),void 0===t&&(t=new oy),this.from=e.clone(),this.to=t.clone(),this.direction=new oy,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=px.ANY,this.result=new nx,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||px.ANY,this.result=t.result||new nx,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(fx),mx.length=0,e.broadphase.aabbQuery(e,fx,mx),this.intersectBodies(mx),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse)return;if(0==(this.collisionFilterGroup&e.collisionFilterMask)||0==(e.collisionFilterGroup&this.collisionFilterMask))return;const i=vx,r=yx;for(let t=0,s=e.shapes.length;t<s;t++){const s=e.shapes[t];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[t],r),e.quaternion.vmult(e.shapeOffsets[t],i),i.vadd(e.position,i),this.intersectShape(s,r,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let t=0,n=e.length;!this.result.shouldStop&&t<n;t++)this.intersectBody(e[t])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const r=function(e,t,n){n.vsub(e,Gx);const i=Gx.dot(t);t.scale(i,Qx),Qx.vadd(e,Qx);const r=n.distanceTo(Qx);return r}(this.from,this.direction,n);if(r>e.boundingSphereRadius)return;const s=this[e.type];s&&s.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){const s=this.from,a=this.to,o=this.direction,l=new oy(0,0,1);t.vmult(l,l);const c=new oy;s.vsub(n,c);const h=c.dot(l);a.vsub(n,c);if(h*c.dot(l)>0)return;if(s.distanceTo(a)<h)return;const u=l.dot(o);if(Math.abs(u)<this.precision)return;const d=new oy,p=new oy,f=new oy;s.vsub(n,d);const m=-l.dot(d)/u;o.scale(m,p),s.vadd(p,f),this.reportIntersection(l,f,r,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(e,t,n,i,r){e.data,e.elementSize;const s=Mx;s.from.copy(this.from),s.to.copy(this.to),xy.pointToLocalFrame(n,t,s.from,s.from),xy.pointToLocalFrame(n,t,s.to,s.to),s.updateDirection();const a=Sx;let o,l,c,h;o=l=0,c=h=e.data.length-1;const u=new uy;s.getAABB(u),e.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,a,!0),o=Math.max(o,a[0]),l=Math.max(l,a[1]),e.getIndexOfPosition(u.upperBound.x,u.upperBound.y,a,!0),c=Math.min(c,a[0]+1),h=Math.min(h,a[1]+1);for(let a=o;a<c;a++)for(let o=l;o<h;o++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(a,o,u),u.overlapsRay(s)){if(e.getConvexTrianglePillar(a,o,!1),xy.pointToWorldFrame(n,t,e.pillarOffset,bx),this._intersectConvex(e.pillarConvex,t,bx,i,r,Cx),this.result.shouldStop)return;e.getConvexTrianglePillar(a,o,!0),xy.pointToWorldFrame(n,t,e.pillarOffset,bx),this._intersectConvex(e.pillarConvex,t,bx,i,r,Cx)}}}_intersectSphere(e,t,n,i,r){const s=this.from,a=this.to,o=e.radius,l=(a.x-s.x)**2+(a.y-s.y)**2+(a.z-s.z)**2,c=2*((a.x-s.x)*(s.x-n.x)+(a.y-s.y)*(s.y-n.y)+(a.z-s.z)*(s.z-n.z)),h=c**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-o**2),u=Ix,d=Bx;if(!(h<0))if(0===h)s.lerp(a,h,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1);else{const e=(-c-Math.sqrt(h))/(2*l),t=(-c+Math.sqrt(h))/(2*l);if(e>=0&&e<=1&&(s.lerp(a,e,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(s.lerp(a,t,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1))}}_intersectConvex(e,t,n,i,r,s){const a=Tx,o=Rx,l=s&&s.faceList||null,c=e.faces,h=e.vertices,u=e.faceNormals,d=this.direction,p=this.from,f=this.to,m=p.distanceTo(f),A=l?l.length:c.length,g=this.result;for(let e=0;!g.shouldStop&&e<A;e++){const s=l?l[e]:e,f=c[s],A=u[s],v=t,y=n;o.copy(h[f[0]]),v.vmult(o,o),o.vadd(y,o),o.vsub(p,o),v.vmult(A,a);const x=d.dot(a);if(Math.abs(x)<this.precision)continue;const _=a.dot(o)/x;if(!(_<0)){d.scale(_,xx),xx.vadd(p,xx),_x.copy(h[f[0]]),v.vmult(_x,_x),y.vadd(_x,_x);for(let e=1;!g.shouldStop&&e<f.length-1;e++){Ex.copy(h[f[e]]),wx.copy(h[f[e+1]]),v.vmult(Ex,Ex),v.vmult(wx,wx),y.vadd(Ex,Ex),y.vadd(wx,wx);const t=xx.distanceTo(p);!px.pointInTriangle(xx,_x,Ex,wx)&&!px.pointInTriangle(xx,Ex,_x,wx)||t>m||this.reportIntersection(a,xx,r,i,s)}}}}_intersectTrimesh(e,t,n,i,r,s){const a=Dx,o=Nx,l=kx,c=Rx,h=Lx,u=Px,d=Fx,p=Ox,f=Ux,m=e.indices;e.vertices;const A=this.from,g=this.to,v=this.direction;l.position.copy(n),l.quaternion.copy(t),xy.vectorToLocalFrame(n,t,v,h),xy.pointToLocalFrame(n,t,A,u),xy.pointToLocalFrame(n,t,g,d),d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,d.vsub(u,h),h.normalize();const y=u.distanceSquared(d);e.tree.rayQuery(this,l,o);for(let s=0,l=o.length;!this.result.shouldStop&&s!==l;s++){const l=o[s];e.getNormal(l,a),e.getVertex(m[3*l],_x),_x.vsub(u,c);const d=h.dot(a),A=a.dot(c)/d;if(A<0)continue;h.scale(A,xx),xx.vadd(u,xx),e.getVertex(m[3*l+1],Ex),e.getVertex(m[3*l+2],wx);const g=xx.distanceSquared(u);!px.pointInTriangle(xx,Ex,_x,wx)&&!px.pointInTriangle(xx,_x,Ex,wx)||g>y||(xy.vectorToWorldFrame(t,a,f),xy.pointToWorldFrame(n,t,xx,p),this.reportIntersection(f,p,r,i,l))}o.length=0}reportIntersection(e,t,n,i,r){const s=this.from,a=this.to,o=s.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case px.ALL:this.hasHit=!0,l.set(s,a,e,t,n,i,o),l.hasHit=!0,this.callback(l);break;case px.CLOSEST:(o<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,a,e,t,n,i,o));break;case px.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,a,e,t,n,i,o),l.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,Gx),n.vsub(t,Ax),e.vsub(t,gx);const r=Gx.dot(Gx),s=Gx.dot(Ax),a=Gx.dot(gx),o=Ax.dot(Ax),l=Ax.dot(gx);let c,h;return(c=o*a-s*l)>=0&&(h=r*l-s*a)>=0&&c+h<r*o-s*s}}px.CLOSEST=hx,px.ANY=ux,px.ALL=dx;const fx=new uy,mx=[],Ax=new oy,gx=new oy,vx=new oy,yx=new Ay,xx=new oy,_x=new oy,Ex=new oy,wx=new oy;new oy,new nx;const Cx={faceList:[0]},bx=new oy,Mx=new px,Sx=[],Ix=new oy,Bx=new oy,Tx=new oy;new oy,new oy;const Rx=new oy,Dx=new oy,Lx=new oy,Px=new oy,Fx=new oy,Ux=new oy,Ox=new oy;new uy;const Nx=[],kx=new xy,Gx=new oy,Qx=new oy;class zx{static defaults(e,t){void 0===e&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class Hx{constructor(){this.spatial=new oy,this.rotational=new oy}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Vx{constructor(e,t,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=Vx.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Hx,this.jacobianElementB=new Hx,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,r=e,s=n;this.a=4/(s*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(s*s*r*(1+4*i))}computeB(e,t,n){const i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,s=i.position;return e.spatial.dot(r)+t.spatial.dot(s)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,s=i.velocity,a=n.angularVelocity,o=i.angularVelocity;return e.multiplyVectors(r,a)+t.multiplyVectors(s,o)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,s=i.vlambda,a=n.wlambda,o=i.wlambda;return e.multiplyVectors(r,a)+t.multiplyVectors(s,o)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,s=n.torque,a=i.force,o=i.torque,l=n.invMassSolve,c=i.invMassSolve;return r.scale(l,Wx),a.scale(c,jx),n.invInertiaWorldSolve.vmult(s,Xx),i.invInertiaWorldSolve.vmult(o,Jx),e.multiplyVectors(Wx,Xx)+t.multiplyVectors(jx,Jx)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,s=i.invMassSolve,a=n.invInertiaWorldSolve,o=i.invInertiaWorldSolve;let l=r+s;return a.vmult(e.rotational,qx),l+=qx.dot(e.rotational),o.vmult(t.rotational,qx),l+=qx.dot(t.rotational),l}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,s=Yx;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,s),i.wlambda.addScaledVector(e,s,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,s),r.wlambda.addScaledVector(e,s,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Vx.idCounter=0;const Wx=new oy,jx=new oy,Xx=new oy,Jx=new oy,qx=new oy,Yx=new oy;class Kx extends Vx{constructor(e,t,n){void 0===n&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new oy,this.rj=new oy,this.ni=new oy}computeB(e){const t=this.a,n=this.b,i=this.bi,r=this.bj,s=this.ri,a=this.rj,o=Zx,l=$x,c=i.velocity,h=i.angularVelocity;i.force,i.torque;const u=r.velocity,d=r.angularVelocity;r.force,r.torque;const p=e_,f=this.jacobianElementA,m=this.jacobianElementB,A=this.ni;s.cross(A,o),a.cross(A,l),A.negate(f.spatial),o.negate(f.rotational),m.spatial.copy(A),m.rotational.copy(l),p.copy(r.position),p.vadd(a,p),p.vsub(i.position,p),p.vsub(s,p);const g=A.dot(p),v=this.restitution+1;return-g*t-(v*u.dot(A)-v*c.dot(A)+d.dot(l)-h.dot(o))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=t_,t=n_,n=i_,i=r_,r=s_;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}}const Zx=new oy,$x=new oy,e_=new oy,t_=new oy,n_=new oy,i_=new oy,r_=new oy,s_=new oy;new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy;class a_ extends Vx{constructor(e,t,n){super(e,t,-n,n),this.ri=new oy,this.rj=new oy,this.t=new oy}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=o_,s=l_,a=this.t;n.cross(a,r),i.cross(a,s);const o=this.jacobianElementA,l=this.jacobianElementB;a.negate(o.spatial),r.negate(o.rotational),l.spatial.copy(a),l.rotational.copy(s);return-this.computeGW()*t-e*this.computeGiMf()}}const o_=new oy,l_=new oy;class c_{constructor(e,t,n){n=zx.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=c_.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}c_.idCounter=0;class h_{constructor(e){void 0===e&&(e={});let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=h_.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}h_.idCounter=0,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new px,new oy,new oy,new oy,new oy(1,0,0),new oy(0,1,0),new oy(0,0,1),new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy;class u_ extends yy{constructor(e){if(super({type:yy.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){void 0===t&&(t=new oy);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const r=this.radius,s=["x","y","z"];for(let t=0;t<s.length;t++){const a=s[t];n[a]=e[a]-r,i[a]=e[a]+r}}}new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy;class d_ extends Ey{constructor(e,t,n,i){if(void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const r=i,s=[],a=[],o=[],l=[],c=[],h=Math.cos,u=Math.sin;s.push(new oy(-t*u(0),.5*-n,t*h(0))),l.push(0),s.push(new oy(-e*u(0),.5*n,e*h(0))),c.push(1);for(let i=0;i<r;i++){const d=2*Math.PI/r*(i+1),p=2*Math.PI/r*(i+.5);i<r-1?(s.push(new oy(-t*u(d),.5*-n,t*h(d))),l.push(2*i+2),s.push(new oy(-e*u(d),.5*n,e*h(d))),c.push(2*i+3),o.push([2*i,2*i+1,2*i+3,2*i+2])):o.push([2*i,2*i+1,1,0]),(r%2==1||i<r/2)&&a.push(new oy(-u(p),0,h(p)))}o.push(l),a.push(new oy(0,1,0));const d=[];for(let e=0;e<c.length;e++)d.push(c[c.length-e-1]);o.push(d),super({vertices:s,faces:o,axes:a}),this.type=yy.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class p_ extends yy{constructor(){super({type:yy.types.PLANE}),this.worldNormal=new oy,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return void 0===t&&(t=new oy),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){f_.set(0,0,1),t.vmult(f_,f_);const r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===f_.x?i.x=e.x:-1===f_.x&&(n.x=e.x),1===f_.y?i.y=e.y:-1===f_.y&&(n.y=e.y),1===f_.z?i.z=e.z:-1===f_.z&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const f_=new oy;new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new uy,new oy,new uy,new oy,new oy,new oy,new oy,new oy,new oy,new oy,new uy,new oy,new xy,new uy;class m_{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);-1!==n&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class A_ extends m_{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,s=this.equations,a=s.length,o=t.bodies,l=o.length,c=e;let h,u,d,p,f,m;if(0!==a)for(let e=0;e!==l;e++)o[e].updateSolveMassProperties();const A=v_,g=y_,v=g_;A.length=a,g.length=a,v.length=a;for(let e=0;e!==a;e++){const t=s[e];v[e]=0,g[e]=t.computeB(c),A[e]=1/t.computeC()}if(0!==a){for(let e=0;e!==l;e++){const t=o[e],n=t.vlambda,i=t.wlambda;n.set(0,0,0),i.set(0,0,0)}for(n=0;n!==i;n++){p=0;for(let e=0;e!==a;e++){const t=s[e];h=g[e],u=A[e],m=v[e],f=t.computeGWlambda(),d=u*(h-f-t.eps*m),m+d<t.minForce?d=t.minForce-m:m+d>t.maxForce&&(d=t.maxForce-m),v[e]+=d,p+=d>0?d:-d,t.addToWlambda(d)}if(p*p<r)break}for(let e=0;e!==l;e++){const t=o[e],n=t.velocity,i=t.angularVelocity;t.vlambda.vmul(t.linearFactor,t.vlambda),n.vadd(t.vlambda,n),t.wlambda.vmul(t.angularFactor,t.wlambda),i.vadd(t.wlambda,i)}let e=s.length;const t=1/c;for(;e--;)s[e].multiplier=v[e]*t}return n}}const g_=[],v_=[],y_=[];Uy.STATIC;class x_{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class __ extends x_{constructor(){super(...arguments),this.type=oy}constructObject(){return new oy}}const E_=yy.types.SPHERE,w_=yy.types.SPHERE|yy.types.PLANE,C_=yy.types.BOX|yy.types.BOX,b_=yy.types.SPHERE|yy.types.BOX,M_=yy.types.PLANE|yy.types.BOX,S_=yy.types.CONVEXPOLYHEDRON,I_=yy.types.SPHERE|yy.types.CONVEXPOLYHEDRON,B_=yy.types.PLANE|yy.types.CONVEXPOLYHEDRON,T_=yy.types.BOX|yy.types.CONVEXPOLYHEDRON,R_=yy.types.SPHERE|yy.types.HEIGHTFIELD,D_=yy.types.BOX|yy.types.HEIGHTFIELD,L_=yy.types.CONVEXPOLYHEDRON|yy.types.HEIGHTFIELD,P_=yy.types.PARTICLE|yy.types.SPHERE,F_=yy.types.PLANE|yy.types.PARTICLE,U_=yy.types.BOX|yy.types.PARTICLE,O_=yy.types.PARTICLE|yy.types.CONVEXPOLYHEDRON,N_=yy.types.CYLINDER,k_=yy.types.SPHERE|yy.types.CYLINDER,G_=yy.types.PLANE|yy.types.CYLINDER,Q_=yy.types.BOX|yy.types.CYLINDER,z_=yy.types.CONVEXPOLYHEDRON|yy.types.CYLINDER,H_=yy.types.HEIGHTFIELD|yy.types.CYLINDER,V_=yy.types.PARTICLE|yy.types.CYLINDER,W_=yy.types.SPHERE|yy.types.TRIMESH,j_=yy.types.PLANE|yy.types.TRIMESH;class X_{get[E_](){return this.sphereSphere}get[w_](){return this.spherePlane}get[C_](){return this.boxBox}get[b_](){return this.sphereBox}get[M_](){return this.planeBox}get[S_](){return this.convexConvex}get[I_](){return this.sphereConvex}get[B_](){return this.planeConvex}get[T_](){return this.boxConvex}get[R_](){return this.sphereHeightfield}get[D_](){return this.boxHeightfield}get[L_](){return this.convexHeightfield}get[P_](){return this.sphereParticle}get[F_](){return this.planeParticle}get[U_](){return this.boxParticle}get[O_](){return this.convexParticle}get[N_](){return this.convexConvex}get[k_](){return this.sphereConvex}get[G_](){return this.planeConvex}get[Q_](){return this.boxConvex}get[z_](){return this.convexConvex}get[H_](){return this.heightfieldCylinder}get[V_](){return this.particleCylinder}get[W_](){return this.sphereTrimesh}get[j_](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new __,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,r,s){let a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new Kx(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const o=this.currentContactMaterial;a.restitution=o.restitution,a.setSpookParams(o.contactEquationStiffness,o.contactEquationRelaxation,this.world.dt);const l=n.material||e.material,c=i.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(a.restitution=l.restitution*c.restitution),a.si=r||n,a.sj=s||i,a}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,r=e.si,s=e.sj,a=this.world,o=this.currentContactMaterial;let l=o.friction;const c=r.material||n.material,h=s.material||i.material;if(c&&h&&c.friction>=0&&h.friction>=0&&(l=c.friction*h.friction),l>0){const r=l*(a.frictionGravity||a.gravity).length();let s=n.invMass+i.invMass;s>0&&(s=1/s);const c=this.frictionEquationPool,h=c.length?c.pop():new a_(n,i,r*s),u=c.length?c.pop():new a_(n,i,r*s);return h.bi=u.bi=n,h.bj=u.bj=i,h.minForce=u.minForce=-r*s,h.maxForce=u.maxForce=r*s,h.ri.copy(e.ri),h.rj.copy(e.rj),u.ri.copy(e.ri),u.rj.copy(e.rj),e.ni.tangents(h.t,u.t),h.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),u.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,a.dt),h.enabled=u.enabled=e.enabled,t.push(h,u),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];J_.setZero(),q_.setZero(),Y_.setZero();const r=t.bi;t.bj;for(let n=0;n!==e;n++)t=this.result[this.result.length-1-n],t.bi!==r?(J_.vadd(t.ni,J_),q_.vadd(t.ri,q_),Y_.vadd(t.rj,Y_)):(J_.vsub(t.ni,J_),q_.vadd(t.rj,q_),Y_.vadd(t.ri,Y_));const s=1/e;q_.scale(s,n.ri),Y_.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),J_.normalize(),J_.tangents(n.t,i.t)}getContacts(e,t,n,i,r,s,a){this.contactPointPool=r,this.frictionEquationPool=a,this.result=i,this.frictionResult=s;const o=$_,l=eE,c=K_,h=Z_;for(let i=0,r=e.length;i!==r;i++){const r=e[i],s=t[i];let a=null;r.material&&s.material&&(a=n.getContactMaterial(r.material,s.material)||null);const u=r.type&Uy.KINEMATIC&&s.type&Uy.STATIC||r.type&Uy.STATIC&&s.type&Uy.KINEMATIC||r.type&Uy.KINEMATIC&&s.type&Uy.KINEMATIC;for(let e=0;e<r.shapes.length;e++){r.quaternion.mult(r.shapeOrientations[e],o),r.quaternion.vmult(r.shapeOffsets[e],c),c.vadd(r.position,c);const t=r.shapes[e];for(let e=0;e<s.shapes.length;e++){s.quaternion.mult(s.shapeOrientations[e],l),s.quaternion.vmult(s.shapeOffsets[e],h),h.vadd(s.position,h);const i=s.shapes[e];if(!(t.collisionFilterMask&i.collisionFilterGroup&&i.collisionFilterMask&t.collisionFilterGroup))continue;if(c.distanceTo(h)>t.boundingSphereRadius+i.boundingSphereRadius)continue;let d=null;t.material&&i.material&&(d=n.getContactMaterial(t.material,i.material)||null),this.currentContactMaterial=d||a||n.defaultContactMaterial;const p=this[t.type|i.type];if(p){let e=!1;e=t.type<i.type?p.call(this,t,i,c,h,o,l,r,s,t,i,u):p.call(this,i,t,h,c,l,o,s,r,t,i,u),e&&u&&(n.shapeOverlapKeeper.set(t.id,i.id),n.bodyOverlapKeeper.set(r.id,s.id))}}}}}sphereSphere(e,t,n,i,r,s,a,o,l,c,h){if(h)return n.distanceSquared(i)<(e.radius+t.radius)**2;const u=this.createContactEquation(a,o,e,t,l,c);i.vsub(n,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(e.radius,u.ri),u.rj.scale(-t.radius,u.rj),u.ri.vadd(n,u.ri),u.ri.vsub(a.position,u.ri),u.rj.vadd(i,u.rj),u.rj.vsub(o.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(e,t,n,i,r,s,a,o,l,c,h){const u=this.createContactEquation(a,o,e,t,l,c);if(u.ni.set(0,0,1),s.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.scale(e.radius,u.ri),n.vsub(i,yE),u.ni.scale(u.ni.dot(yE),xE),yE.vsub(xE,u.rj),-yE.dot(u.ni)<=e.radius){if(h)return!0;const e=u.ri,t=u.rj;e.vadd(n,e),e.vsub(a.position,e),t.vadd(i,t),t.vsub(o.position,t),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}}boxBox(e,t,n,i,r,s,a,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,s,a,o,e,t,h)}sphereBox(e,t,n,i,r,s,a,o,l,c,h){const u=this.v3pool,d=BE;n.vsub(i,bE),t.getSideNormals(d,s);const p=e.radius;let f=!1;const m=RE,A=DE,g=LE;let v=null,y=0,x=0,_=0,E=null;for(let e=0,t=d.length;e!==t&&!1===f;e++){const t=ME;t.copy(d[e]);const n=t.length();t.normalize();const i=bE.dot(t);if(i<n+p&&i>0){const r=SE,s=IE;r.copy(d[(e+1)%3]),s.copy(d[(e+2)%3]);const a=r.length(),o=s.length();r.normalize(),s.normalize();const l=bE.dot(r),c=bE.dot(s);if(l<a&&l>-a&&c<o&&c>-o){const e=Math.abs(i-n-p);if((null===E||e<E)&&(E=e,x=l,_=c,v=n,m.copy(t),A.copy(r),g.copy(s),y++,h))return!0}}}if(y){f=!0;const r=this.createContactEquation(a,o,e,t,l,c);m.scale(-p,r.ri),r.ni.copy(m),r.ni.negate(r.ni),m.scale(v,m),A.scale(x,A),m.vadd(A,m),g.scale(_,g),m.vadd(g,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}let w=u.get();const C=TE;for(let r=0;2!==r&&!f;r++)for(let s=0;2!==s&&!f;s++)for(let u=0;2!==u&&!f;u++)if(w.set(0,0,0),r?w.vadd(d[0],w):w.vsub(d[0],w),s?w.vadd(d[1],w):w.vsub(d[1],w),u?w.vadd(d[2],w):w.vsub(d[2],w),i.vadd(w,C),C.vsub(n,C),C.lengthSquared()<p*p){if(h)return!0;f=!0;const r=this.createContactEquation(a,o,e,t,l,c);r.ri.copy(C),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(p,r.ri),r.rj.copy(w),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}u.release(w),w=null;const b=u.get(),M=u.get(),S=u.get(),I=u.get(),B=u.get(),T=d.length;for(let r=0;r!==T&&!f;r++)for(let s=0;s!==T&&!f;s++)if(r%3!=s%3){d[s].cross(d[r],b),b.normalize(),d[r].vadd(d[s],M),S.copy(n),S.vsub(M,S),S.vsub(i,S);const u=S.dot(b);b.scale(u,I);let m=0;for(;m===r%3||m===s%3;)m++;B.copy(n),B.vsub(I,B),B.vsub(M,B),B.vsub(i,B);const A=Math.abs(u),g=B.length();if(A<d[m].length()&&g<p){if(h)return!0;f=!0;const r=this.createContactEquation(a,o,e,t,l,c);M.vadd(I,r.rj),r.rj.copy(r.rj),B.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(n,r.ri),r.ri.normalize(),r.ri.scale(p,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}u.release(b,M,S,I,B)}planeBox(e,t,n,i,r,s,a,o,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,s,a,o,e,t,h)}convexConvex(e,t,n,i,r,s,a,o,l,c,h,u,d){const p=JE;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,s,p,u,d)){const u=[],d=qE;e.clipAgainstHull(n,r,t,i,s,p,-100,100,u);let f=0;for(let r=0;r!==u.length;r++){if(h)return!0;const s=this.createContactEquation(a,o,e,t,l,c),m=s.ri,A=s.rj;p.negate(s.ni),u[r].normal.negate(d),d.scale(u[r].depth,d),u[r].point.vadd(d,m),A.copy(u[r].point),m.vsub(n,m),A.vsub(i,A),m.vadd(n,m),m.vsub(a.position,m),A.vadd(i,A),A.vsub(o.position,A),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(e,t,n,i,r,s,a,o,l,c,h){const u=this.v3pool;n.vsub(i,PE);const d=t.faceNormals,p=t.faces,f=t.vertices,m=e.radius;let A=!1;for(let r=0;r!==f.length;r++){const u=f[r],d=NE;s.vmult(u,d),i.vadd(d,d);const p=OE;if(d.vsub(n,p),p.lengthSquared()<m*m){if(h)return!0;A=!0;const r=this.createContactEquation(a,o,e,t,l,c);return r.ri.copy(p),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(m,r.ri),d.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),void this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(let r=0,g=p.length;r!==g&&!1===A;r++){const g=d[r],v=p[r],y=kE;s.vmult(g,y);const x=GE;s.vmult(f[v[0]],x),x.vadd(i,x);const _=QE;y.scale(-m,_),n.vadd(_,_);const E=zE;_.vsub(x,E);const w=E.dot(y),C=HE;if(n.vsub(x,C),w<0&&C.dot(y)>0){const r=[];for(let e=0,t=v.length;e!==t;e++){const t=u.get();s.vmult(f[v[e]],t),i.vadd(t,t),r.push(t)}if(CE(r,y,n)){if(h)return!0;A=!0;const s=this.createContactEquation(a,o,e,t,l,c);y.scale(-m,s.ri),y.negate(s.ni);const d=u.get();y.scale(-w,d);const p=u.get();y.scale(-m,p),n.vsub(i,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(d,s.rj),s.rj.vadd(i,s.rj),s.rj.vsub(o.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(a.position,s.ri),u.release(d),u.release(p),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)u.release(r[e]);return}for(let d=0;d!==v.length;d++){const p=u.get(),A=u.get();s.vmult(f[v[(d+1)%v.length]],p),s.vmult(f[v[(d+2)%v.length]],A),i.vadd(p,p),i.vadd(A,A);const g=FE;A.vsub(p,g);const y=UE;g.unit(y);const x=u.get(),_=u.get();n.vsub(p,_);const E=_.dot(y);y.scale(E,x),x.vadd(p,x);const w=u.get();if(x.vsub(n,w),E>0&&E*E<g.lengthSquared()&&w.lengthSquared()<m*m){if(h)return!0;const s=this.createContactEquation(a,o,e,t,l,c);x.vsub(i,s.rj),x.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(o.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(a.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)u.release(r[e]);return u.release(p),u.release(A),u.release(x),u.release(w),void u.release(_)}u.release(p),u.release(A),u.release(x),u.release(w),u.release(_)}for(let e=0,t=r.length;e!==t;e++)u.release(r[e])}}}planeConvex(e,t,n,i,r,s,a,o,l,c,h){const u=VE,d=WE;d.set(0,0,1),r.vmult(d,d);let p=0;const f=jE;for(let r=0;r!==t.vertices.length;r++){u.copy(t.vertices[r]),s.vmult(u,u),i.vadd(u,u),u.vsub(n,f);if(d.dot(f)<=0){if(h)return!0;const r=this.createContactEquation(a,o,e,t,l,c),s=XE;d.scale(d.dot(f),s),u.vsub(s,s),s.vsub(n,r.ri),r.ni.copy(d),u.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(e,t,n,i,r,s,a,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,s,a,o,e,t,h)}sphereHeightfield(e,t,n,i,r,s,a,o,l,c,h){const u=t.data,d=e.radius,p=t.elementSize,f=cw,m=lw;xy.pointToLocalFrame(i,s,n,m);let A=Math.floor((m.x-d)/p)-1,g=Math.ceil((m.x+d)/p)+1,v=Math.floor((m.y-d)/p)-1,y=Math.ceil((m.y+d)/p)+1;if(g<0||y<0||A>u.length||v>u[0].length)return;A<0&&(A=0),g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),A>=u.length&&(A=u.length-1),g>=u.length&&(g=u.length-1),y>=u[0].length&&(y=u[0].length-1),v>=u[0].length&&(v=u[0].length-1);const x=[];t.getRectMinMax(A,v,g,y,x);const _=x[0],E=x[1];if(m.z-d>E||m.z+d<_)return;const w=this.result;for(let l=A;l<g;l++)for(let c=v;c<y;c++){const u=w.length;let d=!1;if(t.getConvexTrianglePillar(l,c,!1),xy.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,n,f,r,s,a,o,e,t,h)),h&&d)return!0;if(t.getConvexTrianglePillar(l,c,!0),xy.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,n,f,r,s,a,o,e,t,h)),h&&d)return!0;if(w.length-u>2)return}}boxHeightfield(e,t,n,i,r,s,a,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,s,a,o,e,t,h)}convexHeightfield(e,t,n,i,r,s,a,o,l,c,h){const u=t.data,d=t.elementSize,p=e.boundingSphereRadius,f=aw,m=ow,A=sw;xy.pointToLocalFrame(i,s,n,A);let g=Math.floor((A.x-p)/d)-1,v=Math.ceil((A.x+p)/d)+1,y=Math.floor((A.y-p)/d)-1,x=Math.ceil((A.y+p)/d)+1;if(v<0||x<0||g>u.length||y>u[0].length)return;g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),x<0&&(x=0),g>=u.length&&(g=u.length-1),v>=u.length&&(v=u.length-1),x>=u[0].length&&(x=u[0].length-1),y>=u[0].length&&(y=u[0].length-1);const _=[];t.getRectMinMax(g,y,v,x,_);const E=_[0],w=_[1];if(!(A.z-p>w||A.z+p<E))for(let l=g;l<v;l++)for(let c=y;c<x;c++){let u=!1;if(t.getConvexTrianglePillar(l,c,!1),xy.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,n,f,r,s,a,o,null,null,h,m,null)),h&&u)return!0;if(t.getConvexTrianglePillar(l,c,!0),xy.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,n,f,r,s,a,o,null,null,h,m,null)),h&&u)return!0}}sphereParticle(e,t,n,i,r,s,a,o,l,c,h){const u=$E;u.set(0,0,1),i.vsub(n,u);if(u.lengthSquared()<=e.radius*e.radius){if(h)return!0;const n=this.createContactEquation(o,a,t,e,l,c);u.normalize(),n.rj.copy(u),n.rj.scale(e.radius,n.rj),n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(e,t,n,i,r,s,a,o,l,c,h){const u=YE;u.set(0,0,1),a.quaternion.vmult(u,u);const d=KE;i.vsub(a.position,d);if(u.dot(d)<=0){if(h)return!0;const n=this.createContactEquation(o,a,t,e,l,c);n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0);const r=ZE;u.scale(u.dot(i),r),i.vsub(r,r),n.rj.copy(r),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(e,t,n,i,r,s,a,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,s,a,o,e,t,h)}convexParticle(e,t,n,i,r,s,a,o,l,c,h){let u=-1;const d=nw,p=rw;let f=null;const m=tw;if(m.copy(i),m.vsub(n,m),r.conjugate(ew),ew.vmult(m,m),e.pointIsInside(m)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let t=0,n=e.faces.length;t!==n;t++){const n=[e.worldVertices[e.faces[t][0]]],r=e.worldFaceNormals[t];i.vsub(n[0],iw);const s=-r.dot(iw);if(null===f||Math.abs(s)<Math.abs(f)){if(h)return!0;f=s,u=t,d.copy(r)}}if(-1!==u){const r=this.createContactEquation(o,a,t,e,l,c);d.scale(f,p),p.vadd(i,p),p.vsub(n,p),r.rj.copy(p),d.negate(r.ni),r.ri.set(0,0,0);const s=r.ri,h=r.rj;s.vadd(i,s),s.vsub(o.position,s),h.vadd(n,h),h.vsub(a.position,h),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,r,s,a,o,l,c,h){return this.convexHeightfield(t,e,i,n,s,r,o,a,l,c,h)}particleCylinder(e,t,n,i,r,s,a,o,l,c,h){return this.convexParticle(t,e,i,n,s,r,o,a,l,c,h)}sphereTrimesh(e,t,n,i,r,s,a,o,l,c,h){const u=lE,d=cE,p=hE,f=uE,m=dE,A=pE,g=gE,v=oE,y=sE,x=vE;xy.pointToLocalFrame(i,s,n,m);const _=e.radius;g.lowerBound.set(m.x-_,m.y-_,m.z-_),g.upperBound.set(m.x+_,m.y+_,m.z+_),t.getTrianglesInAABB(g,x);const E=aE,w=e.radius*e.radius;for(let r=0;r<x.length;r++)for(let u=0;u<3;u++)if(t.getVertex(t.indices[3*x[r]+u],E),E.vsub(m,y),y.lengthSquared()<=w){if(v.copy(E),xy.pointToWorldFrame(i,s,v,E),E.vsub(n,y),h)return!0;let r=this.createContactEquation(a,o,e,t,l,c);r.ni.copy(y),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),r.rj.copy(E),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(let r=0;r<x.length;r++)for(let g=0;g<3;g++){t.getVertex(t.indices[3*x[r]+g],u),t.getVertex(t.indices[3*x[r]+(g+1)%3],d),d.vsub(u,p),m.vsub(d,A);const v=A.dot(p);m.vsub(u,A);let y=A.dot(p);if(y>0&&v<0){m.vsub(u,A),f.copy(p),f.normalize(),y=A.dot(f),f.scale(y,A),A.vadd(u,A);if(A.distanceTo(m)<e.radius){if(h)return!0;const r=this.createContactEquation(a,o,e,t,l,c);A.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),xy.pointToWorldFrame(i,s,A,A),A.vsub(o.position,r.rj),xy.vectorToWorldFrame(s,r.ni,r.ni),xy.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}}const C=fE,b=mE,M=AE,S=rE;for(let r=0,u=x.length;r!==u;r++){t.getTriangleVertices(x[r],C,b,M),t.getNormal(x[r],S),m.vsub(C,A);let u=A.dot(S);if(S.scale(u,A),m.vsub(A,A),u=A.distanceTo(m),px.pointInTriangle(A,C,b,M)&&u<e.radius){if(h)return!0;let r=this.createContactEquation(a,o,e,t,l,c);A.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(a.position,r.ri),xy.pointToWorldFrame(i,s,A,A),A.vsub(o.position,r.rj),xy.vectorToWorldFrame(s,r.ni,r.ni),xy.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}x.length=0}planeTrimesh(e,t,n,i,r,s,a,o,l,c,h){const u=new oy,d=tE;d.set(0,0,1),r.vmult(d,d);for(let r=0;r<t.vertices.length/3;r++){t.getVertex(r,u);const p=new oy;p.copy(u),xy.pointToWorldFrame(i,s,p,u);const f=nE;u.vsub(n,f);if(d.dot(f)<=0){if(h)return!0;const n=this.createContactEquation(a,o,e,t,l,c);n.ni.copy(d);const i=iE;d.scale(f.dot(d),i),u.vsub(i,i),n.ri.copy(i),n.ri.vsub(a.position,n.ri),n.rj.copy(u),n.rj.vsub(o.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const J_=new oy,q_=new oy,Y_=new oy,K_=new oy,Z_=new oy,$_=new Ay,eE=new Ay,tE=new oy,nE=new oy,iE=new oy,rE=new oy,sE=new oy;new oy;const aE=new oy,oE=new oy,lE=new oy,cE=new oy,hE=new oy,uE=new oy,dE=new oy,pE=new oy,fE=new oy,mE=new oy,AE=new oy,gE=new uy,vE=[],yE=new oy,xE=new oy,_E=new oy,EE=new oy,wE=new oy;function CE(e,t,n){let i=null;const r=e.length;for(let s=0;s!==r;s++){const a=e[s],o=_E;e[(s+1)%r].vsub(a,o);const l=EE;o.cross(t,l);const c=wE;n.vsub(a,c);const h=l.dot(c);if(!(null===i||h>0&&!0===i||h<=0&&!1===i))return!1;null===i&&(i=h>0)}return!0}const bE=new oy,ME=new oy,SE=new oy,IE=new oy,BE=[new oy,new oy,new oy,new oy,new oy,new oy],TE=new oy,RE=new oy,DE=new oy,LE=new oy,PE=new oy,FE=new oy,UE=new oy,OE=new oy,NE=new oy,kE=new oy,GE=new oy,QE=new oy,zE=new oy,HE=new oy;new oy,new oy;const VE=new oy,WE=new oy,jE=new oy,XE=new oy,JE=new oy,qE=new oy,YE=new oy,KE=new oy,ZE=new oy,$E=new oy,ew=new Ay,tw=new oy;new oy;const nw=new oy,iw=new oy,rw=new oy,sw=new oy,aw=new oy,ow=[0],lw=new oy,cw=new oy;class hw{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let e=i.length-1;e>=r;e--)i[e+1]=i[e];i[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,r=n.length,s=i.length;let a=0;for(let t=0;t<r;t++){let r=!1;const s=n[t];for(;s>i[a];)a++;r=s===i[a],r||uw(e,s)}a=0;for(let e=0;e<s;e++){let r=!1;const s=i[e];for(;s>n[a];)a++;r=n[a]===s,r||uw(t,s)}}}function uw(e,t){e.push((4294901760&t)>>16,65535&t)}const dw=(e,t)=>e<t?`${e}-${t}`:`${t}-${e}`;class pw{constructor(){this.data={keys:[]}}get(e,t){const n=dw(e,t);return this.data[n]}set(e,t,n){const i=dw(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=dw(e,t),i=this.data.keys.indexOf(n);-1!==i&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;){delete e[t.pop()]}}}class fw extends my{constructor(e){void 0===e&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new oy,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new oy,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=void 0!==e.broadphase?e.broadphase:new tx,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new A_,this.constraints=[],this.narrowphase=new X_(this),this.collisionMatrix=new fy,this.collisionMatrixPrevious=new fy,this.bodyOverlapKeeper=new hw,this.shapeOverlapKeeper=new hw,this.contactmaterials=[],this.contactMaterialTable=new pw,this.defaultMaterial=new h_("default"),this.defaultContactMaterial=new c_(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof nx?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return void 0===n&&(n={}),n.mode=px.ALL,n.from=e,n.to=t,n.callback=i,mw.intersectWorld(this,n)}raycastAny(e,t,n,i){return void 0===n&&(n={}),n.mode=px.ANY,n.from=e,n.to=t,n.result=i,mw.intersectWorld(this,n)}raycastClosest(e,t,n,i){return void 0===n&&(n={}),n.mode=px.CLOSEST,n.from=e,n.to=t,n.result=i,mw.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Uy&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(-1!==i){n.splice(i,1);for(let e=0;e!==n.length;e++)n[e].index=e;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let t=0;t<i.length;t++){const n=i[t];if(n.id===e)return n}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);-1!==t&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){void 0===e&&(e=1/60),void 0===t&&(t=10);const n=Aw.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(e,i,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(void 0===n&&(n=10),void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=Aw.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(Aw.now()-i>1e3*e)););this.accumulator=this.accumulator%e;const s=this.accumulator/e;for(let e=0;e!==this.bodies.length;e++){const t=this.bodies[e];t.previousPosition.lerp(t.position,s,t.interpolatedPosition),t.previousQuaternion.slerp(t.quaternion,s,t.interpolatedQuaternion),t.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=Ew,i=ww,r=this.bodies.length,s=this.bodies,a=this.solver,o=this.gravity,l=this.doProfiling,c=this.profile,h=Uy.DYNAMIC;let u=-1/0;const d=this.constraints,p=_w;o.length();const f=o.x,m=o.y,A=o.z;let g=0;for(l&&(u=Aw.now()),g=0;g!==r;g++){const e=s[g];if(e.type===h){const t=e.force,n=e.mass;t.x+=n*f,t.y+=n*m,t.z+=n*A}}for(let e=0,t=this.subsystems.length;e!==t;e++)this.subsystems[e].update();l&&(u=Aw.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),l&&(c.broadphase=Aw.now()-u);let v=d.length;for(g=0;g!==v;g++){const e=d[g];if(!e.collideConnected)for(let t=n.length-1;t>=0;t-=1)(e.bodyA===n[t]&&e.bodyB===i[t]||e.bodyB===n[t]&&e.bodyA===i[t])&&(n.splice(t,1),i.splice(t,1))}this.collisionMatrixTick(),l&&(u=Aw.now());const y=xw,x=t.length;for(g=0;g!==x;g++)y.push(t[g]);t.length=0;const _=this.frictionEquations.length;for(g=0;g!==_;g++)p.push(this.frictionEquations[g]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,y,this.frictionEquations,p),l&&(c.narrowphase=Aw.now()-u),l&&(u=Aw.now()),g=0;g<this.frictionEquations.length;g++)a.addEquation(this.frictionEquations[g]);const E=t.length;for(let e=0;e!==E;e++){const n=t[e],i=n.bi,r=n.bj,s=n.si,o=n.sj;let l;if(l=i.material&&r.material&&this.getContactMaterial(i.material,r.material)||this.defaultContactMaterial,l.friction,i.material&&r.material&&(i.material.friction>=0&&r.material.friction>=0&&(i.material.friction,r.material.friction),i.material.restitution>=0&&r.material.restitution>=0&&(n.restitution=i.material.restitution*r.material.restitution)),a.addEquation(n),i.allowSleep&&i.type===Uy.DYNAMIC&&i.sleepState===Uy.SLEEPING&&r.sleepState===Uy.AWAKE&&r.type!==Uy.STATIC){r.velocity.lengthSquared()+r.angularVelocity.lengthSquared()>=2*r.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0)}if(r.allowSleep&&r.type===Uy.DYNAMIC&&r.sleepState===Uy.SLEEPING&&i.sleepState===Uy.AWAKE&&i.type!==Uy.STATIC){i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(r.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(i,r,!0),this.collisionMatrixPrevious.get(i,r)||(yw.body=r,yw.contact=n,i.dispatchEvent(yw),yw.body=i,r.dispatchEvent(yw)),this.bodyOverlapKeeper.set(i.id,r.id),this.shapeOverlapKeeper.set(s.id,o.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=Aw.now()-u,u=Aw.now()),g=0;g!==r;g++){const e=s[g];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(v=d.length,g=0;g!==v;g++){const e=d[g];e.update();for(let t=0,n=e.equations.length;t!==n;t++){const n=e.equations[t];a.addEquation(n)}}a.solve(e,this),l&&(c.solve=Aw.now()-u),a.removeAllEquations();const w=Math.pow;for(g=0;g!==r;g++){const t=s[g];if(t.type&h){const n=w(1-t.linearDamping,e),i=t.velocity;i.scale(n,i);const r=t.angularVelocity;if(r){const n=w(1-t.angularDamping,e);r.scale(n,r)}}}this.dispatchEvent(vw),l&&(u=Aw.now());const C=this.stepnumber%(this.quatNormalizeSkip+1)==0,b=this.quatNormalizeFast;for(g=0;g!==r;g++)s[g].integrate(e,C,b);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=Aw.now()-u),this.stepnumber+=1,this.dispatchEvent(gw);let M=!0;if(this.allowSleep)for(M=!1,g=0;g!==r;g++){const e=s[g];e.sleepTick(this.time),e.sleepState!==Uy.SLEEPING&&(M=!0)}this.hasActiveBodies=M}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Cw,bw),e){for(let e=0,t=Cw.length;e<t;e+=2)Mw.bodyA=this.getBodyById(Cw[e]),Mw.bodyB=this.getBodyById(Cw[e+1]),this.dispatchEvent(Mw);Mw.bodyA=Mw.bodyB=null}if(t){for(let e=0,t=bw.length;e<t;e+=2)Sw.bodyA=this.getBodyById(bw[e]),Sw.bodyB=this.getBodyById(bw[e+1]),this.dispatchEvent(Sw);Sw.bodyA=Sw.bodyB=null}Cw.length=bw.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Cw,bw),n){for(let e=0,t=Cw.length;e<t;e+=2){const t=this.getShapeById(Cw[e]),n=this.getShapeById(Cw[e+1]);Iw.shapeA=t,Iw.shapeB=n,t&&(Iw.bodyA=t.body),n&&(Iw.bodyB=n.body),this.dispatchEvent(Iw)}Iw.bodyA=Iw.bodyB=Iw.shapeA=Iw.shapeB=null}if(i){for(let e=0,t=bw.length;e<t;e+=2){const t=this.getShapeById(bw[e]),n=this.getShapeById(bw[e+1]);Bw.shapeA=t,Bw.shapeB=n,t&&(Bw.bodyA=t.body),n&&(Bw.bodyB=n.body),this.dispatchEvent(Bw)}Bw.bodyA=Bw.bodyB=Bw.shapeA=Bw.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const t=e[n];t.force,t.torque,t.force.set(0,0,0),t.torque.set(0,0,0)}}}new uy;const mw=new px,Aw=globalThis.performance||{};if(!Aw.now){let e=Date.now();Aw.timing&&Aw.timing.navigationStart&&(e=Aw.timing.navigationStart),Aw.now=()=>Date.now()-e}new oy;const gw={type:"postStep"},vw={type:"preStep"},yw={type:Uy.COLLIDE_EVENT_NAME,body:null,contact:null},xw=[],_w=[],Ew=[],ww=[],Cw=[],bw=[],Mw={type:"beginContact",bodyA:null,bodyB:null},Sw={type:"endContact",bodyA:null,bodyB:null},Iw={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Bw={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var Tw,Rw={exports:{}},Dw={exports:{}};function Lw(){return Tw||(Tw=1,function(e){!function(t,n){e.exports?e.exports=n():t.EvEmitter=n()}("undefined"!=typeof window?window:UA,(function(){function e(){}let t=e.prototype;return t.on=function(e,t){if(!e||!t)return this;let n=this._events=this._events||{},i=n[e]=n[e]||[];return i.includes(t)||i.push(t),this},t.once=function(e,t){if(!e||!t)return this;this.on(e,t);let n=this._onceEvents=this._onceEvents||{};return(n[e]=n[e]||{})[t]=!0,this},t.off=function(e,t){let n=this._events&&this._events[e];if(!n||!n.length)return this;let i=n.indexOf(t);return-1!=i&&n.splice(i,1),this},t.emitEvent=function(e,t){let n=this._events&&this._events[e];if(!n||!n.length)return this;n=n.slice(0),t=t||[];let i=this._onceEvents&&this._onceEvents[e];for(let r of n){i&&i[r]&&(this.off(e,r),delete i[r]),r.apply(this,t)}return this},t.allOff=function(){return delete this._events,delete this._onceEvents,this},e}))}(Dw)),Dw.exports}
/*!
	 * imagesLoaded v5.0.0
	 * JavaScript is all like "You images are done yet or what?"
	 * MIT License
	 */!function(e){!function(t,n){e.exports?e.exports=n(t,Lw()):t.imagesLoaded=n(t,t.EvEmitter)}("undefined"!=typeof window?window:UA,(function(e,t){let n=e.jQuery,i=e.console;function r(e,t,s){if(!(this instanceof r))return new r(e,t,s);let a=e;"string"==typeof e&&(a=document.querySelectorAll(e)),a?(this.elements=function(e){return Array.isArray(e)?e:"object"==typeof e&&"number"==typeof e.length?[...e]:[e]}(a),this.options={},"function"==typeof t?s=t:Object.assign(this.options,t),s&&this.on("always",s),this.getImages(),n&&(this.jqDeferred=new n.Deferred),setTimeout(this.check.bind(this))):i.error(`Bad element for imagesLoaded ${a||e}`)}r.prototype=Object.create(t.prototype),r.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};const s=[1,9,11];r.prototype.addElementImages=function(e){"IMG"===e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);let{nodeType:t}=e;if(!t||!s.includes(t))return;let n=e.querySelectorAll("img");for(let e of n)this.addImage(e);if("string"==typeof this.options.background){let t=e.querySelectorAll(this.options.background);for(let e of t)this.addElementBackgroundImages(e)}};const a=/url\((['"])?(.*?)\1\)/gi;function o(e){this.img=e}function l(e,t){this.url=e,this.element=t,this.img=new Image}return r.prototype.addElementBackgroundImages=function(e){let t=getComputedStyle(e);if(!t)return;let n=a.exec(t.backgroundImage);for(;null!==n;){let i=n&&n[2];i&&this.addBackground(i,e),n=a.exec(t.backgroundImage)}},r.prototype.addImage=function(e){let t=new o(e);this.images.push(t)},r.prototype.addBackground=function(e,t){let n=new l(e,t);this.images.push(n)},r.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length)return void this.complete();let e=(e,t,n)=>{setTimeout((()=>{this.progress(e,t,n)}))};this.images.forEach((function(t){t.once("progress",e),t.check()}))},r.prototype.progress=function(e,t,n){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&i&&i.log(`progress: ${n}`,e,t)},r.prototype.complete=function(){let e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){let e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},o.prototype=Object.create(t.prototype),o.prototype.check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src)},o.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},o.prototype.confirm=function(e,t){this.isLoaded=e;let{parentNode:n}=this.img,i="PICTURE"===n.nodeName?n:this.img;this.emitEvent("progress",[this,i,t])},o.prototype.handleEvent=function(e){let t="on"+e.type;this[t]&&this[t](e)},o.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},o.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},o.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},l.prototype=Object.create(o.prototype),l.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},l.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},l.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},r.makeJQueryPlugin=function(t){(t=t||e.jQuery)&&(n=t,n.fn.imagesLoaded=function(e,t){return new r(this,e,t).jqDeferred.promise(n(this))})},r.makeJQueryPlugin(),r}))}(Rw);var Pw=OA(Rw.exports);const Fw=(e="div")=>new Promise((t=>{Pw(e,{background:!0},t)})),Uw=e=>{e.preventDefault(),e.stopPropagation()},Ow=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"Mobile":"Desktop",Nw=(e=100,t,n=3)=>Float32Array.from({length:e*n},((e,n)=>t(n))),kw=e=>e instanceof ot||e instanceof Ot||e instanceof Rt,Gw=e=>Array.isArray(e)?e:kw(e)?e.toArray():[e,e,e],Qw=e=>e&&e.constructor===Float32Array,zw=e=>[e.r,e.g,e.b],Hw=(e,t,n)=>{if(void 0!==t){if(Qw(t))return t;if(t instanceof ni){const n=Array.from({length:3*e},(()=>zw(t))).flat();return Float32Array.from(n)}if(kw(t)||Array.isArray(t)){const n=Array.from({length:3*e},(()=>Gw(t))).flat();return Float32Array.from(n)}return Float32Array.from({length:e},(()=>t))}return Float32Array.from({length:e},n)},Vw=(e,t={})=>{const{unsuspend:n="loadedmetadata",crossOrigin:i="Anonymous",loop:r=!0,muted:s=!0,start:a=!0}=t;return new Promise((o=>{const l=Object.assign(document.createElement("video"),{src:e,crossOrigin:i,loop:r,muted:s,...t}),c=new ol(l);l.addEventListener(n,(()=>{a&&c.image.play(),o(c)}))}))};let Ww=null;const jw=e=>{e.outputColorSpace?e.outputColorSpace=De:e.outputEncoding=Be},Xw=e=>{jw(e),e.toneMapping=4},Jw=(e,t)=>{const n=document.createElement("a");document.body.appendChild(n),n.style.display="none";const i=window.URL.createObjectURL(e);n.href=i,n.download=t,n.click()},qw=(e,t=!0)=>{const n=(new Gt).setFromObject(e,t),i=new Ot,r=new sn;n.getCenter(i),n.getBoundingSphere(r);return{boundingBox:n,center:i,boundingSphere:r,width:n.max.x-n.min.x,height:n.max.y-n.min.y,depth:n.max.z-n.min.z}},Yw=e=>{let t=[];return t.push(new Ot(e.min.x,e.min.y,e.min.z)),t.push(new Ot(e.min.x,e.min.y,e.max.z)),t.push(new Ot(e.min.x,e.max.y,e.min.z)),t.push(new Ot(e.min.x,e.max.y,e.max.z)),t.push(new Ot(e.max.x,e.min.y,e.min.z)),t.push(new Ot(e.max.x,e.min.y,e.max.z)),t.push(new Ot(e.max.x,e.max.y,e.min.z)),t.push(new Ot(e.max.x,e.max.y,e.max.z)),t},Kw=(e,t)=>{Jw(new Blob([e],{type:"text/plain"}),t)},Zw=(e,t)=>{Jw(new Blob([e],{type:"application/octet-stream"}),t)},$w=1/6,eC=e=>0|Math.floor(e),tC=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);const nC=function(e=Math.random){const t=function(e){const t=512,n=new Uint8Array(t);for(let e=0;e<t/2;e++)n[e]=e;for(let i=0;i<t/2-1;i++){const t=i+~~(e()*(256-i)),r=n[i];n[i]=n[t],n[t]=r}for(let e=256;e<t;e++)n[e]=n[e-256];return n}(e),n=new Float64Array(t).map((e=>tC[e%12*3])),i=new Float64Array(t).map((e=>tC[e%12*3+1])),r=new Float64Array(t).map((e=>tC[e%12*3+2]));return function(e,s,a){let o,l,c,h;const u=.3333333333333333*(e+s+a),d=eC(e+u),p=eC(s+u),f=eC(a+u),m=(d+p+f)*$w,A=e-(d-m),g=s-(p-m),v=a-(f-m);let y,x,_,E,w,C;A>=g?g>=v?(y=1,x=0,_=0,E=1,w=1,C=0):A>=v?(y=1,x=0,_=0,E=1,w=0,C=1):(y=0,x=0,_=1,E=1,w=0,C=1):g<v?(y=0,x=0,_=1,E=0,w=1,C=1):A<v?(y=0,x=1,_=0,E=0,w=1,C=1):(y=0,x=1,_=0,E=1,w=1,C=0);const b=A-y+$w,M=g-x+$w,S=v-_+$w,I=A-E+2*$w,B=g-w+2*$w,T=v-C+2*$w,R=A-1+.5,D=g-1+.5,L=v-1+.5,P=255&d,F=255&p,U=255&f;let O=.6-A*A-g*g-v*v;if(O<0)o=0;else{const e=P+t[F+t[U]];O*=O,o=O*O*(n[e]*A+i[e]*g+r[e]*v)}let N=.6-b*b-M*M-S*S;if(N<0)l=0;else{const e=P+y+t[F+x+t[U+_]];N*=N,l=N*N*(n[e]*b+i[e]*M+r[e]*S)}let k=.6-I*I-B*B-T*T;if(k<0)c=0;else{const e=P+E+t[F+w+t[U+C]];k*=k,c=k*k*(n[e]*I+i[e]*B+r[e]*T)}let G=.6-R*R-D*D-L*L;if(G<0)h=0;else{const e=P+1+t[F+1+t[U+1]];G*=G,h=G*G*(n[e]*R+i[e]*D+r[e]*L)}return 32*(o+l+c+h)}}(),iC=(e,t,n)=>{e=2*Math.PI*(e-.5),t=2*Math.PI*(t-.5);const i=1+Math.cosh(e)*Math.cosh(t),r=Math.sinh(t)*Math.cos(5*e)/i,s=Math.sinh(t)*Math.sin(5*e)/i,a=Math.cosh(t)*Math.sinh(e)/i;n.set(r,a,s)},rC=(e,t,n)=>{const i=.6,r=2*e*Math.PI,s=2*t*Math.PI,a=Math.cos(r)*Math.cos(s),o=Math.cos(r)*Math.sin(s),l=Math.sin(r),c=1*a/Math.sqrt(1-i*o**2-i*l**2),h=1*o/Math.sqrt(1-i*a**2-i*l**2),u=1*l/Math.sqrt(1-i*Math.cos(r)**2);n.set(h,u,c)},sC=new Ot,aC=new Ot,oC=new Ot,lC=(e,t)=>{const n=sC.setFromMatrixPosition(e.matrixWorld);n.project(t);const i=window.innerWidth/2,r=window.innerHeight/2,s=n.x*i+i,a=-n.y*r+r;return new ot(s,a)},cC=(e,t)=>{const n=sC.setFromMatrixPosition(e.matrixWorld),i=aC.setFromMatrixPosition(t.matrixWorld),r=n.sub(i),s=t.getWorldDirection(oC);return r.angleTo(s)>Math.PI/2},hC=(e,t,n,i)=>{const r=sC.setFromMatrixPosition(e.matrixWorld),s=r.clone();s.project(t),n.setFromCamera(s,t);const a=n.intersectObjects(i,!0);if(a.length){const e=a[0].distance;return r.distanceTo(n.ray.origin)<e}return!0},uC=(e,t,n=[16777271,0])=>{if(t instanceof Zi||t instanceof wr){const i=sC.setFromMatrixPosition(e.matrixWorld),r=aC.setFromMatrixPosition(t.matrixWorld),s=i.distanceTo(r),a=(n[1]-n[0])/(t.far-t.near),o=n[1]-a*t.far;return Math.round(a*s+o)}},dC=(e,t)=>{if(t instanceof wr)return t.zoom;if(t instanceof Zi){const n=sC.setFromMatrixPosition(e.matrixWorld),i=aC.setFromMatrixPosition(t.matrixWorld),r=t.fov*Math.PI/180,s=n.distanceTo(i);return 1/(2*Math.tan(r/2)*s)}return 1},pC=e=>{const t=window.innerHeight/2;return e.projectionMatrix.elements[5]*t},fC=e=>Math.abs(e)<1e-10?0:e,mC=(e,t,n="")=>{let i="matrix3d(";for(let n=0;16!==n;n++)i+=fC(t[n]*e.elements[n])+(15!==n?",":")");return n+i},AC=(gC=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>mC(e,gC));var gC;const vC=(e,t)=>{return mC(e,[1/(n=t),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n};class yC extends Zu{config;resourceList;items;toLoad;loaded;loaders;constructor(e,t,n={}){super(e);const{useDracoLoader:i=!1,useMeshoptDecoder:r=!1,dracoDecoderPath:s="https://www.gstatic.com/draco/versioned/decoders/1.4.3/",ktx2TranscoderPath:a="https://unpkg.com/three/examples/jsm/libs/basis/"}=n;this.config={useDracoLoader:i,useMeshoptDecoder:r,dracoDecoderPath:s,ktx2TranscoderPath:a},this.resourceList=t,this.items={},this.toLoad=t.length,this.loaded=0,this.loaders={},this.setLoaders(),i&&this.setDracoLoader(),r&&this.setMeshoptDecoder(),this.setKTX2Loader(),this.startLoading()}setLoaders(){this.loaders.gltfLoader=new of,this.loaders.textureLoader=new vh,this.loaders.cubeTextureLoader=new Ah,this.loaders.fontLoader=new Um,this.loaders.fbxLoader=new kv,this.loaders.audioLoader=new Jh,this.loaders.objLoader=new SA,this.loaders.hdrTextureLoader=new pA,this.loaders.svgLoader=new AA,this.loaders.exrLoader=new mA,this.loaders.ktx2Loader=new lA}setDracoLoader(){const e=new BA;e.setDecoderPath(this.config.dracoDecoderPath),this.loaders.gltfLoader?.setDRACOLoader(e)}setMeshoptDecoder(){const e=(()=>{if(RA)return RA;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let n,i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(i="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");const r=WebAssembly.instantiate(function(e){const n=new Uint8Array(e.length);for(let t=0;t<e.length;++t){const i=e.charCodeAt(t);n[t]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let i=0;for(let r=0;r<e.length;++r)n[i++]=n[r]<60?t[n[r]]:64*(n[r]-60)+n[++r];return n.buffer.slice(0,i)}(i),{}).then((e=>{n=e.instance,n.exports.__wasm_call_ctors()}));function s(e,t,i,r,s,a){const o=n.exports.sbrk,l=i+3&-4,c=o(l*r),h=o(s.length),u=new Uint8Array(n.exports.memory.buffer);u.set(s,h);const d=e(c,i,r,h,s.length);if(0===d&&a&&a(c,l,r),t.set(u.subarray(c,c+i*r)),o(c-o(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}const a={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return RA={ready:r,supported:!0,decodeVertexBuffer(e,t,i,r,o){s(n.exports.meshopt_decodeVertexBuffer,e,t,i,r,n.exports[a[o]])},decodeIndexBuffer(e,t,i,r){s(n.exports.meshopt_decodeIndexBuffer,e,t,i,r)},decodeIndexSequence(e,t,i,r){s(n.exports.meshopt_decodeIndexSequence,e,t,i,r)},decodeGltfBuffer(e,t,i,r,l,c){s(n.exports[o[l]],e,t,i,r,n.exports[a[c]])}},RA})();this.loaders.gltfLoader?.setMeshoptDecoder(e)}setKTX2Loader(){this.loaders.ktx2Loader?.setTranscoderPath(this.config.ktx2TranscoderPath)?.detectSupport(this.base.renderer),this.loaders.ktx2Loader&&this.loaders.gltfLoader?.setKTX2Loader(this.loaders.ktx2Loader)}startLoading(){for(const e of this.resourceList)"gltfModel"===e.type?this.loaders.gltfLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"texture"===e.type?this.loaders.textureLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"cubeTexture"===e.type?this.loaders.cubeTextureLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"font"===e.type?this.loaders.fontLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"fbxModel"===e.type?this.loaders.fbxLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"audio"===e.type?this.loaders.audioLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"objModel"===e.type?this.loaders.objLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"hdrTexture"===e.type?this.loaders.hdrTextureLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"svg"===e.type?this.loaders.svgLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"exrTexture"===e.type?this.loaders.exrLoader?.load(e.path,(t=>{this.resourceLoaded(e,t)})):"video"===e.type?Vw(e.path).then((t=>{this.resourceLoaded(e,t)})):"ktx2Texture"===e.type&&this.loaders.ktx2Loader?.load(e.path,(t=>{this.resourceLoaded(e,t)}))}resourceLoaded(e,t){this.items[e.name]=t,this.loaded+=1,this.isLoaded&&this.emit("ready")}get loadProgress(){return this.loaded/this.toLoad}get isLoaded(){return this.loaded===this.toLoad}}class xC extends Zu{top;right;bottom;left;front;back;disable;disableX;disableY;disableZ;precise;group;groupOuter;groupInner;bound;constructor(e,t={}){super(e);const{top:n=!1,right:i=!1,bottom:r=!1,left:s=!1,front:a=!1,back:o=!1,disable:l=!1,disableX:c=!1,disableY:h=!1,disableZ:u=!1,precise:d=!0}=t;this.top=n,this.right=i,this.bottom=r,this.left=s,this.front=a,this.back=o,this.disable=l,this.disableX=c,this.disableY=h,this.disableZ=u,this.precise=d;const p=new Na;this.group=p;const f=new Na;this.groupOuter=f;const m=new Na;this.groupInner=m,this.bound=null,this.adjustPosition()}addExisting(){this.container.add(this.group),this.group.add(this.groupOuter),this.groupOuter.add(this.groupInner),this.adjustPosition()}add(...e){this.groupInner.add(...e),this.adjustPosition()}adjustPosition(){const{top:e,right:t,bottom:n,left:i,front:r,back:s,disable:a,disableX:o,disableY:l,disableZ:c,precise:h}=this;this.groupOuter.matrix.identity();const u=qw(this.groupInner,h);this.bound=u;const{center:d,width:p,height:f,depth:m}=u,A=e?f/2:n?-f/2:0,g=i?-p/2:t?p/2:0,v=r?m/2:s?-m/2:0;this.groupOuter.position.set(a||o?0:-d.x+g,a||l?0:-d.y+A,a||c?0:-d.z+v)}}class _C extends Zu{clock;deltaTime;elapsedTime;constructor(e){super(e);const t=new Zh;this.clock=t,this.deltaTime=0,this.elapsedTime=0}update(e){const t=this.clock.getElapsedTime(),n=t-this.elapsedTime;this.deltaTime=n,this.elapsedTime=t,this.emit("tick")}}class EC{constructor(e,t,n){this.variables=[],this.currentTextureIndex=0;let i=T;const r=new qa,s=new Ki;s.position.z=1;const a={passThruTexture:{value:null}},o=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),l=new Hi(new dr(2,2),o);function c(n){n.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(e,t){const n=new Yi({name:"GPUComputationShader",uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(n),n}r.add(l),this.setDataType=function(e){return i=e,this},this.addVariable=function(e,t,n){const i={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:y,magFilter:y};return this.variables.push(i),i},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===n.capabilities.isWebGL2&&!1===n.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let n=0;n<this.variables.length;n++){const i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);const r=i.material,s=r.uniforms;if(null!==i.dependencies)for(let e=0;e<i.dependencies.length;e++){const t=i.dependencies[e];if(t.name!==i.name){let e=!1;for(let n=0;n<this.variables.length;n++)if(t.name===this.variables[n].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+i.name+", dependency="+t.name}s[t.name]={value:null},r.fragmentShader="\nuniform sampler2D "+t.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let n=0,i=this.variables.length;n<i;n++){const i=this.variables[n];if(null!==i.dependencies){const t=i.material.uniforms;for(let n=0,r=i.dependencies.length;n<r;n++){const r=i.dependencies[n];t[r.name].value=r.renderTargets[e].texture}}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();const e=this.variables;for(let t=0;t<e.length;t++){const n=e[t];n.initialValueTexture&&n.initialValueTexture.dispose();const i=n.renderTargets;for(let e=0;e<i.length;e++){i[e].dispose()}}},this.addResolutionDefine=c,this.createShaderMaterial=h,this.createRenderTarget=function(n,r,s,a,o,l){return new Lt(n=n||e,r=r||t,{wrapS:s=s||g,wrapT:a=a||g,minFilter:o=o||y,magFilter:l=l||y,format:F,type:i,depthBuffer:!1})},this.createTexture=function(){const n=new Float32Array(e*t*4),i=new To(n,e,t,F,T);return i.needsUpdate=!0,i},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){const i=n.getRenderTarget(),a=n.xr.enabled,c=n.shadowMap.autoUpdate;n.xr.enabled=!1,n.shadowMap.autoUpdate=!1,l.material=e,n.setRenderTarget(t),n.render(r,s),l.material=o,n.xr.enabled=a,n.shadowMap.autoUpdate=c,n.setRenderTarget(i)}}}class wC extends Zu{shadertoyUniforms;constructor(e){super(e),this.shadertoyUniforms={iGlobalTime:{value:0},iTime:{value:0},iTimeDelta:{value:0},iResolution:{value:new Ot(window.innerWidth,window.innerHeight,1)},iMouse:{value:new Rt(0,0,0,0)},iFrame:{value:0},iDate:{value:new Rt((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate(),(new Date).getHours())},iSampleRate:{value:44100},iChannelTime:{value:[0,0,0,0]}}}injectShadertoyUniforms(e=this.shadertoyUniforms){const t=this.base.clock.elapsedTime;e.iGlobalTime.value=t,e.iTime.value=t;const n=this.base.clock.deltaTime;e.iTimeDelta.value=n,e.iResolution.value=new Ot(window.innerWidth,window.innerHeight,1);const{x:i,y:r}=this.base.iMouse.mouse;e.iMouse.value=new Rt(i,r,0,0),e.iDate.value=new Rt((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate(),(new Date).getHours()),e.iChannelTime.value=[t,t,t,t],e.iFrame.value+=1}}class CC extends Zu{mouse;mouseDOM;mouseScreen;prevMouseDOM;isMouseMoving;mouseMoveOffset;mouseDOMDelta;constructor(e){super(e);const t=new ot(0,0);this.mouse=t;const n=new ot(0,0);this.mouseDOM=n;const i=new ot(0,0);this.mouseScreen=i,this.prevMouseDOM=new ot(0,0),this.isMouseMoving=!1,this.mouseMoveOffset=4,this.mouseDOMDelta=new ot(0,0)}getMouse(e,t){return new ot(e,window.innerHeight-t)}getMouseDOM(e,t){return new ot(e,t)}getMouseScreen(e,t){return new ot(e-window.innerWidth/2,-(t-window.innerHeight/2))}listenForMouse(){const e=Ow();"Desktop"===e?this.listenForDesktop():"Mobile"===e&&this.listenForMobile()}listenForDesktop(){window.addEventListener("mousemove",(e=>{const t=this.getMouse(e.clientX,e.clientY);this.mouse=t;const n=this.getMouseDOM(e.clientX,e.clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.clientX,e.clientY);this.mouseScreen=i}))}listenForMobile(){window.addEventListener("touchstart",(e=>{const t=this.getMouse(e.touches[0].clientX,e.touches[0].clientY);this.mouse=t;const n=this.getMouseDOM(e.touches[0].clientX,e.touches[0].clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.touches[0].clientX,e.touches[0].clientY);this.mouseScreen=i})),window.addEventListener("touchmove",(e=>{const t=this.getMouse(e.touches[0].clientX,e.touches[0].clientY);this.mouse=t;const n=this.getMouseDOM(e.touches[0].clientX,e.touches[0].clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.touches[0].clientX,e.touches[0].clientY);this.mouseScreen=i}))}syncMouseDOM(){this.prevMouseDOM.x=this.mouseDOM.x,this.prevMouseDOM.y=this.mouseDOM.y}judgeIsMouseMoving(){Math.abs(this.mouseDOMDelta.x)<this.mouseMoveOffset&&Math.abs(this.mouseDOMDelta.y)<this.mouseMoveOffset?this.isMouseMoving=!1:this.isMouseMoving=!0}getMouseDOMDelta(){const e=this.mouseDOM.x-this.prevMouseDOM.x,t=this.mouseDOM.y-this.prevMouseDOM.y,n=new ot(e,t);this.mouseDOMDelta=n}update(e){this.getMouseDOMDelta(),this.judgeIsMouseMoving(),this.syncMouseDOM()}}const bC=(e,t)=>{const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},MC=e=>e*(Math.PI/180),SC=e=>e*(180/Math.PI),IC=new Map,BC=e=>{IC.has(e)&&clearTimeout(IC.get(e)),IC.set(e,setTimeout(e,100))},TC=(e,t,n)=>{const i=t.split(/[ ,]+/g);let r;for(let t=0;t<i.length;t+=1)r=i[t],e.addEventListener?e.addEventListener(r,n,!1):e.attachEvent&&e.attachEvent(r,n)},RC=(e,t,n)=>{const i=t.split(/[ ,]+/g);let r;for(let t=0;t<i.length;t+=1)r=i[t],e.removeEventListener?e.removeEventListener(r,n):e.detachEvent&&e.detachEvent(r,n)},DC=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),LC=()=>({x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}),PC=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},FC=(e,t,n)=>{const i=UC(e);for(let e in i)if(i.hasOwnProperty(e))if("string"==typeof t)i[e]=t+" "+n;else{let r="";for(let e=0,i=t.length;e<i;e+=1)r+=t[e]+" "+n+", ";i[e]=r.slice(0,-2)}return i},UC=e=>{const t={};t[e]="";return["webkit","Moz","o"].forEach((function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},OC=(e,t)=>{for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},NC=(e,t)=>{if(e.length)for(let n=0,i=e.length;n<i;n+=1)t(e[n]);else t(e)};var kC,GC=!!("ontouchstart"in window),QC=!!window.PointerEvent,zC=!!window.MSPointerEvent,HC={start:"mousedown",move:"mousemove",end:"mouseup"},VC={};function WC(){}function jC(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=jC.id,jC.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function XC(e,t){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=XC.id,XC.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(t),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);const i=getComputedStyle(n.options.zone.parentElement);return i&&"flex"===i.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}function JC(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=LC(),t.config(e),t.prepareCollections();var n=function(){var e;t.collections.forEach((function(n){n.forEach((function(n){e=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};TC(window,"resize",(function(){BC(n)}));var i=function(){t.scroll=LC()};return TC(window,"scroll",(function(){BC(i)})),t.collections}QC?kC={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:zC?kC={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:GC?(kC={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},VC=HC):kC=HC,WC.prototype.on=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i},WC.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&n._handlers_[e].indexOf(t)>=0&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},WC.prototype.trigger=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach((function(e){e.call(i,{type:n,target:i},t)}))},WC.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{const n={};for(let i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)?n[i]=t[i]:e.hasOwnProperty(i)&&(n[i]=e[i]);return n})(t.options,e))},WC.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},TC(e,kC[t],n._domHandlers_[t]),VC[t]&&TC(e,VC[t],n._domHandlers_[t]),n},WC.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},RC(e,kC[t],n._domHandlers_[t]),VC[t]&&RC(e,VC[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},jC.prototype=new WC,jC.constructor=jC,jC.id=0,jC.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},jC.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{const n=UC(e);for(let e in n)n.hasOwnProperty(e)&&(n[e]=t);return n})("borderRadius","50%"),n=FC("transition","opacity",e),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},OC(i.el,n),"circle"===this.options.shape&&OC(i.back,t),OC(i.front,t),this.applyStyles(i),this},jC.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},jC.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},jC.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},jC.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},jC.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},jC.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){const n=t.options.restJoystick,i={};i.x=!0===n||!1!==n.x?0:t.instance.frontPosition.x,i.y=!0===n||!1!==n.y?0:t.instance.frontPosition.y,t.setPosition(e,i)}return t},jC.prototype.setPosition=function(e,t){var n=this;n.frontPosition={x:t.x,y:t.y};var i=n.options.fadeTime+"ms",r={};r.front=FC("transition",["transform"],i);var s={front:{}};s.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(r),n.applyStyles(s),n.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(n),n.restCallback()}),n.options.fadeTime)},jC.prototype.restCallback=function(){var e=this,t={};t.front=FC("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},jC.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},jC.prototype.computeDirection=function(e){var t,n,i,r=e.angle.radian,s=Math.PI/4,a=Math.PI/2;if(r>s&&r<3*s&&!e.lockX?t="up":r>-s&&r<=s&&!e.lockY?t="left":r>3*-s&&r<=-s&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=r>-a&&r<a?"left":"right"),e.lockX||(i=r>0?"up":"down"),e.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var c={};for(o in this.direction={x:n,y:i,angle:t},e.direction=this.direction,l)l[o]===this.direction[o]&&(c[o]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+i,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e},XC.prototype=new WC,XC.constructor=XC,XC.id=0,XC.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var n=0,i=t.length;n<i;n+=1)if(t[n].identifier===e)return t[n];return!1}},XC.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},XC.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var n=e.createNipple(t.position,e.manager.getIdentifier());n.add(),e.idles.push(n)}},XC.prototype.createNipple=function(e,t){var n=this,i=n.manager.scroll,r={},s=n.options,a=n.parentIsFlex?i.x:i.x+n.box.left,o=n.parentIsFlex?i.y:i.y+n.box.top;if(e.x&&e.y)r={x:e.x-a,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",s.zone.appendChild(l);var c=l.getBoundingClientRect();s.zone.removeChild(l),r=e,e={x:c.left+i.x,y:c.top+i.y}}var h=new jC(n,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(PC(h.ui.el,r),PC(h.ui.front,h.frontPosition)),n.nipples.push(h),n.trigger("added "+h.identifier+":added",h),n.manager.trigger("added "+h.identifier+":added",h),n.bindNipple(h),h},XC.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},XC.prototype.bindNipple=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},XC.prototype.pressureFn=function(e,t,n){var i=this,r=0;clearInterval(i.pressureIntervals[n]),i.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==r&&(t.trigger("pressure",n),i.trigger("pressure "+t.identifier+":pressure",n),r=n)}.bind(i),100)},XC.prototype.onstart=function(e){var t=this,n=t.options,i=e;e=DC(e),t.updateBox();return NC(e,(function(r){t.actives.length<n.maxNumberOfNipples?t.processOnStart(r):i.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(n){if(Object.values(i.touches).findIndex((function(e){return e.identifier===n}))<0){var r=[e[0]];r.identifier=n,t.processOnEnd(r)}})),t.actives.length<n.maxNumberOfNipples&&t.processOnStart(r))})),t.manager.bindDocument(),!1},XC.prototype.processOnStart=function(e){var t,n=this,i=n.options,r=n.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=n.getOrCreate(r,a);o.identifier!==r&&n.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),s>0&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)};if((t=n.idles.indexOf(o))>=0&&n.idles.splice(t,1),n.actives.push(o),n.ids.push(o.identifier),"semi"!==i.mode)l(o);else{if(!(bC(a,o.position)<=i.catchDistance))return o.destroy(),void n.processOnStart(e);l(o)}return o},XC.prototype.getOrCreate=function(e,t){var n,i=this,r=i.options;return/(semi|static)/.test(r.mode)?(n=i.idles[0])?(i.idles.splice(0,1),n):"semi"===r.mode?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):n=i.createNipple(t,e)},XC.prototype.processOnMove=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),r=t.nipples.get(i),s=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+i),void t.manager.removeIdentifier(i);if(n.dynamicPage){var a=r.el.getBoundingClientRect();r.position={x:s.x+a.left,y:s.y+a.top}}r.identifier=i;var o=r.options.size/2,l={x:e.pageX,y:e.pageY};n.lockX&&(l.y=r.position.y),n.lockY&&(l.x=r.position.x);var c,h,u=bC(l,r.position),d=((e,t)=>{const n=t.x-e.x,i=t.y-e.y;return SC(Math.atan2(i,n))})(l,r.position),p=MC(d),f=u/o,m={distance:u,position:l};if("circle"===r.options.shape?(c=Math.min(u,o),h=((e,t,n)=>{const i={x:0,y:0};return n=MC(n),i.x=e.x-t*Math.cos(n),i.y=e.y-t*Math.sin(n),i})(r.position,c,d)):(h=((e,t,n)=>({x:Math.min(Math.max(e.x,t.x-n),t.x+n),y:Math.min(Math.max(e.y,t.y-n),t.y+n)}))(l,r.position,o),c=bC(h,r.position)),n.follow){if(u>o){let e=l.x-h.x,n=l.y-h.y;r.position.x+=e,r.position.y+=n,r.el.style.top=r.position.y-(t.box.top+s.y)+"px",r.el.style.left=r.position.x-(t.box.left+s.x)+"px",u=bC(l,r.position)}}else l=h,u=c;var A=l.x-r.position.x,g=l.y-r.position.y;r.frontPosition={x:A,y:g},n.dataOnly||(r.ui.front.style.transform="translate("+A+"px,"+g+"px)");var v={identifier:r.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:p,degree:d},vector:{x:A/o,y:-g/o},raw:m,instance:r,lockX:n.lockX,lockY:n.lockY};(v=r.computeDirection(v)).angle={radian:MC(180-d),degree:180-d},r.trigger("move",v),t.trigger("move "+r.id+":move",v)}else this.processOnEnd(e)},XC.prototype.processOnEnd=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),r=t.nipples.get(i),s=t.manager.removeIdentifier(r.identifier);r&&(n.dataOnly||r.hide((function(){"dynamic"===n.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(n.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[s.id]=s.identifier))},XC.prototype.onDestroyed=function(e,t){var n=this;n.nipples.indexOf(t)>=0&&n.nipples.splice(n.nipples.indexOf(t),1),n.actives.indexOf(t)>=0&&n.actives.splice(n.actives.indexOf(t),1),n.idles.indexOf(t)>=0&&n.idles.splice(n.idles.indexOf(t),1),n.ids.indexOf(t.identifier)>=0&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},XC.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()},JC.prototype=new WC,JC.constructor=JC,JC.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every((function(e){return!(n=e.get(t))})),n}},JC.prototype.create=function(e){return this.createCollection(e)},JC.prototype.createCollection=function(e){var t=this,n=new XC(t,e);return t.bindCollection(n),t.collections.push(n),n},JC.prototype.bindCollection=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},JC.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},JC.prototype.unbindDocument=function(e){var t=this;Object.keys(t.ids).length&&!0!==e||(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},JC.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},JC.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},JC.prototype.onmove=function(e){return this.onAny("move",e),!1},JC.prototype.onend=function(e){return this.onAny("end",e),!1},JC.prototype.oncancel=function(e){return this.onAny("end",e),!1},JC.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=DC(t);var s=function(e,t,n){n.ids.indexOf(t)>=0&&(n[r](e),e._found_=!0)};return NC(t,(function(e){n=i.getIdentifier(e),NC(i.collections,s.bind(null,e,n)),e._found_||i.removeIdentifier(n)})),!1},JC.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},JC.prototype.onDestroyed=function(e,t){var n=this;if(n.collections.indexOf(t)<0)return!1;n.collections.splice(n.collections.indexOf(t),1)};const qC=new JC;var YC=function(e){return qC.create(e)};class KC{keys;constructor(){this.keys={}}listenForKey(){window.addEventListener("keydown",(e=>{this.onKeyDown(e)})),window.addEventListener("keyup",(e=>{this.onKeyUp(e)}))}onKeyDown(e){this.keys[e.key]=!0}onKeyUp(e){this.keys[e.key]=!1}get isUpKeyDown(){return this.keys.w||this.keys.ArrowUp}get isDownKeyDown(){return this.keys.s||this.keys.ArrowDown}get isLeftKeyDown(){return this.keys.a||this.keys.ArrowLeft}get isRightKeyDown(){return this.keys.d||this.keys.ArrowRight}get isSpaceKeyDown(){return this.keys[" "]}get isEnterKeyDown(){return this.keys.Enter}get isBackspaceKeyDown(){return this.keys.Backspace}get isCtrlKeyDown(){return this.keys.Control}get isShiftKeyDown(){return this.keys.Shift}get isTabKeyDown(){return this.keys.Tab}get isEscKeyDown(){return this.keys.Escape}}class ZC extends Zu{world;meshPhysicsObjects;constructor(e){super(e);const t=new fw;t.gravity.set(0,-9.82,0),this.world=t,this.meshPhysicsObjects=[]}add({mesh:e,body:t,copyPosition:n=!0,copyQuaternion:i=!0}){const r=new $C(e,t,n,i);this.base.physics.world.addBody(t),this.meshPhysicsObjects.push(r)}tick(){const e=this.world,t=this.base.clock.deltaTime;e.step(1/60,t,3)}sync(){this.meshPhysicsObjects.forEach((e=>{const{mesh:t,body:n,copyPosition:i,copyQuaternion:r}=e;i&&t.position.copy(n.position),r&&t.quaternion.copy(n.quaternion)}))}update(e){this.sync(),this.tick()}}class $C{mesh;body;copyPosition;copyQuaternion;constructor(e,t,n=!0,i=!0){this.mesh=e,this.body=t,this.copyPosition=n,this.copyQuaternion=i}}class eb extends wr{frustum;useAspect;constructor(e={}){const t=window.innerWidth/window.innerHeight,{frustum:n=5.7,near:i=.1,far:r=2e3,useAspect:s=!0}=e,a=s?t:1;super(a*n*-.5,a*n*.5,.5*n,-.5*n,i,r),this.frustum=n,this.useAspect=s}}const tb=new vh;class nb{el;rect;mesh;scene;segments;isRectAutoRefreshed;constructor(e,t,n,i={}){const{meshType:r="mesh",meshSizeType:s="size",segments:a={width:64,height:64},textureUniform:o="uTexture",useTextureLoader:l=!0,textureLoader:c=tb,isRectAutoRefreshed:h=!0}=i;this.el=e,this.scene=n,this.segments=a,this.isRectAutoRefreshed=h;let u=null;u=e instanceof HTMLVideoElement?new ol(e):!l||e instanceof HTMLCanvasElement?new Tt(e):c.load(e.src),u.needsUpdate=!0;const d=t.clone();d.uniforms[o].value=u;const p=this.refreshRect();this.rect=p;const{width:f,height:m}=p,A={size:new dr(f,m,a.width,a.height),scale:new dr(1,1,a.width,a.height)}[s],g={points:new sl(A,d),mesh:new Hi(A,d)}[r];"scale"===s&&g.scale.set(f,m,1),n.add(g),this.mesh=g}refreshRect(){const{el:e}=this,t=e.getBoundingClientRect();return this.rect=t,t}setPosition(e=window.scrollY){const{mesh:t}=this;this.isRectAutoRefreshed&&this.refreshRect();const{x:n,y:i}=(e=>{const t=e.left+e.width/2,n=e.top+e.height/2;return{x:t-window.innerWidth/2,y:-n+window.innerHeight/2}})(this.rect);t.position.set(n,i+e,0)}syncPosition(){this.setPosition(0)}syncScale(){const{mesh:e}=this,t=this.refreshRect();e.scale.set(t.width,t.height,1)}destroy(){this.scene.remove(this.mesh)}}class ib{makus;constructor(){this.makus=[]}add(e){return this.makus.push(e),e}addMultiple(e){e.forEach((e=>{this.add(e)}))}setPositions(e=window.scrollY){const{makus:t}=this;t.forEach((t=>{t.setPosition(e)}))}syncPositions(){const{makus:e}=this;e.forEach((e=>{e.syncPosition()}))}syncScales(){const{makus:e}=this;e.forEach((e=>{e.syncScale()}))}clear(){this.makus.forEach((e=>e.destroy()))}}class rb{scroll;constructor(){this.scroll={current:0,target:0,ease:.05,last:0,delta:0,direction:""}}listenForScroll(){window.addEventListener("scroll",(()=>{const e=this.scroll.target,t=window.scrollY-e;this.scroll.target+=t}))}syncScroll(){this.scroll.current=at.lerp(this.scroll.current,this.scroll.target,this.scroll.ease),this.scroll.delta=this.scroll.current-this.scroll.last,this.scroll.direction=this.scroll.delta>0?"down":"up",this.scroll.last=this.scroll.current}}class sb extends Zu{enabled;autoAdaptMobile;constructor(e,t={}){super(e),this.enabled=!0;const{autoAdaptMobile:n=!1}=t;this.autoAdaptMobile=n,this.autoAdaptMobile&&this.resize()}get aspect(){return window.innerWidth/window.innerHeight}resizeRenderer(e){e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(Math.min(2,window.devicePixelRatio))}resizeComposer(e){e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio&&e.setPixelRatio(Math.min(2,window.devicePixelRatio))}resizeCamera(e){const{aspect:t}=this;if(e instanceof Zi)e.aspect=t,e.updateProjectionMatrix();else if(e instanceof eb){const{frustum:n,useAspect:i}=e;if(n){const r=i?t:1;[e.left,e.right,e.top,e.bottom]=[r*n*-.5,r*n*.5,.5*n,-.5*n],e.updateProjectionMatrix()}}}resize(){const{base:e}=this,{renderer:t,camera:n,composer:i}=e;this.resizeRenderer(t),i&&this.resizeComposer(i),this.resizeCamera(n),this.autoAdaptMobile&&this.adaptMobile(),this.emit("resize")}listenForResize(){window.addEventListener("resize",(()=>{this.enabled&&this.resize()}))}enable(){this.enabled=!0}disable(){this.enabled=!1}adaptMobile(){const{base:e}=this,{renderer:t,camera:n}=e,i=document.documentElement.clientWidth,r=document.documentElement.clientHeight;i>r?(t.setSize(i,r),n instanceof Zi&&(n.aspect=i/r,n.updateProjectionMatrix())):(t.setSize(r,i),n instanceof Zi&&(n.aspect=r/i,n.updateProjectionMatrix()))}}var ab={exports:{}};!function(e,t){var n;e.exports=(n=function(){function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";i=e}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(e){e.preventDefault(),t(++i%r.children.length)}),!1);var s=(performance||Date).now(),a=s,o=0,l=e(new n.Panel("FPS","#0ff","#002")),c=e(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(c.update(e-s,200),e>a+1e3&&(l.update(1e3*o/(e-a),100),a=e,o=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:r,setMode:t}},n.Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,c=3*a,h=2*a,u=3*a,d=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var A=m.getContext("2d");return A.font="bold "+9*a+"px Helvetica,Arial,sans-serif",A.textBaseline="top",A.fillStyle=n,A.fillRect(0,0,o,l),A.fillStyle=t,A.fillText(e,c,h),A.fillRect(u,d,p,f),A.fillStyle=n,A.globalAlpha=.9,A.fillRect(u,d,p,f),{dom:m,update:function(l,g){i=Math.min(i,l),r=Math.max(r,l),A.fillStyle=n,A.globalAlpha=1,A.fillRect(0,0,o,d),A.fillStyle=t,A.fillText(s(l)+" "+e+" ("+s(i)+"-"+s(r)+")",c,h),A.drawImage(m,u+a,d,p-a,f,u,d,p-a,f),A.fillRect(u+p-a,d,a,f),A.fillStyle=n,A.globalAlpha=.9,A.fillRect(u+p-a,d,a,s((1-l/g)*f))}}},n)}(ab);var ob=OA(ab.exports);class lb{camera;scene;renderer;container;animator;interactionManager;composer;clock;iMouse;physics;resizer;keyboard;constructor(e="#sketch",t={}){const{hello:n=!0,gl:i={},autoAdaptMobile:r=!1,autoRender:s=!0}=t;n&&console.log("%c- powered by kokomi.js -","padding: 5px 10px; background: #030A8C; font-size: 11px");const a=new Zi(70,window.innerWidth/window.innerHeight,.01,100);a.position.z=1,this.camera=a;const o=new qa;this.scene=o;const l=new Wa({antialias:!0,alpha:!0,...i});l.setSize(window.innerWidth,window.innerHeight),l.setPixelRatio(Math.min(2,window.devicePixelRatio)),this.renderer=l;const c=document.querySelector(e);c?.appendChild(l.domElement),this.container=c;const h=new $u(this,{autoRender:s});this.animator=h;const u=new class{renderer;camera;domElement;bindEventsOnBodyElement;autoAdd;scene;mouse;supportsPointerEvents;interactiveObjects;closestObject;raycaster;treatTouchEventsAsMouseEvents;constructor(e,t,n,i){this.renderer=e,this.camera=t,this.domElement=n,this.bindEventsOnBodyElement=!(i&&typeof i.bindEventsOnBodyElement<"u")||i.bindEventsOnBodyElement,this.scene=i&&typeof i.scene<"u"?i.scene:null,this.scene&&(this.scene.onBeforeRender=()=>{this.autoAdd&&null!==this.scene&&this.scene.traverse((e=>{this.add(e),e.addEventListener("removed",(e=>{this.remove(e.target)}))})),this.update()}),this.autoAdd=!!(i&&typeof i.autoAdd<"u")&&i.autoAdd,this.autoAdd&&null===this.scene&&console.error("Attention: Options.scene needs to be set when using options.autoAdd"),this.mouse=new ot(-1,1),this.supportsPointerEvents=!!window.PointerEvent,this.interactiveObjects=[],this.closestObject=null,this.raycaster=new Eu,n.addEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?n.ownerDocument.addEventListener("pointermove",this.onDocumentPointerMove):n.addEventListener("pointermove",this.onDocumentPointerMove),n.addEventListener("pointerdown",this.onPointerDown),n.addEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?n.ownerDocument.addEventListener("mousemove",this.onDocumentMouseMove):n.addEventListener("mousemove",this.onDocumentMouseMove),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("mouseup",this.onMouseUp),n.addEventListener("touchstart",this.onTouchStart,{passive:!0}),n.addEventListener("touchmove",this.onTouchMove,{passive:!0}),n.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this.treatTouchEventsAsMouseEvents=!0}dispose=()=>{this.domElement.removeEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("pointermove",this.onDocumentPointerMove):this.domElement.removeEventListener("pointermove",this.onDocumentPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("mousemove",this.onDocumentMouseMove):this.domElement.removeEventListener("mousemove",this.onDocumentMouseMove),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("touchstart",this.onTouchStart),this.domElement.removeEventListener("touchmove",this.onTouchMove),this.domElement.removeEventListener("touchend",this.onTouchEnd)};add=(e,t=[])=>{if(e&&!this.interactiveObjects.find((t=>t.target===e)))if(t.length>0)t.forEach((t=>{let n=e.getObjectByName(t);if(n){let e=new Yu(n,t);this.interactiveObjects.push(e)}}));else{let t=new Yu(e,e.name);this.interactiveObjects.push(t)}};remove=(e,t=[])=>{!e||(t.length>0?t.forEach((t=>{let n=e.getObjectByName(t);n&&(this.interactiveObjects=this.interactiveObjects.filter((e=>e.target!==n)))})):this.interactiveObjects=this.interactiveObjects.filter((t=>t.target!==e)))};update=()=>{this.raycaster.setFromCamera(this.mouse,this.camera),this.interactiveObjects.forEach((e=>{e.target&&this.checkIntersection(e)})),this.interactiveObjects.sort((function(e,t){return e.distance-t.distance}));let e,t,n=this.interactiveObjects.find((e=>e.intersected))??null;if(n!=this.closestObject){if(this.closestObject){let e=new Ku("mouseout");this.dispatch(this.closestObject,e)}if(n){let e=new Ku("mouseover");this.dispatch(n,e)}this.closestObject=n}this.interactiveObjects.forEach((t=>{!t.intersected&&t.wasIntersected&&(e||(e=new Ku("mouseleave")),this.dispatch(t,e))})),this.interactiveObjects.forEach((e=>{e.intersected&&!e.wasIntersected&&(t||(t=new Ku("mouseenter")),this.dispatch(e,t))}))};checkIntersection=e=>{let t=this.raycaster.intersectObjects([e.target],!0);if(e.wasIntersected=e.intersected,t.length>0){let n=t[0].distance;t.forEach((e=>{e.distance<n&&(n=e.distance)})),e.intersected=!0,e.distance=n}else e.intersected=!1};onDocumentMouseMove=e=>{this.mapPositionToPoint(this.mouse,e.clientX,e.clientY);let t=new Ku("mousemove",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};onDocumentPointerMove=e=>{this.mapPositionToPoint(this.mouse,e.clientX,e.clientY);let t=new Ku("pointermove",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};onTouchMove=e=>{e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY);let t=new Ku(this.treatTouchEventsAsMouseEvents?"mousemove":"touchmove",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};onMouseClick=e=>{this.update();let t=new Ku("click",e);this.interactiveObjects.forEach((e=>{e.intersected&&this.dispatch(e,t)}))};onMouseDown=e=>{this.mapPositionToPoint(this.mouse,e.clientX,e.clientY),this.update();let t=new Ku("mousedown",e);this.interactiveObjects.forEach((e=>{e.intersected&&this.dispatch(e,t)}))};onPointerDown=e=>{this.mapPositionToPoint(this.mouse,e.clientX,e.clientY),this.update();let t=new Ku("pointerdown",e);this.interactiveObjects.forEach((e=>{e.intersected&&this.dispatch(e,t)}))};onTouchStart=e=>{e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY),this.update();let t=new Ku(this.treatTouchEventsAsMouseEvents?"mousedown":"touchstart",e);this.interactiveObjects.forEach((e=>{e.intersected&&this.dispatch(e,t)}))};onMouseUp=e=>{let t=new Ku("mouseup",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};onPointerUp=e=>{let t=new Ku("pointerup",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};onTouchEnd=e=>{e.touches.length>0&&this.mapPositionToPoint(this.mouse,e.touches[0].clientX,e.touches[0].clientY),this.update();let t=new Ku(this.treatTouchEventsAsMouseEvents?"mouseup":"touchend",e);this.interactiveObjects.forEach((e=>{this.dispatch(e,t)}))};dispatch=(e,t)=>{e.target&&!t.cancelBubble&&(t.coords=this.mouse,t.distance=e.distance,t.intersected=e.intersected,e.target.dispatchEvent(t))};mapPositionToPoint=(e,t,n)=>{let i=this.renderer.domElement.getBoundingClientRect();e.x=(t-i.left)/i.width*2-1,e.y=-(n-i.top)/i.height*2+1}}(this.renderer,this.camera,this.renderer.domElement);this.interactionManager=u,this.composer=null;const d=new _C(this);this.clock=d;const p=new CC(this);this.iMouse=p;const f=new ZC(this);this.physics=f;const m=new sb(this,{autoAdaptMobile:r});this.resizer=m;const A=new KC;this.keyboard=A,this.init(),this.addEventListeners()}addEventListeners(){this.resizer.listenForResize(),this.iMouse.listenForMouse(),this.keyboard.listenForKey()}update(e){this.animator.add(e)}init(){this.update((()=>{this.interactionManager.update()})),this.animator.update()}render(){this.composer?this.composer.render():this.renderer.render(this.scene,this.camera)}async saveScreenshot(e="screenshot.png"){this.render();const t=await new Promise((e=>{this.renderer.domElement.toBlob(e,"image/png")}));t&&Jw(t,e)}destroy(){this.scene.traverse((e=>{e instanceof Hi&&(e.geometry?.dispose(),Object.values(e.material).forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})))})),this.renderer.dispose()}}
/*!
	 * camera-controls
	 * https://github.com/yomotsu/camera-controls
	 * (c) 2017 @yomotsu
	 * Released under the MIT License.
	 */const cb=1,hb=2,ub=4,db=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),pb=0,fb=1,mb=-1;function Ab(e){return e.isPerspectiveCamera}function gb(e){return e.isOrthographicCamera}const vb=2*Math.PI,yb=Math.PI/2,xb=Math.PI/180;function _b(e,t,n){return Math.max(t,Math.min(n,e))}function Eb(e,t=1e-5){return Math.abs(e)<t}function wb(e,t,n=1e-5){return Eb(e-t,n)}function Cb(e,t){return Math.round(e/t)*t}function bb(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Mb(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function Sb(e,t,n,i,r=1/0,s){const a=2/(i=Math.max(1e-4,i)),o=a*s,l=1/(1+o+.48*o*o+.235*o*o*o);let c=e-t;const h=t,u=r*i;c=_b(c,-u,u),t=e-c;const d=(n.value+a*c)*s;n.value=(n.value-a*d)*l;let p=t+(c+d)*l;return h-e>0==p>h&&(p=h,n.value=(p-h)/s),p}function Ib(e,t,n,i,r=1/0,s,a){const o=2/(i=Math.max(1e-4,i)),l=o*s,c=1/(1+l+.48*l*l+.235*l*l*l);let h=t.x,u=t.y,d=t.z,p=e.x-h,f=e.y-u,m=e.z-d;const A=h,g=u,v=d,y=r*i,x=p*p+f*f+m*m;if(x>y*y){const e=Math.sqrt(x);p=p/e*y,f=f/e*y,m=m/e*y}h=e.x-p,u=e.y-f,d=e.z-m;const _=(n.x+o*p)*s,E=(n.y+o*f)*s,w=(n.z+o*m)*s;n.x=(n.x-o*_)*c,n.y=(n.y-o*E)*c,n.z=(n.z-o*w)*c,a.x=h+(p+_)*c,a.y=u+(f+E)*c,a.z=d+(m+w)*c;const C=A-e.x,b=g-e.y,M=v-e.z;return C*(a.x-A)+b*(a.y-g)+M*(a.z-v)>0&&(a.x=A,a.y=g,a.z=v,n.x=(a.x-A)/s,n.y=(a.y-g)/s,n.z=(a.z-v)/s),a}function Bb(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function Tb(e,t){return!!gb(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}class Rb{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}}var Db;const Lb=1/8,Pb=/Mac/.test(null===(Db=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===Db?void 0:Db.platform);let Fb,Ub,Ob,Nb,kb,Gb,Qb,zb,Hb,Vb,Wb,jb,Xb,Jb,qb,Yb,Kb,Zb,$b,eM,tM,nM,iM,rM=class e extends Rb{static install(e){Fb=e.THREE,Ub=Object.freeze(new Fb.Vector3(0,0,0)),Ob=Object.freeze(new Fb.Vector3(0,1,0)),Nb=Object.freeze(new Fb.Vector3(0,0,1)),kb=new Fb.Vector2,Gb=new Fb.Vector3,Qb=new Fb.Vector3,zb=new Fb.Vector3,Hb=new Fb.Vector3,Vb=new Fb.Vector3,Wb=new Fb.Vector3,jb=new Fb.Vector3,Xb=new Fb.Vector3,Jb=new Fb.Vector3,qb=new Fb.Spherical,Yb=new Fb.Spherical,Kb=new Fb.Box3,Zb=new Fb.Box3,$b=new Fb.Sphere,eM=new Fb.Quaternion,tM=new Fb.Quaternion,nM=new Fb.Matrix4,iM=new Fb.Raycaster}static get ACTION(){return db}constructor(t,n){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=db.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=pb,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Fb.Vector3,this._focalOffsetVelocity=new Fb.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,n)=>{let i,r;if(Ab(this._camera)){const n=Gb.copy(this._camera.position).sub(this._target),s=this._camera.getEffectiveFOV()*xb,a=n.length()*Math.tan(.5*s);i=this.truckSpeed*e*a/this._elementRect.height,r=this.truckSpeed*t*a/this._elementRect.height}else{if(!gb(this._camera))return;{const n=this._camera;i=e*(n.right-n.left)/n.zoom/this._elementRect.width,r=t*(n.top-n.bottom)/n.zoom/this._elementRect.height}}this.verticalDragToForward?(n?this.setFocalOffset(this._focalOffsetEnd.x+i,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(i,0,!0),this.forward(-r,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+i,this._focalOffsetEnd.y+r,this._focalOffsetEnd.z,!0):this.truck(i,r,!0)},this._rotateInternal=(e,t)=>{const n=vb*this.azimuthRotateSpeed*e/this._elementRect.height,i=vb*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,i,!0)},this._dollyInternal=(e,t,n)=>{const i=Math.pow(.95,-e*this.dollySpeed),r=this._sphericalEnd.radius,s=this._sphericalEnd.radius*i,a=_b(s,this.minDistance,this.maxDistance),o=a-s;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(s,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(o,!0),this._dollyToNoClamp(a,!0)):this._dollyToNoClamp(a,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?s:a)-r,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,n)=>{const i=Math.pow(.95,e*this.dollySpeed),r=this._zoom,s=this._zoom*i;this.zoomTo(s,!0),this.dollyToCursor&&(this._changedZoom+=s-r,this._dollyControlCoord.set(t,n))},void 0===Fb&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=(new Fb.Quaternion).setFromUnitVectors(this._camera.up,Ob),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=db.NONE,this._target=new Fb.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Fb.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new Fb.Spherical).setFromVector3(Gb.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Fb.Vector3,new Fb.Vector3,new Fb.Vector3,new Fb.Vector3],this._updateNearPlaneCorners(),this._boundary=new Fb.Box3(new Fb.Vector3(-1/0,-1/0,-1/0),new Fb.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Fb.Vector2,this.mouseButtons={left:db.ROTATE,middle:db.DOLLY,right:db.TRUCK,wheel:Ab(this._camera)?db.DOLLY:gb(this._camera)?db.ZOOM:db.NONE},this.touches={one:db.TOUCH_ROTATE,two:Ab(this._camera)?db.TOUCH_DOLLY_TRUCK:gb(this._camera)?db.TOUCH_ZOOM_TRUCK:db.NONE,three:db.TOUCH_TRUCK};const i=new Fb.Vector2,r=new Fb.Vector2,s=new Fb.Vector2,a=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,i=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}const t="mouse"!==e.pointerType?null:(e.buttons&cb)===cb?cb:(e.buttons&ub)===ub?ub:(e.buttons&hb)===hb?hb:null;if(null!==t){const e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&cb)===cb&&this._lockedPointer)return;const n={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(n),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,d(e)},o=e=>{e.cancelable&&e.preventDefault();const t=e.pointerId,n=this._lockedPointer||this._findPointerById(t);if(n){if(n.clientX=e.clientX,n.clientY=e.clientY,n.deltaX=e.movementX,n.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&cb)===cb)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&ub)===ub&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&hb)===hb&&(this._state=this._state|this.mouseButtons.right);p()}},l=e=>{const t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=db.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=db.NONE;f()}};let c=-1;const h=e=>{if(!this._domElement)return;if(!this._enabled||this.mouseButtons.wheel===db.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,i=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===db.ROTATE||this.mouseButtons.wheel===db.TRUCK){const e=performance.now();c-e<1e3&&this._getClientRect(this._elementRect),c=e}const t=Pb?-1:-3,n=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case db.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case db.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1),this._isUserControllingTruck=!0;break;case db.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0),this._isUserControllingOffset=!0;break;case db.DOLLY:this._dollyInternal(-n,i,r),this._isUserControllingDolly=!0;break;case db.ZOOM:this._zoomInternal(-n,i,r),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},u=t=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===e.ACTION.NONE){const e=t instanceof PointerEvent?t.pointerId:0,n=this._findPointerById(e);return n&&this._disposePointer(n),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),void this._domElement.ownerDocument.removeEventListener("pointerup",l)}t.preventDefault()}},d=e=>{if(!this._enabled)return;Bb(this._activePointers,kb),this._getClientRect(this._elementRect),i.copy(kb),r.copy(kb);if(this._activePointers.length>=2){const e=kb.x-this._activePointers[1].clientX,t=kb.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);s.set(0,n);const i=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),a=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);r.set(i,a)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(e.buttons&cb)!==cb||(this._state=this._state|this.mouseButtons.left),(e.buttons&ub)===ub&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&hb)===hb&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);(this._state&db.ROTATE)!==db.ROTATE&&(this._state&db.TOUCH_ROTATE)!==db.TOUCH_ROTATE&&(this._state&db.TOUCH_DOLLY_ROTATE)!==db.TOUCH_DOLLY_ROTATE&&(this._state&db.TOUCH_ZOOM_ROTATE)!==db.TOUCH_ZOOM_ROTATE||(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),(this._state&db.TRUCK)!==db.TRUCK&&(this._state&db.TOUCH_TRUCK)!==db.TOUCH_TRUCK&&(this._state&db.TOUCH_DOLLY_TRUCK)!==db.TOUCH_DOLLY_TRUCK&&(this._state&db.TOUCH_ZOOM_TRUCK)!==db.TOUCH_ZOOM_TRUCK||(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),(this._state&db.DOLLY)!==db.DOLLY&&(this._state&db.TOUCH_DOLLY)!==db.TOUCH_DOLLY&&(this._state&db.TOUCH_DOLLY_TRUCK)!==db.TOUCH_DOLLY_TRUCK&&(this._state&db.TOUCH_DOLLY_OFFSET)!==db.TOUCH_DOLLY_OFFSET&&(this._state&db.TOUCH_DOLLY_ROTATE)!==db.TOUCH_DOLLY_ROTATE||(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),(this._state&db.ZOOM)!==db.ZOOM&&(this._state&db.TOUCH_ZOOM)!==db.TOUCH_ZOOM&&(this._state&db.TOUCH_ZOOM_TRUCK)!==db.TOUCH_ZOOM_TRUCK&&(this._state&db.TOUCH_ZOOM_OFFSET)!==db.TOUCH_ZOOM_OFFSET&&(this._state&db.TOUCH_ZOOM_ROTATE)!==db.TOUCH_ZOOM_ROTATE||(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),(this._state&db.OFFSET)!==db.OFFSET&&(this._state&db.TOUCH_OFFSET)!==db.TOUCH_OFFSET&&(this._state&db.TOUCH_DOLLY_OFFSET)!==db.TOUCH_DOLLY_OFFSET&&(this._state&db.TOUCH_ZOOM_OFFSET)!==db.TOUCH_ZOOM_OFFSET||(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Bb(this._activePointers,kb);const e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:r.x-kb.x,n=e?-e.deltaY:r.y-kb.y;if(r.copy(kb),(this._state&db.ROTATE)!==db.ROTATE&&(this._state&db.TOUCH_ROTATE)!==db.TOUCH_ROTATE&&(this._state&db.TOUCH_DOLLY_ROTATE)!==db.TOUCH_DOLLY_ROTATE&&(this._state&db.TOUCH_ZOOM_ROTATE)!==db.TOUCH_ZOOM_ROTATE||(this._rotateInternal(t,n),this._isUserControllingRotate=!0),(this._state&db.DOLLY)===db.DOLLY||(this._state&db.ZOOM)===db.ZOOM){const e=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,r=this.dollyDragInverted?-1:1;(this._state&db.DOLLY)===db.DOLLY?(this._dollyInternal(r*n*Lb,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(r*n*Lb,e,t),this._isUserControllingZoom=!0)}if((this._state&db.TOUCH_DOLLY)===db.TOUCH_DOLLY||(this._state&db.TOUCH_ZOOM)===db.TOUCH_ZOOM||(this._state&db.TOUCH_DOLLY_TRUCK)===db.TOUCH_DOLLY_TRUCK||(this._state&db.TOUCH_ZOOM_TRUCK)===db.TOUCH_ZOOM_TRUCK||(this._state&db.TOUCH_DOLLY_OFFSET)===db.TOUCH_DOLLY_OFFSET||(this._state&db.TOUCH_ZOOM_OFFSET)===db.TOUCH_ZOOM_OFFSET||(this._state&db.TOUCH_DOLLY_ROTATE)===db.TOUCH_DOLLY_ROTATE||(this._state&db.TOUCH_ZOOM_ROTATE)===db.TOUCH_ZOOM_ROTATE){const e=kb.x-this._activePointers[1].clientX,t=kb.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t),i=s.y-n;s.set(0,n);const a=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&db.TOUCH_DOLLY)===db.TOUCH_DOLLY||(this._state&db.TOUCH_DOLLY_ROTATE)===db.TOUCH_DOLLY_ROTATE||(this._state&db.TOUCH_DOLLY_TRUCK)===db.TOUCH_DOLLY_TRUCK||(this._state&db.TOUCH_DOLLY_OFFSET)===db.TOUCH_DOLLY_OFFSET?(this._dollyInternal(i*Lb,a,o),this._isUserControllingDolly=!0):(this._zoomInternal(i*Lb,a,o),this._isUserControllingZoom=!0)}(this._state&db.TRUCK)!==db.TRUCK&&(this._state&db.TOUCH_TRUCK)!==db.TOUCH_TRUCK&&(this._state&db.TOUCH_DOLLY_TRUCK)!==db.TOUCH_DOLLY_TRUCK&&(this._state&db.TOUCH_ZOOM_TRUCK)!==db.TOUCH_ZOOM_TRUCK||(this._truckInternal(t,n,!1),this._isUserControllingTruck=!0),(this._state&db.OFFSET)!==db.OFFSET&&(this._state&db.TOUCH_OFFSET)!==db.TOUCH_OFFSET&&(this._state&db.TOUCH_DOLLY_OFFSET)!==db.TOUCH_DOLLY_OFFSET&&(this._state&db.TOUCH_ZOOM_OFFSET)!==db.TOUCH_ZOOM_OFFSET||(this._truckInternal(t,n,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},f=()=>{Bb(this._activePointers,kb),r.copy(kb),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),d())},this.unlockPointer=()=>{var e,t,n;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(e=this._domElement)||void 0===e||e.ownerDocument.exitPointerLock(),null===(t=this._domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerlockchange",m),null===(n=this._domElement)||void 0===n||n.ownerDocument.removeEventListener("pointerlockerror",A),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==db.NONE&&(this._state=db.NONE,this._activePointers.length=0,f())},n&&this.connect(n),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=_b(e.width,0,1),this._interactiveArea.height=_b(e.height,0,1),this._interactiveArea.x=_b(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=_b(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const i=_b(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=_b(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const s=!n||wb(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wb(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(s)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=pb,this._changedDolly=0,this._dollyToNoClamp(_b(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const t=this._collisionTest(),i=wb(t,this._spherical.radius);if(!(n>e)&&i)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||wb(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Hb).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||wb(this._target.x,this._targetEnd.x,this.restThreshold)&&wb(this._target.y,this._targetEnd.y,this.restThreshold)&&wb(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=_b(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||wb(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),Vb.setFromMatrixColumn(this._camera.matrix,0),Wb.setFromMatrixColumn(this._camera.matrix,1),Vb.multiplyScalar(e),Wb.multiplyScalar(-t);const i=Gb.copy(Vb).add(Wb),r=Qb.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,n)}forward(e,t=!1){Gb.setFromMatrixColumn(this._camera.matrix,0),Gb.crossVectors(this._camera.up,Gb),Gb.multiplyScalar(e);const n=Qb.copy(this._targetEnd).add(Gb);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return Gb.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Gb.x,this._targetEnd.y+Gb.y,this._targetEnd.z+Gb.z,t)}moveTo(e,t,n,i=!1){this._isUserControllingTruck=!1;const r=Gb.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const s=!i||wb(this._target.x,this._targetEnd.x,this.restThreshold)&&wb(this._target.y,this._targetEnd.y,this.restThreshold)&&wb(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}lookInDirectionOf(e,t,n,i=!1){const r=Gb.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,i)}fitToBox(e,t,{cover:n=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:s=0,paddingTop:a=0}={}){const o=[],l=e.isBox3?Kb.copy(e):Kb.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Cb(this._sphericalEnd.theta,yb),h=Cb(this._sphericalEnd.phi,yb);o.push(this.rotateTo(c,h,t));const u=Gb.setFromSpherical(this._sphericalEnd).normalize(),d=eM.setFromUnitVectors(u,Nb),p=wb(Math.abs(u.y),1);p&&d.multiply(tM.setFromAxisAngle(Ob,c)),d.multiply(this._yAxisUpSpaceInverse);const f=Zb.makeEmpty();Qb.copy(l.min).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.min).setX(l.max.x).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.min).setY(l.max.y).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.max).setZ(l.min.z).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.min).setZ(l.max.z).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.max).setY(l.min.y).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.max).setX(l.min.x).applyQuaternion(d),f.expandByPoint(Qb),Qb.copy(l.max).applyQuaternion(d),f.expandByPoint(Qb),f.min.x-=i,f.min.y-=s,f.max.x+=r,f.max.y+=a,d.setFromUnitVectors(Nb,u),p&&d.premultiply(tM.invert()),d.premultiply(this._yAxisUpSpace);const m=f.getSize(Gb),A=f.getCenter(Qb).applyQuaternion(d);if(Ab(this._camera)){const e=this.getDistanceToFitBox(m.x,m.y,m.z,n);o.push(this.moveTo(A.x,A.y,A.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(gb(this._camera)){const e=this._camera,i=e.right-e.left,r=e.top-e.bottom,s=n?Math.max(i/m.x,r/m.y):Math.min(i/m.x,r/m.y);o.push(this.moveTo(A.x,A.y,A.z,t)),o.push(this.zoomTo(s,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(t,n){const i=[],r="isObject3D"in t?e.createBoundingSphere(t,$b):$b.copy(t);if(i.push(this.moveTo(r.center.x,r.center.y,r.center.z,n)),Ab(this._camera)){const e=this.getDistanceToFitSphere(r.radius);i.push(this.dollyTo(e,n))}else if(gb(this._camera)){const e=this._camera.right-this._camera.left,t=this._camera.top-this._camera.bottom,s=2*r.radius,a=Math.min(e/s,t/s);i.push(this.zoomTo(a,n))}return i.push(this.setFocalOffset(0,0,0,n)),Promise.all(i)}setLookAt(e,t,n,i,r,s,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=pb,this._changedDolly=0;const o=Qb.set(i,r,s),l=Gb.set(e,t,n);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!a||wb(this._target.x,this._targetEnd.x,this.restThreshold)&&wb(this._target.y,this._targetEnd.y,this.restThreshold)&&wb(this._target.z,this._targetEnd.z,this.restThreshold)&&wb(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wb(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wb(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,n,i,r,s,a,o,l,c,h,u,d,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=pb,this._changedDolly=0;const f=Gb.set(i,r,s),m=Qb.set(e,t,n);qb.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));const A=zb.set(c,h,u),g=Qb.set(a,o,l);Yb.setFromVector3(g.sub(A).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(A,d));const v=Yb.theta-qb.theta,y=Yb.phi-qb.phi,x=Yb.radius-qb.radius;this._sphericalEnd.set(qb.radius+x*d,qb.phi+y*d,qb.theta+v*d),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const _=!p||wb(this._target.x,this._targetEnd.x,this.restThreshold)&&wb(this._target.y,this._targetEnd.y,this.restThreshold)&&wb(this._target.z,this._targetEnd.z,this.restThreshold)&&wb(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wb(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wb(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(_)}setPosition(e,t,n,i=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,n,i=!1){const r=this.getPosition(Gb),s=this.setLookAt(r.x,r.y,r.z,e,t,n,i);return this._sphericalEnd.phi=_b(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),s}setFocalOffset(e,t,n,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||wb(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&wb(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&wb(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),Vb.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Wb.setFromMatrixColumn(this._camera.matrixWorldInverse,1),jb.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=Gb.set(e,t,n),r=i.distanceTo(this._camera.position),s=i.sub(this._camera.position);Vb.multiplyScalar(s.x),Wb.multiplyScalar(s.y),jb.multiplyScalar(s.z),Gb.copy(Vb).add(Wb).add(jb),Gb.z=Gb.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Gb.x,Gb.y,-Gb.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,i){null!==e?(this._viewport=this._viewport||new Fb.Vector4,"number"==typeof e?this._viewport.set(e,t,n,i):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,n,i=!1){if(Tb(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,s=this._camera.getEffectiveFOV()*xb,a=this._camera.aspect;return.5*((i?r>a:r<a)?t:e/a)/Math.tan(.5*s)+.5*n}getDistanceToFitSphere(e){if(Tb(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*xb,n=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),i=1<this._camera.aspect?t:n;return e/Math.sin(.5*i)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Fb.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Fb.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Fb.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Fb.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%vb,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=vb),this._spherical.theta+=vb*Math.round((this._sphericalEnd.theta-this._spherical.theta)/vb)}reset(e=!1){if(!wb(this._camera.up.x,this._cameraUp0.x)||!wb(this._camera.up.y,this._cameraUp0.y)||!wb(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const e=this.getPosition(Gb);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ob),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=Gb.subVectors(this._target,this._camera.position).normalize(),t=Qb.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(Gb);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=Xb.subVectors(this._targetEnd,this._target),s=Jb.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Eb(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Sb(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(Eb(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Sb(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(Eb(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Sb(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(Eb(r.x)&&Eb(r.y)&&Eb(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Ib(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Eb(s.x)&&Eb(s.y)&&Eb(s.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Ib(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Eb(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Sb(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor)if(Ab(this._camera)&&0!==this._changedDolly){const e=this._spherical.radius-this._lastDistance,t=this._camera,n=this._getCameraDirection(Hb),i=Gb.copy(n).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);const r=Qb.crossVectors(i,n),s=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*xb*.5),a=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,o=zb.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*s*t.aspect)).add(r.multiplyScalar(this._dollyControlCoord.y*s)),l=Gb.copy(this._targetEnd).lerp(o,a),c=this._lastDollyDirection===fb&&this._spherical.radius<=this.minDistance,h=this._lastDollyDirection===mb&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(c||h)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;const t=Qb.copy(n).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);const u=Qb.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(u),this._changedDolly-=e,Eb(this._changedDolly)&&(this._changedDolly=0)}else if(gb(this._camera)&&0!==this._changedZoom){const e=this._zoom-this._lastZoom,t=this._camera,n=Gb.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),i=Qb.set(0,0,-1).applyQuaternion(t.quaternion),r=zb.copy(n).add(i.multiplyScalar(-n.dot(t.up))),s=-(this._zoom-e-this._zoom)/this._zoom,a=this._getCameraDirection(Hb),o=this._targetEnd.dot(a),l=Gb.copy(this._targetEnd).lerp(r,s),c=l.dot(a),h=a.multiplyScalar(c-o);l.sub(h),this._boundary.clampPoint(l,l);const u=Qb.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(u),this._changedZoom-=e,Eb(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const o=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,o),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!Eb(this._focalOffset.x)||!Eb(this._focalOffset.y)||!Eb(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Vb.setFromMatrixColumn(this._camera.matrix,0),Wb.setFromMatrixColumn(this._camera.matrix,1),jb.setFromMatrixColumn(this._camera.matrix,2),Vb.multiplyScalar(this._focalOffset.x),Wb.multiplyScalar(-this._focalOffset.y),jb.multiplyScalar(this._focalOffset.z),Gb.copy(Vb).add(Wb).add(jb),this._camera.position.add(Gb)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Gb.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),Eb(t,this.restThreshold)&&Eb(n,this.restThreshold)&&Eb(i,this.restThreshold)&&Eb(r.x,this.restThreshold)&&Eb(r.y,this.restThreshold)&&Eb(r.z,this.restThreshold)&&Eb(s.x,this.restThreshold)&&Eb(s.y,this.restThreshold)&&Eb(s.z,this.restThreshold)&&Eb(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:bb(this.maxDistance),minZoom:this.minZoom,maxZoom:bb(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:bb(this.maxPolarAngle),minAzimuthAngle:bb(this.minAzimuthAngle),maxAzimuthAngle:bb(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:Gb.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Mb(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Mb(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Mb(n.maxPolarAngle),this.minAzimuthAngle=Mb(n.minAzimuthAngle),this.maxAzimuthAngle=Mb(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),qb.setFromVector3(Gb.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(qb.theta,qb.phi,t),this.dollyTo(qb.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):(e.setAttribute("data-camera-controls-version","2.8.5"),this._addAllEventListeners(e),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const i=t.lengthSq();if(0===i)return e;const r=Qb.copy(t).add(e),s=this._boundary.clampPoint(r,zb).sub(r),a=s.lengthSq();if(0===a)return e.add(t);if(a===i)return e;if(0===n)return e.add(t).add(s);{const i=1+n*a/t.dot(s);return e.add(Qb.copy(t).multiplyScalar(i)).add(s.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Ab(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*xb,i=Math.tan(.5*n)*t,r=i*e.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(gb(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,i=e.right*t,r=e.top*t,s=e.bottom*t;this._nearPlaneCorners[0].set(n,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,s,0),this._nearPlaneCorners[3].set(n,s,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(Tb(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Hb);nM.lookAt(Ub,t,this._camera.up);for(let n=0;n<4;n++){const i=Qb.copy(this._nearPlaneCorners[n]);i.applyMatrix4(nM);const r=zb.addVectors(this._target,i);iM.set(r,t),iM.far=this._spherical.radius+1;const s=iM.intersectObjects(this.colliderMeshes);0!==s.length&&s[0].distance<e&&(e=s[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{const t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Fb.Sphere){const n=t,i=n.center;Kb.makeEmpty(),e.traverseVisible((e=>{e.isMesh&&Kb.expandByObject(e)})),Kb.getCenter(i);let r=0;return e.traverseVisible((e=>{if(!e.isMesh)return;const t=e,n=t.geometry.clone();n.applyMatrix4(t.matrixWorld);const s=n.attributes.position;for(let e=0,t=s.count;e<t;e++)Gb.fromBufferAttribute(s,e),r=Math.max(r,i.distanceToSquared(Gb))})),n.radius=Math.sqrt(r),n}};class sM extends Zu{controls;constructor(e,t={}){super(e);const{enableDamping:n=!0}=t,i=new Np(e.camera,e.renderer.domElement);this.controls=i,i.enableDamping=n}update(e){this.controls.update()}}class aM extends bi{constructor(e=((e,t,n)=>n.set(e,t,Math.cos(e)*Math.sin(t))),t=8,n=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],s=[],a=[],o=1e-5,l=new Ot,c=new Ot,h=new Ot,u=new Ot,d=new Ot,p=t+1;for(let i=0;i<=n;i++){const p=i/n;for(let n=0;n<=t;n++){const i=n/t;e(i,p,c),r.push(c.x,c.y,c.z),i-o>=0?(e(i-o,p,h),u.subVectors(c,h)):(e(i+o,p,h),u.subVectors(h,c)),p-o>=0?(e(i,p-o,h),d.subVectors(c,h)):(e(i,p+o,h),d.subVectors(h,c)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),a.push(i,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,r=e*p+n+1,s=(e+1)*p+n+1,a=(e+1)*p+n;i.push(t,r,a),i.push(r,s,a)}this.setIndex(i),this.setAttribute("position",new gi(r,3)),this.setAttribute("normal",new gi(s,3)),this.setAttribute("uv",new gi(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class oM extends Zu{width;height;rt;constructor(e,t={}){super(e);const{width:n,height:i,samples:r=0,depth:s=!1,options:a={}}=t;this.width=n,this.height=i;const o=new Lt(this.actualWidth,this.actualHeight,{minFilter:E,magFilter:E,type:R,...a});this.rt=o,s&&(o.depthTexture=new Qa(this.actualWidth,this.actualHeight,T)),r&&(o.samples=r),this.base.resizer.on("resize",(()=>{this.rt.setSize(this.actualWidth,this.actualHeight)}))}get actualWidth(){return this.width||window.innerWidth*window.devicePixelRatio}get actualHeight(){return this.height||window.innerHeight*window.devicePixelRatio}}class lM extends Zu{frames;blur;smooth;shadowCamera;renderTarget;renderTargetBlur;blurPlane;depthMaterial;horizontalBlurMaterial;verticalBlurMaterial;count;group;mesh;constructor(e,t={}){super(e);let{scale:n=10,frames:i=1/0,opacity:r=1,width:s=1,height:a=1,blur:o=1,far:l=10,resolution:c=512,smooth:h=!0,color:u="#000000",depthWrite:d=!1}=t;this.frames=i,this.blur=o,this.smooth=h,s*=Array.isArray(n)?n[0]:n||1,a*=Array.isArray(n)?n[1]:n||1,this.base.renderer;const p=new wr(-s/2,s/2,a/2,-a/2,0,l);this.shadowCamera=p;const f=new Lt(c,c);this.renderTarget=f;const m=new Lt(c,c);this.renderTargetBlur=m,m.texture.generateMipmaps=f.texture.generateMipmaps=!1;const A=new dr(s,a).rotateX(Math.PI/2),g=new Hi(A);this.blurPlane=g;const v=new Ra;this.depthMaterial=v,v.depthTest=v.depthWrite=!1,v.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new ni(u)}},e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n         void main() {\n        "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const y=new Yi(am);this.horizontalBlurMaterial=y;const x=new Yi(om);this.verticalBlurMaterial=x,x.depthTest=y.depthTest=!1,this.count=0;const _=new Na;this.group=_,_.rotation.x=Math.PI/2;const E=new ai({map:f.texture,transparent:!0,opacity:r,depthWrite:d}),w=new Hi(A,E);this.mesh=w,w.scale.set(1,-1,1),w.rotation.set(-Math.PI/2,0,0)}addExisting(){this.group.add(this.mesh),this.group.add(this.shadowCamera),this.container.add(this.group)}blurShadows(e){const{shadowCamera:t,renderTarget:n,renderTargetBlur:i,blurPlane:r,horizontalBlurMaterial:s,verticalBlurMaterial:a}=this,o=this.base.renderer;r.visible=!0,r.material=s,s.uniforms.tDiffuse.value=n.texture,s.uniforms.h.value=1*e/256,o.setRenderTarget(i),o.render(r,t),r.material=a,a.uniforms.tDiffuse.value=i.texture,a.uniforms.v.value=1*e/256,o.setRenderTarget(n),o.render(r,t),r.visible=!1}update(e){let{shadowCamera:t,frames:n,blur:i,smooth:r,depthMaterial:s,renderTarget:a}=this;const o=this.container,l=this.base.renderer;if(t&&(n===1/0||this.count<n)){const e=o.background;o.background=null;const n=o.overrideMaterial;o.overrideMaterial=s,l.setRenderTarget(a),l.render(o,t),o.overrideMaterial=n,this.blurShadows(i),r&&this.blurShadows(.4*i),l.setRenderTarget(null),o.background=e,this.count+=1}}}const cM={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};class hM extends Yi{kernel;constructor(e=new ot){super({uniforms:{inputBuffer:new xu(null),depthBuffer:new xu(null),resolution:new xu(new ot),texelSize:new xu(new ot),halfTexelSize:new xu(new ot),kernel:new xu(0),scale:new xu(1),cameraNear:new xu(0),cameraFar:new xu(1),minDepthThreshold:new xu(0),maxDepthThreshold:new xu(1),depthScale:new xu(0),depthToBlurRatioBias:new xu(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:0,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class uM{renderTargetA;renderTargetB;convolutionMaterial;scene;camera;screen;renderToScreen;constructor({gl:e,resolution:t,width:n=500,height:i=500,minDepthThreshold:r=0,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:o=.25}){this.renderToScreen=!1,this.renderTargetA=new Lt(t,t,{minFilter:E,magFilter:E,stencilBuffer:!1,depthBuffer:!1,type:R}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new hM,this.convolutionMaterial.setTexelSize(1/n,1/i),this.convolutionMaterial.setResolution(new ot(n,i)),this.scene=new qa,this.camera=new Ki,this.convolutionMaterial.uniforms.minDepthThreshold.value=r,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=o,this.convolutionMaterial.defines.USE_DEPTH=a>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),h=new bi;h.setAttribute("position",new fi(l,3)),h.setAttribute("uv",new fi(c,2)),this.screen=new Hi(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const i=this.scene,r=this.camera,s=this.renderTargetA,a=this.renderTargetB;let o=this.convolutionMaterial,l=o.uniforms;l.depthBuffer.value=t.depthTexture;const c=o.kernel;let h,u,d,p=t;for(u=0,d=c.length-1;u<d;++u)h=0==(1&u)?s:a,l.kernel.value=c[u],l.inputBuffer.value=p.texture,e.setRenderTarget(h),e.render(i,r),p=h;l.kernel.value=c[u],l.inputBuffer.value=p.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(i,r)}}function dM(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pM(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}
/*!
	 * GSAP 3.12.5
	 * https://gsap.com
	 *
	 * @license Copyright 2008-2024, GreenSock. All rights reserved.
	 * Subject to the terms at https://gsap.com/standard-license or for
	 * Club GSAP members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/var fM,mM,AM,gM,vM,yM,xM,_M,EM,wM,CM,bM={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},MM={duration:.5,overwrite:!1,delay:0},SM=1e8,IM=1e-8,BM=2*Math.PI,TM=BM/4,RM=0,DM=Math.sqrt,LM=Math.cos,PM=Math.sin,FM=function(e){return"string"==typeof e},UM=function(e){return"function"==typeof e},OM=function(e){return"number"==typeof e},NM=function(e){return void 0===e},kM=function(e){return"object"==typeof e},GM=function(e){return!1!==e},QM=function(){return"undefined"!=typeof window},zM=function(e){return UM(e)||FM(e)},HM="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},VM=Array.isArray,WM=/(?:-?\.?\d|\.)+/gi,jM=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,XM=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,JM=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,qM=/[+-]=-?[.\d]+/,YM=/[^,'"\[\]\s]+/gi,KM=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ZM={},$M={},eS=function(e){return($M=BS(e,ZM))&&RB},tS=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},nS=function(e,t){return!t&&console.warn(e)},iS=function(e,t){return e&&(ZM[e]=t)&&$M&&($M[e]=t)||ZM},rS=function(){return 0},sS={suppressEvents:!0,isStart:!0,kill:!1},aS={suppressEvents:!0,kill:!1},oS={suppressEvents:!0},lS={},cS=[],hS={},uS={},dS={},pS=30,fS=[],mS="",AS=function(e){var t,n,i=e[0];if(kM(i)||UM(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=fS.length;n--&&!fS[n].targetTest(i););t=fS[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new WI(e[n],t)))||e.splice(n,1);return e},gS=function(e){return e._gsap||AS(lI(e))[0]._gsap},vS=function(e,t,n){return(n=e[t])&&UM(n)?e[t]():NM(n)&&e.getAttribute&&e.getAttribute(t)||n},yS=function(e,t){return(e=e.split(",")).forEach(t)||e},xS=function(e){return Math.round(1e5*e)/1e5||0},_S=function(e){return Math.round(1e7*e)/1e7||0},ES=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},wS=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},CS=function(){var e,t,n=cS.length,i=cS.slice(0);for(hS={},cS.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},bS=function(e,t,n,i){cS.length&&!mM&&CS(),e.render(t,n,mM&&t<0&&(e._initted||e._startAt)),cS.length&&!mM&&CS()},MS=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(YM).length<2?t:FM(e)?e.trim():e},SS=function(e){return e},IS=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},BS=function(e,t){for(var n in t)e[n]=t[n];return e},TS=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=kM(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},RS=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},DS=function(e){var t,n=e.parent||gM,i=e.keyframes?(t=VM(e.keyframes),function(e,n){for(var i in n)i in e||"duration"===i&&t||"ease"===i||(e[i]=n[i])}):IS;if(GM(e.inherit))for(;n;)i(e,n.vars.defaults),n=n.parent||n._dp;return e},LS=function(e,t,n,i,r){var s,a=e[i];if(r)for(s=t[r];a&&a[r]>s;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},PS=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=t._prev,s=t._next;r?r._next=s:e[n]===t&&(e[n]=s),s?s._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},FS=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},US=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},OS=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},NS=function(e,t,n,i){return e._startAt&&(mM?e._startAt.revert(aS):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},kS=function e(t){return!t||t._ts&&e(t.parent)},GS=function(e){return e._repeat?QS(e._tTime,e=e.duration()+e._rDelay)*e:0},QS=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},zS=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},HS=function(e){return e._end=_S(e._start+(e._tDur/Math.abs(e._ts||e._rts||IM)||0))},VS=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=_S(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),HS(e),n._dirty||US(n,e)),e},WS=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=zS(e.rawTime(),t),(!t._dur||iI(0,t.totalDuration(),n)-t._tTime>IM)&&t.render(n,!0)),US(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},jS=function(e,t,n,i){return t.parent&&FS(t),t._start=_S((OM(n)?n:n||e!==gM?eI(e,n,t):e._time)+t._delay),t._end=_S(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),LS(e,t,"_first","_last",e._sort?"_start":0),YS(t)||(e._recent=t),i||WS(e,t),e._ts<0&&VS(e,e._tTime),e},XS=function(e,t){return(ZM.ScrollTrigger||tS("scrollTrigger",t))&&ZM.ScrollTrigger.create(t,e)},JS=function(e,t,n,i,r){return $I(e,t,r),e._initted?!n&&e._pt&&!mM&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&EM!==DI.frame?(cS.push(e),e._lazy=[r,i],1):void 0:1},qS=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},YS=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},KS=function(e,t,n,i){var r=e._repeat,s=_S(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=r?r<0?1e10:_S(s*(r+1)+e._rDelay*r):s,a>0&&!i&&VS(e,e._tTime=e._tDur*a),e.parent&&HS(e),n||US(e.parent,e),e},ZS=function(e){return e instanceof XI?US(e):KS(e,e._dur)},$S={_start:0,endTime:rS,totalDuration:rS},eI=function e(t,n,i){var r,s,a,o=t.labels,l=t._recent||$S,c=t.duration()>=SM?l.endTime(!1):t._dur;return FM(n)&&(isNaN(n)||n in o)?(s=n.charAt(0),a="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(r<0?l:i).totalDuration()/100:1)):r<0?(n in o||(o[n]=c),o[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),a&&i&&(s=s/100*(VM(i)?i[0]:i).totalDuration()),r>1?e(t,n.substr(0,r-1),i)+s:c+s)):null==n?c:+n},tI=function(e,t,n){var i,r,s=OM(t[1]),a=(s?2:1)+(e<2?0:1),o=t[a];if(s&&(o.duration=t[1]),o.parent=n,e){for(i=o,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=GM(r.vars.inherit)&&r.parent;o.immediateRender=GM(i.immediateRender),e<2?o.runBackwards=1:o.startAt=t[a-1]}return new rB(t[0],o,t[a+1])},nI=function(e,t){return e||0===e?t(e):t},iI=function(e,t,n){return n<e?e:n>t?t:n},rI=function(e,t){return FM(e)&&(t=KM.exec(e))?t[1]:""},sI=[].slice,aI=function(e,t){return e&&kM(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&kM(e[0]))&&!e.nodeType&&e!==vM},oI=function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var i;return FM(e)&&!t||aI(e,1)?(i=n).push.apply(i,lI(e)):n.push(e)}))||n},lI=function(e,t,n){return AM&&!t&&AM.selector?AM.selector(e):!FM(e)||n||!yM&&LI()?VM(e)?oI(e,n):aI(e)?sI.call(e,0):e?[e]:[]:sI.call((t||xM).querySelectorAll(e),0)},cI=function(e){return e=lI(e)[0]||nS("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return lI(t,n.querySelectorAll?n:n===e?nS("Invalid scope")||xM.createElement("div"):e)}},hI=function(e){return e.sort((function(){return.5-Math.random()}))},uI=function(e){if(UM(e))return e;var t=kM(e)?e:{each:e},n=GI(t.ease),i=t.from||0,r=parseFloat(t.base)||0,s={},a=i>0&&i<1,o=isNaN(i)||a,l=t.axis,c=i,h=i;return FM(i)?c=h={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(c=i[0],h=i[1]),function(e,a,u){var d,p,f,m,A,g,v,y,x,_=(u||t).length,E=s[_];if(!E){if(!(x="auto"===t.grid?0:(t.grid||[1,SM])[1])){for(v=-1e8;v<(v=u[x++].getBoundingClientRect().left)&&x<_;);x<_&&x--}for(E=s[_]=[],d=o?Math.min(x,_)*c-.5:i%x,p=x===SM?0:o?_*h/x-.5:i/x|0,v=0,y=SM,g=0;g<_;g++)f=g%x-d,m=p-(g/x|0),E[g]=A=l?Math.abs("y"===l?m:f):DM(f*f+m*m),A>v&&(v=A),A<y&&(y=A);"random"===i&&hI(E),E.max=v-y,E.min=y,E.v=_=(parseFloat(t.amount)||parseFloat(t.each)*(x>_?_-1:l?"y"===l?_/x:x:Math.max(x,_/x))||0)*("edges"===i?-1:1),E.b=_<0?r-_:r,E.u=rI(t.amount||t.each)||0,n=n&&_<0?NI(n):n}return _=(E[e]-E.min)/E.max||0,_S(E.b+(n?n(_):_)*E.v)+E.u}},dI=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=_S(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(OM(n)?0:rI(n))}},pI=function(e,t){var n,i,r=VM(e);return!r&&kM(e)&&(n=r=e.radius||SM,e.values?(e=lI(e.values),(i=!OM(e[0]))&&(n*=n)):e=dI(e.increment)),nI(t,r?UM(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var r,s,a=parseFloat(i?t.x:t),o=parseFloat(i?t.y:0),l=SM,c=0,h=e.length;h--;)(r=i?(r=e[h].x-a)*r+(s=e[h].y-o)*s:Math.abs(e[h]-a))<l&&(l=r,c=h);return c=!n||l<=n?e[c]:t,i||c===t||OM(t)?c:c+rI(t)}:dI(e))},fI=function(e,t,n,i){return nI(VM(e)?!t:!0===n?!!(n=0):!i,(function(){return VM(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i}))},mI=function(e,t,n){return nI(n,(function(n){return e[~~t(n)]}))},AI=function(e){for(var t,n,i,r,s=0,a="";~(t=e.indexOf("random(",s));)i=e.indexOf(")",t),r="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(r?YM:WM),a+=e.substr(s,t-s)+fI(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return a+e.substr(s,e.length-s)},gI=function(e,t,n,i,r){var s=t-e,a=i-n;return nI(r,(function(t){return n+((t-e)/s*a||0)}))},vI=function(e,t,n){var i,r,s,a=e.labels,o=SM;for(i in a)(r=a[i]-t)<0==!!n&&r&&o>(r=Math.abs(r))&&(s=i,o=r);return s},yI=function(e,t,n){var i,r,s,a=e.vars,o=a[t],l=AM,c=e._ctx;if(o)return i=a[t+"Params"],r=a.callbackScope||e,n&&cS.length&&CS(),c&&(AM=c),s=i?o.apply(r,i):o.call(r),AM=l,s},xI=function(e){return FS(e),e.scrollTrigger&&e.scrollTrigger.kill(!!mM),e.progress()<1&&yI(e,"onInterrupt"),e},_I=[],EI=function(e){if(e)if(e=!e.name&&e.default||e,QM()||e.headless){var t=e.name,n=UM(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:rS,render:pB,add:KI,kill:mB,modifier:fB,rawVars:0},s={targetTest:0,get:0,getSetter:cB,aliases:{},register:0};if(LI(),e!==i){if(uS[t])return;IS(i,IS(RS(e,r),s)),BS(i.prototype,BS(r,RS(e,s))),uS[i.prop=t]=i,e.targetTest&&(fS.push(i),lS[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}iS(t,i),e.register&&e.register(RB,i,vB)}else _I.push(e)},wI=255,CI={aqua:[0,wI,wI],lime:[0,wI,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,wI],navy:[0,0,128],white:[wI,wI,wI],olive:[128,128,0],yellow:[wI,wI,0],orange:[wI,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[wI,0,0],pink:[wI,192,203],cyan:[0,wI,wI],transparent:[wI,wI,wI,0]},bI=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*wI+.5|0},MI=function(e,t,n){var i,r,s,a,o,l,c,h,u,d,p=e?OM(e)?[e>>16,e>>8&wI,e&wI]:0:CI.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),CI[e])p=CI[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),r=e.charAt(2),s=e.charAt(3),e="#"+i+i+r+r+s+s+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&wI,p&wI,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&wI,e&wI]}else if("hsl"===e.substr(0,3))if(p=d=e.match(WM),t){if(~e.indexOf("="))return p=e.match(jM),n&&p.length<4&&(p[3]=1),p}else a=+p[0]%360/360,o=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=bI(a+1/3,i,r),p[1]=bI(a,i,r),p[2]=bI(a-1/3,i,r);else p=e.match(WM)||CI.transparent;p=p.map(Number)}return t&&!d&&(i=p[0]/wI,r=p[1]/wI,s=p[2]/wI,l=((c=Math.max(i,r,s))+(h=Math.min(i,r,s)))/2,c===h?a=o=0:(u=c-h,o=l>.5?u/(2-c-h):u/(c+h),a=c===i?(r-s)/u+(r<s?6:0):c===r?(s-i)/u+2:(i-r)/u+4,a*=60),p[0]=~~(a+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},SI=function(e){var t=[],n=[],i=-1;return e.split(BI).forEach((function(e){var r=e.match(XM)||[];t.push.apply(t,r),n.push(i+=r.length+1)})),t.c=n,t},II=function(e,t,n){var i,r,s,a,o="",l=(e+o).match(BI),c=t?"hsla(":"rgba(",h=0;if(!l)return e;if(l=l.map((function(e){return(e=MI(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(s=SI(e),(i=n.c).join(o)!==s.c.join(o)))for(a=(r=e.replace(BI,"1").split(XM)).length-1;h<a;h++)o+=r[h]+(~i.indexOf(h)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(a=(r=e.split(BI)).length-1;h<a;h++)o+=r[h]+l[h];return o+r[a]},BI=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in CI)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),TI=/hsl[a]?\(/,RI=function(e){var t,n=e.join(" ");if(BI.lastIndex=0,BI.test(n))return t=TI.test(n),e[1]=II(e[1],t),e[0]=II(e[0],t,SI(e[1])),!0},DI=function(){var e,t,n,i,r,s,a=Date.now,o=500,l=33,c=a(),h=c,u=1e3/240,d=u,p=[],f=function n(f){var m,A,g,v,y=a()-h,x=!0===f;if((y>o||y<0)&&(c+=y-l),((m=(g=(h+=y)-c)-d)>0||x)&&(v=++i.frame,r=g-1e3*i.time,i.time=g/=1e3,d+=m+(m>=u?4:u-m),A=1),x||(e=t(n)),A)for(s=0;s<p.length;s++)p[s](g,r,v,f)};return i={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(e){return r/(1e3/(e||60))},wake:function(){_M&&(!yM&&QM()&&(vM=yM=window,xM=vM.document||{},ZM.gsap=RB,(vM.gsapVersions||(vM.gsapVersions=[])).push(RB.version),eS($M||vM.GreenSockGlobals||!vM.gsap&&vM||{}),_I.forEach(EI)),n="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,e&&i.sleep(),t=n||function(e){return setTimeout(e,d-1e3*i.time+1|0)},CM=1,f(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(e),CM=0,t=rS},lagSmoothing:function(e,t){o=e||1/0,l=Math.min(t||33,o)},fps:function(e){u=1e3/(e||240),d=1e3*i.time+u},add:function(e,t,n){var r=t?function(t,n,s,a){e(t,n,s,a),i.remove(r)}:e;return i.remove(e),p[n?"unshift":"push"](r),LI(),r},remove:function(e,t){~(t=p.indexOf(e))&&p.splice(t,1)&&s>=t&&s--},_listeners:p},i}(),LI=function(){return!CM&&DI.wake()},PI={},FI=/^[\d.\-M][\d.\-,\s]/,UI=/["']/g,OI=function(e){for(var t,n,i,r={},s=e.substr(1,e.length-3).split(":"),a=s[0],o=1,l=s.length;o<l;o++)n=s[o],t=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),r[a]=isNaN(i)?i.replace(UI,"").trim():+i,a=n.substr(t+1).trim();return r},NI=function(e){return function(t){return 1-e(1-t)}},kI=function e(t,n){for(var i,r=t._first;r;)r instanceof XI?e(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?e(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},GI=function(e,t){return e&&(UM(e)?e:PI[e]||function(e){var t=(e+"").split("("),n=PI[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[OI(t[1])]:function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)}(e).split(",").map(MS)):PI._CE&&FI.test(e)?PI._CE("",e):n}(e))||t},QI=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var r,s={easeIn:t,easeOut:n,easeInOut:i};return yS(e,(function(e){for(var t in PI[e]=ZM[e]=s,PI[r=e.toLowerCase()]=n,s)PI[r+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=PI[e+"."+t]=s[t]})),s},zI=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},HI=function e(t,n,i){var r=n>=1?n:1,s=(i||(t?.3:.45))/(n<1?n:1),a=s/BM*(Math.asin(1/r)||0),o=function(e){return 1===e?1:r*Math.pow(2,-10*e)*PM((e-a)*s)+1},l="out"===t?o:"in"===t?function(e){return 1-o(1-e)}:zI(o);return s=BM/s,l.config=function(n,i){return e(t,n,i)},l},VI=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},r="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:zI(i);return r.config=function(n){return e(t,n)},r};yS("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;QI(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),PI.Linear.easeNone=PI.none=PI.Linear.easeIn,QI("Elastic",HI("in"),HI("out"),HI()),function(e,t){var n=1/t,i=function(i){return i<n?e*i*i:i<.7272727272727273?e*Math.pow(i-1.5/t,2)+.75:i<.9090909090909092?e*(i-=2.25/t)*i+.9375:e*Math.pow(i-2.625/t,2)+.984375};QI("Bounce",(function(e){return 1-i(1-e)}),i)}(7.5625,2.75),QI("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),QI("Circ",(function(e){return-(DM(1-e*e)-1)})),QI("Sine",(function(e){return 1===e?1:1-LM(e*TM)})),QI("Back",VI("in"),VI("out"),VI()),PI.SteppedEase=PI.steps=ZM.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0;return function(e){return((i*iI(0,.99999999,e)|0)+r)*n}}},MM.ease=PI["quad.out"],yS("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return mS+=e+","+e+"Params,"}));var WI=function(e,t){this.id=RM++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:vS,this.set=t?t.getSetter:cB},jI=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,KS(this,+e.duration,1,1),this.data=e.data,AM&&(this._ctx=AM,AM.data.push(this)),CM||DI.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,KS(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(LI(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(VS(this,e),!n._dp||n.parent||WS(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&jS(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===IM||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),bS(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+GS(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+GS(this),t):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?QS(this._tTime,n)+1:1},t.timeScale=function(e,t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var n=this.parent&&this._ts?zS(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(iI(-Math.abs(this._delay),this._tDur,n),!1!==t),HS(this),OS(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(LI(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==IM&&(this._tTime-=IM)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&jS(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(GM(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?zS(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=oS);var t=mM;return mM=e,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),mM=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(Math.abs(t._ts)||1),t=t._dp;return!this.parent&&this._sat?this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,ZS(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,ZS(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(eI(this,e),GM(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,GM(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-IM))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise((function(n){var i=UM(e)?e:SS,r=function(){var e=t.then;t.then=null,UM(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?r():t._prom=r}))},t.kill=function(){xI(this)},e}();IS(jI.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var XI=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=GM(t.sortChildren),gM&&jS(t.parent||gM,dM(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&XS(dM(i),t.scrollTrigger),i}pM(t,e);var n=t.prototype;return n.to=function(e,t,n){return tI(0,arguments,this),this},n.from=function(e,t,n){return tI(1,arguments,this),this},n.fromTo=function(e,t,n,i){return tI(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,DS(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new rB(e,t,eI(this,n),1),this},n.call=function(e,t,n){return jS(this,rB.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,r,s,a){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=a,n.parent=this,new rB(e,n,eI(this,r)),this},n.staggerFrom=function(e,t,n,i,r,s,a){return n.runBackwards=1,DS(n).immediateRender=GM(n.immediateRender),this.staggerTo(e,t,n,i,r,s,a)},n.staggerFromTo=function(e,t,n,i,r,s,a,o){return i.startAt=n,DS(i).immediateRender=GM(i.immediateRender),this.staggerTo(e,t,i,r,s,a,o)},n.render=function(e,t,n){var i,r,s,a,o,l,c,h,u,d,p,f,m=this._time,A=this._dirty?this.totalDuration():this._tDur,g=this._dur,v=e<=0?0:_S(e),y=this._zTime<0!=e<0&&(this._initted||!g);if(this!==gM&&v>A&&e>=0&&(v=A),v!==this._tTime||n||y){if(m!==this._time&&g&&(v+=this._time-m,e+=this._time-m),i=v,u=this._start,l=!(h=this._ts),y&&(g||(m=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,o=g+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*o+e,t,n);if(i=_S(v%o),v===A?(a=this._repeat,i=g):((a=~~(v/o))&&a===v/o&&(i=g,a--),i>g&&(i=g)),d=QS(this._tTime,o),!m&&this._tTime&&d!==a&&this._tTime-d*o-this._dur<=0&&(d=a),p&&1&a&&(i=g-i,f=1),a!==d&&!this._lock){var x=p&&1&d,_=x===(p&&1&a);if(a<d&&(x=!x),m=x?0:v%g?g:v,this._lock=1,this.render(m||(f?0:_S(a*o)),t,!g)._lock=0,this._tTime=v,!t&&this.parent&&yI(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(g=this._dur,A=this._tDur,_&&(this._lock=2,m=x?g:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;kI(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,_S(m),_S(i)),c&&(v-=i-(i=c._start))),this._tTime=v,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,m=0),!m&&i&&!t&&!a&&(yI(this,"onStart"),this._tTime!==v))return this;if(i>=m&&e>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&c!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!l){c=0,s&&(v+=this._zTime=-1e-8);break}}r=s}else{r=this._last;for(var E=e<0?e:i;r;){if(s=r._prev,(r._act||E<=r._end)&&r._ts&&c!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(E-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(E-r._start)*r._ts,t,n||mM&&(r._initted||r._startAt)),i!==this._time||!this._ts&&!l){c=0,s&&(v+=this._zTime=E?-1e-8:IM);break}}r=s}}if(c&&!t&&(this.pause(),c.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=u,HS(this),this.render(e,t,n);this._onUpdate&&!t&&yI(this,"onUpdate",!0),(v===A&&this._tTime>=this.totalDuration()||!v&&m)&&(u!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||((e||!g)&&(v===A&&this._ts>0||!v&&this._ts<0)&&FS(this,1),t||e<0&&!m||!v&&!m&&A||(yI(this,v===A&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(v<A&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(OM(t)||(t=eI(this,t,e)),!(e instanceof jI)){if(VM(e))return e.forEach((function(e){return n.add(e,t)})),this;if(FM(e))return this.addLabel(e,t);if(!UM(e))return this;e=rB.delayedCall(0,e)}return this!==e?jS(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-1e8);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof rB?t&&r.push(s):(n&&r.push(s),e&&r.push.apply(r,s.getChildren(!0,t,n)))),s=s._next;return r},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return FM(e)?this.removeLabel(e):UM(e)?this.killTweensOf(e):(PS(this,e),e===this._recent&&(this._recent=this._last),US(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_S(DI.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=eI(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=rB.delayedCall(0,t||rS,n);return i.data="isPause",this._hasPause=1,jS(this,i,eI(this,e))},n.removePause=function(e){var t=this._first;for(e=eI(this,e);t;)t._start===e&&"isPause"===t.data&&FS(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),r=i.length;r--;)JI!==i[r]&&i[r].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],r=lI(e),s=this._first,a=OM(t);s;)s instanceof rB?wS(s._targets,r)&&(a?(!JI||s._initted&&s._ts)&&s.globalTime(0)<=t&&s.globalTime(s.totalDuration())>t:!t||s.isActive())&&i.push(s):(n=s.getTweensOf(r,t)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,r=eI(i,e),s=t,a=s.startAt,o=s.onStart,l=s.onStartParams,c=s.immediateRender,h=rB.to(i,IS({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:t.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale())||IM,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale());h._dur!==e&&KS(h,e,0,1).render(h._time,!0,!0),n=1}o&&o.apply(h,l||[])}},t));return c?h.render(0):h},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,IS({startAt:{time:eI(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),vI(this,eI(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),vI(this,eI(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+IM)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=e,r._end+=e),r=r._next;if(t)for(i in s)s[i]>=n&&(s[i]+=e);return US(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),US(this)},n.totalDuration=function(e){var t,n,i,r=0,s=this,a=s._last,o=SM;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-e:e));if(s._dirty){for(i=s.parent;a;)t=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&s._sort&&a._ts&&!s._lock?(s._lock=1,jS(s,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),o=0),a._end>r&&a._ts&&(r=a._end),a=t;KS(s,s===gM&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},t.updateRoot=function(e){if(gM._ts&&(bS(gM,zS(e,gM)),EM=DI.frame),DI.frame>=pS){pS+=bM.autoSleep||120;var t=gM._first;if((!t||!t._ts)&&bM.autoSleep&&DI._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||DI.sleep()}}},t}(jI);IS(XI.prototype,{_lock:0,_hasPause:0,_forcing:0});var JI,qI,YI=function(e,t,n,i,r,s,a){var o,l,c,h,u,d,p,f,m=new vB(this._pt,e,t,0,1,dB,null,r),A=0,g=0;for(m.b=n,m.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=AI(i)),s&&(s(f=[n,i],e,t),n=f[0],i=f[1]),l=n.match(JM)||[];o=JM.exec(i);)h=o[0],u=i.substring(A,o.index),c?c=(c+1)%5:"rgba("===u.substr(-5)&&(c=1),h!==l[g++]&&(d=parseFloat(l[g-1])||0,m._pt={_next:m._pt,p:u||1===g?u:",",s:d,c:"="===h.charAt(1)?ES(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},A=JM.lastIndex);return m.c=A<i.length?i.substring(A,i.length):"",m.fp=a,(qM.test(i)||p)&&(m.e=0),this._pt=m,m},KI=function(e,t,n,i,r,s,a,o,l,c){UM(i)&&(i=i(r||0,e,s));var h,u=e[t],d="get"!==n?n:UM(u)?l?e[t.indexOf("set")||!UM(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():u,p=UM(u)?l?oB:aB:sB;if(FM(i)&&(~i.indexOf("random(")&&(i=AI(i)),"="===i.charAt(1)&&((h=ES(d,i)+(rI(d)||0))||0===h)&&(i=h)),!c||d!==i||qI)return isNaN(d*i)||""===i?(!u&&!(t in e)&&tS(t,i),YI.call(this,e,t,d,i,p,o||bM.stringFilter,l)):(h=new vB(this._pt,e,t,+d||0,i-(d||0),"boolean"==typeof u?uB:hB,0,p),l&&(h.fp=l),a&&h.modifier(a,this,e),this._pt=h)},ZI=function(e,t,n,i,r,s){var a,o,l,c;if(uS[e]&&!1!==(a=new uS[e]).init(r,a.rawVars?t[e]:function(e,t,n,i,r){if(UM(e)&&(e=tB(e,r,t,n,i)),!kM(e)||e.style&&e.nodeType||VM(e)||HM(e))return FM(e)?tB(e,r,t,n,i):e;var s,a={};for(s in e)a[s]=tB(e[s],r,t,n,i);return a}(t[e],i,r,s,n),n,i,s)&&(n._pt=o=new vB(n._pt,r,e,0,1,a.render,a,0,a.priority),n!==wM))for(l=n._ptLookup[n._targets.indexOf(r)],c=a._props.length;c--;)l[a._props[c]]=o;return a},$I=function e(t,n,i){var r,s,a,o,l,c,h,u,d,p,f,m,A,g=t.vars,v=g.ease,y=g.startAt,x=g.immediateRender,_=g.lazy,E=g.onUpdate,w=g.runBackwards,C=g.yoyoEase,b=g.keyframes,M=g.autoRevert,S=t._dur,I=t._startAt,B=t._targets,T=t.parent,R=T&&"nested"===T.data?T.vars.targets:B,D="auto"===t._overwrite&&!fM,L=t.timeline;if(L&&(!b||!v)&&(v="none"),t._ease=GI(v,MM.ease),t._yEase=C?NI(GI(!0===C?v:C,MM.ease)):0,C&&t._yoyo&&!t._repeat&&(C=t._yEase,t._yEase=t._ease,t._ease=C),t._from=!L&&!!g.runBackwards,!L||b&&!g.stagger){if(m=(u=B[0]?gS(B[0]).harness:0)&&g[u.prop],r=RS(g,lS),I&&(I._zTime<0&&I.progress(1),n<0&&w&&x&&!M?I.render(-1,!0):I.revert(w&&S?aS:sS),I._lazy=0),y){if(FS(t._startAt=rB.set(B,IS({data:"isStart",overwrite:!1,parent:T,immediateRender:!0,lazy:!I&&GM(_),startAt:null,delay:0,onUpdate:E&&function(){return yI(t,"onUpdate")},stagger:0},y))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(mM||!x&&!M)&&t._startAt.revert(aS),x&&S&&n<=0&&i<=0)return void(n&&(t._zTime=n))}else if(w&&S&&!I)if(n&&(x=!1),a=IS({overwrite:!1,data:"isFromStart",lazy:x&&!I&&GM(_),immediateRender:x,stagger:0,parent:T},r),m&&(a[u.prop]=m),FS(t._startAt=rB.set(B,a)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(mM?t._startAt.revert(aS):t._startAt.render(-1,!0)),t._zTime=n,x){if(!n)return}else e(t._startAt,IM,IM);for(t._pt=t._ptCache=0,_=S&&GM(_)||_&&!S,s=0;s<B.length;s++){if(h=(l=B[s])._gsap||AS(B)[s]._gsap,t._ptLookup[s]=p={},hS[h.id]&&cS.length&&CS(),f=R===B?s:R.indexOf(l),u&&!1!==(d=new u).init(l,m||r,t,f,R)&&(t._pt=o=new vB(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=o})),d.priority&&(c=1)),!u||m)for(a in r)uS[a]&&(d=ZI(a,r,t,f,l,R))?d.priority&&(c=1):p[a]=o=KI.call(t,l,a,"get",r[a],f,R,0,g.stringFilter);t._op&&t._op[s]&&t.kill(l,t._op[s]),D&&t._pt&&(JI=t,gM.killTweensOf(l,p,t.globalTime(n)),A=!t.parent,JI=0),t._pt&&_&&(hS[h.id]=1)}c&&gB(t),t._onInit&&t._onInit(t)}t._onUpdate=E,t._initted=(!t._op||t._pt)&&!A,b&&n<=0&&L.render(SM,!0,!0)},eB=function(e,t,n,i){var r,s,a=t.ease||i||"power1.inOut";if(VM(t))s=n[e]||(n[e]=[]),t.forEach((function(e,n){return s.push({t:n/(t.length-1)*100,v:e,e:a})}));else for(r in t)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(e),v:t[r],e:a})},tB=function(e,t,n,i,r){return UM(e)?e.call(t,n,i,r):FM(e)&&~e.indexOf("random(")?AI(e):e},nB=mS+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",iB={};yS(nB+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return iB[e]=1}));var rB=function(e){function t(t,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,o,l,c,h,u,d,p,f=(s=e.call(this,r?n:DS(n))||this).vars,m=f.duration,A=f.delay,g=f.immediateRender,v=f.stagger,y=f.overwrite,x=f.keyframes,_=f.defaults,E=f.scrollTrigger,w=f.yoyoEase,C=n.parent||gM,b=(VM(t)||HM(t)?OM(t[0]):"length"in n)?[t]:lI(t);if(s._targets=b.length?AS(b):nS("GSAP target "+t+" not found. https://gsap.com",!bM.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=y,x||v||zM(m)||zM(A)){if(n=s.vars,(a=s.timeline=new XI({data:"nested",defaults:_||{},targets:C&&"nested"===C.data?C.vars.targets:b})).kill(),a.parent=a._dp=dM(s),a._start=0,v||zM(m)||zM(A)){if(c=b.length,d=v&&uI(v),kM(v))for(h in v)~nB.indexOf(h)&&(p||(p={}),p[h]=v[h]);for(o=0;o<c;o++)(l=RS(n,iB)).stagger=0,w&&(l.yoyoEase=w),p&&BS(l,p),u=b[o],l.duration=+tB(m,dM(s),o,u,b),l.delay=(+tB(A,dM(s),o,u,b)||0)-s._delay,!v&&1===c&&l.delay&&(s._delay=A=l.delay,s._start+=A,l.delay=0),a.to(u,l,d?d(o,u,b):0),a._ease=PI.none;a.duration()?m=A=0:s.timeline=0}else if(x){DS(IS(a.vars.defaults,{ease:"none"})),a._ease=GI(x.ease||n.ease||"none");var M,S,I,B=0;if(VM(x))x.forEach((function(e){return a.to(b,e,">")})),a.duration();else{for(h in l={},x)"ease"===h||"easeEach"===h||eB(h,x[h],l,x.easeEach);for(h in l)for(M=l[h].sort((function(e,t){return e.t-t.t})),B=0,o=0;o<M.length;o++)(I={ease:(S=M[o]).e,duration:(S.t-(o?M[o-1].t:0))/100*m})[h]=S.v,a.to(b,I,B),B+=I.duration;a.duration()<m&&a.to({},{duration:m-a.duration()})}}m||s.duration(m=a.duration())}else s.timeline=0;return!0!==y||fM||(JI=dM(s),gM.killTweensOf(b),JI=0),jS(C,dM(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(g||!m&&!x&&s._start===_S(C._time)&&GM(g)&&kS(dM(s))&&"nested"!==C.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-A)||0)),E&&XS(dM(s),E),s}pM(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,r,s,a,o,l,c,h,u,d=this._time,p=this._tDur,f=this._dur,m=e<0,A=e>p-IM&&!m?p:e<IM?0:e;if(f){if(A!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=A,h=this.timeline,this._repeat){if(a=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*a+e,t,n);if(i=_S(A%a),A===p?(s=this._repeat,i=f):((s=~~(A/a))&&s===_S(A/a)&&(i=f,s--),i>f&&(i=f)),(l=this._yoyo&&1&s)&&(u=this._yEase,i=f-i),o=QS(this._tTime,a),i===d&&!n&&this._initted&&s===o)return this._tTime=A,this;s!==o&&(h&&this._yEase&&kI(h,l),this.vars.repeatRefresh&&!l&&!this._lock&&this._time!==a&&this._initted&&(this._lock=n=1,this.render(_S(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(JS(this,m?e:i,n,t,A))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==o))return this;if(f!==this._dur)return this.render(e,t,n)}if(this._tTime=A,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(u||this._ease)(i/f),this._from&&(this.ratio=c=1-c),i&&!d&&!t&&!s&&(yI(this,"onStart"),this._tTime!==A))return this;for(r=this._pt;r;)r.r(c,r.d),r=r._next;h&&h.render(e<0?e:h._dur*h._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(m&&NS(this,e,0,n),yI(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!t&&this.parent&&yI(this,"onRepeat"),A!==this._tDur&&A||this._tTime!==A||(m&&!this._onUpdate&&NS(this,e,0,!0),(e||!f)&&(A===this._tDur&&this._ts>0||!A&&this._ts<0)&&FS(this,1),t||m&&!d||!(A||d||l)||(yI(this,A===p?"onComplete":"onReverseComplete",!0),this._prom&&!(A<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var r,s,a,o=e.ratio,l=t<0||!t&&(!e._start&&qS(e)&&(e._initted||!YS(e))||(e._ts<0||e._dp._ts<0)&&!YS(e))?0:1,c=e._rDelay,h=0;if(c&&e._repeat&&(h=iI(0,e._tDur,t),s=QS(h,c),e._yoyo&&1&s&&(l=1-l),s!==QS(e._tTime,c)&&(o=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==o||mM||i||e._zTime===IM||!t&&e._zTime){if(!e._initted&&JS(e,t,i,n,h))return;for(a=e._zTime,e._zTime=t||(n?IM:0),n||(n=t&&!a),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=h,r=e._pt;r;)r.r(l,r.d),r=r._next;t<0&&NS(e,t,0,!0),e._onUpdate&&!n&&yI(e,"onUpdate"),h&&e._repeat&&!n&&e.parent&&yI(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&FS(e,1),n||mM||(yI(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,i,r){CM||DI.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||$I(this,s),function(e,t,n,i,r,s,a,o){var l,c,h,u,d=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!d)for(d=e._ptCache[t]=[],h=e._ptLookup,u=e._targets.length;u--;){if((l=h[u][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return qI=1,e.vars[t]="+=0",$I(e,a),qI=0,o?nS(t+" not eligible for reset"):1;d.push(l)}for(u=d.length;u--;)(l=(c=d[u])._pt||c).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,c.e&&(c.e=xS(n)+rI(c.e)),c.b&&(c.b=l.s+rI(c.b))}(this,e,t,n,i,this._ease(s/this._dur),s,r)?this.resetTo(e,t,n,i,1):(VS(this,0),this.parent||LS(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?xI(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,JI&&!0!==JI.vars.overwrite)._first||xI(this),this.parent&&n!==this.timeline.totalDuration()&&KS(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,a,o,l,c,h=this._targets,u=e?lI(e):h,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(h,u))return"all"===t&&(this._pt=0),xI(this);for(i=this._op=this._op||[],"all"!==t&&(FM(t)&&(o={},yS(t,(function(e){return o[e]=1})),t=o),t=function(e,t){var n,i,r,s,a=e[0]?gS(e[0]).harness:0,o=a&&a.aliases;if(!o)return t;for(i in n=BS({},t),o)if(i in n)for(r=(s=o[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(h,t)),c=h.length;c--;)if(~u.indexOf(h[c]))for(o in r=d[c],"all"===t?(i[c]=t,a=r,s={}):(s=i[c]=i[c]||{},a=t),a)(l=r&&r[o])&&("kill"in l.d&&!0!==l.d.kill(o)||PS(this,l,"_pt"),delete r[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&p&&xI(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return tI(1,arguments)},t.delayedCall=function(e,n,i,r){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},t.fromTo=function(e,t,n){return tI(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return gM.killTweensOf(e,t,n)},t}(jI);IS(rB.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),yS("staggerTo,staggerFrom,staggerFromTo",(function(e){rB[e]=function(){var t=new XI,n=sI.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var sB=function(e,t,n){return e[t]=n},aB=function(e,t,n){return e[t](n)},oB=function(e,t,n,i){return e[t](i.fp,n)},lB=function(e,t,n){return e.setAttribute(t,n)},cB=function(e,t){return UM(e[t])?aB:NM(e[t])&&e.setAttribute?lB:sB},hB=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},uB=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},dB=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},pB=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},fB=function(e,t,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(e,t,n),s=r},mB=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?PS(this,i,"_pt"):i.dep||(t=1),i=n;return!t},AB=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},gB=function(e){for(var t,n,i,r,s=e._pt;s;){for(t=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=t}e._pt=i},vB=function(){function e(e,t,n,i,r,s,a,o,l){this.t=t,this.s=i,this.c=r,this.p=n,this.r=s||hB,this.d=a||this,this.set=o||sB,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=AB,this.m=e,this.mt=n,this.tween=t},e}();yS(mS+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return lS[e]=1})),ZM.TweenMax=ZM.TweenLite=rB,ZM.TimelineLite=ZM.TimelineMax=XI,gM=new XI({sortChildren:!1,defaults:MM,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),bM.stringFilter=RI;var yB=[],xB={},_B=[],EB=0,wB=0,CB=function(e){return(xB[e]||_B).map((function(e){return e()}))},bB=function(){var e=Date.now(),t=[];e-EB>2&&(CB("matchMediaInit"),yB.forEach((function(e){var n,i,r,s,a=e.queries,o=e.conditions;for(i in a)(n=vM.matchMedia(a[i]).matches)&&(r=1),n!==o[i]&&(o[i]=n,s=1);s&&(e.revert(),r&&t.push(e))})),CB("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e,(function(t){return e.add(null,t)}))})),EB=e,CB("matchMedia"))},MB=function(){function e(e,t){this.selector=t&&cI(t),this.data=[],this._r=[],this.isReverted=!1,this.id=wB++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){UM(e)&&(n=t,t=e,e=UM);var i=this,r=function(){var e,r=AM,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=cI(n)),AM=i,e=t.apply(i,arguments),UM(e)&&i._r.push(e),AM=r,i.selector=s,i.isReverted=!1,e};return i.last=r,e===UM?r(i,(function(e){return i.add(null,e)})):e?i[e]=r:r},t.ignore=function(e){var t=AM;AM=null,e(this),AM=t},t.getTweens=function(){var t=[];return this.data.forEach((function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof rB&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e?function(){for(var t,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(t=n.data[r]).data&&(t.revert(),t.getChildren(!0,!0,!1).forEach((function(e){return i.splice(i.indexOf(e),1)})));for(i.map((function(e){return{g:e._dur||e._delay||e._sat&&!e._sat.vars.immediateRender?e.globalTime(0):-1/0,t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),r=n.data.length;r--;)(t=n.data[r])instanceof XI?"nested"!==t.data&&(t.scrollTrigger&&t.scrollTrigger.revert(),t.kill()):!(t instanceof rB)&&t.revert&&t.revert(e);n._r.forEach((function(t){return t(e,n)})),n.isReverted=!0}():this.data.forEach((function(e){return e.kill&&e.kill()})),this.clear(),t)for(var i=yB.length;i--;)yB[i].id===this.id&&yB.splice(i,1)},t.revert=function(e){this.kill(e||{})},e}(),SB=function(){function e(e){this.contexts=[],this.scope=e,AM&&AM.data.push(this)}var t=e.prototype;return t.add=function(e,t,n){kM(e)||(e={matches:e});var i,r,s,a=new MB(0,n||this.scope),o=a.conditions={};for(r in AM&&!a.selector&&(a.selector=AM.selector),this.contexts.push(a),t=a.add("onMatch",t),a.queries=e,e)"all"===r?s=1:(i=vM.matchMedia(e[r]))&&(yB.indexOf(a)<0&&yB.push(a),(o[r]=i.matches)&&(s=1),i.addListener?i.addListener(bB):i.addEventListener("change",bB));return s&&t(a,(function(e){return a.add(null,e)})),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),IB={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return EI(e)}))},timeline:function(e){return new XI(e)},getTweensOf:function(e,t){return gM.getTweensOf(e,t)},getProperty:function(e,t,n,i){FM(e)&&(e=lI(e)[0]);var r=gS(e||{}).get,s=n?SS:MS;return"native"===n&&(n=""),e?t?s((uS[t]&&uS[t].get||r)(e,t,n,i)):function(t,n,i){return s((uS[t]&&uS[t].get||r)(e,t,n,i))}:e},quickSetter:function(e,t,n){if((e=lI(e)).length>1){var i=e.map((function(e){return RB.quickSetter(e,t,n)})),r=i.length;return function(e){for(var t=r;t--;)i[t](e)}}e=e[0]||{};var s=uS[t],a=gS(e),o=a.harness&&(a.harness.aliases||{})[t]||t,l=s?function(t){var i=new s;wM._pt=0,i.init(e,n?t+n:t,wM,0,[e]),i.render(1,i),wM._pt&&pB(1,wM)}:a.set(e,o);return s?l:function(t){return l(e,o,n?t+n:t,a,1)}},quickTo:function(e,t,n){var i,r=RB.to(e,BS(((i={})[t]="+=0.1",i.paused=!0,i),n||{})),s=function(e,n,i){return r.resetTo(t,e,n,i)};return s.tween=r,s},isTweening:function(e){return gM.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=GI(e.ease,MM.ease)),TS(MM,e||{})},config:function(e){return TS(bM,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach((function(e){return e&&!uS[e]&&!ZM[e]&&nS(t+" effect requires "+e+" plugin.")})),dS[t]=function(e,t,i){return n(lI(e),IS(t||{},r),i)},s&&(XI.prototype[t]=function(e,n,i){return this.add(dS[t](e,kM(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){PI[e]=GI(t)},parseEase:function(e,t){return arguments.length?GI(e,t):PI},getById:function(e){return gM.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,r=new XI(e);for(r.smoothChildTiming=GM(e.smoothChildTiming),gM.remove(r),r._dp=0,r._time=r._tTime=gM._time,n=gM._first;n;)i=n._next,!t&&!n._dur&&n instanceof rB&&n.vars.onComplete===n._targets[0]||jS(r,n,n._start-n._delay),n=i;return jS(gM,r,0),r},context:function(e,t){return e?new MB(e,t):AM},matchMedia:function(e){return new SB(e)},matchMediaRefresh:function(){return yB.forEach((function(e){var t,n,i=e.conditions;for(n in i)i[n]&&(i[n]=!1,t=1);t&&e.revert()}))||bB()},addEventListener:function(e,t){var n=xB[e]||(xB[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=xB[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:function e(t,n,i){var r=n-t;return VM(t)?mI(t,e(0,t.length),n):nI(i,(function(e){return(r+(e-t)%r)%r+t}))},wrapYoyo:function e(t,n,i){var r=n-t,s=2*r;return VM(t)?mI(t,e(0,t.length-1),n):nI(i,(function(e){return t+((e=(s+(e-t)%s)%s||0)>r?s-e:e)}))},distribute:uI,random:fI,snap:pI,normalize:function(e,t,n){return gI(e,t,0,1,n)},getUnit:rI,clamp:function(e,t,n){return nI(n,(function(n){return iI(e,t,n)}))},splitColor:MI,toArray:lI,selector:cI,mapRange:gI,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||rI(n))}},interpolate:function e(t,n,i,r){var s=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!s){var a,o,l,c,h,u=FM(t),d={};if(!0===i&&(r=1)&&(i=null),u)t={p:t},n={p:n};else if(VM(t)&&!VM(n)){for(l=[],c=t.length,h=c-2,o=1;o<c;o++)l.push(e(t[o-1],t[o]));c--,s=function(e){e*=c;var t=Math.min(h,~~e);return l[t](e-t)},i=n}else r||(t=BS(VM(t)?[]:{},t));if(!l){for(a in n)KI.call(d,t,a,"get",n[a]);s=function(e){return pB(e,d)||(u?t.p:t)}}}return nI(i,s)},shuffle:hI},install:eS,effects:dS,ticker:DI,updateRoot:XI.updateRoot,plugins:uS,globalTimeline:gM,core:{PropTween:vB,globals:iS,Tween:rB,Timeline:XI,Animation:jI,getCache:gS,_removeLinkedListItem:PS,reverting:function(){return mM},context:function(e){return e&&AM&&(AM.data.push(e),e._ctx=AM),AM},suppressOverwrites:function(e){return fM=e}}};yS("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return IB[e]=rB[e]})),DI.add(XI.updateRoot),wM=IB.to({},{duration:0});var BB=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},TB=function(e,t){return{name:e,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,r;if(FM(n)&&(i={},yS(n,(function(e){return i[e]=1})),n=i),t){for(r in i={},n)i[r]=t(n[r]);n=i}!function(e,t){var n,i,r,s=e._targets;for(n in t)for(i=s.length;i--;)(r=e._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=BB(r,n)),r&&r.modifier&&r.modifier(t[n],e,s[i],n))}(e,n)}}}},RB=IB.registerPlugin({name:"attr",init:function(e,t,n,i,r){var s,a,o;for(s in this.tween=n,t)o=e.getAttribute(s)||"",(a=this.add(e,"setAttribute",(o||0)+"",t[s],i,r,0,0,s)).op=s,a.b=o,this._props.push(s)},render:function(e,t){for(var n=t._pt;n;)mM?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},TB("roundProps",dI),TB("modifiers"),TB("snap",pI))||IB;rB.version=XI.version=RB.version="3.12.5",_M=1,QM()&&LI(),PI.Power0,PI.Power1,PI.Power2,PI.Power3,PI.Power4,PI.Linear,PI.Quad,PI.Cubic,PI.Quart,PI.Quint,PI.Strong,PI.Elastic,PI.Back,PI.SteppedEase,PI.Bounce,PI.Sine,PI.Expo,PI.Circ;
/*!
	 * CSSPlugin 3.12.5
	 * https://gsap.com
	 *
	 * Copyright 2008-2024, GreenSock. All rights reserved.
	 * Subject to the terms at https://gsap.com/standard-license or for
	 * Club GSAP members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/
var DB,LB,PB,FB,UB,OB,NB,kB,GB={},QB=180/Math.PI,zB=Math.PI/180,HB=Math.atan2,VB=/([A-Z])/g,WB=/(left|right|width|margin|padding|x)/i,jB=/[\s,\(]\S/,XB={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},JB=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},qB=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},YB=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},KB=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ZB=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},$B=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},eT=function(e,t,n){return e.style[t]=n},tT=function(e,t,n){return e.style.setProperty(t,n)},nT=function(e,t,n){return e._gsap[t]=n},iT=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},rT=function(e,t,n,i,r){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},sT=function(e,t,n,i,r){var s=e._gsap;s[t]=n,s.renderTransform(r,s)},aT="transform",oT=aT+"Origin",lT=function e(t,n){var i=this,r=this.target,s=r.style,a=r._gsap;if(t in GB&&s){if(this.tfm=this.tfm||{},"transform"===t)return XB.transform.split(",").forEach((function(t){return e.call(i,t,n)}));if(~(t=XB[t]||t).indexOf(",")?t.split(",").forEach((function(e){return i.tfm[e]=MT(r,e)})):this.tfm[t]=a.x?a[t]:MT(r,t),t===oT&&(this.tfm.zOrigin=a.zOrigin),this.props.indexOf(aT)>=0)return;a.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(oT,n,"")),t=aT}(s||n)&&this.props.push(t,n,s[t])},cT=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},hT=function(){var e,t,n=this.props,i=this.target,r=i.style,s=i._gsap;for(e=0;e<n.length;e+=3)n[e+1]?i[n[e]]=n[e+2]:n[e+2]?r[n[e]]=n[e+2]:r.removeProperty("--"===n[e].substr(0,2)?n[e]:n[e].replace(VB,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)s[t]=this.tfm[t];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(e=NB())&&e.isStart||r[aT]||(cT(r),s.zOrigin&&r[oT]&&(r[oT]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},uT=function(e,t){var n={target:e,props:[],revert:hT,save:lT};return e._gsap||RB.core.getCache(e),t&&t.split(",").forEach((function(e){return n.save(e)})),n},dT=function(e,t){var n=LB.createElementNS?LB.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):LB.createElement(e);return n&&n.style?n:LB.createElement(e)},pT=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(VB,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,mT(n)||n,1)||""},fT="O,Moz,ms,Ms,Webkit".split(","),mT=function(e,t,n){var i=(t||UB).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(fT[r]+e in i););return r<0?null:(3===r?"ms":r>=0?fT[r]:"")+e},AT=function(){"undefined"!=typeof window&&window.document&&(DB=window,LB=DB.document,PB=LB.documentElement,UB=dT("div")||{style:{}},dT("div"),aT=mT(aT),oT=aT+"Origin",UB.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",kB=!!mT("perspective"),NB=RB.core.reverting,FB=1)},gT=function e(t){var n,i=dT("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,s=this.nextSibling,a=this.style.cssText;if(PB.appendChild(i),i.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(s?r.insertBefore(this,s):r.appendChild(this)),PB.removeChild(i),this.style.cssText=a,n},vT=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},yT=function(e){var t;try{t=e.getBBox()}catch(n){t=gT.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===gT||(t=gT.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+vT(e,["x","cx","x1"])||0,y:+vT(e,["y","cy","y1"])||0,width:0,height:0}},xT=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!yT(e))},_T=function(e,t){if(t){var n,i=e.style;t in GB&&t!==oT&&(t=aT),i.removeProperty?("ms"!==(n=t.substr(0,2))&&"webkit"!==t.substr(0,6)||(t="-"+t),i.removeProperty("--"===n?t:t.replace(VB,"-$1").toLowerCase())):i.removeAttribute(t)}},ET=function(e,t,n,i,r,s){var a=new vB(e._pt,t,n,0,1,s?$B:ZB);return e._pt=a,a.b=i,a.e=r,e._props.push(n),a},wT={deg:1,rad:1,turn:1},CT={grid:1,flex:1},bT=function e(t,n,i,r){var s,a,o,l,c=parseFloat(i)||0,h=(i+"").trim().substr((c+"").length)||"px",u=UB.style,d=WB.test(n),p="svg"===t.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,A="px"===r,g="%"===r;if(r===h||!c||wT[r]||wT[h])return c;if("px"!==h&&!A&&(c=e(t,n,i,"px")),l=t.getCTM&&xT(t),(g||"%"===h)&&(GB[n]||~n.indexOf("adius")))return s=l?t.getBBox()[d?"width":"height"]:t[f],xS(g?c/s*m:c/100*s);if(u[d?"width":"height"]=m+(A?h:r),a=~n.indexOf("adius")||"em"===r&&t.appendChild&&!p?t:t.parentNode,l&&(a=(t.ownerSVGElement||{}).parentNode),a&&a!==LB&&a.appendChild||(a=LB.body),(o=a._gsap)&&g&&o.width&&d&&o.time===DI.time&&!o.uncache)return xS(c/o.width*m);if(!g||"height"!==n&&"width"!==n)(g||"%"===h)&&!CT[pT(a,"display")]&&(u.position=pT(t,"position")),a===t&&(u.position="static"),a.appendChild(UB),s=UB[f],a.removeChild(UB),u.position="absolute";else{var v=t.style[n];t.style[n]=m+r,s=t[f],v?t.style[n]=v:_T(t,n)}return d&&g&&((o=gS(a)).time=DI.time,o.width=a[f]),xS(A?s*c/m:s&&c?m/s*c:0)},MT=function(e,t,n,i){var r;return FB||AT(),t in XB&&"transform"!==t&&~(t=XB[t]).indexOf(",")&&(t=t.split(",")[0]),GB[t]&&"transform"!==t?(r=NT(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:kT(pT(e,oT))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=RT[t]&&RT[t](e,t,n)||pT(e,t)||vS(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?bT(e,t,r,n)+n:r},ST=function(e,t,n,i){if(!n||"none"===n){var r=mT(t,e,1),s=r&&pT(e,r,1);s&&s!==n?(t=r,n=s):"borderColor"===t&&(n=pT(e,"borderTopColor"))}var a,o,l,c,h,u,d,p,f,m,A,g=new vB(this._pt,e.style,t,0,1,dB),v=0,y=0;if(g.b=n,g.e=i,n+="","auto"===(i+="")&&(u=e.style[t],e.style[t]=i,i=pT(e,t)||i,u?e.style[t]=u:_T(e,t)),RI(a=[n,i]),i=a[1],l=(n=a[0]).match(XM)||[],(i.match(XM)||[]).length){for(;o=XM.exec(i);)d=o[0],f=i.substring(v,o.index),h?h=(h+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(h=1),d!==(u=l[y++]||"")&&(c=parseFloat(u)||0,A=u.substr((c+"").length),"="===d.charAt(1)&&(d=ES(c,d)+A),p=parseFloat(d),m=d.substr((p+"").length),v=XM.lastIndex-m.length,m||(m=m||bM.units[t]||A,v===i.length&&(i+=m,g.e+=m)),A!==m&&(c=bT(e,t,u,m)||0),g._pt={_next:g._pt,p:f||1===y?f:",",s:c,c:p-c,m:h&&h<4||"zIndex"===t?Math.round:0});g.c=v<i.length?i.substring(v,i.length):""}else g.r="display"===t&&"none"===i?$B:ZB;return qM.test(i)&&(g.e=0),this._pt=g,g},IT={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},BT=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==i&&"right"!==i||(e=n,n=i,i=e),t[0]=IT[n]||n,t[1]=IT[i]||i,t.join(" ")},TT=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,s=t.t,a=s.style,o=t.u,l=s._gsap;if("all"===o||!0===o)a.cssText="",i=1;else for(r=(o=o.split(",")).length;--r>-1;)n=o[r],GB[n]&&(i=1,n="transformOrigin"===n?oT:aT),_T(s,n);i&&(_T(s,aT),l&&(l.svg&&s.removeAttribute("transform"),NT(s,1),l.uncache=1,cT(a)))}},RT={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var s=e._pt=new vB(e._pt,t,n,0,0,TT);return s.u=i,s.pr=-10,s.tween=r,e._props.push(n),1}}},DT=[1,0,0,1,0,0],LT={},PT=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},FT=function(e){var t=pT(e,aT);return PT(t)?DT:t.substr(7).match(jM).map(xS)},UT=function(e,t){var n,i,r,s,a=e._gsap||gS(e),o=e.style,l=FT(e);return a.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?DT:l:(l!==DT||e.offsetParent||e===PB||a.svg||(r=o.display,o.display="block",(n=e.parentNode)&&e.offsetParent||(s=1,i=e.nextElementSibling,PB.appendChild(e)),l=FT(e),r?o.display=r:_T(e,"display"),s&&(i?n.insertBefore(e,i):n?n.appendChild(e):PB.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},OT=function(e,t,n,i,r,s){var a,o,l,c=e._gsap,h=r||UT(e,!0),u=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,m=h[0],A=h[1],g=h[2],v=h[3],y=h[4],x=h[5],_=t.split(" "),E=parseFloat(_[0])||0,w=parseFloat(_[1])||0;n?h!==DT&&(o=m*v-A*g)&&(l=E*(-A/o)+w*(m/o)-(m*x-A*y)/o,E=E*(v/o)+w*(-g/o)+(g*x-v*y)/o,w=l):(E=(a=yT(e)).x+(~_[0].indexOf("%")?E/100*a.width:E),w=a.y+(~(_[1]||_[0]).indexOf("%")?w/100*a.height:w)),i||!1!==i&&c.smooth?(y=E-u,x=w-d,c.xOffset=p+(y*m+x*g)-y,c.yOffset=f+(y*A+x*v)-x):c.xOffset=c.yOffset=0,c.xOrigin=E,c.yOrigin=w,c.smooth=!!i,c.origin=t,c.originIsAbsolute=!!n,e.style[oT]="0px 0px",s&&(ET(s,c,"xOrigin",u,E),ET(s,c,"yOrigin",d,w),ET(s,c,"xOffset",p,c.xOffset),ET(s,c,"yOffset",f,c.yOffset)),e.setAttribute("data-svg-origin",E+" "+w)},NT=function(e,t){var n=e._gsap||new WI(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,s,a,o,l,c,h,u,d,p,f,m,A,g,v,y,x,_,E,w,C,b,M,S,I,B,T,R,D,L,P,F=e.style,U=n.scaleX<0,O="px",N="deg",k=getComputedStyle(e),G=pT(e,oT)||"0";return i=r=s=l=c=h=u=d=p=0,a=o=1,n.svg=!(!e.getCTM||!xT(e)),k.translate&&("none"===k.translate&&"none"===k.scale&&"none"===k.rotate||(F[aT]=("none"!==k.translate?"translate3d("+(k.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==k.rotate?"rotate("+k.rotate+") ":"")+("none"!==k.scale?"scale("+k.scale.split(" ").join(",")+") ":"")+("none"!==k[aT]?k[aT]:"")),F.scale=F.rotate=F.translate="none"),A=UT(e,n.svg),n.svg&&(n.uncache?(S=e.getBBox(),G=n.xOrigin-S.x+"px "+(n.yOrigin-S.y)+"px",M=""):M=!t&&e.getAttribute("data-svg-origin"),OT(e,M||G,!!M||n.originIsAbsolute,!1!==n.smooth,A)),f=n.xOrigin||0,m=n.yOrigin||0,A!==DT&&(x=A[0],_=A[1],E=A[2],w=A[3],i=C=A[4],r=b=A[5],6===A.length?(a=Math.sqrt(x*x+_*_),o=Math.sqrt(w*w+E*E),l=x||_?HB(_,x)*QB:0,(u=E||w?HB(E,w)*QB+l:0)&&(o*=Math.abs(Math.cos(u*zB))),n.svg&&(i-=f-(f*x+m*E),r-=m-(f*_+m*w))):(P=A[6],D=A[7],B=A[8],T=A[9],R=A[10],L=A[11],i=A[12],r=A[13],s=A[14],c=(g=HB(P,R))*QB,g&&(M=C*(v=Math.cos(-g))+B*(y=Math.sin(-g)),S=b*v+T*y,I=P*v+R*y,B=C*-y+B*v,T=b*-y+T*v,R=P*-y+R*v,L=D*-y+L*v,C=M,b=S,P=I),h=(g=HB(-E,R))*QB,g&&(v=Math.cos(-g),L=w*(y=Math.sin(-g))+L*v,x=M=x*v-B*y,_=S=_*v-T*y,E=I=E*v-R*y),l=(g=HB(_,x))*QB,g&&(M=x*(v=Math.cos(g))+_*(y=Math.sin(g)),S=C*v+b*y,_=_*v-x*y,b=b*v-C*y,x=M,C=S),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,h=180-h),a=xS(Math.sqrt(x*x+_*_+E*E)),o=xS(Math.sqrt(b*b+P*P)),g=HB(C,b),u=Math.abs(g)>2e-4?g*QB:0,p=L?1/(L<0?-L:L):0),n.svg&&(M=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!PT(pT(e,aT)),M&&e.setAttribute("transform",M))),Math.abs(u)>90&&Math.abs(u)<270&&(U?(a*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+O,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+O,n.z=s+O,n.scaleX=xS(a),n.scaleY=xS(o),n.rotation=xS(l)+N,n.rotationX=xS(c)+N,n.rotationY=xS(h)+N,n.skewX=u+N,n.skewY=d+N,n.transformPerspective=p+O,(n.zOrigin=parseFloat(G.split(" ")[2])||!t&&n.zOrigin||0)&&(F[oT]=kT(G)),n.xOffset=n.yOffset=0,n.force3D=bM.force3D,n.renderTransform=n.svg?jT:kB?WT:QT,n.uncache=0,n},kT=function(e){return(e=e.split(" "))[0]+" "+e[1]},GT=function(e,t,n){var i=rI(t);return xS(parseFloat(t)+parseFloat(bT(e,"x",n+"px",i)))+i},QT=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,WT(e,t)},zT="0deg",HT="0px",VT=") ",WT=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,o=n.z,l=n.rotation,c=n.rotationY,h=n.rotationX,u=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,A=n.force3D,g=n.target,v=n.zOrigin,y="",x="auto"===A&&e&&1!==e||!0===A;if(v&&(h!==zT||c!==zT)){var _,E=parseFloat(c)*zB,w=Math.sin(E),C=Math.cos(E);E=parseFloat(h)*zB,_=Math.cos(E),s=GT(g,s,w*_*-v),a=GT(g,a,-Math.sin(E)*-v),o=GT(g,o,C*_*-v+v)}m!==HT&&(y+="perspective("+m+VT),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(x||s!==HT||a!==HT||o!==HT)&&(y+=o!==HT||x?"translate3d("+s+", "+a+", "+o+") ":"translate("+s+", "+a+VT),l!==zT&&(y+="rotate("+l+VT),c!==zT&&(y+="rotateY("+c+VT),h!==zT&&(y+="rotateX("+h+VT),u===zT&&d===zT||(y+="skew("+u+", "+d+VT),1===p&&1===f||(y+="scale("+p+", "+f+VT),g.style[aT]=y||"translate(0, 0)"},jT=function(e,t){var n,i,r,s,a,o=t||this,l=o.xPercent,c=o.yPercent,h=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,m=o.scaleX,A=o.scaleY,g=o.target,v=o.xOrigin,y=o.yOrigin,x=o.xOffset,_=o.yOffset,E=o.forceCSS,w=parseFloat(h),C=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=zB,p*=zB,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-p)*-A,s=Math.cos(d-p)*A,p&&(f*=zB,a=Math.tan(p-f),r*=a=Math.sqrt(1+a*a),s*=a,f&&(a=Math.tan(f),n*=a=Math.sqrt(1+a*a),i*=a)),n=xS(n),i=xS(i),r=xS(r),s=xS(s)):(n=m,s=A,i=r=0),(w&&!~(h+"").indexOf("px")||C&&!~(u+"").indexOf("px"))&&(w=bT(g,"x",h,"px"),C=bT(g,"y",u,"px")),(v||y||x||_)&&(w=xS(w+v-(v*n+y*r)+x),C=xS(C+y-(v*i+y*s)+_)),(l||c)&&(a=g.getBBox(),w=xS(w+l/100*a.width),C=xS(C+c/100*a.height)),a="matrix("+n+","+i+","+r+","+s+","+w+","+C+")",g.setAttribute("transform",a),E&&(g.style[aT]=a)},XT=function(e,t,n,i,r){var s,a,o=360,l=FM(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?QB:1)-i,h=i+c+"deg";return l&&("short"===(s=r.split("_")[1])&&(c%=o)!==c%180&&(c+=c<0?o:-360),"cw"===s&&c<0?c=(c+36e9)%o-~~(c/o)*o:"ccw"===s&&c>0&&(c=(c-36e9)%o-~~(c/o)*o)),e._pt=a=new vB(e._pt,t,n,i,c,qB),a.e=h,a.u="deg",e._props.push(n),a},JT=function(e,t){for(var n in t)e[n]=t[n];return e},qT=function(e,t,n){var i,r,s,a,o,l,c,h=JT({},n._gsap),u=n.style;for(r in h.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),u[aT]=t,i=NT(n,1),_T(n,aT),n.setAttribute("transform",s)):(s=getComputedStyle(n)[aT],u[aT]=t,i=NT(n,1),u[aT]=s),GB)(s=h[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=rI(s)!==(c=rI(a))?bT(n,r,s,c):parseFloat(s),l=parseFloat(a),e._pt=new vB(e._pt,i,r,o,l-o,JB),e._pt.u=c||0,e._props.push(r));JT(i,h)};yS("padding,margin,Width,Radius",(function(e,t){var n="Top",i="Right",r="Bottom",s="Left",a=(t<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map((function(n){return t<2?e+n:"border"+n+e}));RT[t>1?"border"+e:e]=function(e,t,n,i,r){var s,o;if(arguments.length<4)return s=a.map((function(t){return MT(e,t,n)})),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(i+"").split(" "),o={},a.forEach((function(e,t){return o[e]=s[t]=s[t]||s[(t-1)/2|0]})),e.init(t,o,r)}}));var YT,KT,ZT,$T={name:"css",register:AT,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var s,a,o,l,c,h,u,d,p,f,m,A,g,v,y,x,_=this._props,E=e.style,w=n.vars.startAt;for(u in FB||AT(),this.styles=this.styles||uT(e),x=this.styles.props,this.tween=n,t)if("autoRound"!==u&&(a=t[u],!uS[u]||!ZI(u,t,n,i,e,r)))if(c=typeof a,h=RT[u],"function"===c&&(c=typeof(a=a.call(n,i,e,r))),"string"===c&&~a.indexOf("random(")&&(a=AI(a)),h)h(this,e,u,a,n)&&(y=1);else if("--"===u.substr(0,2))s=(getComputedStyle(e).getPropertyValue(u)+"").trim(),a+="",BI.lastIndex=0,BI.test(s)||(d=rI(s),p=rI(a)),p?d!==p&&(s=bT(e,u,s,p)+p):d&&(a+=d),this.add(E,"setProperty",s,a,i,r,0,0,u),_.push(u),x.push(u,0,E[u]);else if("undefined"!==c){if(w&&u in w?(s="function"==typeof w[u]?w[u].call(n,i,e,r):w[u],FM(s)&&~s.indexOf("random(")&&(s=AI(s)),rI(s+"")||"auto"===s||(s+=bM.units[u]||rI(MT(e,u))||""),"="===(s+"").charAt(1)&&(s=MT(e,u))):s=MT(e,u),l=parseFloat(s),(f="string"===c&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),o=parseFloat(a),u in XB&&("autoAlpha"===u&&(1===l&&"hidden"===MT(e,"visibility")&&o&&(l=0),x.push("visibility",0,E.visibility),ET(this,E,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==u&&"transform"!==u&&~(u=XB[u]).indexOf(",")&&(u=u.split(",")[0])),m=u in GB)if(this.styles.save(u),A||((g=e._gsap).renderTransform&&!t.parseTransform||NT(e,t.parseTransform),v=!1!==t.smoothOrigin&&g.smooth,(A=this._pt=new vB(this._pt,E,aT,0,1,g.renderTransform,g,0,-1)).dep=1),"scale"===u)this._pt=new vB(this._pt,g,"scaleY",g.scaleY,(f?ES(g.scaleY,f+o):o)-g.scaleY||0,JB),this._pt.u=0,_.push("scaleY",u),u+="X";else{if("transformOrigin"===u){x.push(oT,0,E[oT]),a=BT(a),g.svg?OT(e,a,0,v,0,this):((p=parseFloat(a.split(" ")[2])||0)!==g.zOrigin&&ET(this,g,"zOrigin",g.zOrigin,p),ET(this,E,u,kT(s),kT(a)));continue}if("svgOrigin"===u){OT(e,a,1,v,0,this);continue}if(u in LT){XT(this,g,u,l,f?ES(l,f+a):a);continue}if("smoothOrigin"===u){ET(this,g,"smooth",g.smooth,a);continue}if("force3D"===u){g[u]=a;continue}if("transform"===u){qT(this,a,e);continue}}else u in E||(u=mT(u)||u);if(m||(o||0===o)&&(l||0===l)&&!jB.test(a)&&u in E)o||(o=0),(d=(s+"").substr((l+"").length))!==(p=rI(a)||(u in bM.units?bM.units[u]:d))&&(l=bT(e,u,s,p)),this._pt=new vB(this._pt,m?g:E,u,l,(f?ES(l,f+o):o)-l,m||"px"!==p&&"zIndex"!==u||!1===t.autoRound?JB:KB),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=YB);else if(u in E)ST.call(this,e,u,s,f?f+a:a);else if(u in e)this.add(e,u,s||e[u],f?f+a:a,i,r);else if("parseTransform"!==u){tS(u,a);continue}m||(u in E?x.push(u,0,E[u]):x.push(u,1,s||e[u])),_.push(u)}y&&gB(this)},render:function(e,t){if(t.tween._time||!NB())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:MT,aliases:XB,getSetter:function(e,t,n){var i=XB[t];return i&&i.indexOf(",")<0&&(t=i),t in GB&&t!==oT&&(e._gsap.x||MT(e,"x"))?n&&OB===n?"scale"===t?iT:nT:(OB=n||{})&&("scale"===t?rT:sT):e.style&&!NM(e.style[t])?eT:~t.indexOf("-")?tT:cB(e,t)},core:{_removeProperty:_T,_getMatrix:UT}};RB.utils.checkPrefix=mT,RB.core.getStyleSaver=uT,ZT=yS((YT="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(KT="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){GB[e]=1})),yS(KT,(function(e){bM.units[e]="deg",LT[e]=1})),XB[ZT[13]]=YT+","+KT,yS("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");XB[t[1]]=ZT[t[0]]})),yS("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){bM.units[e]="px"})),RB.registerPlugin($T);var eR=RB.registerPlugin($T)||RB;eR.core.Tween;class tR extends Zu{id;material;mesh;infospots;isInfospotVisible;active;constructor(e,t={}){super(e);const{id:n="",radius:i=5e3}=t;this.id=n;const r=new Cc(i,60,40),s=new ai({side:1,transparent:!0,opacity:1});this.material=s;const a=new Hi(r,s);this.mesh=a,this.infospots=[],this.isInfospotVisible=!1,this.active=!1}addExisting(){this.container.add(this.mesh)}outputPosition(){(this.base.container||window).addEventListener("click",(e=>{const t=this.base.interactionManager.raycaster.intersectObject(this.mesh,!0)[0].point.clone(),n=`${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)}`;console.log(n),this.emit("click",t)}))}show(){this.material.opacity=1}hide(){this.material.opacity=0}fadeIn(e=.5){return new Promise((t=>{eR.fromTo(this.material,{opacity:0},{opacity:1,duration:e,onComplete(){t(!0)}})}))}fadeOut(e=.5){return new Promise((t=>{eR.fromTo(this.material,{opacity:1},{opacity:0,duration:e,onComplete(){t(!0)}})}))}add(e){this.infospots.push(e)}addGroup(e){for(const t of e)this.add(t)}update(e){for(const e of this.infospots)this.active&&this.isInfospotVisible?e.makeVisible():e.makeInvisible()}toggleInfospotVisibility(e){const t=e||!this.isInfospotVisible;this.isInfospotVisible=t}onEnter(e=.5){this.active=!0,this.toggleInfospotVisibility(!0),this.fadeIn(e)}onLeave(e=.5){this.active=!1,this.toggleInfospotVisibility(!1),this.fadeOut(e)}}class nR extends tR{constructor(e,t,n={}){super(e);const{id:i="",radius:r=5e3}=n;this.id=i;const s=new Cc(r,60,40),a=new ai({map:t,side:1,transparent:!0,opacity:1});this.material=a;const o=new Hi(s,a);this.mesh=o}}class iR extends Zu{camera;orbitControls;panoramas;currentPanorama;constructor(e,t={}){super(e);const{fov:n=60}=t,i=new Zi(n,window.innerWidth/window.innerHeight,1,1e4);i.position.set(0,0,1),e.camera=i,e.interactionManager.camera=i,this.camera=i;const r=new sM(e);this.orbitControls=r,this.panoramas=[],this.currentPanorama=null}add(e){e.addExisting(),this.panoramas.push(e),e.onEnter(0),this.currentPanorama=e}setPanorama(e,t=.5){if(e===this.currentPanorama)return;this.panoramas.filter((e=>e!==this.currentPanorama)).forEach((e=>{e.onLeave(0)})),this.currentPanorama?.onLeave(t),e?.onEnter(t),this.currentPanorama=e}}class rR extends Zu{el;position;visibleClassName;xPropertyName;yPropertyName;zIndexPropertyName;scalePropertyName;viewportWidthName;viewportHeightName;perspectiveName;transformOuterName;transformInnerName;raycaster;occlude;transform;distanceFactor;parentGroup;group;visibleToggle;constructor(e,t,n=new Ot(0,0,0),i={}){super(e),this.el=t,this.position=n;const{visibleClassName:r="visible",xPropertyName:s="--x",yPropertyName:a="--y",zIndexPropertyName:o="--z-index",scalePropertyName:l="--scale",viewportWidthName:c="--viewport-width",viewportHeightName:h="--viewport-height",perspectiveName:u="--perspective",transformOuterName:d="--transform-outer",transformInnerName:p="--transform-inner",occlude:f=[],transform:m=!1,distanceFactor:A=0,group:g=null}=i;this.visibleClassName=r,this.xPropertyName=s,this.yPropertyName=a,this.zIndexPropertyName=o,this.scalePropertyName=l,this.viewportWidthName=c,this.viewportHeightName=h,this.perspectiveName=u,this.transformOuterName=d,this.transformInnerName=p,this.raycaster=new Eu,this.occlude=f,this.transform=m,this.distanceFactor=A,this.parentGroup=g,this.group=new Na,this.group.position.copy(this.position),this.visibleToggle=!0}get domPosition(){return lC(this.group,this.base.camera)}get zIndex(){return uC(this.group,this.base.camera)}get scale(){return this.distanceFactor?dC(this.group,this.base.camera)*this.distanceFactor:1}get isBehindCamera(){return cC(this.group,this.base.camera)}get isVisible(){return hC(this.group,this.base.camera,this.raycaster,this.occlude)}get visible(){return!!this.visibleToggle&&(0===this.occlude.length?!this.isBehindCamera:!this.isBehindCamera&&this.isVisible)}get viewportSize(){return{width:window.innerWidth,height:window.innerHeight}}get fov(){return pC(this.base.camera)}get perspective(){return this.base.camera.isOrthographicCamera?"":this.fov}get transformOuter(){const e=this.base.camera,{isOrthographicCamera:t,top:n,left:i,bottom:r,right:s}=e,{fov:a}=this,o=window.innerWidth/2,l=window.innerHeight/2,c=AC(e.matrixWorldInverse);return`${t?`scale(${a})translate(${fC(-(s+i)/2)}px,${fC((n+r)/2)}px)`:`translateZ(${a}px)`}${c}translate(${o}px,${l}px)`}get transformInner(){const e=this.group.matrixWorld;return vC(e,1/((this.distanceFactor||10)/400))}addExisting(){this.parentGroup?this.parentGroup.add(this.group):this.container.add(this.group)}show(){this.el?.classList.add(this.visibleClassName)}hide(){this.el?.classList.remove(this.visibleClassName)}translate({x:e=0,y:t=0}){this.el?.style.setProperty(this.xPropertyName,`${e}px`),this.el?.style.setProperty(this.yPropertyName,`${t}px`)}setZIndex(e=0){this.el?.style.setProperty(this.zIndexPropertyName,`${e}`)}setScale(e=1){this.el?.style.setProperty(this.scalePropertyName,`${e}`)}syncPosition(){this.translate(this.domPosition),this.setScale(this.scale),this.zIndex&&this.setZIndex(this.zIndex),this.transform&&this.setTransformProperty()}makeVisible(){this.visibleToggle=!0}makeInvisible(){this.visibleToggle=!1}update(e){this.syncPosition(),this.visible?this.show():this.hide()}setTransformProperty(){this.el?.style.setProperty(this.viewportWidthName,`${this.viewportSize.width}px`),this.el?.style.setProperty(this.viewportHeightName,`${this.viewportSize.height}px`),this.el?.style.setProperty(this.perspectiveName,`${this.perspective}px`),this.el?.style.setProperty(this.transformOuterName,this.transformOuter),this.el?.style.setProperty(this.transformInnerName,this.transformInner)}}const sR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n}\n",aR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nuniform sampler2D tDiffuse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec2 p=vUv;\n    vec4 color=texture(tDiffuse,p);\n    gl_FragColor=color;\n}\n";const oR="\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=vec4(p,1.);\n    \n    vUv=uv;\n}\n",lR="\nuniform float iTime;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec2 p=vUv;\n    vec3 color=vec3(p,0.);\n    gl_FragColor=vec4(color,1.);\n}\n";class cR extends Zu{material;mesh;uniformInjector;constructor(e,t={}){super(e);const{vertexShader:n=oR,fragmentShader:i=lR,uniforms:r={},shadertoyMode:s=!1}=t,a=s?`\n    \nuniform float iGlobalTime;\nuniform float iTime;\nuniform float iTimeDelta;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\nuniform int iFrame;\nuniform vec4 iDate;\nuniform float iSampleRate;\n\nuniform sampler2D iChannel0;\nuniform sampler2D iChannel1;\nuniform sampler2D iChannel2;\nuniform sampler2D iChannel3;\nuniform samplerCube iChannel0Cube;\nuniform samplerCube iChannel1Cube;\nuniform samplerCube iChannel2Cube;\nuniform samplerCube iChannel3Cube;\n\nuniform float iChannelTime[4];\n\n\n    ${i}\n\n    \nvarying vec2 vUv;\n\nvoid main(){\n    mainImage(gl_FragColor,vUv*iResolution.xy);\n}\n\n    `:i,o=new wC(e);this.uniformInjector=o;const l=new dr(2,2),c=new Yi({vertexShader:n,fragmentShader:a,uniforms:{...o.shadertoyUniforms,...r},side:2});this.material=c;const h=new Hi(l,c);this.mesh=h}addExisting(){this.container.add(this.mesh)}update(e){const t=this.material.uniforms;this.uniformInjector.injectShadertoyUniforms(t)}}const hR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    csm_Position=p;\n    \n    vUv=uv;\n}\n",uR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec2 p=vUv;\n    vec3 col=vec3(p,0.);\n    \n    csm_DiffuseColor=vec4(col,1.);\n}\n\n";class dR extends Zu{material;mesh;uniformInjector;constructor(e,t={}){super(e);const{geometry:n=new dr(1,1,16,16),baseMaterial:i=new Yi,vertexShader:r=hR,fragmentShader:s=uR,uniforms:a={},patchMap:o={},materialParams:l={}}=t,c=new wC(e);this.uniformInjector=c;const h=new yg({baseMaterial:i,vertexShader:r,fragmentShader:s,uniforms:{...c.shadertoyUniforms,...a},patchMap:o,...l});this.material=h;const u=new Hi(n,h);this.mesh=u}addExisting(){this.container.add(this.mesh)}update(e){const t=this.material.uniforms;this.uniformInjector.injectShadertoyUniforms(t)}}const pR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nuniform float uPointSize;\n\nvoid main(){\n    vec3 p=position;\n    csm_Position=p;\n\n    gl_PointSize=uPointSize;\n    \n    vUv=uv;\n}\n",fR="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec2 p=vUv;\n    vec3 col=vec3(p,0.);\n    \n    csm_DiffuseColor=vec4(col,1.);\n}\n\n";function mR(){var e=Object.create(null);function t(i,r){var s=i.id,a=i.name,o=i.dependencies;void 0===o&&(o=[]);var l=i.init;void 0===l&&(l=function(){});var c=i.getTransferables;if(void 0===c&&(c=null),!e[s])try{o=o.map((function(n){return n&&n.isWorkerModule&&(t(n,(function(e){if(e instanceof Error)throw e})),n=e[n.id].value),n})),l=n("<"+a+">.init",l),c&&(c=n("<"+a+">.getTransferables",c));var h=null;"function"==typeof l?h=l.apply(void 0,o):console.error("worker module init function failed to rehydrate"),e[s]={id:s,value:h,getTransferables:c},r(h)}catch(e){e&&e.noLog||console.error(e),r(e)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(e){console.error(e)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",(function(n){var i=n.data,r=i.messageId,s=i.action,a=i.data;try{"registerModule"===s&&t(a,(function(e){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===s&&function(t,n){var i,r=t.id,s=t.args;e[r]&&"function"==typeof e[r].value||n(new Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var a=(i=e[r]).value.apply(i,s);a&&"function"==typeof a.then?a.then(o,(function(e){return n(e instanceof Error?e:new Error(""+e))})):o(a)}catch(e){n(e)}function o(t){try{var i=e[r].getTransferables&&e[r].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),n(t,i)}catch(e){console.error(e),n(e)}}}(a,(function(e,t){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:e},t||void 0)}))}catch(e){postMessage({messageId:r,success:!1,error:e.stack})}}))}var AR=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){"undefined"!=typeof process&&"test"===process.env.NODE_ENV||console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return AR=function(){return e},e},gR=0,vR=0,yR=!1,xR=Object.create(null),_R=Object.create(null),ER=Object.create(null);function wR(e){if(!(e&&"function"==typeof e.init||yR))throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,i=e.getTransferables,r=e.workerId;if(!AR())return function(e){var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then((function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var n=e.dependencies,i=e.init;n=Array.isArray(n)?n.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var r=Promise.all(n).then((function(e){return i.apply(null,e)}));return t._getInitResult=function(){return r},r},t}(e);null==r&&(r="#default");var s="workerModule"+ ++gR,a=e.name||s,o=null;function l(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!o){o=bR(r,"registerModule",l.workerModuleData);var n=function(){o=null,_R[r].delete(n)};(_R[r]||(_R[r]=new Set)).add(n)}return o.then((function(t){if(t.isCallable)return bR(r,"callModule",{id:s,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!=typeof e||e.workerModuleData||(yR=!0,e=wR({workerId:r,name:"<"+a+"> function dependency: "+e.name,init:"function(){return (\n"+CR(e)+"\n)}"}),yR=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),l.workerModuleData={isWorkerModule:!0,id:s,name:a,dependencies:t,init:CR(n),getTransferables:i&&CR(i)},l}function CR(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function bR(e,t,n){return new Promise((function(i,r){var s=++vR;ER[s]=function(e){e.success?i(e.result):r(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=xR[e];if(!t){var n=CR(mR);(t=xR[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,i=ER[n];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete ER[n],i(t)}}return t}(e).postMessage({messageId:s,action:t,data:n})}))}function MR(){var e=function(e){function t(e,t,n,i,r,s,a,o,l,c){var h=1-l;c.x=h*h*h*e+3*h*h*l*n+3*h*l*l*r+l*l*l*a,c.y=h*h*h*t+3*h*h*l*i+3*h*l*l*s+l*l*l*o}function n(e,t){for(var n,i,r,s,a,o=/([MLQCZ])([^MLQCZ]*)/g;n=o.exec(e);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(n[1]){case"M":s=i=l[0],a=r=l[1];break;case"L":l[0]===s&&l[1]===a||t("L",s,a,s=l[0],a=l[1]);break;case"Q":t("Q",s,a,s=l[2],a=l[3],l[0],l[1]);break;case"C":t("C",s,a,s=l[4],a=l[5],l[0],l[1],l[2],l[3]);break;case"Z":s===i&&a===r||t("L",s,a,i,r)}}}function i(e,i,r){void 0===r&&(r=16);var s={x:0,y:0};n(e,(function(e,n,a,o,l,c,h,u,d){switch(e){case"L":i(n,a,o,l);break;case"Q":for(var p=n,f=a,m=1;m<r;m++)y=a,x=h,_=l,C=void 0,C=1-(E=m/(r-1)),(w=s).x=C*C*n+2*C*E*c+E*E*o,w.y=C*C*y+2*C*E*x+E*E*_,i(p,f,s.x,s.y),p=s.x,f=s.y;break;case"C":for(var A=n,g=a,v=1;v<r;v++)t(n,a,c,h,u,d,o,l,v/(r-1),s),i(A,g,s.x,s.y),A=s.x,g=s.y}var y,x,_,E,w,C}))}var r="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function o(e,t){var n=e.getContext?e.getContext("webgl",a):e,i=s.get(n);if(!i){var r="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,o={},l={},c={},h=-1,u=[];function d(e){var t=o[e];if(!t&&!(t=o[e]=n.getExtension(e)))throw new Error(e+" not supported");return t}function p(e,t){var i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}function f(e,t,i,s){if(!l[e]){var a={},o={},c=n.createProgram();n.attachShader(c,p(t,n.VERTEX_SHADER)),n.attachShader(c,p(i,n.FRAGMENT_SHADER)),n.linkProgram(c),l[e]={program:c,transaction:function(e){n.useProgram(c),e({setUniform:function(e,t){for(var i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];var s=o[t]||(o[t]=n.getUniformLocation(c,t));n["uniform"+e].apply(n,[s].concat(i))},setAttribute:function(e,t,i,s,o){var l=a[e];l||(l=a[e]={buf:n.createBuffer(),loc:n.getAttribLocation(c,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),r?n.vertexAttribDivisor(l.loc,s):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,s),o!==l.data&&(n.bufferData(n.ARRAY_BUFFER,o,i),l.data=o)}})}}}l[e].transaction(s)}function m(e,t){h++;try{n.activeTexture(n.TEXTURE0+h);var i=c[e];i||(i=c[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,i),t(i,h)}finally{h--}}function A(e,t,i){var r=n.createFramebuffer();u.push(r),n.bindFramebuffer(n.FRAMEBUFFER,r),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{i(r)}finally{n.deleteFramebuffer(r),n.bindFramebuffer(n.FRAMEBUFFER,u[--u.length-1]||null)}}function g(){o={},l={},c={},h=-1,u.length=0}n.canvas.addEventListener("webglcontextlost",(function(e){g(),e.preventDefault()}),!1),s.set(n,i={gl:n,isWebGL2:r,getExtension:d,withProgram:f,withTexture:m,withTextureFramebuffer:A,handleContextLoss:g})}t(i)}function l(e,t,n,i,s,a,l,c){void 0===l&&(l=15),void 0===c&&(c=null),o(e,(function(e){var o=e.gl,h=e.withProgram;(0,e.withTexture)("copy",(function(e,u){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,s,a,0,o.RGBA,o.UNSIGNED_BYTE,t),h("copy",r,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",(function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,o.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",u),o.bindFramebuffer(o.FRAMEBUFFER,c||null),o.disable(o.BLEND),o.colorMask(8&l,4&l,2&l,1&l),o.viewport(n,i,s,a),o.scissor(n,i,s,a),o.drawArrays(o.TRIANGLES,0,3)}))}))}))}var c=Object.freeze({__proto__:null,withWebGLContext:o,renderImageData:l,resizeWebGLCanvasWithoutClearing:function(e,t,n){var i=e.width,r=e.height;o(e,(function(s){var a=s.gl,o=new Uint8Array(i*r*4);a.readPixels(0,0,i,r,a.RGBA,a.UNSIGNED_BYTE,o),e.width=t,e.height=n,l(a,o,0,0,i,r)}))}});function h(e,t,n,r,s,a){void 0===a&&(a=1);var o=new Uint8Array(e*t),l=r[2]-r[0],c=r[3]-r[1],h=[];i(n,(function(e,t,n,i){h.push({x1:e,y1:t,x2:n,y2:i,minX:Math.min(e,n),minY:Math.min(t,i),maxX:Math.max(e,n),maxY:Math.max(t,i)})})),h.sort((function(e,t){return e.maxX-t.maxX}));for(var u=0;u<e;u++)for(var d=0;d<t;d++){var f=A(r[0]+l*(u+.5)/e,r[1]+c*(d+.5)/t),m=Math.pow(1-Math.abs(f)/s,a)/2;f<0&&(m=1-m),m=Math.max(0,Math.min(255,Math.round(255*m))),o[d*e+u]=m}return o;function A(e,t){for(var n=1/0,i=1/0,r=h.length;r--;){var s=h[r];if(s.maxX+i<=e)break;if(e+i>s.minX&&t-i<s.maxY&&t+i>s.minY){var a=p(e,t,s.x1,s.y1,s.x2,s.y2);a<n&&(n=a,i=Math.sqrt(n))}}return function(e,t){for(var n=0,i=h.length;i--;){var r=h[i];if(r.maxX<=e)break;r.y1>t!=r.y2>t&&e<(r.x2-r.x1)*(t-r.y1)/(r.y2-r.y1)+r.x1&&(n+=r.y1<r.y2?1:-1)}return 0!==n}(e,t)&&(i=-i),i}}function u(e,t,n,i,r,s,a,o,l,c){void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0),d(e,t,n,i,r,s,a,null,o,l,c)}function d(e,t,n,i,r,s,a,o,c,u,d){void 0===s&&(s=1),void 0===c&&(c=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var p=h(e,t,n,i,r,s),f=new Uint8Array(4*p.length),m=0;m<p.length;m++)f[4*m+d]=p[m];l(a,f,c,u,e,t,1<<3-d,o)}function p(e,t,n,i,r,s){var a=r-n,o=s-i,l=a*a+o*o,c=l?Math.max(0,Math.min(1,((e-n)*a+(t-i)*o)/l)):0,h=e-(n+c*a),u=t-(i+c*o);return h*h+u*u}var f=Object.freeze({__proto__:null,generate:h,generateIntoCanvas:u,generateIntoFramebuffer:d}),m=new Float32Array([0,0,2,0,0,2]),A=null,g=!1,v={},y=new WeakMap;function x(e){if(!g&&!C(e))throw new Error("WebGL generation not supported")}function _(e,t,n,i,r,s,a){if(void 0===s&&(s=1),void 0===a&&(a=null),!a&&!(a=A)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw new Error("OffscreenCanvas or DOM canvas not supported");a=A=l.getContext("webgl",{depth:!1})}x(a);var c=new Uint8Array(e*t*4);o(a,(function(a){var o=a.gl,l=a.withTexture,h=a.withTextureFramebuffer;l("readable",(function(a,l){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,null),h(a,l,(function(a){w(e,t,n,i,r,s,o,a,0,0,0),o.readPixels(0,0,e,t,o.RGBA,o.UNSIGNED_BYTE,c)}))}))}));for(var h=new Uint8Array(e*t),u=0,d=0;u<c.length;u+=4)h[d++]=c[u];return h}function E(e,t,n,i,r,s,a,o,l,c){void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0),w(e,t,n,i,r,s,a,null,o,l,c)}function w(e,t,n,s,a,l,c,h,u,d,p){void 0===l&&(l=1),void 0===u&&(u=0),void 0===d&&(d=0),void 0===p&&(p=0),x(c);var f=[];i(n,(function(e,t,n,i){f.push(e,t,n,i)})),f=new Float32Array(f),o(c,(function(n){var i=n.gl,o=n.isWebGL2,c=n.getExtension,A=n.withProgram,g=n.withTexture,v=n.withTextureFramebuffer,y=n.handleContextLoss;if(g("rawDistances",(function(n,g){e===n._lastWidth&&t===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=e,n._lastHeight=t,0,i.RGBA,i.UNSIGNED_BYTE,null),A("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",(function(r){var h=r.setAttribute,u=r.setUniform,d=!o&&c("ANGLE_instanced_arrays"),p=!o&&c("EXT_blend_minmax");h("aUV",2,i.STATIC_DRAW,0,m),h("aLineSegment",4,i.DYNAMIC_DRAW,1,f),u.apply(void 0,["4f","uGlyphBounds"].concat(s)),u("1f","uMaxDistance",a),u("1f","uExponent",l),v(n,g,(function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,e,t),i.scissor(0,0,e,t),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,o?i.MAX:p.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),o?i.drawArraysInstanced(i.TRIANGLES,0,3,f.length/4):d.drawArraysInstancedANGLE(i.TRIANGLES,0,3,f.length/4)}))})),A("post",r,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",(function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,m),n.setUniform("1i","tex",g),i.bindFramebuffer(i.FRAMEBUFFER,h),i.disable(i.BLEND),i.colorMask(0===p,1===p,2===p,3===p),i.viewport(u,d,e,t),i.scissor(u,d,e,t),i.drawArrays(i.TRIANGLES,0,3)}))})),i.isContextLost())throw y(),new Error("webgl context lost")}))}function C(e){var t=e&&e!==A?e.canvas||e:v,n=y.get(t);if(void 0===n){g=!0;var i=null;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],s=_(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);n=s&&r.length===s.length&&s.every((function(e,t){return e===r[t]})),n||(i="bad trial run results",console.info(r,s))}catch(e){n=!1,i=e.message}i&&console.warn("WebGL SDF generation not supported:",i),g=!1,y.set(t,n)}return n}var b=Object.freeze({__proto__:null,generate:_,generateIntoCanvas:E,generateIntoFramebuffer:w,isSupported:C});return e.forEachPathCommand=n,e.generate=function(e,t,n,i,r,s){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===s&&(s=1);try{return _.apply(b,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),h.apply(f,arguments)}},e.generateIntoCanvas=function(e,t,n,i,r,s,a,o,l,c){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return E.apply(b,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),u.apply(f,arguments)}},e.javascript=f,e.pathToLineSegments=i,e.webgl=b,e.webglUtils=c,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const SR=/\bvoid\s+main\s*\(\s*\)\s*{/g;function IR(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let n=pr[t];return n?IR(n):e}))}const BR=[];for(let e=0;e<256;e++)BR[e]=(e<16?"0":"")+e.toString(16);const TR=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},RR=Date.now(),DR=new WeakMap,LR=new Map;let PR=1e10;function FR(e,t){const n=function(e){const t=JSON.stringify(e,OR);let n=kR.get(t);null==n&&kR.set(t,n=++NR);return n}
/*!
	Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
	Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
	*/(t);let i=DR.get(e);if(i||DR.set(e,i=Object.create(null)),i[n])return new i[n];const r=`_onBeforeCompile${n}`,s=function(i,s){e.onBeforeCompile.call(this,i,s);const a=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let o=LR[a];if(!o){const e=function(e,{vertexShader:t,fragmentShader:n},i,r){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:u,fragmentColorTransform:d,customRewriter:p,timeUniform:f}=i;s=s||"",a=a||"",o=o||"",c=c||"",h=h||"",u=u||"",(l||p)&&(t=IR(t));(d||p)&&(n=IR(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(p){let e=p({vertexShader:t,fragmentShader:n});t=e.vertexShader,n=e.fragmentShader}if(d){let e=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(t=>(e.push(t),""))),u=`${d}\n${e.join("\n")}\n${u}`}if(f){const e=`\nuniform float ${f};\n`;s=e+s,c=e+c}l&&(s=`${s}\nvoid troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,a=`\ntroika_position_${r} = vec3(position);\ntroika_normal_${r} = vec3(normal);\ntroika_uv_${r} = vec2(uv);\ntroikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});\n${a}\n`,t=(t=`vec3 troika_position_${r};\nvec3 troika_normal_${r};\nvec2 troika_uv_${r};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,((e,t,n,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,n))?t:`troika_${t}_${r}`)),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`)));return t=UR(t,r,s,a,o),n=UR(n,r,c,h,u),{vertexShader:t,fragmentShader:n}}(this,i,t,n);o=LR[a]=e}i.vertexShader=o.vertexShader,i.fragmentShader=o.fragmentShader,TR(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-RR}}),this[r]&&this[r](i)},a=function(){return o(t.chained?e:e.clone())},o=function(i){const r=Object.create(i,l);return Object.defineProperty(r,"baseMaterial",{value:e}),Object.defineProperty(r,"id",{value:PR++}),r.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(BR[255&e]+BR[e>>8&255]+BR[e>>16&255]+BR[e>>24&255]+"-"+BR[255&t]+BR[t>>8&255]+"-"+BR[t>>16&15|64]+BR[t>>24&255]+"-"+BR[63&n|128]+BR[n>>8&255]+"-"+BR[n>>16&255]+BR[n>>24&255]+BR[255&i]+BR[i>>8&255]+BR[i>>16&255]+BR[i>>24&255]).toUpperCase()}(),r.uniforms=TR({},i.uniforms,t.uniforms),r.defines=TR({},i.defines,t.defines),r.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",r.extensions=TR({},i.extensions,t.extensions),r._listeners=void 0,r},l={constructor:{value:a},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>s,set(e){this[r]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(TR(this.extensions,t.extensions),TR(this.defines,t.defines),TR(this.uniforms,qi.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return o(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=FR(e.isDerivedMaterial?e.getDepthMaterial():new Ra({depthPacking:Te}),t),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=FR(e.isDerivedMaterial?e.getDistanceMaterial():new Da,t),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:n}=this;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return i[n]=a,new a}function UR(e,t,n,i,r){return(i||r||n)&&(e=e.replace(SR,`\n${n}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${i}\n  troikaOrigMain${t}();\n  ${r}\n}`),e}function OR(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let NR=0;const kR=new Map;const GR=wR({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var n=t._bin,i=new Uint8Array(e);if("ttcf"==n.readASCII(i,0,4)){var r=4;n.readUshort(i,r),r+=2,n.readUshort(i,r),r+=2;var s=n.readUint(i,r);r+=4;for(var a=[],o=0;o<s;o++){var l=n.readUint(i,r);r+=4,a.push(t._readFont(i,l))}return a}return[t._readFont(i,0)]},_readFont:function(e,n){var i=t._bin,r=n;i.readFixed(e,n),n+=4;var s=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],o={_data:e,_offset:r},l={},c=0;c<s;c++){var h=i.readASCII(e,n,4);n+=4,i.readUint(e,n),n+=4;var u=i.readUint(e,n);n+=4;var d=i.readUint(e,n);n+=4,l[h]={offset:u,length:d}}for(c=0;c<a.length;c++){var p=a[c];l[p]&&(o[p.trim()]=t[p.trim()].parse(e,l[p].offset,l[p].length,o))}return o},_tabOffset:function(e,n,i){for(var r=t._bin,s=r.readUshort(e,i+4),a=i+12,o=0;o<s;o++){var l=r.readASCII(e,a,4);a+=4,r.readUint(e,a),a+=4;var c=r.readUint(e,a);if(a+=4,r.readUint(e,a),a+=4,l==n)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){return t._bin._view(e).getInt32(n)},readInt8:function(e,n){return t._bin._view(e).getInt8(n)},readShort:function(e,n){return t._bin._view(e).getInt16(n)},readUshort:function(e,n){return t._bin._view(e).getUint16(n)},readUshorts:function(e,n,i){for(var r=[],s=0;s<i;s++)r.push(t._bin.readUshort(e,n+2*s));return r},readUint:function(e,n){return t._bin._view(e).getUint32(n)},readUint64:function(e,n){return 4294967296*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},readUnicode:function(e,t,n){for(var i="",r=0;r<n;r++){var s=e[t++]<<8|e[t++];i+=String.fromCharCode(s)}return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,i){var r=t._bin._tdec;return r&&0==n&&i==e.length?r.decode(e):t._bin.readASCII(e,n,i)},readBytes:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(e[t+r]);return i},readASCIIArray:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(String.fromCharCode(e[t+r]));return i},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,n,i,r,s){var a=t._bin,o={},l=n;a.readFixed(e,n),n+=4;var c=a.readUshort(e,n);n+=2;var h=a.readUshort(e,n);n+=2;var u=a.readUshort(e,n);return n+=2,o.scriptList=t._lctf.readScriptList(e,l+c),o.featureList=t._lctf.readFeatureList(e,l+h),o.lookupList=t._lctf.readLookupList(e,l+u,s),o},t._lctf.readLookupList=function(e,n,i){var r=t._bin,s=n,a=[],o=r.readUshort(e,n);n+=2;for(var l=0;l<o;l++){var c=r.readUshort(e,n);n+=2;var h=t._lctf.readLookupTable(e,s+c,i);a.push(h)}return a},t._lctf.readLookupTable=function(e,n,i){var r=t._bin,s=n,a={tabs:[]};a.ltype=r.readUshort(e,n),n+=2,a.flag=r.readUshort(e,n),n+=2;var o=r.readUshort(e,n);n+=2;for(var l=a.ltype,c=0;c<o;c++){var h=r.readUshort(e,n);n+=2;var u=i(e,l,s+h,a);a.tabs.push(u)}return a},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)0!=(e>>>n&1)&&t++;return t},t._lctf.readClassDef=function(e,n){var i=t._bin,r=[],s=i.readUshort(e,n);if(n+=2,1==s){var a=i.readUshort(e,n);n+=2;var o=i.readUshort(e,n);n+=2;for(var l=0;l<o;l++)r.push(a+l),r.push(a+l),r.push(i.readUshort(e,n)),n+=2}if(2==s){var c=i.readUshort(e,n);for(n+=2,l=0;l<c;l++)r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2}return r},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var i=e[n],r=e[n+1];if(e[n+2],i<=t&&t<=r)return n}return-1},t._lctf.readCoverage=function(e,n){var i=t._bin,r={};r.fmt=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);return n+=2,1==r.fmt&&(r.tab=i.readUshorts(e,n,s)),2==r.fmt&&(r.tab=i.readUshorts(e,n,3*s)),r},t._lctf.coverageIndex=function(e,n){var i=e.tab;if(1==e.fmt)return i.indexOf(n);if(2==e.fmt){var r=t._lctf.getInterval(i,n);if(-1!=r)return i[r+2]+(n-i[r])}return-1},t._lctf.readFeatureList=function(e,n){var i=t._bin,r=n,s=[],a=i.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2;var h=t._lctf.readFeatureTable(e,r+c);h.tag=l.trim(),s.push(h)}return s},t._lctf.readFeatureTable=function(e,n){var i=t._bin,r=n,s={},a=i.readUshort(e,n);n+=2,a>0&&(s.featureParams=r+a);var o=i.readUshort(e,n);n+=2,s.tab=[];for(var l=0;l<o;l++)s.tab.push(i.readUshort(e,n+2*l));return s},t._lctf.readScriptList=function(e,n){var i=t._bin,r=n,s={},a=i.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2,s[l.trim()]=t._lctf.readScriptTable(e,r+c)}return s},t._lctf.readScriptTable=function(e,n){var i=t._bin,r=n,s={},a=i.readUshort(e,n);n+=2,a>0&&(s.default=t._lctf.readLangSysTable(e,r+a));var o=i.readUshort(e,n);n+=2;for(var l=0;l<o;l++){var c=i.readASCII(e,n,4);n+=4;var h=i.readUshort(e,n);n+=2,s[c.trim()]=t._lctf.readLangSysTable(e,r+h)}return s},t._lctf.readLangSysTable=function(e,n){var i=t._bin,r={};i.readUshort(e,n),n+=2,r.reqFeature=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);return n+=2,r.features=i.readUshorts(e,n,s),r},t.CFF={},t.CFF.parse=function(e,n,i){var r=t._bin;(e=new Uint8Array(e.buffer,n,i))[n=0],e[++n],e[++n],e[++n],n++;var s=[];n=t.CFF.readIndex(e,n,s);for(var a=[],o=0;o<s.length-1;o++)a.push(r.readASCII(e,n+s[o],s[o+1]-s[o]));n+=s[s.length-1];var l=[];n=t.CFF.readIndex(e,n,l);var c=[];for(o=0;o<l.length-1;o++)c.push(t.CFF.readDict(e,n+l[o],n+l[o+1]));n+=l[l.length-1];var h=c[0],u=[];n=t.CFF.readIndex(e,n,u);var d=[];for(o=0;o<u.length-1;o++)d.push(r.readASCII(e,n+u[o],u[o+1]-u[o]));if(n+=u[u.length-1],t.CFF.readSubrs(e,n,h),h.CharStrings){n=h.CharStrings,u=[],n=t.CFF.readIndex(e,n,u);var p=[];for(o=0;o<u.length-1;o++)p.push(r.readBytes(e,n+u[o],u[o+1]-u[o]));h.CharStrings=p}if(h.ROS){n=h.FDArray;var f=[];for(n=t.CFF.readIndex(e,n,f),h.FDArray=[],o=0;o<f.length-1;o++){var m=t.CFF.readDict(e,n+f[o],n+f[o+1]);t.CFF._readFDict(e,m,d),h.FDArray.push(m)}n+=f[f.length-1],n=h.FDSelect,h.FDSelect=[];var A=e[n];if(n++,3!=A)throw A;var g=r.readUshort(e,n);for(n+=2,o=0;o<g+1;o++)h.FDSelect.push(r.readUshort(e,n),e[n+2]),n+=3}return h.Encoding&&(h.Encoding=t.CFF.readEncoding(e,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=t.CFF.readCharset(e,h.charset,h.CharStrings.length)),t.CFF._readFDict(e,h,d),h},t.CFF._readFDict=function(e,n,i){var r;for(var s in n.Private&&(r=n.Private[1],n.Private=t.CFF.readDict(e,r,r+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,r+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)&&(n[s]=i[n[s]-426+35])},t.CFF.readSubrs=function(e,n,i){var r=t._bin,s=[];n=t.CFF.readIndex(e,n,s);var a,o=s.length;a=o<1240?107:o<33900?1131:32768,i.Bias=a,i.Subrs=[];for(var l=0;l<s.length-1;l++)i.Subrs.push(r.readBytes(e,n+s[l],s[l+1]-s[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return-1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,i){t._bin;var r=[".notdef"],s=e[n];if(n++,0!=s)throw"error: unknown encoding format: "+s;var a=e[n];n++;for(var o=0;o<a;o++)r.push(e[n+o]);return r},t.CFF.readCharset=function(e,n,i){var r=t._bin,s=[".notdef"],a=e[n];if(n++,0==a)for(var o=0;o<i;o++){var l=r.readUshort(e,n);n+=2,s.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;s.length<i;){l=r.readUshort(e,n),n+=2;var c=0;for(1==a?(c=e[n],n++):(c=r.readUshort(e,n),n+=2),o=0;o<=c;o++)s.push(l),l++}}return s},t.CFF.readIndex=function(e,n,i){var r=t._bin,s=r.readUshort(e,n)+1,a=e[n+=2];if(n++,1==a)for(var o=0;o<s;o++)i.push(e[n+o]);else if(2==a)for(o=0;o<s;o++)i.push(r.readUshort(e,n+2*o));else if(3==a)for(o=0;o<s;o++)i.push(16777215&r.readUint(e,n+3*o-1));else if(1!=s)throw"unsupported offset size: "+a+", count: "+s;return(n+=s*a)-1},t.CFF.getCharString=function(e,n,i){var r=t._bin,s=e[n],a=e[n+1];e[n+2],e[n+3],e[n+4];var o=1,l=null,c=null;s<=20&&(l=s,o=1),12==s&&(l=100*s+a,o=2),21<=s&&s<=27&&(l=s,o=1),28==s&&(c=r.readShort(e,n+1),o=3),29<=s&&s<=31&&(l=s,o=1),32<=s&&s<=246&&(c=s-139,o=1),247<=s&&s<=250&&(c=256*(s-247)+a+108,o=2),251<=s&&s<=254&&(c=256*-(s-251)-a-108,o=2),255==s&&(c=r.readInt(e,n+1)/65535,o=5),i.val=null!=c?c:"o"+l,i.size=o},t.CFF.readCharString=function(e,n,i){for(var r=n+i,s=t._bin,a=[];n<r;){var o=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,h=null,u=null;o<=20&&(h=o,c=1),12==o&&(h=100*o+l,c=2),19!=o&&20!=o||(h=o,c=2),21<=o&&o<=27&&(h=o,c=1),28==o&&(u=s.readShort(e,n+1),c=3),29<=o&&o<=31&&(h=o,c=1),32<=o&&o<=246&&(u=o-139,c=1),247<=o&&o<=250&&(u=256*(o-247)+l+108,c=2),251<=o&&o<=254&&(u=256*-(o-251)-l-108,c=2),255==o&&(u=s.readInt(e,n+1)/65535,c=5),a.push(null!=u?u:"o"+h),n+=c}return a},t.CFF.readDict=function(e,n,i){for(var r=t._bin,s={},a=[];n<i;){var o=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,h=null,u=null;if(28==o&&(u=r.readShort(e,n+1),c=3),29==o&&(u=r.readInt(e,n+1),c=5),32<=o&&o<=246&&(u=o-139,c=1),247<=o&&o<=250&&(u=256*(o-247)+l+108,c=2),251<=o&&o<=254&&(u=256*-(o-251)-l-108,c=2),255==o)throw u=r.readInt(e,n+1)/65535,c=5,"unknown number";if(30==o){var d=[];for(c=1;;){var p=e[n+c];c++;var f=p>>4,m=15&p;if(15!=f&&d.push(f),15!=m&&d.push(m),15==m)break}for(var A="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<d.length;v++)A+=g[d[v]];u=parseFloat(A)}o<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][o],c=1,12==o&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=h?(s[h]=1==a.length?a[0]:a,a=[]):a.push(u),n+=c}return s},t.cmap={},t.cmap.parse=function(e,n,i){e=new Uint8Array(e.buffer,n,i),n=0;var r=t._bin,s={};r.readUshort(e,n),n+=2;var a=r.readUshort(e,n);n+=2;var o=[];s.tables=[];for(var l=0;l<a;l++){var c=r.readUshort(e,n);n+=2;var h=r.readUshort(e,n);n+=2;var u=r.readUint(e,n);n+=4;var d="p"+c+"e"+h,p=o.indexOf(u);if(-1==p){var f;p=s.tables.length,o.push(u);var m=r.readUshort(e,u);0==m?f=t.cmap.parse0(e,u):4==m?f=t.cmap.parse4(e,u):6==m?f=t.cmap.parse6(e,u):12==m?f=t.cmap.parse12(e,u):console.debug("unknown format: "+m,c,h,u),s.tables.push(f)}if(null!=s[d])throw"multiple tables for one platform+encoding";s[d]=p}return s},t.cmap.parse0=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,r.map=[];for(var a=0;a<s-6;a++)r.map.push(e[n+a]);return r},t.cmap.parse4=function(e,n){var i=t._bin,r=n,s={};s.format=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2;var l=o/2;s.searchRange=i.readUshort(e,n),n+=2,s.entrySelector=i.readUshort(e,n),n+=2,s.rangeShift=i.readUshort(e,n),n+=2,s.endCount=i.readUshorts(e,n,l),n+=2*l,n+=2,s.startCount=i.readUshorts(e,n,l),n+=2*l,s.idDelta=[];for(var c=0;c<l;c++)s.idDelta.push(i.readShort(e,n)),n+=2;for(s.idRangeOffset=i.readUshorts(e,n,l),n+=2*l,s.glyphIdArray=[];n<r+a;)s.glyphIdArray.push(i.readUshort(e,n)),n+=2;return s},t.cmap.parse6=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,r.firstCode=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);n+=2,r.glyphIdArray=[];for(var a=0;a<s;a++)r.glyphIdArray.push(i.readUshort(e,n)),n+=2;return r},t.cmap.parse12=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,n+=2,i.readUint(e,n),n+=4,i.readUint(e,n),n+=4;var s=i.readUint(e,n);n+=4,r.groups=[];for(var a=0;a<s;a++){var o=n+12*a,l=i.readUint(e,o+0),c=i.readUint(e,o+4),h=i.readUint(e,o+8);r.groups.push([l,c,h])}return r},t.glyf={},t.glyf.parse=function(e,t,n,i){for(var r=[],s=0;s<i.maxp.numGlyphs;s++)r.push(null);return r},t.glyf._parseGlyf=function(e,n){var i=t._bin,r=e._data,s=t._tabOffset(r,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var a={};if(a.noc=i.readShort(r,s),s+=2,a.xMin=i.readShort(r,s),s+=2,a.yMin=i.readShort(r,s),s+=2,a.xMax=i.readShort(r,s),s+=2,a.yMax=i.readShort(r,s),s+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var o=0;o<a.noc;o++)a.endPts.push(i.readUshort(r,s)),s+=2;var l=i.readUshort(r,s);if(s+=2,r.length-s<l)return null;a.instructions=i.readBytes(r,s,l),s+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],o=0;o<c;o++){var h=r[s];if(s++,a.flags.push(h),0!=(8&h)){var u=r[s];s++;for(var d=0;d<u;d++)a.flags.push(h),o++}}for(a.xs=[],o=0;o<c;o++){var p=0!=(2&a.flags[o]),f=0!=(16&a.flags[o]);p?(a.xs.push(f?r[s]:-r[s]),s++):f?a.xs.push(0):(a.xs.push(i.readShort(r,s)),s+=2)}for(a.ys=[],o=0;o<c;o++)p=0!=(4&a.flags[o]),f=0!=(32&a.flags[o]),p?(a.ys.push(f?r[s]:-r[s]),s++):f?a.ys.push(0):(a.ys.push(i.readShort(r,s)),s+=2);var m=0,A=0;for(o=0;o<c;o++)m+=a.xs[o],A+=a.ys[o],a.xs[o]=m,a.ys[o]=A}else{var g;a.parts=[];do{g=i.readUshort(r,s),s+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(v),v.glyphIndex=i.readUshort(r,s),s+=2,1&g){var y=i.readShort(r,s);s+=2;var x=i.readShort(r,s);s+=2}else y=i.readInt8(r,s),s++,x=i.readInt8(r,s),s++;2&g?(v.m.tx=y,v.m.ty=x):(v.p1=y,v.p2=x),8&g?(v.m.a=v.m.d=i.readF2dot14(r,s),s+=2):64&g?(v.m.a=i.readF2dot14(r,s),s+=2,v.m.d=i.readF2dot14(r,s),s+=2):128&g&&(v.m.a=i.readF2dot14(r,s),s+=2,v.m.b=i.readF2dot14(r,s),s+=2,v.m.c=i.readF2dot14(r,s),s+=2,v.m.d=i.readF2dot14(r,s),s+=2)}while(32&g);if(256&g){var _=i.readUshort(r,s);for(s+=2,a.instr=[],o=0;o<_;o++)a.instr.push(r[s]),s++}}return a},t.GDEF={},t.GDEF.parse=function(e,n,i,r){var s=n;n+=4;var a=t._bin.readUshort(e,n);return{glyphClassDef:0===a?null:t._lctf.readClassDef(e,s+a)}},t.GPOS={},t.GPOS.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GPOS.subt)},t.GPOS.subt=function(e,n,i,r){var s=t._bin,a=i,o={};if(o.fmt=s.readUshort(e,i),i+=2,1==n||2==n||3==n||7==n||8==n&&o.fmt<=2){var l=s.readUshort(e,i);i+=2,o.coverage=t._lctf.readCoverage(e,l+a)}if(1==n&&1==o.fmt){var c=s.readUshort(e,i);i+=2,0!=c&&(o.pos=t.GPOS.readValueRecord(e,i,c))}else if(2==n&&o.fmt>=1&&o.fmt<=2){c=s.readUshort(e,i),i+=2;var h=s.readUshort(e,i);i+=2;var u=t._lctf.numOfOnes(c),d=t._lctf.numOfOnes(h);if(1==o.fmt){o.pairsets=[];var p=s.readUshort(e,i);i+=2;for(var f=0;f<p;f++){var m=a+s.readUshort(e,i);i+=2;var A=s.readUshort(e,m);m+=2;for(var g=[],v=0;v<A;v++){var y=s.readUshort(e,m);m+=2,0!=c&&(b=t.GPOS.readValueRecord(e,m,c),m+=2*u),0!=h&&(M=t.GPOS.readValueRecord(e,m,h),m+=2*d),g.push({gid2:y,val1:b,val2:M})}o.pairsets.push(g)}}if(2==o.fmt){var x=s.readUshort(e,i);i+=2;var _=s.readUshort(e,i);i+=2;var E=s.readUshort(e,i);i+=2;var w=s.readUshort(e,i);for(i+=2,o.classDef1=t._lctf.readClassDef(e,a+x),o.classDef2=t._lctf.readClassDef(e,a+_),o.matrix=[],f=0;f<E;f++){var C=[];for(v=0;v<w;v++){var b=null,M=null;0!=c&&(b=t.GPOS.readValueRecord(e,i,c),i+=2*u),0!=h&&(M=t.GPOS.readValueRecord(e,i,h),i+=2*d),C.push({val1:b,val2:M})}o.matrix.push(C)}}}else if(4==n&&1==o.fmt)o.markCoverage=t._lctf.readCoverage(e,s.readUshort(e,i)+a),o.baseCoverage=t._lctf.readCoverage(e,s.readUshort(e,i+2)+a),o.markClassCount=s.readUshort(e,i+4),o.markArray=t.GPOS.readMarkArray(e,s.readUshort(e,i+6)+a),o.baseArray=t.GPOS.readBaseArray(e,s.readUshort(e,i+8)+a,o.markClassCount);else if(6==n&&1==o.fmt)o.mark1Coverage=t._lctf.readCoverage(e,s.readUshort(e,i)+a),o.mark2Coverage=t._lctf.readCoverage(e,s.readUshort(e,i+2)+a),o.markClassCount=s.readUshort(e,i+4),o.mark1Array=t.GPOS.readMarkArray(e,s.readUshort(e,i+6)+a),o.mark2Array=t.GPOS.readBaseArray(e,s.readUshort(e,i+8)+a,o.markClassCount);else{if(9==n&&1==o.fmt){var S=s.readUshort(e,i);i+=2;var I=s.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=S;else if(r.ltype!=S)throw"invalid extension substitution";return t.GPOS.subt(e,r.ltype,a+I)}console.debug("unsupported GPOS table LookupType",n,"format",o.fmt)}return o},t.GPOS.readValueRecord=function(e,n,i){var r=t._bin,s=[];return s.push(1&i?r.readShort(e,n):0),n+=1&i?2:0,s.push(2&i?r.readShort(e,n):0),n+=2&i?2:0,s.push(4&i?r.readShort(e,n):0),n+=4&i?2:0,s.push(8&i?r.readShort(e,n):0),n+=8&i?2:0,s},t.GPOS.readBaseArray=function(e,n,i){var r=t._bin,s=[],a=n,o=r.readUshort(e,n);n+=2;for(var l=0;l<o;l++){for(var c=[],h=0;h<i;h++)c.push(t.GPOS.readAnchorRecord(e,a+r.readUshort(e,n))),n+=2;s.push(c)}return s},t.GPOS.readMarkArray=function(e,n){var i=t._bin,r=[],s=n,a=i.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=t.GPOS.readAnchorRecord(e,i.readUshort(e,n+2)+s);l.markClass=i.readUshort(e,n),r.push(l),n+=4}return r},t.GPOS.readAnchorRecord=function(e,n){var i=t._bin,r={};return r.fmt=i.readUshort(e,n),r.x=i.readShort(e,n+2),r.y=i.readShort(e,n+4),r},t.GSUB={},t.GSUB.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GSUB.subt)},t.GSUB.subt=function(e,n,i,r){var s=t._bin,a=i,o={};if(o.fmt=s.readUshort(e,i),i+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&o.fmt<=2||6==n&&o.fmt<=2){var l=s.readUshort(e,i);i+=2,o.coverage=t._lctf.readCoverage(e,a+l)}if(1==n&&o.fmt>=1&&o.fmt<=2){if(1==o.fmt)o.delta=s.readShort(e,i),i+=2;else if(2==o.fmt){var c=s.readUshort(e,i);i+=2,o.newg=s.readUshorts(e,i,c),i+=2*o.newg.length}}else if(2==n&&1==o.fmt){c=s.readUshort(e,i),i+=2,o.seqs=[];for(var h=0;h<c;h++){var u=s.readUshort(e,i)+a;i+=2;var d=s.readUshort(e,u);o.seqs.push(s.readUshorts(e,u+2,d))}}else if(4==n)for(o.vals=[],c=s.readUshort(e,i),i+=2,h=0;h<c;h++){var p=s.readUshort(e,i);i+=2,o.vals.push(t.GSUB.readLigatureSet(e,a+p))}else if(5==n&&2==o.fmt){if(2==o.fmt){var f=s.readUshort(e,i);i+=2,o.cDef=t._lctf.readClassDef(e,a+f),o.scset=[];var m=s.readUshort(e,i);for(i+=2,h=0;h<m;h++){var A=s.readUshort(e,i);i+=2,o.scset.push(0==A?null:t.GSUB.readSubClassSet(e,a+A))}}}else if(6==n&&3==o.fmt){if(3==o.fmt){for(h=0;h<3;h++){c=s.readUshort(e,i),i+=2;for(var g=[],v=0;v<c;v++)g.push(t._lctf.readCoverage(e,a+s.readUshort(e,i+2*v)));i+=2*c,0==h&&(o.backCvg=g),1==h&&(o.inptCvg=g),2==h&&(o.ahedCvg=g)}c=s.readUshort(e,i),i+=2,o.lookupRec=t.GSUB.readSubstLookupRecords(e,i,c)}}else{if(7==n&&1==o.fmt){var y=s.readUshort(e,i);i+=2;var x=s.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=y;else if(r.ltype!=y)throw"invalid extension substitution";return t.GSUB.subt(e,r.ltype,a+x)}console.debug("unsupported GSUB table LookupType",n,"format",o.fmt)}return o},t.GSUB.readSubClassSet=function(e,n){var i=t._bin.readUshort,r=n,s=[],a=i(e,n);n+=2;for(var o=0;o<a;o++){var l=i(e,n);n+=2,s.push(t.GSUB.readSubClassRule(e,r+l))}return s},t.GSUB.readSubClassRule=function(e,n){var i=t._bin.readUshort,r={},s=i(e,n),a=i(e,n+=2);n+=2,r.input=[];for(var o=0;o<s-1;o++)r.input.push(i(e,n)),n+=2;return r.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,a),r},t.GSUB.readSubstLookupRecords=function(e,n,i){for(var r=t._bin.readUshort,s=[],a=0;a<i;a++)s.push(r(e,n),r(e,n+2)),n+=4;return s},t.GSUB.readChainSubClassSet=function(e,n){var i=t._bin,r=n,s=[],a=i.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=i.readUshort(e,n);n+=2,s.push(t.GSUB.readChainSubClassRule(e,r+l))}return s},t.GSUB.readChainSubClassRule=function(e,n){for(var i=t._bin,r={},s=["backtrack","input","lookahead"],a=0;a<s.length;a++){var o=i.readUshort(e,n);n+=2,1==a&&o--,r[s[a]]=i.readUshorts(e,n,o),n+=2*r[s[a]].length}return o=i.readUshort(e,n),n+=2,r.subst=i.readUshorts(e,n,2*o),n+=2*r.subst.length,r},t.GSUB.readLigatureSet=function(e,n){var i=t._bin,r=n,s=[],a=i.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=i.readUshort(e,n);n+=2,s.push(t.GSUB.readLigature(e,r+l))}return s},t.GSUB.readLigature=function(e,n){var i=t._bin,r={chain:[]};r.nglyph=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);n+=2;for(var a=0;a<s-1;a++)r.chain.push(i.readUshort(e,n)),n+=2;return r},t.head={},t.head.parse=function(e,n,i){var r=t._bin,s={};return r.readFixed(e,n),n+=4,s.fontRevision=r.readFixed(e,n),n+=4,r.readUint(e,n),n+=4,r.readUint(e,n),n+=4,s.flags=r.readUshort(e,n),n+=2,s.unitsPerEm=r.readUshort(e,n),n+=2,s.created=r.readUint64(e,n),n+=8,s.modified=r.readUint64(e,n),n+=8,s.xMin=r.readShort(e,n),n+=2,s.yMin=r.readShort(e,n),n+=2,s.xMax=r.readShort(e,n),n+=2,s.yMax=r.readShort(e,n),n+=2,s.macStyle=r.readUshort(e,n),n+=2,s.lowestRecPPEM=r.readUshort(e,n),n+=2,s.fontDirectionHint=r.readShort(e,n),n+=2,s.indexToLocFormat=r.readShort(e,n),n+=2,s.glyphDataFormat=r.readShort(e,n),n+=2,s},t.hhea={},t.hhea.parse=function(e,n,i){var r=t._bin,s={};return r.readFixed(e,n),n+=4,s.ascender=r.readShort(e,n),n+=2,s.descender=r.readShort(e,n),n+=2,s.lineGap=r.readShort(e,n),n+=2,s.advanceWidthMax=r.readUshort(e,n),n+=2,s.minLeftSideBearing=r.readShort(e,n),n+=2,s.minRightSideBearing=r.readShort(e,n),n+=2,s.xMaxExtent=r.readShort(e,n),n+=2,s.caretSlopeRise=r.readShort(e,n),n+=2,s.caretSlopeRun=r.readShort(e,n),n+=2,s.caretOffset=r.readShort(e,n),n+=2,n+=8,s.metricDataFormat=r.readShort(e,n),n+=2,s.numberOfHMetrics=r.readUshort(e,n),n+=2,s},t.hmtx={},t.hmtx.parse=function(e,n,i,r){for(var s=t._bin,a={aWidth:[],lsBearing:[]},o=0,l=0,c=0;c<r.maxp.numGlyphs;c++)c<r.hhea.numberOfHMetrics&&(o=s.readUshort(e,n),n+=2,l=s.readShort(e,n),n+=2),a.aWidth.push(o),a.lsBearing.push(l);return a},t.kern={},t.kern.parse=function(e,n,i,r){var s=t._bin,a=s.readUshort(e,n);if(n+=2,1==a)return t.kern.parseV1(e,n-2,i,r);var o=s.readUshort(e,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<o;c++){n+=2,i=s.readUshort(e,n),n+=2;var h=s.readUshort(e,n);n+=2;var u=h>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=t.kern.readFormat0(e,n,l)}return l},t.kern.parseV1=function(e,n,i,r){var s=t._bin;s.readFixed(e,n),n+=4;var a=s.readUint(e,n);n+=4;for(var o={glyph1:[],rval:[]},l=0;l<a;l++){s.readUint(e,n),n+=4;var c=s.readUshort(e,n);n+=2,s.readUshort(e,n),n+=2;var h=c>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;n=t.kern.readFormat0(e,n,o)}return o},t.kern.readFormat0=function(e,n,i){var r=t._bin,s=-1,a=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2;for(var o=0;o<a;o++){var l=r.readUshort(e,n);n+=2;var c=r.readUshort(e,n);n+=2;var h=r.readShort(e,n);n+=2,l!=s&&(i.glyph1.push(l),i.rval.push({glyph2:[],vals:[]}));var u=i.rval[i.rval.length-1];u.glyph2.push(c),u.vals.push(h),s=l}return n},t.loca={},t.loca.parse=function(e,n,i,r){var s=t._bin,a=[],o=r.head.indexToLocFormat,l=r.maxp.numGlyphs+1;if(0==o)for(var c=0;c<l;c++)a.push(s.readUshort(e,n+(c<<1))<<1);if(1==o)for(c=0;c<l;c++)a.push(s.readUint(e,n+(c<<2)));return a},t.maxp={},t.maxp.parse=function(e,n,i){var r=t._bin,s={},a=r.readUint(e,n);return n+=4,s.numGlyphs=r.readUshort(e,n),n+=2,65536==a&&(s.maxPoints=r.readUshort(e,n),n+=2,s.maxContours=r.readUshort(e,n),n+=2,s.maxCompositePoints=r.readUshort(e,n),n+=2,s.maxCompositeContours=r.readUshort(e,n),n+=2,s.maxZones=r.readUshort(e,n),n+=2,s.maxTwilightPoints=r.readUshort(e,n),n+=2,s.maxStorage=r.readUshort(e,n),n+=2,s.maxFunctionDefs=r.readUshort(e,n),n+=2,s.maxInstructionDefs=r.readUshort(e,n),n+=2,s.maxStackElements=r.readUshort(e,n),n+=2,s.maxSizeOfInstructions=r.readUshort(e,n),n+=2,s.maxComponentElements=r.readUshort(e,n),n+=2,s.maxComponentDepth=r.readUshort(e,n),n+=2),s},t.name={},t.name.parse=function(e,n,i){var r=t._bin,s={};r.readUshort(e,n),n+=2;var a=r.readUshort(e,n);n+=2,r.readUshort(e,n);for(var o,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,h=0;h<a;h++){var u=r.readUshort(e,n);n+=2;var d=r.readUshort(e,n);n+=2;var p=r.readUshort(e,n);n+=2;var f=r.readUshort(e,n);n+=2;var m=r.readUshort(e,n);n+=2;var A=r.readUshort(e,n);n+=2;var g,v=l[f],y=c+12*a+A;if(0==u)g=r.readUnicode(e,y,m/2);else if(3==u&&0==d)g=r.readUnicode(e,y,m/2);else if(0==d)g=r.readASCII(e,y,m);else if(1==d)g=r.readUnicode(e,y,m/2);else if(3==d)g=r.readUnicode(e,y,m/2);else{if(1!=u)throw"unknown encoding "+d+", platformID: "+u;g=r.readASCII(e,y,m),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var x="p"+u+","+p.toString(16);null==s[x]&&(s[x]={}),s[x][void 0!==v?v:f]=g,s[x]._lang=p}for(var _ in s)if(null!=s[_].postScriptName&&1033==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName&&0==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName&&3084==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName)return s[_];for(var _ in s){o=_;break}return console.debug("returning name table with languageID "+s[o]._lang),s[o]},t["OS/2"]={},t["OS/2"].parse=function(e,n,i){var r=t._bin.readUshort(e,n);n+=2;var s={};if(0==r)t["OS/2"].version0(e,n,s);else if(1==r)t["OS/2"].version1(e,n,s);else if(2==r||3==r||4==r)t["OS/2"].version2(e,n,s);else{if(5!=r)throw"unknown OS/2 table version: "+r;t["OS/2"].version5(e,n,s)}return s},t["OS/2"].version0=function(e,n,i){var r=t._bin;return i.xAvgCharWidth=r.readShort(e,n),n+=2,i.usWeightClass=r.readUshort(e,n),n+=2,i.usWidthClass=r.readUshort(e,n),n+=2,i.fsType=r.readUshort(e,n),n+=2,i.ySubscriptXSize=r.readShort(e,n),n+=2,i.ySubscriptYSize=r.readShort(e,n),n+=2,i.ySubscriptXOffset=r.readShort(e,n),n+=2,i.ySubscriptYOffset=r.readShort(e,n),n+=2,i.ySuperscriptXSize=r.readShort(e,n),n+=2,i.ySuperscriptYSize=r.readShort(e,n),n+=2,i.ySuperscriptXOffset=r.readShort(e,n),n+=2,i.ySuperscriptYOffset=r.readShort(e,n),n+=2,i.yStrikeoutSize=r.readShort(e,n),n+=2,i.yStrikeoutPosition=r.readShort(e,n),n+=2,i.sFamilyClass=r.readShort(e,n),n+=2,i.panose=r.readBytes(e,n,10),n+=10,i.ulUnicodeRange1=r.readUint(e,n),n+=4,i.ulUnicodeRange2=r.readUint(e,n),n+=4,i.ulUnicodeRange3=r.readUint(e,n),n+=4,i.ulUnicodeRange4=r.readUint(e,n),n+=4,i.achVendID=[r.readInt8(e,n),r.readInt8(e,n+1),r.readInt8(e,n+2),r.readInt8(e,n+3)],n+=4,i.fsSelection=r.readUshort(e,n),n+=2,i.usFirstCharIndex=r.readUshort(e,n),n+=2,i.usLastCharIndex=r.readUshort(e,n),n+=2,i.sTypoAscender=r.readShort(e,n),n+=2,i.sTypoDescender=r.readShort(e,n),n+=2,i.sTypoLineGap=r.readShort(e,n),n+=2,i.usWinAscent=r.readUshort(e,n),n+=2,i.usWinDescent=r.readUshort(e,n),n+2},t["OS/2"].version1=function(e,n,i){var r=t._bin;return n=t["OS/2"].version0(e,n,i),i.ulCodePageRange1=r.readUint(e,n),n+=4,i.ulCodePageRange2=r.readUint(e,n),n+4},t["OS/2"].version2=function(e,n,i){var r=t._bin;return n=t["OS/2"].version1(e,n,i),i.sxHeight=r.readShort(e,n),n+=2,i.sCapHeight=r.readShort(e,n),n+=2,i.usDefault=r.readUshort(e,n),n+=2,i.usBreak=r.readUshort(e,n),n+=2,i.usMaxContext=r.readUshort(e,n),n+2},t["OS/2"].version5=function(e,n,i){var r=t._bin;return n=t["OS/2"].version2(e,n,i),i.usLowerOpticalPointSize=r.readUshort(e,n),n+=2,i.usUpperOpticalPointSize=r.readUshort(e,n),n+2},t.post={},t.post.parse=function(e,n,i){var r=t._bin,s={};return s.version=r.readFixed(e,n),n+=4,s.italicAngle=r.readFixed(e,n),n+=4,s.underlinePosition=r.readShort(e,n),n+=2,s.underlineThickness=r.readShort(e,n),n+=2,s},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,i=-1;if(null!=n.p0e4?i=n.p0e4:null!=n.p3e1?i=n.p3e1:null!=n.p1e0?i=n.p1e0:null!=n.p0e3&&(i=n.p0e3),-1==i)throw"no familiar platform and encoding!";var r=n.tables[i];if(0==r.format)return t>=r.map.length?0:r.map[t];if(4==r.format){for(var s=-1,a=0;a<r.endCount.length;a++)if(t<=r.endCount[a]){s=a;break}return-1==s||r.startCount[s]>t?0:65535&(0!=r.idRangeOffset[s]?r.glyphIdArray[t-r.startCount[s]+(r.idRangeOffset[s]>>1)-(r.idRangeOffset.length-s)]:t+r.idDelta[s])}if(12==r.format){if(t>r.groups[r.groups.length-1][1])return 0;for(a=0;a<r.groups.length;a++){var o=r.groups[a];if(o[0]<=t&&t<=o[1])return o[2]+(t-o[0])}return 0}throw"unknown cmap table format "+r.format},t.U.glyphToPath=function(e,n){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var r=e.SVG.entries[n];return null==r?i:("string"==typeof r&&(r=t.SVG.toPath(r),e.SVG.entries[n]=r),r)}if(e.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,o=e.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=n;)l+=2;o=a.FDArray[a.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],s,a,o,i)}else e.glyf&&t.U._drawGlyf(n,e,i);return i},t.U._drawGlyf=function(e,n,i){var r=n.glyf[e];null==r&&(r=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=r&&(r.noc>-1?t.U._simpleGlyph(r,i):t.U._compoGlyph(r,n,i))},t.U._simpleGlyph=function(e,n){for(var i=0;i<e.noc;i++){for(var r=0==i?0:e.endPts[i-1]+1,s=e.endPts[i],a=r;a<=s;a++){var o=a==r?s:a-1,l=a==s?r:a+1,c=1&e.flags[a],h=1&e.flags[o],u=1&e.flags[l],d=e.xs[a],p=e.ys[a];if(a==r)if(c){if(!h){t.U.P.moveTo(n,d,p);continue}t.U.P.moveTo(n,e.xs[o],e.ys[o])}else h?t.U.P.moveTo(n,e.xs[o],e.ys[o]):t.U.P.moveTo(n,(e.xs[o]+d)/2,(e.ys[o]+p)/2);c?h&&t.U.P.lineTo(n,d,p):u?t.U.P.qcurveTo(n,d,p,e.xs[l],e.ys[l]):t.U.P.qcurveTo(n,d,p,(d+e.xs[l])/2,(p+e.ys[l])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,i){for(var r=0;r<e.parts.length;r++){var s={cmds:[],crds:[]},a=e.parts[r];t.U._drawGlyf(a.glyphIndex,n,s);for(var o=a.m,l=0;l<s.crds.length;l+=2){var c=s.crds[l],h=s.crds[l+1];i.crds.push(c*o.a+h*o.b+o.tx),i.crds.push(c*o.c+h*o.d+o.ty)}for(l=0;l<s.cmds.length;l++)i.cmds.push(s.cmds[l])}},t.U._getGlyphClass=function(e,n){var i=t._lctf.getInterval(n,e);return-1==i?0:n[i+2]},t.U._applySubs=function(e,n,i,r){for(var s=e.length-n-1,a=0;a<i.tabs.length;a++)if(null!=i.tabs[a]){var o,l=i.tabs[a];if(!l.coverage||-1!=(o=t._lctf.coverageIndex(l.coverage,e[n])))if(1==i.ltype)e[n],1==l.fmt?e[n]=e[n]+l.delta:e[n]=l.newg[o];else if(4==i.ltype)for(var c=l.vals[o],h=0;h<c.length;h++){var u=c[h],d=u.chain.length;if(!(d>s)){for(var p=!0,f=0,m=0;m<d;m++){for(;-1==e[n+f+(1+m)];)f++;u.chain[m]!=e[n+f+(1+m)]&&(p=!1)}if(p){for(e[n]=u.nglyph,m=0;m<d+f;m++)e[n+m+1]=-1;break}}}else if(5==i.ltype&&2==l.fmt)for(var A=t._lctf.getInterval(l.cDef,e[n]),g=l.cDef[A+2],v=l.scset[g],y=0;y<v.length;y++){var x=v[y],_=x.input;if(!(_.length>s)){for(p=!0,m=0;m<_.length;m++){var E=t._lctf.getInterval(l.cDef,e[n+1+m]);if(-1==A&&l.cDef[E+2]!=_[m]){p=!1;break}}if(p){var w=x.substLookupRecords;for(h=0;h<w.length;h+=2)w[h],w[h+1]}}}else if(6==i.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,n-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,n))continue;if(!t.U._glsCovered(e,l.ahedCvg,n+l.inptCvg.length))continue;var C=l.lookupRec;for(y=0;y<C.length;y+=2){A=C[y];var b=r[C[y+1]];t.U._applySubs(e,n+A,b,r)}}}},t.U._glsCovered=function(e,n,i){for(var r=0;r<n.length;r++)if(-1==t._lctf.coverageIndex(n[r],e[i+r]))return!1;return!0},t.U.glyphsToPath=function(e,n,i){for(var r={cmds:[],crds:[]},s=0,a=0;a<n.length;a++){var o=n[a];if(-1!=o){for(var l=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,c=t.U.glyphToPath(e,o),h=0;h<c.crds.length;h+=2)r.crds.push(c.crds[h]+s),r.crds.push(c.crds[h+1]);for(i&&r.cmds.push(i),h=0;h<c.cmds.length;h++)r.cmds.push(c.cmds[h]);i&&r.cmds.push("X"),s+=e.hmtx.aWidth[o],a<n.length-1&&(s+=t.U.getPairAdjustment(e,o,l))}}return r},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,i,r,s,a){e.cmds.push("C"),e.crds.push(t,n,i,r,s,a)},t.U.P.qcurveTo=function(e,t,n,i,r){e.cmds.push("Q"),e.crds.push(t,n,i,r)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,i,r,s){for(var a=n.stack,o=n.nStems,l=n.haveWidth,c=n.width,h=n.open,u=0,d=n.x,p=n.y,f=0,m=0,A=0,g=0,v=0,y=0,x=0,_=0,E=0,w=0,C={val:0,size:0};u<e.length;){t.CFF.getCharString(e,u,C);var b=C.val;if(u+=C.size,"o1"==b||"o18"==b)a.length%2!=0&&!l&&(c=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o3"==b||"o23"==b)a.length%2!=0&&!l&&(c=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o4"==b)a.length>1&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),h&&t.U.P.closePath(s),p+=a.pop(),t.U.P.moveTo(s,d,p),h=!0;else if("o5"==b)for(;a.length>0;)d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p);else if("o6"==b||"o7"==b)for(var M=a.length,S="o6"==b,I=0;I<M;I++){var B=a.shift();S?d+=B:p+=B,S=!S,t.U.P.lineTo(s,d,p)}else if("o8"==b||"o24"==b){M=a.length;for(var T=0;T+6<=M;)f=d+a.shift(),m=p+a.shift(),A=f+a.shift(),g=m+a.shift(),d=A+a.shift(),p=g+a.shift(),t.U.P.curveTo(s,f,m,A,g,d,p),T+=6;"o24"==b&&(d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p))}else{if("o11"==b)break;if("o1234"==b||"o1235"==b||"o1236"==b||"o1237"==b)"o1234"==b&&(m=p,A=(f=d+a.shift())+a.shift(),w=g=m+a.shift(),y=g,_=p,d=(x=(v=(E=A+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(s,f,m,A,g,E,w),t.U.P.curveTo(s,v,y,x,_,d,p)),"o1235"==b&&(f=d+a.shift(),m=p+a.shift(),A=f+a.shift(),g=m+a.shift(),E=A+a.shift(),w=g+a.shift(),v=E+a.shift(),y=w+a.shift(),x=v+a.shift(),_=y+a.shift(),d=x+a.shift(),p=_+a.shift(),a.shift(),t.U.P.curveTo(s,f,m,A,g,E,w),t.U.P.curveTo(s,v,y,x,_,d,p)),"o1236"==b&&(f=d+a.shift(),m=p+a.shift(),A=f+a.shift(),w=g=m+a.shift(),y=g,x=(v=(E=A+a.shift())+a.shift())+a.shift(),_=y+a.shift(),d=x+a.shift(),t.U.P.curveTo(s,f,m,A,g,E,w),t.U.P.curveTo(s,v,y,x,_,d,p)),"o1237"==b&&(f=d+a.shift(),m=p+a.shift(),A=f+a.shift(),g=m+a.shift(),E=A+a.shift(),w=g+a.shift(),v=E+a.shift(),y=w+a.shift(),x=v+a.shift(),_=y+a.shift(),Math.abs(x-d)>Math.abs(_-p)?d=x+a.shift():p=_+a.shift(),t.U.P.curveTo(s,f,m,A,g,E,w),t.U.P.curveTo(s,v,y,x,_,d,p));else if("o14"==b){if(a.length>0&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),4==a.length){var R=a.shift(),D=a.shift(),L=a.shift(),P=a.shift(),F=t.CFF.glyphBySE(i,L),U=t.CFF.glyphBySE(i,P);t.U._drawCFF(i.CharStrings[F],n,i,r,s),n.x=R,n.y=D,t.U._drawCFF(i.CharStrings[U],n,i,r,s)}h&&(t.U.P.closePath(s),h=!1)}else if("o19"==b||"o20"==b)a.length%2!=0&&!l&&(c=a.shift()+r.nominalWidthX),o+=a.length>>1,a.length=0,l=!0,u+=o+7>>3;else if("o21"==b)a.length>2&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),p+=a.pop(),d+=a.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,d,p),h=!0;else if("o22"==b)a.length>1&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),d+=a.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,d,p),h=!0;else if("o25"==b){for(;a.length>6;)d+=a.shift(),p+=a.shift(),t.U.P.lineTo(s,d,p);f=d+a.shift(),m=p+a.shift(),A=f+a.shift(),g=m+a.shift(),d=A+a.shift(),p=g+a.shift(),t.U.P.curveTo(s,f,m,A,g,d,p)}else if("o26"==b)for(a.length%2&&(d+=a.shift());a.length>0;)f=d,m=p+a.shift(),d=A=f+a.shift(),p=(g=m+a.shift())+a.shift(),t.U.P.curveTo(s,f,m,A,g,d,p);else if("o27"==b)for(a.length%2&&(p+=a.shift());a.length>0;)m=p,A=(f=d+a.shift())+a.shift(),g=m+a.shift(),d=A+a.shift(),p=g,t.U.P.curveTo(s,f,m,A,g,d,p);else if("o10"==b||"o29"==b){var O="o10"==b?r:i;if(0==a.length)console.debug("error: empty stack");else{var N=a.pop(),k=O.Subrs[N+O.Bias];n.x=d,n.y=p,n.nStems=o,n.haveWidth=l,n.width=c,n.open=h,t.U._drawCFF(k,n,i,r,s),d=n.x,p=n.y,o=n.nStems,l=n.haveWidth,c=n.width,h=n.open}}else if("o30"==b||"o31"==b){var G=a.length,Q=(T=0,"o31"==b);for(T+=G-(M=-3&G);T<M;)Q?(m=p,A=(f=d+a.shift())+a.shift(),p=(g=m+a.shift())+a.shift(),M-T==5?(d=A+a.shift(),T++):d=A,Q=!1):(f=d,m=p+a.shift(),A=f+a.shift(),g=m+a.shift(),d=A+a.shift(),M-T==5?(p=g+a.shift(),T++):p=g,Q=!0),t.U.P.curveTo(s,f,m,A,g,d,p),T+=4}else{if("o"==(b+"").charAt(0))throw console.debug("Unknown operation: "+b,e),b;a.push(b)}}}n.x=d,n.y=p,n.nStems=o,n.haveWidth=l,n.width=c,n.open=h};var n=t,i={Typr:n};return e.Typr=n,e.default=i,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr}
/*!
	Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
	(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
	Original licenses apply: 
	- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
	- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
	*/,function(){return function(e){var t=Uint8Array,n=Uint16Array,i=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,t){for(var r=new n(31),s=0;s<31;++s)r[s]=t+=1<<e[s-1];var a=new i(r[30]);for(s=1;s<30;++s)for(var o=r[s];o<r[s+1];++o)a[o]=o-r[s]<<5|s;return[r,a]},l=o(r,2),c=l[0],h=l[1];c[28]=258,h[258]=28;for(var u=o(s,0)[0],d=new n(32768),p=0;p<32768;++p){var f=(43690&p)>>>1|(21845&p)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,d[p]=((65280&f)>>>8|(255&f)<<8)>>>1}var m=function(e,t,i){for(var r=e.length,s=0,a=new n(t);s<r;++s)++a[e[s]-1];var o,l=new n(t);for(s=0;s<t;++s)l[s]=l[s-1]+a[s-1]<<1;o=new n(1<<t);var c=15-t;for(s=0;s<r;++s)if(e[s])for(var h=s<<4|e[s],u=t-e[s],p=l[e[s]-1]++<<u,f=p|(1<<u)-1;p<=f;++p)o[d[p]>>>c]=h;return o},A=new t(288);for(p=0;p<144;++p)A[p]=8;for(p=144;p<256;++p)A[p]=9;for(p=256;p<280;++p)A[p]=7;for(p=280;p<288;++p)A[p]=8;var g=new t(32);for(p=0;p<32;++p)g[p]=5;var v=m(A,9),y=m(g,5),x=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},_=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},E=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(e,t,n){var i=new Error(t||w[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,C),!n)throw i;return i},b=function(e,o,l){var h=e.length;if(!h||l&&!l.l&&h<5)return o||new t(0);var d=!o||l,p=!l||l.i;l||(l={}),o||(o=new t(3*h));var f,A=function(e){var n=o.length;if(e>n){var i=new t(Math.max(2*n,e));i.set(o),o=i}},g=l.f||0,w=l.p||0,b=l.b||0,M=l.l,S=l.d,I=l.m,B=l.n,T=8*h;do{if(!M){l.f=g=_(e,w,1);var R=_(e,w+1,3);if(w+=3,!R){var D=e[(H=((f=w)/8|0)+(7&f&&1)+4)-4]|e[H-3]<<8,L=H+D;if(L>h){p&&C(0);break}d&&A(b+D),o.set(e.subarray(H,L),b),l.b=b+=D,l.p=w=8*L;continue}if(1==R)M=v,S=y,I=9,B=5;else if(2==R){var P=_(e,w,31)+257,F=_(e,w+10,15)+4,U=P+_(e,w+5,31)+1;w+=14;for(var O=new t(U),N=new t(19),k=0;k<F;++k)N[a[k]]=_(e,w+3*k,7);w+=3*F;var G=x(N),Q=(1<<G)-1,z=m(N,G);for(k=0;k<U;){var H,V=z[_(e,w,Q)];if(w+=15&V,(H=V>>>4)<16)O[k++]=H;else{var W=0,j=0;for(16==H?(j=3+_(e,w,3),w+=2,W=O[k-1]):17==H?(j=3+_(e,w,7),w+=3):18==H&&(j=11+_(e,w,127),w+=7);j--;)O[k++]=W}}var X=O.subarray(0,P),J=O.subarray(P);I=x(X),B=x(J),M=m(X,I),S=m(J,B)}else C(1);if(w>T){p&&C(0);break}}d&&A(b+131072);for(var q=(1<<I)-1,Y=(1<<B)-1,K=w;;K=w){var Z=(W=M[E(e,w)&q])>>>4;if((w+=15&W)>T){p&&C(0);break}if(W||C(2),Z<256)o[b++]=Z;else{if(256==Z){K=w,M=null;break}var $=Z-254;if(Z>264){var ee=r[k=Z-257];$=_(e,w,(1<<ee)-1)+c[k],w+=ee}var te=S[E(e,w)&Y],ne=te>>>4;if(te||C(3),w+=15&te,J=u[ne],ne>3&&(ee=s[ne],J+=E(e,w)&(1<<ee)-1,w+=ee),w>T){p&&C(0);break}d&&A(b+131072);for(var ie=b+$;b<ie;b+=4)o[b]=o[b-J],o[b+1]=o[b+1-J],o[b+2]=o[b+2-J],o[b+3]=o[b+3-J];b=ie}}l.l=M,l.p=K,l.b=b,M&&(g=1,l.m=I,l.d=S,l.n=B)}while(!g);return b==o.length?o:function(e,r,s){(null==s||s>e.length)&&(s=e.length);var a=new(e instanceof n?n:e instanceof i?i:t)(s-0);return a.set(e.subarray(0,s)),a}(o,0,b)},M=new t(0),S="undefined"!=typeof TextDecoder&&new TextDecoder;try{S.decode(M,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),n=0;function i(){var e=t.getUint16(n);return n+=2,e}function r(){var e=t.getUint32(n);return n+=4,e}function s(e){g.setUint16(v,e),v+=2}function a(e){g.setUint32(v,e),v+=4}for(var o={signature:r(),flavor:r(),length:r(),numTables:i(),reserved:i(),totalSfntSize:r(),majorVersion:i(),minorVersion:i(),metaOffset:r(),metaLength:r(),metaOrigLength:r(),privOffset:r(),privLength:r()},l=0;Math.pow(2,l)<=o.numTables;)l++;l--;for(var c=16*Math.pow(2,l),h=16*o.numTables-c,u=12,d=[],p=0;p<o.numTables;p++)d.push({tag:r(),offset:r(),compLength:r(),origLength:r(),origChecksum:r()}),u+=16;var f,m=new Uint8Array(12+16*d.length+d.reduce((function(e,t){return e+t.origLength+4}),0)),A=m.buffer,g=new DataView(A),v=0;return a(o.flavor),s(o.numTables),s(c),s(l),s(h),d.forEach((function(e){a(e.tag),a(e.origChecksum),a(u),a(e.origLength),e.outOffset=u,(u+=e.origLength)%4!=0&&(u+=4-u%4)})),d.forEach((function(t){var n,i=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var r=new Uint8Array(t.origLength);n=new Uint8Array(i,2),b(n,r)}else r=new Uint8Array(i);m.set(r,t.outOffset);var s=0;(u=t.outOffset+t.origLength)%4!=0&&(s=4-u%4),m.set(new Uint8Array(s).buffer,t.outOffset+t.origLength),f=u+s})),A.slice(0,f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const n={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let r;function s(e){if(!r){const e={R:2,L:1,D:4,C:16,U:32,T:8};r=new Map;for(let t in i){let n=0;i[t].split(",").forEach((i=>{let[s,a]=i.split("+");s=parseInt(s,36),a=a?parseInt(a,36):0,r.set(n+=s,e[t]);for(let i=a;i--;)r.set(++n,e[t])}))}}return r.get(e)||32}const a=[null,"isol","init","fina","medi"];function o(e){const t=new Uint8Array(e.length);let n=32,i=1,r=-1;for(let a=0;a<e.length;a++){const o=e.codePointAt(a);let l=0|s(o),c=1;8&l||(21&n?22&l?(c=3,1!==i&&3!==i||t[r]++):33&l&&(2!==i&&4!==i||t[r]--):34&n&&(2!==i&&4!==i||t[r]--),i=t[a]=c,n=l,r=a,o>65535&&a++)}return t}function l(t,n){const i=t.GDEF&&t.GDEF.glyphClassDef;return i?e.U._getGlyphClass(n,i):0}function c(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}function h(t){const i=Object.create(null),r=t["OS/2"],s=t.hhea,h=t.head.unitsPerEm,u=c(r&&r.sTypoAscender,s&&s.ascender,h),d={unitsPerEm:h,ascender:u,descender:c(r&&r.sTypoDescender,s&&s.descender,0),capHeight:c(r&&r.sCapHeight,u),xHeight:c(r&&r.sxHeight,u),lineGap:c(r&&r.sTypoLineGap,s&&s.lineGap),supportsCodePoint:n=>e.U.codeToGlyph(t,n)>0,forEachGlyph(r,s,c,h){let u=0;const p=1/d.unitsPerEm*s,f=function(t,n){const i=[];for(let r=0;r<n.length;r++){const s=n.codePointAt(r);s>65535&&r++,i.push(e.U.codeToGlyph(t,s))}const r=t.GSUB;if(r){const{lookupList:t,featureList:s}=r;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,h=[];s.forEach((r=>{if(c.test(r.tag))for(let s=0;s<r.tab.length;s++){if(h[r.tab[s]])continue;h[r.tab[s]]=!0;const c=t[r.tab[s]],u=/^(isol|init|fina|medi)$/.test(r.tag);u&&!l&&(l=o(n));for(let n=0;n<i.length;n++)l&&u&&a[l[n]]!==r.tag||e.U._applySubs(i,n,c,t)}}))}return i}(t,r);let m=0;const A=function(t,n){const i=new Int16Array(3*n.length);let r=0;for(;r<n.length;r++){const c=n[r];if(-1===c)continue;i[3*r+2]=t.hmtx.aWidth[c];const h=t.GPOS;if(h){const u=h.lookupList;for(let h=0;h<u.length;h++){const d=u[h];for(let h=0;h<d.tabs.length;h++){const u=d.tabs[h];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(u.coverage,c)&&u.pos){o(u.pos,r);break}}else if(2===d.ltype){let t=null,i=s();if(-1!==i){const s=e._lctf.coverageIndex(u.coverage,n[i]);if(-1!==s){if(1===u.fmt){const e=u.pairsets[s];for(let n=0;n<e.length;n++)e[n].gid2===c&&(t=e[n])}else if(2===u.fmt){const r=e.U._getGlyphClass(n[i],u.classDef1),s=e.U._getGlyphClass(c,u.classDef2);t=u.matrix[r][s]}if(t){t.val1&&o(t.val1,i),t.val2&&o(t.val2,r);break}}}}else if(4===d.ltype){const t=e._lctf.coverageIndex(u.markCoverage,c);if(-1!==t){const o=s(a),l=-1===o?-1:e._lctf.coverageIndex(u.baseCoverage,n[o]);if(-1!==l){const e=u.markArray[t],n=u.baseArray[l][e.markClass];i[3*r]=n.x-e.x+i[3*o]-i[3*o+2],i[3*r+1]=n.y-e.y+i[3*o+1];break}}}else if(6===d.ltype){const a=e._lctf.coverageIndex(u.mark1Coverage,c);if(-1!==a){const o=s();if(-1!==o){const s=n[o];if(3===l(t,s)){const t=e._lctf.coverageIndex(u.mark2Coverage,s);if(-1!==t){const e=u.mark1Array[a],n=u.mark2Array[t][e.markClass];i[3*r]=n.x-e.x+i[3*o]-i[3*o+2],i[3*r+1]=n.y-e.y+i[3*o+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=s();if(-1!==e){const r=t.kern.glyph1.indexOf(n[e]);if(-1!==r){const n=t.kern.rval[r].glyph2.indexOf(c);-1!==n&&(i[3*e+2]+=t.kern.rval[r].vals[n])}}}}return i;function s(e){for(let t=r-1;t>=0;t--)if(-1!==n[t]&&(!e||e(n[t])))return t;return-1}function a(e){return 1===l(t,e)}function o(e,t){for(let n=0;n<3;n++)i[3*t+n]+=e[n]||0}}(t,f);return f.forEach(((a,o)=>{if(-1!==a){let r=i[a];if(!r){const{cmds:s,crds:o}=e.U.glyphToPath(t,a);let l,c,h,u,d="",p=0;for(let e=0,t=s.length;e<t;e++){const t=n[s[e]];d+=s[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+o[p++]}if(o.length){l=c=1/0,h=u=-1/0;for(let e=0,t=o.length;e<t;e+=2){let t=o[e],n=o[e+1];t<l&&(l=t),n<c&&(c=n),t>h&&(h=t),n>u&&(u=n)}}else l=h=c=u=0;r=i[a]={index:a,advanceWidth:t.hmtx.aWidth[a],xMin:l,yMin:c,xMax:h,yMax:u,path:d}}h.call(null,r,u+A[3*o]*p,A[3*o+1]*p,m),u+=A[3*o+2]*p,c&&(u+=c*s)}m+=r.codePointAt(m)>65535?2:1})),u}};return d}return function(n){const i=new Uint8Array(n,0,4),r=e._bin.readASCII(i,0,4);if("wOFF"===r)n=t(n);else if("wOF2"===r)throw new Error("woff2 fonts not supported");return h(e.parse(n)[0])}}],init:(e,t,n)=>n(e(),t())});
/*!
	Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
	for use in Troika text rendering. 
	Original MIT license applies
	*/const QR=wR({name:"FontResolver",dependencies:[function(e,t){const n=Object.create(null),i=Object.create(null);function r(t,r){let s=n[t];s?r(s):i[t]?i[t].push(r):(i[t]=[r],function(t,n){const i=e=>{console.error(`Failure loading font ${t}`,e)};try{const r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status>=400)i(new Error(r.statusText));else if(r.status>0)try{const i=e(r.response);i.src=t,n(i)}catch(e){i(e)}},r.onerror=i,r.send()}catch(e){i(e)}}(t,(e=>{e.src=t,n[t]=e,i[t].forEach((t=>t(e))),delete i[t]})))}return function(e,i,{lang:s,fonts:a=[],style:o="normal",weight:l="normal",unicodeFontsURL:c}={}){const h=new Uint8Array(e.length),u=[];e.length||m();const d=new Map,p=[];if("italic"!==o&&(o="normal"),"number"!=typeof l&&(l="bold"===l?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter((e=>!e.lang||e.lang.test(s))).reverse()).length){const t=1,i=2;let s=0;!function o(l=0){for(let c=l,f=e.length;c<f;c++){const l=e.codePointAt(c);if(s===t&&u[h[c-1]].supportsCodePoint(l)||/\s/.test(e[c]))h[c]=h[c-1],s===i&&(p[p.length-1][1]=c);else for(let e=h[c],f=a.length;e<=f;e++)if(e===f){(s===i?p[p.length-1]:p[p.length]=[c,c])[1]=c,s=i}else{h[c]=e;const{src:i,unicodeRange:p}=a[e];if(!p||A(l,p)){const e=n[i];if(!e)return void r(i,(()=>{o(c)}));if(e.supportsCodePoint(l)){let n=d.get(e);"number"!=typeof n&&(n=u.length,u.push(e),d.set(e,n)),h[c]=n,s=t;break}}}l>65535&&c+1<f&&(h[c+1]=h[c],c++,s===i&&(p[p.length-1][1]=c))}f()}()}else p.push([0,e.length-1]),f();function f(){if(p.length){const n=p.map((t=>e.substring(t[0],t[1]+1))).join("\n");t.getFontsForString(n,{lang:s||void 0,style:o,weight:l,dataUrl:c}).then((({fontUrls:e,chars:t})=>{const n=u.length;let i=0;p.forEach((e=>{for(let r=0,s=e[1]-e[0];r<=s;r++)h[e[0]+r]=t[i++]+n;i++}));let s=0;e.forEach(((t,i)=>{r(t,(t=>{u[i+n]=t,++s===e.length&&m()}))}))}))}else m()}function m(){i({chars:h,fonts:u})}function A(e,t){for(let n=0;n<t.length;n++){const[i,r=i]=t[n];if(i<=e&&e<=r)return!0}return!1}}},GR,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&0!=(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach((function(t,n){e.push((+n).toString(36)+":"+t.toString(36))})),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach((function(e){var n=e.split(":");t.buckets.set(parseInt(n[0],36),parseInt(n[1],36))}))};var n=Math.pow(2,8),i=n-1,r=~i;function s(e){var t=function(e){return e&r}(e).toString(16),i=function(e){return(e&r)+n-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+i+".json"}function a(e,t){var n=e&i,r=t.codePointAt(n/6|0);return 0!=((r=(r||48)-48)&1<<n%6)}function o(e,t){!function(e,t){var n;(n=e,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(e){return e.split("-").map((function(e){return parseInt(e.trim(),16)}))}))).forEach((function(e){var n=e[0],i=e[1];void 0===i&&(i=n),t(n,i)}))}(e,(function(e,n){for(var i=e;i<=n;i++)t(i)}))}var l={},c={},h=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(e){var n=h.get(e);return n||(n=new t,o(e.ranges,(function(e){return n.add(e)})),h.set(e,n)),n}var p,f=new Map;function m(e,t,n){return e[t]?t:e[n]?n:function(e){for(var t in e)return t}(e)}function A(e,t){var n=t;if(!e.includes(n)){n=1/0;for(var i=0;i<e.length;i++)Math.abs(e[i]-t)<Math.abs(n-t)&&(n=e[i])}return n}function g(e){return p||(p=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(e){p.add(e)}))),p.has(e)}return e.CodePointSet=t,e.clearCache=function(){l={},c={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var n,i=t.lang;void 0===i&&(i=/\p{Script=Hangul}/u.test(n=e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var r=t.category;void 0===r&&(r="sans-serif");var o=t.style;void 0===o&&(o="normal");var h=t.weight;void 0===h&&(h=400);var p=(t.dataUrl||u).replace(/\/$/g,""),v=new Map,y=new Uint8Array(e.length),x={},_={},E=new Array(e.length),w=new Map,C=!1;function b(e){var t=f.get(e);return t||(t=fetch(p+"/"+e).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then((function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]}))})).catch((function(t){if(p!==u)return C||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+t.message),C=!0),p=u,f.delete(e),b(e);throw t})),f.set(e,t)),t}for(var M=function(t){var n=e.codePointAt(t),i=s(n);E[t]=i,l[i]||w.has(i)||w.set(i,b(i).then((function(e){l[i]=e}))),n>65535&&(t++,S=t)},S=0;S<e.length;S++)M(S);return Promise.all(w.values()).then((function(){w.clear();for(var t=function(t){var r=e.codePointAt(t),s=null,o=l[E[t]],h=void 0;for(var u in o){var d=_[u];if(void 0===d&&(d=_[u]=new RegExp(u).test(i||"en")),d){for(var p in h=u,o[u])if(a(r,o[u][p])){s=p;break}break}}if(!s)e:for(var f in o)if(f!==h)for(var m in o[f])if(a(r,o[f][m])){s=m;break e}s||(console.debug("No font coverage for U+"+r.toString(16)),s="latin"),E[t]=s,c[s]||w.has(s)||w.set(s,b("font-meta/"+s+".json").then((function(e){c[s]=e}))),r>65535&&(t++,n=t)},n=0;n<e.length;n++)t(n);return Promise.all(w.values())})).then((function(){for(var t,n=null,i=0;i<e.length;i++){var s=e.codePointAt(i);if(n&&(g(s)||d(n).has(s)))y[i]=y[i-1];else{n=c[E[i]];var a=x[n.id];if(!a){var l=n.typeforms,u=m(l,r,"sans-serif"),f=m(l[u],o,"normal"),_=A(null===(t=l[u])||void 0===t?void 0:t[f],h);a=x[n.id]=p+"/font-files/"+n.id+"/"+u+"."+f+"."+_+".woff"}var w=v.get(a);null==w&&(w=v.size,v.set(a,w)),y[i]=w}s>65535&&(i++,y[i]=y[i-1])}return{fontUrls:Array.from(v.keys()),chars:y}}))},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,n)=>e(t,n())});const zR=()=>(self.performance||Date).now(),HR=MR();let VR;const WR=[];let jR=0;function XR(){const e=zR();for(;WR.length&&zR()-e<5;)WR.shift()();jR=WR.length?setTimeout(XR,0):0}const JR=(...e)=>new Promise(((t,n)=>{WR.push((()=>{const i=zR();try{HR.webgl.generateIntoCanvas(...e),t({timing:zR()-i})}catch(e){n(e)}})),jR||(jR=setTimeout(XR,0))})),qR={};let YR=0;function KR(e,t,n,i,r,s,a,o,l,c){const h="TroikaTextSDFGenerator_JS_"+YR++%4;let u=qR[h];return u||(u=qR[h]={workerModule:wR({name:h,workerId:h,dependencies:[MR,zR],init(e,t){const n=e().javascript.generate;return function(...e){const i=t();return{textureData:n(...e),timing:t()-i}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(e,t,n,i,r,s).then((({textureData:n,timing:i})=>{const r=zR(),s=new Uint8Array(4*n.length);for(let e=0;e<n.length;e++)s[4*e+c]=n[e];return HR.webglUtils.renderImageData(a,s,o,l,e,t,1<<3-c),i+=zR()-r,0==--u.requests&&(u.idleTimer=setTimeout((()=>{!function(e){_R[e]&&_R[e].forEach((function(e){e()})),xR[e]&&(xR[e].terminate(),delete xR[e])}(h)}),2e3)),{timing:i}}))}const ZR=HR.webglUtils.resizeWebGLCanvasWithoutClearing,$R={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},eD=new ni;function tD(){return(self.performance||Date).now()}const nD=Object.create(null);function iD(e,t){e=function(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e);const n=tD(),{defaultFontURL:i}=$R,r=[];if(i&&r.push({label:"default",src:aD(i)}),e.font&&r.push({label:"user",src:aD(e.font)}),e.font=r,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||$R.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||$R.unicodeFontsURL,null!=e.colorRanges){let t={};for(let n in e.colorRanges)if(e.colorRanges.hasOwnProperty(n)){let i=e.colorRanges[n];"number"!=typeof i&&(i=eD.set(i).getHex()),t[n]=i}e.colorRanges=t}Object.freeze(e);const{textureWidth:s,sdfExponent:a}=$R,{sdfGlyphSize:o}=e,l=s/o*4;let c=nD[o];if(!c){const e=document.createElement("canvas");e.width=s,e.height=256*o/l,c=nD[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:e,sdfTexture:new Tt(e,void 0,void 0,void 0,E,E),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",(t=>{console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0})),t.addEventListener("webglcontextrestored",(t=>{console.log("Context Restored",t),e.contextLost=!1;const n=[];e.glyphsByFont.forEach((t=>{t.forEach((t=>{n.push(rD(t,e,!0))}))})),Promise.all(n).then((()=>{oD(e),e.sdfTexture.needsUpdate=!0}))}))}(c)}const{sdfTexture:h,sdfCanvas:u}=c;cD(e).then((i=>{const{glyphIds:r,glyphFontIndices:d,fontData:p,glyphPositions:f,fontSize:m,timings:A}=i,g=[],v=new Float32Array(4*r.length);let y=0,x=0;const _=tD(),E=p.map((e=>{let t=c.glyphsByFont.get(e.src);return t||c.glyphsByFont.set(e.src,t=new Map),t}));r.forEach(((e,t)=>{const n=d[t],{src:s,unitsPerEm:a}=p[n];let l=E[n].get(e);if(!l){const{path:t,pathBounds:r}=i.glyphData[s][e],a=Math.max(r[2]-r[0],r[3]-r[1])/o*($R.sdfMargin*o+.5),h=c.glyphCount++,u=[r[0]-a,r[1]-a,r[2]+a,r[3]+a];E[n].set(e,l={path:t,atlasIndex:h,sdfViewBox:u}),g.push(l)}const{sdfViewBox:h}=l,u=f[x++],A=f[x++],_=m/a;v[y++]=u+h[0]*_,v[y++]=A+h[1]*_,v[y++]=u+h[2]*_,v[y++]=A+h[3]*_,r[t]=l.atlasIndex})),A.quads=(A.quads||0)+(tD()-_);const w=tD();A.sdf={};const C=u.height,b=Math.ceil(c.glyphCount/l),M=Math.pow(2,Math.ceil(Math.log2(b*o)));M>C&&(console.info(`Increasing SDF texture size ${C}->${M}`),ZR(u,s,M),h.dispose()),Promise.all(g.map((t=>rD(t,c,e.gpuAccelerateSDF).then((({timing:e})=>{A.sdf[t.atlasIndex]=e}))))).then((()=>{g.length&&!c.contextLost&&(oD(c),h.needsUpdate=!0),A.sdfTotal=tD()-w,A.total=tD()-n,t(Object.freeze({parameters:e,sdfTexture:h,sdfGlyphSize:o,sdfExponent:a,glyphBounds:v,glyphAtlasIndices:r,glyphColors:i.glyphColors,caretPositions:i.caretPositions,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))}))})),Promise.resolve().then((()=>{var e;c.contextLost||(e=u)._warm||(HR.webgl.isSupported(e),e._warm=!0)}))}function rD({path:e,atlasIndex:t,sdfViewBox:n},{sdfGlyphSize:i,sdfCanvas:r,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:l}=$R,c=Math.max(n[2]-n[0],n[3]-n[1]),h=Math.floor(t/4);return function(e,t,n,i,r,s,a,o,l,c,h=!0){return h?JR(e,t,n,i,r,s,a,o,l,c).then(null,(h=>(VR||(console.warn("WebGL SDF generation failed, falling back to JS",h),VR=!0),KR(e,t,n,i,r,s,a,o,l,c)))):KR(e,t,n,i,r,s,a,o,l,c)}(i,i,e,n,c,l,r,h%(o/i)*i,Math.floor(h/(o/i))*i,t%4,a)}let sD;function aD(e){return sD||(sD="undefined"==typeof document?{}:document.createElement("a")),sD.href=e,sD.href}function oD(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:n}=e,{width:i,height:r}=t,s=e.sdfCanvas.getContext("webgl");let a=n.image.data;a&&a.length===i*r*4||(a=new Uint8Array(i*r*4),n.image={width:i,height:r,data:a},n.flipY=!1,n.isDataTexture=!0),s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,a)}}const lD=wR({name:"Typesetter",dependencies:[function(e,t){const n=1/0,i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:u,lang:d,sdfGlyphSize:p=64,fontSize:f=400,fontWeight:m=1,fontStyle:A="normal",letterSpacing:g=0,lineHeight:v="normal",maxWidth:y=n,direction:x,textAlign:_="left",textIndent:E=0,whiteSpace:w="normal",overflowWrap:C="normal",anchorX:b=0,anchorY:M=0,metricsOnly:S=!1,unicodeFontsURL:I,preResolvedFonts:B=null,includeCaretPositions:T=!1,chunkedBoundsSize:R=8192,colorRanges:D=null},L){const P=c(),F={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),f=+f,g=+g,y=+y,v=v||"normal",E=+E,function({text:t,lang:n,fonts:i,style:r,weight:s,preResolvedFonts:a,unicodeFontsURL:o},l){const c=({chars:e,fonts:t})=>{let n,i;const r=[];for(let s=0;s<e.length;s++)e[s]!==i?(i=e[s],r.push(n={start:s,end:s,fontObj:t[e[s]]})):n.end=s;l(r)};a?c(a):e(t,c,{lang:n,fonts:i,style:r,weight:s,unicodeFontsURL:o})}({text:a,lang:d,style:A,weight:m,fonts:"string"==typeof u?[{src:u}]:u,unicodeFontsURL:I,preResolvedFonts:B},(e=>{F.fontLoad=c()-P;const u=isFinite(y);let d=null,p=null,m=null,A=null,I=null,B=null,U=null,O=null,N=0,k=0,G="nowrap"!==w;const Q=new Map,z=c();let H=E,V=0,W=new h;const j=[W];e.forEach((e=>{const{fontObj:t}=e,{ascender:n,descender:o,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:p}=t;let m=Q.get(t);if(!m){const e=f/l,i="normal"===v?(n-o+c)*e:v*f,r=(i-(n-o)*e)/2,s=Math.min(i,(n-o)*e),a=(n+o)/2*e+s/2;m={index:Q.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:n*e,descender:o*e,capHeight:d*e,xHeight:p*e,lineHeight:i,baseline:-r-n*e,caretTop:a,caretBottom:a-s},Q.set(t,m)}const{fontSizeMult:A}=m,x=a.slice(e.start,e.end+1);let _,w;t.forEachGlyph(x,f,g,((t,n,o,l)=>{n+=V,l+=e.start,_=n,w=t;const c=a.charAt(l),d=t.advanceWidth*A,p=W.count;let v;if("isEmpty"in t||(t.isWhitespace=!!c&&new RegExp(r).test(c),t.canBreakAfter=!!c&&s.test(c),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||i.test(c)),t.isWhitespace||t.isEmpty||k++,G&&u&&!t.isWhitespace&&n+d+H>y&&p){if(W.glyphAt(p-1).glyphObj.canBreakAfter)v=new h,H=-n;else for(let e=p;e--;){if(0===e&&"break-word"===C){v=new h,H=-n;break}if(W.glyphAt(e).glyphObj.canBreakAfter){v=W.splitAt(e+1);const t=v.glyphAt(0).x;H-=t;for(let e=v.count;e--;)v.glyphAt(e).x-=t;break}}v&&(W.isSoftWrapped=!0,W=v,j.push(W),N=y)}let x=W.glyphAt(W.count);x.glyphObj=t,x.x=n+H,x.y=o,x.width=d,x.charIndex=l,x.fontData=m,"\n"===c&&(W=new h,j.push(W),H=-(n+d+g*f)+E)})),V=_+w.advanceWidth*A+g*f}));let X=0;j.forEach((e=>{let t=!0;for(let n=e.count;n--;){const i=e.glyphAt(n);t&&!i.glyphObj.isWhitespace&&(e.width=i.x+i.width,e.width>N&&(N=e.width),t=!1);let{lineHeight:r,capHeight:s,xHeight:a,baseline:o}=i.fontData;r>e.lineHeight&&(e.lineHeight=r);const l=o-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+s),e.ex=Math.max(e.ex,e.baseline+a)}e.baseline-=X,e.cap-=X,e.ex-=X,X+=e.lineHeight}));let J=0,q=0;if(b&&("number"==typeof b?J=-b:"string"==typeof b&&(J=-N*("left"===b?0:"center"===b?.5:"right"===b?1:o(b)))),M&&("number"==typeof M?q=-M:"string"==typeof M&&(q="top"===M?0:"top-baseline"===M?-j[0].baseline:"top-cap"===M?-j[0].cap:"top-ex"===M?-j[0].ex:"middle"===M?X/2:"bottom"===M?X:"bottom-baseline"===M?-j[j.length-1].baseline:o(M)*X)),!S){const e=t.getEmbeddingLevels(a,x);d=new Uint16Array(k),p=new Uint8Array(k),m=new Float32Array(2*k),A={},U=[n,n,-1/0,-1/0],O=[],T&&(B=new Float32Array(4*a.length)),D&&(I=new Uint8Array(3*k));let i,r,s=0,o=-1,c=-1;if(j.forEach(((h,u)=>{let{count:f,width:g}=h;if(f>0){let u=0;for(let e=f;e--&&h.glyphAt(e).glyphObj.isWhitespace;)u++;let v=0,y=0;if("center"===_)v=(N-g)/2;else if("right"===_)v=N-g;else if("justify"===_&&h.isSoftWrapped){let e=0;for(let t=f-u;t--;)h.glyphAt(t).glyphObj.isWhitespace&&e++;y=(N-g)/e}if(y||v){let e=0;for(let t=0;t<f;t++){let n=h.glyphAt(t);const i=n.glyphObj;n.x+=v+e,0!==y&&i.isWhitespace&&t<f-u&&(e+=y,n.width+=y)}}const x=t.getReorderSegments(a,e,h.glyphAt(0).charIndex,h.glyphAt(h.count-1).charIndex);for(let e=0;e<x.length;e++){const[t,n]=x[e];let i=1/0,r=-1/0;for(let e=0;e<f;e++)if(h.glyphAt(e).charIndex>=t){let t=e,s=e;for(;s<f;s++){let e=h.glyphAt(s);if(e.charIndex>n)break;s<f-u&&(i=Math.min(i,e.x),r=Math.max(r,e.x+e.width))}for(let e=t;e<s;e++){const t=h.glyphAt(e);t.x=r-(t.x+t.width-i)}break}}let E;const w=e=>E=e;for(let u=0;u<f;u++){const f=h.glyphAt(u);E=f.glyphObj;const g=E.index,v=1&e.levels[f.charIndex];if(v){const e=t.getMirroredCharacter(a[f.charIndex]);e&&f.fontData.fontObj.forEachGlyph(e,0,0,w)}if(T){const{charIndex:e,fontData:t}=f,n=f.x+J,i=f.x+f.width+J;B[4*e]=v?i:n,B[4*e+1]=v?n:i,B[4*e+2]=h.baseline+t.caretBottom+q,B[4*e+3]=h.baseline+t.caretTop+q;const r=e-o;r>1&&l(B,o,r),o=e}if(D){const{charIndex:e}=f;for(;e>c;)c++,D.hasOwnProperty(c)&&(r=D[c])}if(!E.isWhitespace&&!E.isEmpty){const e=s++,{fontSizeMult:t,src:a,index:o}=f.fontData,l=A[a]||(A[a]={});l[g]||(l[g]={path:E.path,pathBounds:[E.xMin,E.yMin,E.xMax,E.yMax]});const c=f.x+J,u=f.y+h.baseline+q;m[2*e]=c,m[2*e+1]=u;const v=c+E.xMin*t,y=u+E.yMin*t,x=c+E.xMax*t,_=u+E.yMax*t;v<U[0]&&(U[0]=v),y<U[1]&&(U[1]=y),x>U[2]&&(U[2]=x),_>U[3]&&(U[3]=_),e%R==0&&(i={start:e,end:e,rect:[n,n,-1/0,-1/0]},O.push(i)),i.end++;const w=i.rect;if(v<w[0]&&(w[0]=v),y<w[1]&&(w[1]=y),x>w[2]&&(w[2]=x),_>w[3]&&(w[3]=_),d[e]=g,p[e]=o,D){const t=3*e;I[t]=r>>16&255,I[t+1]=r>>8&255,I[t+2]=255&r}}}}})),B){const e=a.length-o;e>1&&l(B,o,e)}}const Y=[];Q.forEach((({index:e,src:t,unitsPerEm:n,ascender:i,descender:r,lineHeight:s,capHeight:a,xHeight:o})=>{Y[e]={src:t,unitsPerEm:n,ascender:i,descender:r,lineHeight:s,capHeight:a,xHeight:o}})),F.typesetting=c()-z,L({glyphIds:d,glyphFontIndices:p,glyphPositions:m,glyphData:A,fontData:Y,caretPositions:B,glyphColors:I,chunkedBounds:O,fontSize:f,topBaseline:q+j[0].baseline,blockBounds:[J,q-X,J+N,q],visibleBounds:U,timings:F})}))}function o(e){let t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function l(e,t,n){const i=e[4*t],r=e[4*t+1],s=e[4*t+2],a=e[4*t+3],o=(r-i)/n;for(let r=0;r<n;r++){const n=4*(t+r);e[n]=i+o*r,e[n+1]=i+o*(r+1),e[n+2]=s,e[n+3]=a}}function c(){return(self.performance||Date).now()}function h(){this.data=[]}const u=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/u.length)},glyphAt(e){let t=h.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new h;return t.data=this.data.splice(e*u.length),t}},h.flyweight=u.reduce(((e,t,n,i)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*u.length+n]},set(e){this.data[this.index*u.length+n]=e}}),e)),{data:null,index:0}),{typeset:a,measure:function(e,t){a({...e,metricsOnly:!0},(e=>{const[n,i,r,s]=e.blockBounds;t({width:r-n,height:s-i})}))}}},QR,function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},i={};n.L=1,i[1]="L",Object.keys(t).forEach((function(e,t){n[e]=1<<t+1,i[n[e]]=e})),Object.freeze(n);var r=n.LRI|n.RLI|n.FSI,s=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,o=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|r|n.PDI|o,c=null;function h(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var i=0;t[e].split(",").forEach((function(t){var r=t.split("+"),s=r[0],a=r[1];s=parseInt(s,36),a=a?parseInt(a,36):0,c.set(i+=s,n[e]);for(var o=0;o<a;o++)c.set(++i,n[e])}))}};for(var i in t)e(i)}}(),c.get(e.codePointAt(0))||n.L}var u,d,p,f="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",m="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function A(e,t){var n,i=0,r=new Map,s=t&&new Map;return e.split(",").forEach((function e(a){if(-1!==a.indexOf("+"))for(var o=+a;o--;)e(n);else{n=a;var l=a.split(">"),c=l[0],h=l[1];c=String.fromCodePoint(i+=parseInt(c,36)),h=String.fromCodePoint(i+=parseInt(h,36)),r.set(c,h),t&&s.set(h,c)}})),{map:r,reverseMap:s}}function g(){if(!u){var e=A(f,!0),t=e.map,n=e.reverseMap;u=t,d=n,p=A(m,!1).map}}function v(e){return g(),u.get(e)||null}function y(e){return g(),d.get(e)||null}function x(e){return g(),p.get(e)||null}var _=n.L,E=n.R,w=n.EN,C=n.ES,b=n.ET,M=n.AN,S=n.CS,I=n.B,B=n.S,T=n.ON,R=n.BN,D=n.NSM,L=n.AL,P=n.LRO,F=n.RLO,U=n.LRE,O=n.RLE,N=n.PDF,k=n.LRI,G=n.RLI,Q=n.FSI,z=n.PDI;var H;function V(e){return function(){if(!H){var e=A("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach((function(e,n){t.set(n,e)})),H=t}}(),H.get(e)||null}function W(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);var s=[];return t.paragraphs.forEach((function(r){var a=Math.max(n,r.start),o=Math.min(i,r.end);if(a<o){for(var c=t.levels.slice(a,o+1),u=o;u>=a&&h(e[u])&l;u--)c[u]=r.level;for(var d=r.level,p=1/0,f=0;f<c.length;f++){var m=c[f];m>d&&(d=m),m<p&&(p=1|m)}for(var A=d;A>=p;A--)for(var g=0;g<c.length;g++)if(c[g]>=A){for(var v=g;g+1<c.length&&c[g+1]>=A;)g++;g>v&&s.push([v+n,g+n])}}})),s}function j(e,t,n,i){for(var r=W(e,t,n,i),s=[],a=0;a<e.length;a++)s[a]=a;return r.forEach((function(e){for(var t=e[0],n=e[1],i=s.slice(t,n+1),r=i.length;r--;)s[n-r]=i[r]})),s}return e.closingToOpeningBracket=y,e.getBidiCharType=h,e.getBidiCharTypeName=function(e){return i[h(e)]},e.getCanonicalBracket=x,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),i=0;i<e.length;i++)n[i]=h(e[i]);var c=new Map;function u(e,t){var i=n[e];n[e]=t,c.set(i,c.get(i)-1),i&a&&c.set(a,c.get(a)-1),c.set(t,(c.get(t)||0)+1),t&a&&c.set(a,(c.get(a)||0)+1)}for(var d=new Uint8Array(e.length),p=new Map,f=[],m=null,A=0;A<e.length;A++)m||f.push(m={start:A,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Qt(A,!1)}),n[A]&I&&(m.end=A,m=null);for(var g=O|U|F|P|r|z|N|I,H=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},W=0;W<f.length;W++){var j=[{_level:(m=f[W]).level,_override:0,_isolate:0}],X=void 0,J=0,q=0,Y=0;c.clear();for(var K=m.start;K<=m.end;K++){var Z=n[K];if(X=j[j.length-1],c.set(Z,(c.get(Z)||0)+1),Z&a&&c.set(a,(c.get(a)||0)+1),Z&g)if(Z&(O|U)){d[K]=X._level;var $=(Z===O?V:H)(X._level);$<=125&&!J&&!q?j.push({_level:$,_override:0,_isolate:0}):J||q++}else if(Z&(F|P)){d[K]=X._level;var ee=(Z===F?V:H)(X._level);ee<=125&&!J&&!q?j.push({_level:ee,_override:Z&F?E:_,_isolate:0}):J||q++}else if(Z&r){Z&Q&&(Z=1===Qt(K+1,!0)?G:k),d[K]=X._level,X._override&&u(K,X._override);var te=(Z===G?V:H)(X._level);te<=125&&0===J&&0===q?(Y++,j.push({_level:te,_override:0,_isolate:1,_isolInitIndex:K})):J++}else if(Z&z){if(J>0)J--;else if(Y>0){for(q=0;!j[j.length-1]._isolate;)j.pop();var ne=j[j.length-1]._isolInitIndex;null!=ne&&(p.set(ne,K),p.set(K,ne)),j.pop(),Y--}X=j[j.length-1],d[K]=X._level,X._override&&u(K,X._override)}else Z&N?(0===J&&(q>0?q--:!X._isolate&&j.length>1&&(j.pop(),X=j[j.length-1])),d[K]=X._level):Z&I&&(d[K]=m.level);else d[K]=X._level,X._override&&Z!==R&&u(K,X._override)}for(var ie=[],re=null,se=m.start;se<=m.end;se++){var ae=n[se];if(!(ae&o)){var oe=d[se],le=ae&r,ce=ae===z;re&&oe===re._level?(re._end=se,re._endsWithIsolInit=le):ie.push(re={_start:se,_end:se,_level:oe,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var he=[],ue=0;ue<ie.length;ue++){var de=ie[ue];if(!de._startsWithPDI||de._startsWithPDI&&!p.has(de._start)){for(var pe=[re=de],fe=void 0;re&&re._endsWithIsolInit&&null!=(fe=p.get(re._end));)for(var me=ue+1;me<ie.length;me++)if(ie[me]._start===fe){pe.push(re=ie[me]);break}for(var Ae=[],ge=0;ge<pe.length;ge++)for(var ve=pe[ge],ye=ve._start;ye<=ve._end;ye++)Ae.push(ye);for(var xe=d[Ae[0]],_e=m.level,Ee=Ae[0]-1;Ee>=0;Ee--)if(!(n[Ee]&o)){_e=d[Ee];break}var we=Ae[Ae.length-1],Ce=d[we],be=m.level;if(!(n[we]&r))for(var Me=we+1;Me<=m.end;Me++)if(!(n[Me]&o)){be=d[Me];break}he.push({_seqIndices:Ae,_sosType:Math.max(_e,xe)%2?E:_,_eosType:Math.max(be,Ce)%2?E:_})}}for(var Se=0;Se<he.length;Se++){var Ie=he[Se],Be=Ie._seqIndices,Te=Ie._sosType,Re=Ie._eosType;if(c.get(D))for(var De=0;De<Be.length;De++){var Le=Be[De];if(n[Le]&D){for(var Pe=Te,Fe=De-1;Fe>=0;Fe--)if(!(n[Be[Fe]]&o)){Pe=n[Be[Fe]];break}u(Le,Pe&(r|z)?T:Pe)}}if(c.get(w))for(var Ue=0;Ue<Be.length;Ue++){var Oe=Be[Ue];if(n[Oe]&w)for(var Ne=Ue-1;Ne>=-1;Ne--){var ke=-1===Ne?Te:n[Be[Ne]];if(ke&s){ke===L&&u(Oe,M);break}}}if(c.get(L))for(var Ge=0;Ge<Be.length;Ge++){var Qe=Be[Ge];n[Qe]&L&&u(Qe,E)}if(c.get(C)||c.get(S))for(var ze=1;ze<Be.length-1;ze++){var He=Be[ze];if(n[He]&(C|S)){for(var Ve=0,We=0,je=ze-1;je>=0&&(Ve=n[Be[je]])&o;je--);for(var Xe=ze+1;Xe<Be.length&&(We=n[Be[Xe]])&o;Xe++);Ve===We&&(n[He]===C?Ve===w:Ve&(w|M))&&u(He,Ve)}}if(c.get(w))for(var Je=0;Je<Be.length;Je++){var qe=Be[Je];if(n[qe]&w){for(var Ye=Je-1;Ye>=0&&n[Be[Ye]]&(b|o);Ye--)u(Be[Ye],w);for(var Ke=Je+1;Ke<Be.length&&n[Be[Ke]]&(b|o);Ke++)u(Be[Ke],w)}}if(c.get(b)||c.get(C)||c.get(S))for(var Ze=0;Ze<Be.length;Ze++){var $e=Be[Ze];if(n[$e]&(b|C|S)){u($e,T);for(var et=Ze-1;et>=0&&n[Be[et]]&o;et--)u(Be[et],T);for(var tt=Ze+1;tt<Be.length&&n[Be[tt]]&o;tt++)u(Be[tt],T)}}if(c.get(w))for(var nt=0,it=Te;nt<Be.length;nt++){var rt=Be[nt],st=n[rt];st&w?it===_&&u(rt,_):st&s&&(it=st)}if(c.get(a)){for(var at=E|w|M,ot=at|_,lt=[],ct=[],ht=0;ht<Be.length;ht++)if(n[Be[ht]]&a){var ut=e[Be[ht]],dt=void 0;if(null!==v(ut)){if(!(ct.length<63))break;ct.push({char:ut,seqIndex:ht})}else if(null!==(dt=y(ut)))for(var pt=ct.length-1;pt>=0;pt--){var ft=ct[pt].char;if(ft===dt||ft===y(x(ut))||v(x(ft))===ut){lt.push([ct[pt].seqIndex,ht]),ct.length=pt;break}}}lt.sort((function(e,t){return e[0]-t[0]}));for(var mt=0;mt<lt.length;mt++){for(var At=lt[mt],gt=At[0],vt=At[1],yt=!1,xt=0,_t=gt+1;_t<vt;_t++){var Et=Be[_t];if(n[Et]&ot){yt=!0;var wt=n[Et]&at?E:_;if(wt===Ht(Et)){xt=wt;break}}}if(yt&&!xt){xt=Te;for(var Ct=gt-1;Ct>=0;Ct--){var bt=Be[Ct];if(n[bt]&ot){var Mt=n[bt]&at?E:_;xt=Mt!==Ht(bt)?Mt:Ht(bt);break}}}if(xt){if(n[Be[gt]]=n[Be[vt]]=xt,xt!==Ht(Be[gt]))for(var St=gt+1;St<Be.length;St++)if(!(n[Be[St]]&o)){h(e[Be[St]])&D&&(n[Be[St]]=xt);break}if(xt!==Ht(Be[vt]))for(var It=vt+1;It<Be.length;It++)if(!(n[Be[It]]&o)){h(e[Be[It]])&D&&(n[Be[It]]=xt);break}}}for(var Bt=0;Bt<Be.length;Bt++)if(n[Be[Bt]]&a){for(var Tt=Bt,Rt=Bt,Dt=Te,Lt=Bt-1;Lt>=0;Lt--){if(!(n[Be[Lt]]&o)){Dt=n[Be[Lt]]&at?E:_;break}Tt=Lt}for(var Pt=Re,Ft=Bt+1;Ft<Be.length;Ft++){if(!(n[Be[Ft]]&(a|o))){Pt=n[Be[Ft]]&at?E:_;break}Rt=Ft}for(var Ut=Tt;Ut<=Rt;Ut++)n[Be[Ut]]=Dt===Pt?Dt:Ht(Be[Ut]);Bt=Rt}}}for(var Ot=m.start;Ot<=m.end;Ot++){var Nt=d[Ot],kt=n[Ot];if(1&Nt?kt&(_|w|M)&&d[Ot]++:kt&E?d[Ot]++:kt&(M|w)&&(d[Ot]+=2),kt&o&&(d[Ot]=0===Ot?m.level:d[Ot-1]),Ot===m.end||h(e[Ot])&(B|I))for(var Gt=Ot;Gt>=0&&h(e[Gt])&l;Gt--)d[Gt]=m.level}}return{levels:d,paragraphs:f};function Qt(t,i){for(var s=t;s<e.length;s++){var a=n[s];if(a&(E|L))return 1;if(a&(I|_)||i&&a===z)return 0;if(a&r){var o=zt(s);s=-1===o?e.length:o}}return 0}function zt(t){for(var i=1,s=t+1;s<e.length;s++){var a=n[s];if(a&I)break;if(a&z){if(0==--i)return s}else a&r&&i++}return-1}function Ht(e){return 1&d[e]?E:_}},e.getMirroredCharacter=V,e.getMirroredCharactersMap=function(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);for(var s=new Map,a=n;a<=i;a++)if(1&t[a]){var o=V(e[a]);null!==o&&s.set(a,o)}return s},e.getReorderSegments=W,e.getReorderedIndices=j,e.getReorderedString=function(e,t,n,i){var r=j(e,t,n,i),s=[].concat(e);return r.forEach((function(n,i){s[i]=(1&t.levels[n]?V(e[n]):null)||e[n]})),s.join("")},e.openingToClosingBracket=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}],init:(e,t,n)=>e(t,n())}),cD=wR({name:"Typesetter",dependencies:[lD],init:e=>function(t){return new Promise((n=>{e.typeset(t,n)}))},getTransferables(e){const t=[];for(let n in e)e[n]&&e[n].buffer&&t.push(e[n].buffer);return t}}),hD={};const uD="aTroikaGlyphIndex";class dD extends Gh{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new sn,this.boundingBox=new Gt}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const t=this.getIndex().count;this.setDrawRange(1===e?t/2:0,2===e?t:t/2)}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=hD[e];if(!t){const n=new dr(1,1,e,e),i=n.clone(),r=n.attributes,s=i.attributes,a=new bi,o=r.uv.count;for(let e=0;e<o;e++)s.position.array[3*e]*=-1,s.normal.array[3*e+2]*=-1;["position","normal","uv"].forEach((e=>{a.setAttribute(e,new gi([...r[e].array,...s[e].array],r[e].itemSize))})),a.setIndex([...n.index.array,...i.index.array.map((e=>e+o))]),a.translate(.5,.5,0),t=hD[e]=a}return t}(e);["position","normal","uv"].forEach((e=>{this.attributes[e]=t.attributes[e].clone()})),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,i,r){pD(this,"aTroikaGlyphBounds",e,4),pD(this,uD,t,1),pD(this,"aTroikaGlyphColor",r,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:i,floor:r,min:s,max:a,sin:o,cos:l}=Math,c=i/2,h=2*i,u=Math.abs(t),d=e[0]/u,p=e[2]/u,f=r((d+c)/h)!==r((p+c)/h)?-u:s(o(d)*u,o(p)*u),m=r((d-c)/h)!==r((p-c)/h)?u:a(o(d)*u,o(p)*u),A=r((d+i)/h)!==r((p+i)/h)?2*u:a(u-l(d)*u,u-l(p)*u);n.min.set(f,e[1],t<0?-A:0),n.max.set(m,e[3],t<0?0:A)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(uD).count,n=this._chunkedBounds;if(n)for(let i=n.length;i--;){t=n[i].end;let r=n[i].rect;if(r[1]<e.w&&r[3]>e.y&&r[0]<e.z&&r[2]>e.x)break}this.instanceCount=t}}function pD(e,t,n,i){const r=e.getAttribute(t);n?r&&r.array.length===n.length?(r.array.set(n),r.needsUpdate=!0):(e.setAttribute(t,new Po(n,i)),delete e._maxInstanceCount,e.dispose()):r&&e.deleteAttribute(t)}const fD=new ai({color:16777215,side:2,transparent:!0}),mD=8421504,AD=new fn,gD=new Ot,vD=new Ot,yD=[],xD=new Ot,_D="+x+y";function ED(e){return Array.isArray(e)?e[0]:e}let wD=()=>{const e=new Hi(new dr(1,1),fD);return wD=()=>e,e},CD=()=>{const e=new Hi(new dr(1,1,32,1),fD);return CD=()=>e,e};const bD={type:"syncstart"},MD={type:"synccomplete"},SD=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],ID=SD.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class BD extends Hi{constructor(){super(new dD,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=mD,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=_D,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(bD),iD({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},(t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{n.forEach((e=>e&&e()))}))),this.dispatchEvent(MD),e&&e()}))))}onBeforeRender(e,t,n,i,r,s){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r),r._hadOwnSide=r.hasOwnProperty("side"),this.geometry.setSide(r._actualSide=r.side),r.side=0}onAfterRender(e,t,n,i,r,s){r._hadOwnSide?r.side=r._actualSide:delete r.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=fD.clone());if(e&&e.baseMaterial===t||(e=this._derivedMaterial=function(e){const t=FR(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ot},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Rt(0,0,0,0)},uTroikaClipRect:{value:new Rt(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ot},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new ni},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new lt},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(t)&&(t=t.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(e)||(e=e.replace(SR,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(t),t.addEventListener("dispose",(function n(){t.removeEventListener("dispose",n),e.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",(function n(){e.removeEventListener("dispose",n),t.dispose()}))),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return ED(this.material).getDepthMaterial()}get customDistanceMaterial(){return ED(this.material).getDistanceMaterial()}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:e,blockBounds:r}=i;n.uTroikaSDFTexture.value=e,n.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(r),n.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let s,a,o,l=0,c=0,h=0,u=0,d=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:n,outlineBlur:i,outlineOpacity:r}=this;l=this._parsePercent(e)||0,c=Math.max(0,this._parsePercent(i)||0),s=r,u=this._parsePercent(t)||0,d=this._parsePercent(n)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(o=this.strokeColor,n.uTroikaStrokeColor.value.set(null==o?mD:o),a=this.strokeOpacity,null==a&&(a=1)),s=this.fillOpacity;n.uTroikaDistanceOffset.value=l,n.uTroikaPositionOffset.value.set(u,d),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==s?1:s,n.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&4===p.length)n.uTroikaClipRect.value.fromArray(p);else{const e=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(r[0]-e,r[1]-e,r[2]+e,r[3]+e)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const r=t?this.outlineColor||0:this.color;if(null==r)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new ni;r===t._input&&"object"!=typeof r||t.set(t._input=r)}let s=this.orientation||_D;if(s!==e._orientation){let t=n.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let i=s!==_D&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(i){let[,e,n,r,s]=i;gD.set(0,0,0)[n]="-"===e?1:-1,vD.set(0,0,0)[s]="-"===r?-1:1,AD.lookAt(xD,gD.cross(vD),vD),t.setFromMatrix4(AD)}else t.identity();e._orientation=s}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new ot){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new ot){return gD.copy(e),this.localPositionToTextCoords(this.worldToLocal(gD),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:i}=this;if(n){const r=n.blockBounds,s=i?CD():wD(),a=s.geometry,{position:o,uv:l}=a.attributes;for(let e=0;e<l.count;e++){let t=r[0]+l.getX(e)*(r[2]-r[0]);const n=r[1]+l.getY(e)*(r[3]-r[1]);let s=0;i&&(s=i-Math.cos(t/i)*i,t=Math.sin(t/i)*i),o.setXYZ(e,t,n,s)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,yD.length=0,s.raycast(e,yD);for(let e=0;e<yD.length;e++)yD[e].object=this,t.push(yD[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,ID.forEach((t=>{this[t]=e[t]})),this}clone(){return(new this.constructor).copy(this)}}SD.forEach((e=>{const t="_private_"+e;Object.defineProperty(BD.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));class TD extends Zu{mesh;constructor(e,t=""){super(e),this.mesh=new BD,this.mesh.text=t,this.mesh.anchorX="center",this.mesh.anchorY="middle"}addExisting(){this.container.add(this.mesh)}}const RD="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n}\n",DD="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nuniform sampler2D uTexture;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec4 tex=texture(uTexture,vUv);\n    vec3 color=tex.rgb;\n    gl_FragColor=vec4(color,1.);\n}\n";class LD extends Zu{elList;vertexShader;fragmentShader;uniforms;makuConfig;isScrollPositionSync;makuMaterial;makuGroup;scroller;uniformInjector;materialParams;useSelfScroller;isRectAutoRefreshed;constructor(e,t={}){super(e);const{elList:n=[...document.querySelectorAll("img")],vertexShader:i=RD,fragmentShader:r=DD,uniforms:s={},makuConfig:a={},isScrollPositionSync:o=!0,scroller:l=null,materialParams:c={},isRectAutoRefreshed:h=!1}=t;this.elList=n,this.vertexShader=i,this.fragmentShader=r,this.uniforms=s,this.makuConfig=a,this.isScrollPositionSync=o,this.isRectAutoRefreshed=h,this.makuMaterial=null,this.makuGroup=null,this.scroller=l,this.materialParams=c;const u=new wC(e);this.uniformInjector=u,this.useSelfScroller=!1,l||(this.useSelfScroller=!0)}async addExisting(){await Fw();const{uniformInjector:e}=this,t=new Yi({vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,side:2,uniforms:{uTexture:{value:null},uMeshSize:{value:new ot(0,0)},uMeshPosition:{value:new ot(0,0)},uMediaSize:{value:new ot(0,0)},...e.shadertoyUniforms,...this.uniforms},...this.materialParams});this.makuMaterial=t;const n=new ib;this.makuGroup=n;const i=this.elList.map((e=>new nb(e,t,this.container,{...this.makuConfig,isRectAutoRefreshed:this.isRectAutoRefreshed})));if(n.addMultiple(i),n.setPositions(),this.useSelfScroller){const e=new rb;this.scroller=e,this.scroller.listenForScroll()}this.base.resizer.on("resize",(()=>{n.makus.forEach((e=>{e.rect=e.el.getBoundingClientRect()}))}))}update(e){const{scroller:t,makuGroup:n}=this;t?.syncScroll(),n?.makus.forEach((e=>{const n=e.mesh.material.uniforms;this.uniformInjector.injectShadertoyUniforms(n),n.uMeshSize.value=new ot(e.el.clientWidth,e.el.clientHeight),n.uMeshPosition.value=new ot(e.mesh.position.x,e.mesh.position.y);const i=e.el;i instanceof HTMLImageElement?n.uMediaSize.value=new ot(i.naturalWidth,i.naturalHeight):i instanceof HTMLVideoElement?n.uMediaSize.value=new ot(i.videoWidth,i.videoHeight):i instanceof HTMLCanvasElement&&(n.uMediaSize.value=new ot(i.width,i.height)),this.isScrollPositionSync&&(e.el.classList.contains("webgl-fixed")?e.setPosition(0):e.setPosition(t?.scroll.current))}))}checkImagesLoaded(){return new Promise((e=>{this.base.update((()=>{this.makuGroup&&this.makuGroup.makus.map((e=>e.mesh.material.uniforms.uTexture.value.image?.complete)).every((e=>e))&&e(!0)}))}))}iterate(e){this.makuGroup?.makus.forEach(((t,n)=>{e(t,n)}))}}const PD="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n}\n",FD="\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec2 p=vUv;\n    vec3 color=vec3(p,0.);\n    gl_FragColor=vec4(color,1.);\n}\n";class UD{el;textMesh;rect;constructor(e,t){this.el=e,this.textMesh=t;const n=e.getBoundingClientRect();this.rect=n}setPosition(e=window.scrollY){const{textMesh:t,rect:n}=this,{mesh:i}=t,{x:r,y:s,height:a}=n,o=r-window.innerWidth/2,l=-(s+a/2-window.innerHeight/2)+e;i.position.set(o,l,0)}}const OD=rb;const ND=(e,t)=>{const n=e instanceof HTMLVideoElement?"linear":"mipmap",i=e instanceof HTMLVideoElement?"linear":"mipmap",r=e?.getAttribute("wrap-s")||"repeat",s=e?.getAttribute("wrap-t")||"repeat",a=e?.getAttribute("min-filter")||n,o=e?.getAttribute("mag-filter")||i,l={clamp:g,repeat:A,mirror:v},c={nearest:y,linear:E,mipmap:b};if(t.wrapS=l[r],t.wrapT=l[s],t.minFilter=c[a],t.magFilter=c[o],e instanceof HTMLVideoElement){const n=e?.getAttribute("autoplay")||"";e?.addEventListener("loadedmetadata",(()=>{n&&t.image.play()}))}},kD=e=>{if(!e)return null;const t=(new vh).load(e.src);return ND(e,t),t},GD=(e,t)=>{if(!e)return null;const n=(new Ah).load(t.map((e=>e.src)));return ND(e,n),n},QD=(e,t,n=null)=>{if(!e)return{};let i=null;const r=e.getAttribute("type")||"2d";if(e instanceof HTMLImageElement){if("2d"===r)i=kD(e);else if("cube"===r){const t=n?.querySelector("[cube=px]"),r=n?.querySelector("[cube=nx]"),s=n?.querySelector("[cube=py]"),a=n?.querySelector("[cube=ny]"),o=n?.querySelector("[cube=pz]"),l=n?.querySelector("[cube=nz]");i=GD(e,[t,r,s,a,o,l])}}else e instanceof HTMLVideoElement&&(i=(e=>{if(!e)return null;const t=new ol(e);return ND(e,t),t})(e));const s={"2d":t,cube:`${t}Cube`}[r]||t;return i?{[s]:{value:i},[`${s}Resolution`]:{value:new ot(i.image?.width,i.image?.height)}}:{}};class zD extends lb{create(e,t={}){new cR(this,{shadertoyMode:!0,fragmentShader:e,uniforms:t}).addExisting()}}class HD extends HTMLElement{container;sketch;constructor(){super(),this.container=null,this.sketch=null}static register(){customElements.get("shader-toy")||customElements.define("shader-toy",HD)}connectedCallback(){this.create()}get elId(){return this.id||"sketch"}get containerId(){return`${this.elId}-container`}get fragShader(){return this.querySelector("[type=frag]")?.textContent||"\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\n    // Time varying pixel color\n    vec3 col = 0.5 + 0.5*cos(iTime+uv.xyx+vec3(0,2,4));\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}\n"}getTextureUniform(e){const t=this.querySelector(`[name=${e}]`);return QD(t,e,this)}get uniforms(){return{...this.getTextureUniform("iChannel0"),...this.getTextureUniform("iChannel1"),...this.getTextureUniform("iChannel2"),...this.getTextureUniform("iChannel3")}}createContainer(){const e=document.createElement("div");e.id=this.containerId,e.style.width="100%",e.style.height="100%",this.appendChild(e),this.container=e}create(){this.createContainer();const e=this.fragShader,t=this.uniforms,n=((e="sketch",t,n={})=>{const i=new zD(`#${e}`);return i.create(t,n),i})(this.containerId,e,t),i=n.renderer.domElement;i.style.width="100%",i.style.height="100%",this.sketch=n}}e.AnimationManager=class extends Zu{clips;root;mixer;constructor(e,t,n){super(e),this.clips=t,this.root=n,this.mixer=new yu(n)}get names(){return this.clips.map((e=>e.name))}get actions(){return Object.fromEntries(this.clips.map((e=>[e.name,this.mixer.clipAction(e)])))}update(){this.mixer.update(this.base.clock.deltaTime)}},e.Animator=$u,e.AssetManager=yC,e.Base=lb,e.BasicPanorama=tR,e.Bender=class{bend(e,t,n){let i=0;if(0!==n){const r=e.attributes.position.array;for(let e=0;e<r.length;e+=3){let s=r[e],a=r[e+1],o=r[e+2];if("x"===t)i=o*n;else i=s*n;let l=Math.sin(i),c=Math.cos(i);switch(t){case"x":r[e]=s,r[e+1]=(a-1/n)*c+1/n,r[e+2]=-(a-1/n)*l;break;case"y":r[e]=-(o-1/n)*l,r[e+1]=a,r[e+2]=(o-1/n)*c+1/n;break;default:r[e]=-(a-1/n)*l,r[e+1]=(a-1/n)*c+1/n,r[e+2]=o}}e.attributes.position.needsUpdate=!0}}},e.Box=class extends Zu{mesh;constructor(e,t={}){super(e);const{width:n=.2,height:i=.2,depth:r=.2,position:s=new Ot(0,0,0),material:a=new ai({color:new ni("#ffffff")})}=t,o=new Wi(n,i,r),l=new Hi(o,a);l.position.copy(s),this.mesh=l}addExisting(){this.container.add(this.mesh)}spin(e,t="y",n=1){this.mesh.rotation[t]=e/1e3*n}},e.CameraControls=class extends Zu{controls;constructor(e){super(e),rM.install({THREE:qu});const t=new rM(e.camera,e.renderer.domElement);this.controls=t}update(e){this.controls.update(this.base.clock.deltaTime)}},e.Caustics=class extends Zu{group;scene;lightSource;intensity;normalMaterial;ior;chromaticAberration;samples;saturation;noiseIntensity;scaleCorrection;material;causticsPlane;normalFBO;normalCamera;causticsFBO;causticsComputeMaterial;causticsQuad;bound;constructor(e,t={}){super(e);const{lightSource:n=new Ot(-10,13,-10),intensity:i=.5,normalMaterial:r=new Nc,ior:s=1.25,chromaticAberration:a=.16,samples:o=16,saturation:l=1.265,noiseIntensity:c=.01,scaleCorrection:h=1.75}=t;this.lightSource=n,this.intensity=i,this.normalMaterial=r,this.ior=s,this.chromaticAberration=a,this.samples=o,this.saturation=l,this.noiseIntensity=c,this.scaleCorrection=h;const u=new Na;this.group=u;const d=new qa;this.scene=d,u.add(this.scene);const p=new dr,f=new Yi({vertexShader:"\nuniform float iTime;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n}\n",fragmentShader:"\nuniform float iTime;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\n\nvarying vec2 vUv;\n\nuniform sampler2D uTexture;\nuniform float uCa;\nuniform float uSaturation;\nuniform float uNoiseIntensity;\n\nvec3 saturation(vec3 rgb,float adjustment){\n    const vec3 W=vec3(.2125,.7154,.0721);\n    vec3 intensity=vec3(dot(rgb,W));\n    return mix(intensity,rgb,adjustment);\n}\n\nhighp float random(vec2 co)\n{\n    highp float a=12.9898;\n    highp float b=78.233;\n    highp float c=43758.5453;\n    highp float dt=dot(co.xy,vec2(a,b));\n    highp float sn=mod(dt,3.14);\n    return fract(sin(sn)*c);\n}\n\nvoid main(){\n    vec2 uv=vUv;\n    vec3 col=vec3(0.);\n    for(int i=0;i<SAMPLES;i++){\n        float noise=random(uv)*uNoiseIntensity;\n        float slide=float(i)/float(SAMPLES)*.1+noise;\n        \n        vec2 dir=vec2(1.);\n        dir=i%2==0?vec2(-.5,0.):vec2(0.,.5);\n        \n        float R=texture(uTexture,uv+(uCa*slide*dir*1.)).r;\n        float G=texture(uTexture,uv+(uCa*slide*dir*2.)).g;\n        float B=texture(uTexture,uv+(uCa*slide*dir*3.)).b;\n        col.r+=R;\n        col.g+=G;\n        col.b+=B;\n    }\n    col/=float(SAMPLES);\n    col=saturation(col,uSaturation);\n    \n    gl_FragColor=vec4(col,1.);\n}\n",transparent:!0,blending:2,uniforms:{uTexture:{value:null},uCa:{value:this.chromaticAberration},uSaturation:{value:this.saturation},uNoiseIntensity:{value:this.noiseIntensity}},defines:{SAMPLES:this.samples}});this.material=f;const m=new Hi(p,f);this.causticsPlane=m,this.causticsPlane.rotation.set(-Math.PI/2,0,0),this.causticsPlane.position.set(5,0,5),this.causticsPlane.scale.setScalar(10),this.group.add(this.causticsPlane);const A=new oM(this.base);this.normalFBO=A;const g=new Zi(65,1,.1,1e3);this.normalCamera=g;const v=new oM(this.base);this.causticsFBO=v;const y=new Yi({vertexShader:"\nuniform float iTime;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\n\nvarying vec2 vUv;\n\nvarying vec3 vWorldPosition;\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n    vWorldPosition=vec3(modelMatrix*vec4(p,1));\n}\n",fragmentShader:"\n#ifndef saturate\n#define saturate(a)clamp(a,0.,1.)\n#endif\n\nuniform float iTime;\nuniform vec3 iResolution;\nuniform vec4 iMouse;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\n\nuniform sampler2D uNormalTexture;\nuniform vec3 uLightPosition;\nuniform float uIntensity;\nuniform float uIor;\n\nvoid main(){\n    vec2 uv=vUv;\n    \n    vec3 normal=normalize(texture(uNormalTexture,uv).xyz);\n    vec3 lightDir=normalize(uLightPosition);\n    \n    vec3 ray=refract(lightDir,normal,1./uIor);\n    \n    vec3 oldPos=vWorldPosition;\n    vec3 newPos=vWorldPosition+ray;\n    \n    // https://medium.com/@evanwallace/rendering-realtime-caustics-in-webgl-2a99a29a0b2c\n    float oldArea=length(dFdx(oldPos))*length(dFdy(oldPos));\n    float newArea=length(dFdx(newPos))*length(dFdy(newPos));\n    float result=saturate(oldArea/newArea)*uIntensity;\n    result=pow(result,2.);\n    \n    gl_FragColor=vec4(vec3(result),1.);\n}\n",uniforms:{uNormalTexture:{value:null},uLightPosition:{value:this.lightSource},uIntensity:{value:this.intensity},uIor:{value:this.ior}}});this.causticsComputeMaterial=y;const x=new zp(y);this.causticsQuad=x}addExisting(){this.container.add(this.group)}add(...e){this.scene.add(...e)}adjustPlane(){const e=this.bound.boundingBox,t=Yw(e),n=this.lightSource.clone().normalize(),i=t.map((e=>e.add(n.clone().multiplyScalar(-e.y/n.y)))),r=i.reduce(((e,t)=>e.add(t)),new Ot(0,0,0)).divideScalar(i.length);this.causticsPlane.position.copy(r);const s=i.map((e=>Math.hypot(e.x-r.x,e.z-r.z))).reduce(((e,t)=>Math.max(e,t)),0);this.causticsPlane.scale.setScalar(s*this.scaleCorrection)}update(){const e=qw(this.scene);this.bound=e,this.adjustPlane(),this.material.uniforms.uCa.value=this.chromaticAberration,this.material.defines.SAMPLES=this.samples,this.material.uniforms.uSaturation.value=this.saturation,this.material.uniforms.uNoiseIntensity.value=this.noiseIntensity,this.normalCamera.position.copy(this.lightSource),this.normalCamera.lookAt(this.bound.center),this.scene.overrideMaterial=this.normalMaterial,this.scene.overrideMaterial.side=1,this.base.renderer.setRenderTarget(this.normalFBO.rt),this.base.renderer.render(this.scene,this.normalCamera),this.scene.overrideMaterial=null,this.causticsComputeMaterial.uniforms.uNormalTexture.value=this.normalFBO.rt.texture,this.causticsComputeMaterial.uniforms.uLightPosition.value=this.lightSource,this.causticsComputeMaterial.uniforms.uIntensity.value=this.intensity,this.causticsComputeMaterial.uniforms.uIor.value=this.ior,this.causticsQuad.material=this.causticsComputeMaterial,this.base.renderer.setRenderTarget(this.causticsFBO.rt),this.causticsQuad.render(this.base.renderer),this.causticsPlane.material.uniforms.uTexture.value=this.causticsFBO.rt.texture,this.base.renderer.setRenderTarget(null)}},e.Center=xC,e.Clock=_C,e.Component=Zu,e.ContactShadows=lM,e.CubemapQuad=class extends cR{constructor(e,t={}){super(e,{...t,fragmentShader:`\n      \nuniform vec2 unViewport;\nuniform vec3 unCorners[5];\n\n\n      ${t.fragmentShader}\n\n      \nvoid main()\n{\n    vec4 color=vec4(0.,0.,0.,1.);\n    vec3 ro=vec3(0.);\n    vec2 uv=gl_FragCoord.xy/unViewport.xy;\n    vec3 rd=normalize(mix(mix(unCorners[0],unCorners[1],uv.x),mix(unCorners[3],unCorners[2],uv.x),uv.y)-ro);\n    mainCubemap(color,gl_FragCoord.xy,ro,rd);\n    gl_FragColor=color;\n}\n\n      `,uniforms:{unViewport:{value:new ot(window.innerHeight,window.innerHeight)},unCorners:{value:[1,1,1,1,1,-1,1,-1,-1,1,-1,1,0,0,0]}}})}},e.CustomEffect=class extends Zu{composer;customPass;uniformInjector;constructor(e,t={}){super(e);const{vertexShader:n=sR,fragmentShader:i=aR,uniforms:r={}}=t,s=new $p(e.renderer);this.composer=s;const a=new nf(e.scene,e.camera);s.addPass(a);const o=new wC(e);this.uniformInjector=o;const l=new Wp({vertexShader:n,fragmentShader:i,uniforms:{tDiffuse:{value:null},...o.shadertoyUniforms,...r}});this.customPass=l,l.renderToScreen=!0,s.addPass(l)}addExisting(){this.base.composer=this.composer}update(e){const t=this.customPass.uniforms;this.uniformInjector.injectShadertoyUniforms(t)}},e.CustomMaterial=Ng,e.CustomMesh=dR,e.CustomPoints=class extends Zu{material;points;uniformInjector;constructor(e,t={}){super(e);const{geometry:n=new dr(1,1,16,16),baseMaterial:i=new Yi,vertexShader:r=pR,fragmentShader:s=fR,uniforms:a={},patchMap:o={},materialParams:l={}}=t,c=new wC(e);this.uniformInjector=c;const h=new yg({baseMaterial:i,vertexShader:r,fragmentShader:s,uniforms:{...c.shadertoyUniforms,uPointSize:{value:10},...a},patchMap:o,...l});this.material=h;const u=new sl(n,h);this.points=u}addExisting(){this.container.add(this.points)}update(e){const t=this.material.uniforms;this.uniformInjector.injectShadertoyUniforms(t)}},e.CustomShaderMaterial=yg,e.DecalGeometry=class extends bi{constructor(e,t,n,i){super();const r=[],s=[],a=[],o=new Ot,l=new fn;l.makeRotationFromEuler(n),l.setPosition(t);const c=new fn;function h(t,n,i){n.applyMatrix4(e.matrixWorld),n.applyMatrix4(c),i.transformDirection(e.matrixWorld),t.push(new rm(n.clone(),i.clone()))}function u(e,t){const n=[],r=.5*Math.abs(i.dot(t));for(let i=0;i<e.length;i+=3){let s,a,o,l,c,h,u,p=0;switch(s=e[i+0].position.dot(t)-r>0,a=e[i+1].position.dot(t)-r>0,o=e[i+2].position.dot(t)-r>0,p=(s?1:0)+(a?1:0)+(o?1:0),p){case 0:n.push(e[i]),n.push(e[i+1]),n.push(e[i+2]);break;case 1:if(s&&(l=e[i+1],c=e[i+2],h=d(e[i],l,t,r),u=d(e[i],c,t,r)),a){l=e[i],c=e[i+2],h=d(e[i+1],l,t,r),u=d(e[i+1],c,t,r),n.push(h),n.push(c.clone()),n.push(l.clone()),n.push(c.clone()),n.push(h.clone()),n.push(u);break}o&&(l=e[i],c=e[i+1],h=d(e[i+2],l,t,r),u=d(e[i+2],c,t,r)),n.push(l.clone()),n.push(c.clone()),n.push(h),n.push(u),n.push(h.clone()),n.push(c.clone());break;case 2:s||(l=e[i].clone(),c=d(l,e[i+1],t,r),h=d(l,e[i+2],t,r),n.push(l),n.push(c),n.push(h)),a||(l=e[i+1].clone(),c=d(l,e[i+2],t,r),h=d(l,e[i],t,r),n.push(l),n.push(c),n.push(h)),o||(l=e[i+2].clone(),c=d(l,e[i],t,r),h=d(l,e[i+1],t,r),n.push(l),n.push(c),n.push(h))}}return n}function d(e,t,n,i){const r=e.position.dot(n)-i,s=r/(r-(t.position.dot(n)-i));return new rm(new Ot(e.position.x+s*(t.position.x-e.position.x),e.position.y+s*(t.position.y-e.position.y),e.position.z+s*(t.position.z-e.position.z)),new Ot(e.normal.x+s*(t.normal.x-e.normal.x),e.normal.y+s*(t.normal.y-e.normal.y),e.normal.z+s*(t.normal.z-e.normal.z)))}c.copy(l).invert(),function(){let t,n=[];const c=new Ot,d=new Ot;if(!0===e.geometry.isGeometry)return void console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");const p=e.geometry,f=p.attributes.position,m=p.attributes.normal;if(null!==p.index){const e=p.index;for(t=0;t<e.count;t++)c.fromBufferAttribute(f,e.getX(t)),d.fromBufferAttribute(m,e.getX(t)),h(n,c,d)}else for(t=0;t<f.count;t++)c.fromBufferAttribute(f,t),d.fromBufferAttribute(m,t),h(n,c,d);for(n=u(n,o.set(1,0,0)),n=u(n,o.set(-1,0,0)),n=u(n,o.set(0,1,0)),n=u(n,o.set(0,-1,0)),n=u(n,o.set(0,0,1)),n=u(n,o.set(0,0,-1)),t=0;t<n.length;t++){const e=n[t];a.push(.5+e.position.x/i.x,.5+e.position.y/i.y),e.position.applyMatrix4(l),r.push(e.position.x,e.position.y,e.position.z),s.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new gi(r,3)),this.setAttribute("normal",new gi(s,3)),this.setAttribute("uv",new gi(a,2))}},e.DoubleFBO=class extends Zu{readFBO;writeFBO;constructor(e,t={}){super(e);const n=new oM(this.base,t);this.readFBO=n;const i=new oM(this.base,t);this.writeFBO=i}swap(){[this.readFBO,this.writeFBO]=[this.writeFBO,this.readFBO]}},e.DragDetecter=class extends Zu{isDragging;isCursorChanged;enabled;constructor(e,t={}){super(e);const{isCursorChanged:n=!0}=t;this.isCursorChanged=n,this.isDragging=!1,this.enabled=!0}detectDrag(){const e=Ow(),t={Mobile:"touchstart",Desktop:"mousedown"}[e],n={Mobile:"touchend",Desktop:"mouseup"}[e],i={Mobile:"touchmove",Desktop:"mousemove"}[e];this.changeCursorGrab(),window.addEventListener(t,(()=>{this.enabled?(this.isDragging=!0,this.changeCursorGrabbing(),this.emit("dragstart")):this.endDrag()})),window.addEventListener(n,(()=>{this.enabled?(this.isDragging=!1,this.changeCursorGrab(),this.emit("dragend")):this.endDrag()})),window.addEventListener(i,(()=>{this.enabled?this.isDragging&&this.emit("drag",this.base.iMouse.mouseDOMDelta):this.endDrag()}))}enable(){this.enabled=!0}disable(){this.enabled=!1}changeCursorGrab(){const e=this.base.renderer.domElement;this.isCursorChanged&&(e.style.cursor="grab")}changeCursorGrabbing(){const e=this.base.renderer.domElement;this.isCursorChanged&&(e.style.cursor="grabbing")}resetCursor(){this.base.renderer.domElement.style.cursor="auto"}endDrag(){this.isDragging=!1,this.resetCursor()}},e.Environment=class extends Zu{fbo;cubeCamera;virtualScene;ignoreObjects;constructor(e,t={}){super(e);const{resolution:n=256,near:i=1,far:r=1e3,scene:s=null,options:a={},textureType:o=R,ignoreObjects:l=[]}=t;this.ignoreObjects=l;const c=new nr(n,a);c.texture.type=o,this.fbo=c;const h=new er(i,r,c);this.cubeCamera=h;const u=s||new qa;this.virtualScene=u}update(){this.ignoreObjects.forEach((e=>{e.visible=!1})),this.cubeCamera.update(this.base.renderer,this.virtualScene),this.ignoreObjects.forEach((e=>{e.visible=!0}))}add(e){this.virtualScene.add(e)}get texture(){return this.fbo.texture}},e.FBO=oM,e.FBXLoader=kv,e.FirstPersonCamera=class extends Zu{camera;rotation;phi;theta;phiSpeed;thetaSpeed;rotationEnabled;translation;forwardSpeed;leftSpeed;translationEnabled;constructor(e,t={}){super(e);const{camera:n=this.base.camera,phiSpeed:i=8,thetaSpeed:r=5,translation:s=new Ot(0,2,0),forwardSpeed:a=1,leftSpeed:o=1}=t;this.camera=n,this.rotation=new Ut,this.phi=0,this.theta=0,this.phiSpeed=i,this.thetaSpeed=r,this.rotationEnabled=!0,this.translation=s,this.forwardSpeed=a,this.leftSpeed=o,this.translationEnabled=!0}update(e){this.rotationEnabled&&this.updateRotation(),this.updateCamera(),this.translationEnabled&&this.updateTranslation()}updateRotation(){const e=this.base.iMouse.mouseDOMDelta.x/window.innerWidth,t=this.base.iMouse.mouseDOMDelta.y/window.innerHeight;this.phi+=-e*this.phiSpeed,this.theta=at.clamp(this.theta+-t*this.thetaSpeed,-Math.PI/3,Math.PI/3);const n=new Ut;n.setFromAxisAngle(new Ot(0,1,0),this.phi);const i=new Ut;i.setFromAxisAngle(new Ot(1,0,0),this.theta);const r=new Ut;r.multiply(n),r.multiply(i),this.rotation.copy(r)}updateTranslation(){const e=(this.base.keyboard.isUpKeyDown?1:0)+(this.base.keyboard.isDownKeyDown?-1:0),t=(this.base.keyboard.isLeftKeyDown?1:0)+(this.base.keyboard.isRightKeyDown?-1:0),n=this.base.clock.deltaTime,i=new Ut;i.setFromAxisAngle(new Ot(0,1,0),this.phi);const r=new Ot(0,0,-1);r.applyQuaternion(i),r.multiplyScalar(e*n*10*this.forwardSpeed);const s=new Ot(-1,0,0);s.applyQuaternion(i),s.multiplyScalar(t*n*10*this.leftSpeed),this.translation.add(r),this.translation.add(s)}updateCamera(){this.camera.quaternion.copy(this.rotation),this.camera.position.copy(this.translation)}},e.Float=class extends Zu{group;speed;rotationIntensity;floatIntensity;floatingRange;offset;constructor(e,t={}){super(e);const{speed:n=1,rotationIntensity:i=1,floatIntensity:r=1,floatingRange:s=[-.1,.1]}=t;this.speed=n,this.rotationIntensity=i,this.floatIntensity=r,this.floatingRange=s;const a=new Na;this.group=a,this.offset=114514*Math.random()}addExisting(){this.container.add(this.group)}add(...e){this.group.add(...e)}update(e){const{speed:t,rotationIntensity:n,floatIntensity:i,floatingRange:r,offset:s}=this,a=s+this.base.clock.elapsedTime;this.group.rotation.x=Math.cos(a/4*t)/8*n,this.group.rotation.y=Math.sin(a/4*t)/8*n,this.group.rotation.z=Math.sin(a/4*t)/20*n;let o=Math.sin(a/4*t)/10;o=at.mapLinear(o,-.1,.1,r?.[0]??-.1,r?.[1]??.1),this.group.position.y=o*i}},e.FullScreenQuad=zp,e.GPUComputer=class extends Zu{gpu;uj;constructor(e,t={}){super(e);const{width:n=128,height:i=128}=t,r=new EC(n,i,e.renderer);this.gpu=r;const s=new wC(this.base);this.uj=s}createTexture(){return this.gpu.createTexture()}createVariable(e,t,n,i){const r=this.gpu.addVariable(e,t,n);return r.wrapS=A,r.wrapT=A,r.material.uniforms={...r.material.uniforms,...this.uj.shadertoyUniforms,...i},r}setVariableDependencies(e,t){this.gpu.setVariableDependencies(e,t)}init(){this.gpu.init()}update(e){const t=this.gpu.variables;t&&t.forEach((e=>{this.uj.injectShadertoyUniforms(e.material.uniforms)})),this.gpu.compute()}getVariableRt(e){return this.gpu.getCurrentRenderTarget(e).texture}},e.Gallery=LD,e.GlassMaterial=class extends Fc{constructor(e){super({roughness:.6,transmission:1,thickness:1.2,clearcoat:1,clearcoatRoughness:.1,clearcoatNormalScale:new ot(.3,.3),...e})}},e.Html=rR,e.HyperbolicHelicoidGeometry=class extends aM{constructor(e,t){super(iC,e,t)}},e.IMouse=CC,e.ImagePanorama=nR,e.InfiniteGallery=class extends LD{direction;gap;appendCount;constructor(e,t={}){super(e,{...t,isScrollPositionSync:!1});const{direction:n="vertical",gap:i=64,appendCount:r=3}=t;this.direction=n,this.gap=i,this.appendCount=r}get lengthType(){return{horizontal:"clientWidth",vertical:"clientHeight"}[this.direction]}get dimensionType(){return{horizontal:"x",vertical:"y"}[this.direction]}getImgLength(){let e=0;return this.makuGroup&&(e=this.makuGroup.makus[0].el[this.lengthType]),e}getItemLength(){const{gap:e}=this;return this.getImgLength()+e}getTotalCount(){let e=0;return this.makuGroup&&(e=this.makuGroup.makus.length),e}sync(e=0){const{appendCount:t}=this;if(this.makuGroup){const n=this.getItemLength(),i=this.getTotalCount(),r=n*i;this.iterate(((i,s)=>{i.mesh.position[this.dimensionType]=(n*s-e-114514*r)%r+n*t}))}}getSnapIndex(e=0){const t=this.getItemLength();return Math.round(e/t)}snap(e=0){return this.getItemLength()*this.getSnapIndex(e)}getActiveIndex(e=0){const t=this.getSnapIndex(e),n=this.getTotalCount();return(t+114514*n)%n}},e.Joystick=class extends Zu{manager;data;constructor(e,t={}){super(e),t.zone&&(t.zone.onmousedown=Uw,t.zone.onpointerdown=Uw,t.zone.ontouchstart=Uw);const n=YC({mode:"static",position:{left:"75px",bottom:"75px"},...t});this.manager=n,this.data={}}listenForGesture(){this.manager.on("start",(()=>{this.emit("move-start",this.data)})),this.manager.on("move",((e,t)=>{this.emit("move",t),this.data=t})),this.manager.on("end",(()=>{this.emit("move-end",this.data)}))}},e.Keyboard=KC,e.LightFormer=class extends Zu{material;mesh;constructor(e,t={}){super(e);const{color:n="white",form:i="rect",intensity:r=1}=t,s={circle:new Ec(0,1,64),ring:new Ec(.5,1,64),rect:new dr}[i],a=new ai({side:2,color:new ni(n)});a.color.multiplyScalar(r),this.material=a;const o=new Hi(s,a);this.mesh=o}addExisting(){this.container.add(this.mesh)}},e.MeshPhysicsObject=$C,e.MeshReflectorMaterial=class extends Zu{parent;material;virtualCamera;fbo1;fbo2;blurpass;hasBlur;ignoreObjects;beforeRender;constructor(e,t,n={}){super(e),this.parent=t;let{resolution:i=256,mixBlur:r=0,mixStrength:s=1,blur:a=[0,0],mirror:o=0,ignoreObjects:l=[]}=n;this.ignoreObjects=l,a=Array.isArray(a)?a:[a,a];const c=a[0]+a[1]>0;this.hasBlur=c;const h=this.base.renderer,u=t,d=new ar,p=new Ot,f=new Ot,m=new Ot,A=new fn,g=new Ot(0,0,-1),v=new Rt,y=new Ot,x=new Ot,_=new Rt,w=new fn,C=new Zi;this.virtualCamera=C;const b=this.base.camera;this.beforeRender=()=>{if(f.setFromMatrixPosition(u.matrixWorld),m.setFromMatrixPosition(b.matrixWorld),A.extractRotation(u.matrixWorld),p.set(0,0,1),p.applyMatrix4(A),y.subVectors(f,m),y.dot(p)>0)return;y.reflect(p).negate(),y.add(f),A.extractRotation(b.matrixWorld),g.set(0,0,-1),g.applyMatrix4(A),g.add(m),x.subVectors(f,g),x.reflect(p).negate(),x.add(f),C.position.copy(y),C.up.set(0,1,0),C.up.applyMatrix4(A),C.up.reflect(p),C.lookAt(x),C.far=b.far,C.updateMatrixWorld(),C.projectionMatrix.copy(b.projectionMatrix),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(C.projectionMatrix),w.multiply(C.matrixWorldInverse),w.multiply(u.matrixWorld),d.setFromNormalAndCoplanarPoint(p,f),d.applyMatrix4(C.matrixWorldInverse),v.set(d.normal.x,d.normal.y,d.normal.z,d.constant);const e=C.projectionMatrix;_.x=(Math.sign(v.x)+e.elements[8])/e.elements[0],_.y=(Math.sign(v.y)+e.elements[9])/e.elements[5],_.z=-1,_.w=(1+e.elements[10])/e.elements[14],v.multiplyScalar(2/v.dot(_)),e.elements[2]=v.x,e.elements[6]=v.y,e.elements[10]=v.z+1,e.elements[14]=v.w};const M={minFilter:E,magFilter:E,type:R},I=new Lt(i,i,M);I.depthBuffer=!0,I.depthTexture=new Qa(i,i),I.depthTexture.format=U,I.depthTexture.type=S;const B=new Lt(i,i,M),T=new uM({gl:h,resolution:i,width:a[0],height:a[1]}),D={mirror:o,textureMatrix:w,mixBlur:r,tDiffuse:I.texture,tDepth:I.depthTexture,tDiffuseBlur:B.texture,hasBlur:c,mixStrength:s},L={"defines-USE_BLUR":c?"":void 0};this.fbo1=I,this.fbo2=B,this.blurpass=T;const P=new FA(D);P.defines.USE_BLUR=L["defines-USE_BLUR"],this.material=P}update(e){const{parent:t,beforeRender:n,virtualCamera:i,fbo1:r,fbo2:s,blurpass:a,hasBlur:o,ignoreObjects:l}=this,c=this.base.renderer,h=this.base.scene;t.visible=!1,l.forEach((e=>{e.visible=!1}));const u=c.xr.enabled,d=c.shadowMap.autoUpdate;n(),c.xr.enabled=!1,c.shadowMap.autoUpdate=!1,c.setRenderTarget(r),c.state.buffers.depth.setMask(!0),c.autoClear||c.clear(),c.render(h,i),o&&a.render(c,r,s),c.xr.enabled=u,c.shadowMap.autoUpdate=d,t.visible=!0,l.forEach((e=>{e.visible=!0})),c.setRenderTarget(null)}},e.MeshReflectorMaterialImpl=FA,e.MeshTransmissionMaterial=class extends Zu{fbo;fboBack;material;parent;backside;background;oldBg;constructor(e,t,n={}){super(e);const{backside:i=!0,samples:r=16,background:s=null,chromaticAberration:a=.5,refraction:o=.25,saturation:l=1.14,lightPosition:c=new Ot(-1,1,1),diffuse:h=.2,specular:u=15,fresnel:d=8,fresnelColor:p=new ni("#ffffff")}=n;this.backside=i,this.background=s,this.parent=t;const f=new oM(this.base);this.fbo=f;const m=new oM(this.base);this.fboBack=m;const A=new Yi({vertexShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvarying vec3 vNormal;\nvarying vec3 vEyeVector;\n\n#define GLSLIFY 1\n// https://tympanus.net/codrops/2019/10/29/real-time-multiside-refraction-in-three-steps/\nvec4 getWorldPosition(mat4 modelMat,vec3 pos){\n    vec4 worldPosition=modelMat*vec4(pos,1.);\n    return worldPosition;\n}\n\n// https://tympanus.net/codrops/2019/10/29/real-time-multiside-refraction-in-three-steps/\nvec3 getEyeVector(mat4 modelMat,vec3 pos,vec3 camPos){\n    vec4 worldPosition=getWorldPosition(modelMat,pos);\n    vec3 eyeVector=normalize(worldPosition.xyz-camPos);\n    return eyeVector;\n}\n\nvoid main(){\n    vec3 p=position;\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);\n    \n    vUv=uv;\n\n    vNormal=normalize(normalMatrix*normal);\n    vEyeVector=getEyeVector(modelMatrix,p,cameraPosition);\n}\n",fragmentShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nuniform sampler2D uTexture;\nuniform vec2 uFBOResolution;\n\nvarying vec3 vNormal;\nvarying vec3 vEyeVector;\n\nuniform float uChromaticAberration;\nuniform float uRefraction;\nuniform float uSaturation;\nuniform vec3 uLightPosition;\nuniform float uDiffuse;\nuniform float uSpecular;\nuniform float uFresnel;\nuniform vec3 uFresnelColor;\n\nvec3 saturation(vec3 rgb,float adjustment){\n    const vec3 W=vec3(.2125,.7154,.0721);\n    vec3 intensity=vec3(dot(rgb,W));\n    return mix(intensity,rgb,adjustment);\n}\n\n#ifndef saturate\n#define saturate(a) clamp(a,0.,1.)\n#endif\n\nfloat diffuse(vec3 n,vec3 l){\n    float diff=saturate(dot(n,l));\n    return diff;\n}\n\nfloat specular2(vec3 n,vec3 l,float shininess){\n    float spec=pow(saturate(pow(dot(n,l),2.)),shininess);\n    return spec;\n}\n\nfloat lighting(vec3 light,vec3 normal,vec3 eyeVector,float d,float s){\n    vec3 N=normal;\n    vec3 L=normalize(-light);\n    vec3 H=normalize(eyeVector+L);\n    \n    float diff=diffuse(N,L)*d;\n    float spec=specular2(N,H,s);\n    float lin=diff+spec;\n    return lin;\n}\n\nfloat fresnel2(vec3 eyeVector,vec3 worldNormal,float power){\n    float fresnelFactor=abs(dot(eyeVector,worldNormal));\n    float inversefresnelFactor=1.-fresnelFactor;\n    return pow(inversefresnelFactor,power);\n}\n\nvoid main(){\n    vec2 p=gl_FragCoord.xy/uFBOResolution.xy;\n    \n    vec3 col=vec3(0.);\n    \n    float iorR=1.15;\n    float iorY=1.16;\n    float iorG=1.18;\n    float iorC=1.22;\n    float iorB=1.22;\n    float iorP=1.22;\n    \n    float cr=uChromaticAberration;\n    float refra=uRefraction;\n    float sat=uSaturation;\n    \n    vec3 lightPos=uLightPosition;\n    float d=uDiffuse;\n    float s=uSpecular;\n    \n    float fr=uFresnel;\n    vec3 frCol=uFresnelColor;\n    \n    for(int i=0;i<SAMPLES;i++){\n        float slide=float(i)/float(SAMPLES)*.1;\n        \n        vec3 refractVecR=refract(vEyeVector,vNormal,(1./iorR));\n        vec3 refractVecY=refract(vEyeVector,vNormal,(1./iorY));\n        vec3 refractVecG=refract(vEyeVector,vNormal,(1./iorG));\n        vec3 refractVecC=refract(vEyeVector,vNormal,(1./iorC));\n        vec3 refractVecB=refract(vEyeVector,vNormal,(1./iorB));\n        vec3 refractVecP=refract(vEyeVector,vNormal,(1./iorP));\n        \n        float r=texture(uTexture,p+refractVecR.xy*(refra+slide*1.)*cr).x*.5;\n        \n        float y=(texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).x*2.+\n        texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).y*2.-\n        texture(uTexture,p+refractVecY.xy*(refra+slide*1.)*cr).z)/6.;\n        \n        float g=texture(uTexture,p+refractVecG.xy*(refra+slide*2.)*cr).y*.5;\n        \n        float c=(texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).y*2.+\n        texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).z*2.-\n        texture(uTexture,p+refractVecC.xy*(refra+slide*2.5)*cr).x)/6.;\n        \n        float b=texture(uTexture,p+refractVecB.xy*(refra+slide*3.)*cr).z*.5;\n        \n        float p=(texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).z*2.+\n        texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).x*2.-\n        texture(uTexture,p+refractVecP.xy*(refra+slide*1.)*cr).y)/6.;\n        \n        float R=r+(2.*p+2.*y-c)/3.;\n        float G=g+(2.*y+2.*c-p)/3.;\n        float B=b+(2.*c+2.*p-y)/3.;\n        \n        col.r+=R;\n        col.g+=G;\n        col.b+=B;\n        \n        col=saturation(col,sat);\n    }\n    \n    col/=float(SAMPLES);\n    \n    float lin=lighting(lightPos,vNormal,vEyeVector,d,s);\n    col+=vec3(lin);\n    \n    float F=fresnel2(vEyeVector,vNormal,fr);\n    col+=vec3(F)*frCol;\n    \n    gl_FragColor=vec4(col,1.);\n}\n",defines:{SAMPLES:r},uniforms:{uTexture:{value:null},uFBOResolution:{value:new ot(f.rt.width,f.rt.height)},uChromaticAberration:{value:a},uRefraction:{value:o},uSaturation:{value:l},uLightPosition:{value:c},uDiffuse:{value:h},uSpecular:{value:u},uFresnel:{value:d},uFresnelColor:{value:p}}});this.material=A,this.oldBg=null,this.base.resizer.on("resize",(()=>{A.uniforms.uFBOResolution.value=new ot(f.rt.width,f.rt.height)}))}update(e){const{fbo:t,fboBack:n}=this;this.oldBg=this.base.scene.background,this.background&&(this.base.scene.background=this.background),this.parent.visible=!1;const i=this.parent.material;this.backside&&(this.base.renderer.setRenderTarget(n.rt),this.base.renderer.render(this.base.scene,this.base.camera),i.uniforms.uTexture.value=n.rt.texture,i.side=1,this.parent.visible=!0),this.base.renderer.setRenderTarget(t.rt),this.base.renderer.render(this.base.scene,this.base.camera),i.uniforms.uTexture.value=t.rt.texture,i.side=0,this.base.scene.background=this.oldBg,this.base.renderer.setRenderTarget(null),this.parent.visible=!0}},e.Moji=UD,e.MojiGroup=class extends Zu{elList;vertexShader;fragmentShader;uniforms;textMeshConfig;isScrollPositionSync;textMeshMaterial;mojis;scroller;uniformInjector;materialParams;useSelfScroller;constructor(e,t={}){super(e);const{elList:n=[...document.querySelectorAll(".webgl-text")],vertexShader:i=PD,fragmentShader:r=FD,uniforms:s={},textMeshConfig:a={},isScrollPositionSync:o=!0,scroller:l=null,materialParams:c={}}=t;this.elList=n,this.vertexShader=i,this.fragmentShader=r,this.uniforms=s,this.textMeshConfig=a,this.isScrollPositionSync=o,this.textMeshMaterial=null,this.mojis=[],this.scroller=l,this.materialParams=c;const h=new wC(e);this.uniformInjector=h,this.useSelfScroller=!1,l||(this.useSelfScroller=!0)}addExisting(){const{uniformInjector:e}=this,t=new Yi({vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,side:2,uniforms:{uTextColor:{value:new ni("black")},...e.shadertoyUniforms,...this.uniforms},...this.materialParams});this.textMeshMaterial=t;const n=this.elList.map(((e,n)=>{const i=new TD(this.base,e.innerText.trim());i.mesh.material=t.clone(),i.container=this.container,i.addExisting();const r=window.getComputedStyle(e,null).getPropertyValue("font-size"),s=parseFloat(r);i.mesh.fontSize=s;const a=window.getComputedStyle(e,null).getPropertyValue("text-align");i.mesh.anchorX={start:"left",end:"right",center:"center"}[a];const o=e.dataset.webglTextColor||"black";i.mesh.material.uniforms.uTextColor.value=new ni(o);const l=e.dataset.webglFontUrl||"";l&&(i.mesh.font=l);const c=e.dataset.webglFontWeight||"";c&&(i.mesh.fontWeight=c);const h=this.textMeshConfig.letterSpacing;h&&(i.mesh.letterSpacing=h);return new UD(e,i)}));if(this.mojis=n,this.mojis.forEach((e=>{e.setPosition()})),this.useSelfScroller){const e=new rb;this.scroller=e,this.scroller.listenForScroll()}this.base.resizer.on("resize",(()=>{n.forEach((e=>{e.rect=e.el.getBoundingClientRect()}))}))}update(){const{scroller:e,mojis:t}=this;e?.syncScroll(),t.forEach((t=>{const n=t.textMesh.mesh.material.uniforms;this.uniformInjector.injectShadertoyUniforms(n),this.isScrollPositionSync&&(t.el.classList.contains("webgl-fixed")?t.setPosition(0):t.setPosition(e?.scroll.current))}))}},e.NormalScroller=OD,e.OrbitControls=sM,e.OrthographicCamera=eb,e.PackedMipMapGenerator=class{_swapTarget;_copyQuad;_mipQuad;_mipMaterials;constructor(e=""){e||(e="\n\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < SAMPLES; i ++ ) {\n\n\t\t\t\t\tgl_FragColor += samples[ i ] * weights[ i ];\n\n\t\t\t\t}\n\n\t\t\t");const t=DA(LA);t.fragmentShader=t.fragmentShader.replace(/<mipmap_logic>/g,e);const n=new Array(4);n[0]=new Yi(DA(t)),n[0].defines.X_IS_EVEN=0,n[0].defines.Y_IS_EVEN=0,n[1]=new Yi(DA(t)),n[1].defines.X_IS_EVEN=1,n[1].defines.Y_IS_EVEN=0,n[2]=new Yi(DA(t)),n[2].defines.X_IS_EVEN=0,n[2].defines.Y_IS_EVEN=1,n[3]=new Yi(DA(t)),n[3].defines.X_IS_EVEN=1,n[3].defines.Y_IS_EVEN=1;const i=new Lt;i.texture.minFilter=y,i.texture.magFilter=y,this._swapTarget=i,this._copyQuad=new zp(new Yi(jp)),this._mipQuad=new zp(null),this._mipMaterials=n}update(e,t,n,i=!1){e.isWebGLRenderTarget&&(e=e.texture);const r=n.autoClear,s=n.getClearAlpha(),a=n.getRenderTarget();n.getClearColor(PA);const o=this._copyQuad,l=this._mipQuad,c=this._swapTarget,h=this._mipMaterials;let u,d;i?(u=at.floorPowerOfTwo(e.image.width),d=at.floorPowerOfTwo(e.image.height)):(u=Math.floor(e.image.width),d=Math.floor(e.image.height));const p=Math.floor(1.5*u),f=Math.floor(d);t.setSize(p,f),c.texture.type!==t.texture.type?(c.dispose(),c.copy(t),c.texture.image={...c.texture.image}):c.setSize(p,f),n.autoClear=!1,n.setClearColor(0),n.setClearAlpha(),o.material.uniforms.tDiffuse.value=e,o.camera.setViewOffset(u,d,0,0,p,f),n.setRenderTarget(t),n.clear(),o.render(n),n.setRenderTarget(c),n.clear(),o.render(n);let m=u,A=d,g=0;for(;m>1&&A>1;){const e=h[(m%2==0?1:0)|(A%2==0?2:0)];e.uniforms.map.value=c.texture,e.uniforms.parentLevel.value=g,e.uniforms.parentMapSize.value.set(m,A),e.uniforms.originalMapSize.value.set(u,d),l.material=e,m=Math.floor(m/2),A=Math.floor(A/2);const i=f-2*A;n.setRenderTarget(t),l.camera.setViewOffset(m,A,-u,-i,p,f),l.render(n),n.setRenderTarget(c),e.uniforms.map.value=t.texture,l.render(n),g++}return n.setRenderTarget(a),n.setClearAlpha(s),n.setClearColor(PA),n.autoClear=r,g+1}dispose(){this._swapTarget.dispose(),this._mipQuad.dispose(),this._copyQuad.dispose(),this._mipMaterials.forEach((e=>e.dispose()))}},e.PanoramaGenerator=class extends Zu{config;assetManager;viewer;panoramas;isSceneJumpEnabled;constructor(e,t=null){super(e),this.config=null,this.assetManager=null,this.viewer=null,this.panoramas=[],this.isSceneJumpEnabled=!0,t&&this.setConfig(t)}setConfig(e){this.config=e}getInfospotElByConfig(e){const t=e.className||`point-${e.id}`;return document.querySelector(`.${t}`)}generate(){const{config:e}=this;if(!e)return;const t=e.map((e=>({name:e.name,type:"texture",path:e.url}))),n=new yC(this.base,t);this.assetManager=n,this.assetManager.on("ready",(()=>{const e=new iR(this.base);this.viewer=e,this.generatePanoramas(),e.setPanorama(this.panoramas[0],0),this.emit("generate",this)}))}generateByConfig(e){this.setConfig(e),this.generate()}generatePanoramas(){const{config:e}=this;if(!e)return;const t=e.map((e=>{const t=this.assetManager?.items[e.name],n=new nR(this.base,t);n.id=e.id;const{viewer:i}=this;return i?.add(n),n}));return this.panoramas=t,t}generateInfospots(){const{config:e}=this;e&&e.forEach((e=>{if(e.infospots){const t=e.infospots.map((e=>{const t=this.getInfospotElByConfig(e),n=new rR(this.base,t,new Ot(e.point.x,e.point.y,e.point.z));return n.addExisting(),n})),{panoramas:n}=this,i=n.find((t=>t.id===e.id));i&&(i.infospots=[],i.addGroup(t))}}))}generateSceneJump(){const{config:e}=this;e&&e.forEach((e=>{e.infospots&&e.infospots.forEach((e=>{if(e.jump){const{panoramas:t,viewer:n}=this,i=t.find((t=>t.id===e.jump));if(i){this.getInfospotElByConfig(e).onclick=()=>{this.isSceneJumpEnabled&&(n?.setPanorama(i),this.emit("jump",e.jump))}}}else{this.getInfospotElByConfig(e).onclick=()=>{this.isSceneJumpEnabled}}}))}))}generateInfospotsWithSceneJump(){this.generateInfospots(),this.generateSceneJump()}get allInfospotConfig(){return this.config?this.config.map((e=>{if(!e.infospots)return[];const t=e.infospots?.map((e=>({id:e.id,name:e.name||e.id,point:e.point,jump:e.jump,className:e.className})));return t})).flat().filter((e=>e)):[]}outputCurrentScenePosition(){this.viewer?.currentPanorama?.outputPosition(),this.viewer?.currentPanorama?.on("click",(e=>{this.emit("click-scene",e)}))}enableSceneJump(){this.isSceneJumpEnabled=!0}disableSceneJump(){this.isSceneJumpEnabled=!1}},e.PersistenceEffect=class extends Zu{isActive;clearColor;fadeFactor;fadeColor;scaleX;scaleY;rotationAngle;orthoCamera;uvMatrix;fadeMaterial;fadePlane;resultPlane;framebuffer1;framebuffer2;constructor(e,t={}){super(e),this.isActive=!1;const{clearColor:n=1118481,fadeFactor:i=.2,fadeColor:r=new ni("#000000"),scaleX:s=0,scaleY:a=0,rotationAngle:o=0}=t;this.clearColor=n,this.fadeFactor=i,this.fadeColor=r,this.scaleX=s,this.scaleY=a,this.rotationAngle=o;const l=-innerWidth/2,c=innerWidth/2,h=-innerHeight/2,u=innerHeight/2,d=new wr(l,c,h,u,-100,100);d.position.z=-10,d.lookAt(new Ot(0,0,0)),this.orthoCamera=d;const p=new dr(innerWidth,innerHeight),f=new lt;this.uvMatrix=f;const m=new Yi({uniforms:{inputTexture:{value:null},fadeFactor:{value:this.fadeFactor},fadeColor:{value:this.fadeColor},uvMatrix:{value:f}},vertexShader:"\n        uniform mat3 uvMatrix;\n        varying vec2 vUv;\n        void main () {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          vUv = (uvMatrix * vec3(uv, 1.0)).xy;\n        }\n      ",fragmentShader:"\n        uniform sampler2D inputTexture;\n        uniform float fadeFactor;\n        uniform vec3 fadeColor;\n        varying vec2 vUv;\n        void main () {\n          vec4 texColor = texture2D(inputTexture, vUv);\n          vec4 fadeColorWithAlpha = vec4(fadeColor, 1.0);\n          gl_FragColor = mix(texColor, fadeColorWithAlpha, fadeFactor);\n        }\n      "});this.fadeMaterial=m;const A=new Hi(p,m);this.fadePlane=A;const g=new ai({map:null}),v=new Hi(p,g);this.resultPlane=v;const y=new Lt(innerWidth,innerHeight),x=new Lt(innerWidth,innerHeight);this.framebuffer1=y,this.framebuffer2=x}addExisting(){const{base:e}=this,{renderer:t}=e,{framebuffer1:n,framebuffer2:i}=this;t.setClearColor(this.clearColor),t.setRenderTarget(n),t.clearColor(),t.setRenderTarget(i),t.clearColor(),this.enable()}enable(){this.isActive=!0}disable(){this.isActive=!1}update(e){if(!this.isActive)return;const{base:t}=this,{renderer:n,scene:i,camera:r}=t,{orthoCamera:s,uvMatrix:a,fadeMaterial:o,fadePlane:l,resultPlane:c}=this,{framebuffer1:h,framebuffer2:u}=this;n.autoClearColor=!1,o.uniforms.inputTexture.value=h.texture,o.uniforms.fadeFactor.value=this.fadeFactor,n.setRenderTarget(u),n.render(l,s),n.render(i,r),n.setRenderTarget(null),c.material.map=u.texture,n.render(c,s);const d=at.mapLinear(this.scaleX,-1,1,1.05,.95),p=at.mapLinear(this.scaleY,-1,1,1.05,.95),f=at.degToRad(this.rotationAngle);a.setUvTransform(0,0,d,p,f,.5,.5);const m=h;this.framebuffer1=u,this.framebuffer2=m}},e.Physics=ZC,e.RayMarchingQuad=class extends Zu{screenQuad;marcher;constructor(e,t){super(e),this.screenQuad=null,this.marcher=t}render(){this.screenQuad&&this.container.remove(this.screenQuad.mesh);const e=new cR(this.base,{fragmentShader:this.marcher.fragmentShader,shadertoyMode:!0});e.addExisting(),this.screenQuad=e}},e.RaycastSelector=class extends Zu{raycaster;constructor(e){super(e),this.raycaster=new Eu}getInterSects(e=this.container.children){this.raycaster.setFromCamera(this.base.interactionManager.mouse,this.base.camera);return this.raycaster.intersectObjects(e,!0)}getFirstIntersect(e=this.container.children){const t=this.getInterSects(e)[0];return t&&t.face?t:null}onChooseIntersect(e){const t=this.getFirstIntersect();if(!t)return null;return e===t.object?t:null}onChooseInclude(e){const t=this.getInterSects().find((t=>t.object===e));return t||null}},e.RectAreaLightHelper=class extends qo{constructor(e,t){const n=new bi;n.setAttribute("position",new gi([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();super(n,new Ho({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const i=new bi;i.setAttribute("position",new gi([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Hi(i,new ai({side:1,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},e.Reflector=ry,e.RenderQuad=class extends dR{constructor(e,t,n={}){super(e,{vertexShader:"",fragmentShader:"",baseMaterial:new ai,geometry:n.geometry||new dr(window.innerWidth,window.innerHeight),materialParams:{map:t,transparent:!0,...n.materialParams}})}},e.RenderTexture=class extends Zu{fbo;texture;rtScene;rtCamera;constructor(e,t={}){super(e);const{rtScene:n=new qa,rtCamera:i=new Zi(70,window.innerWidth/window.innerHeight,.01,100),fboOptions:r={}}=t;this.rtScene=n,this.rtCamera=i;const s=new oM(e,{...t,options:r});this.fbo=s;const a=s.rt.texture;this.texture=a}update(){this.base.renderer.setRenderTarget(this.fbo.rt),this.base.renderer.render(this.rtScene,this.rtCamera),this.base.renderer.setRenderTarget(null)}add(e){this.rtScene.add(e)}},e.Resizer=sb,e.SVGLoader=AA,e.ScreenCamera=class extends Zu{camera;constructor(e,t={}){super(e);const{position:n=new Ot(0,0,600),near:i=100,far:r=2e3}=t,s=((e,t=window.innerHeight)=>at.radToDeg(2*Math.atan(t/2/e)))(n.z),a=e.container,o=a.clientWidth/a.clientHeight,l=new Zi(s,o,i,r);l.position.copy(n),this.camera=l}addExisting(){this.base.camera=this.camera,this.base.interactionManager.camera=this.camera}},e.ScreenQuad=cR,e.ShaderToyElement=HD,e.Sparkles=class extends Zu{uj;sparkles;constructor(e,t={}){super(e);const{count:n=100,speed:i=1,opacity:s=1,color:a,size:o,scale:l=1,noise:c=1,blending:h=r}=t,u=new bi,d=Float32Array.from(Array.from({length:n},(()=>Gw(l).map(at.randFloatSpread))).flat());u.setAttribute("position",new fi(d,3));const p=Hw(n,o,Math.random),f=Hw(n,s),m=Hw(n,i),A=Hw(3*n,c),g=Hw(void 0===a?3*n:n,Qw(a)?a:new ni(a),(()=>1));u.setAttribute("size",new fi(p,1)),u.setAttribute("opacity",new fi(f,1)),u.setAttribute("speed",new fi(m,1)),u.setAttribute("noise",new fi(A,3)),u.setAttribute("color",new fi(g,3));const v=new wC(this.base);this.uj=v;const y=new Yi({vertexShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nuniform float uPixelRatio;\n\nattribute float size;\nattribute float speed;\nattribute float opacity;\nattribute vec3 noise;\nattribute vec3 color;\n\nvarying vec3 vColor;\nvarying float vOpacity;\n\nvec3 distort(vec3 p){\n    float t=iTime;\n    p.y+=sin(t*speed+p.x*noise.x*100.)*.2;\n    p.z+=cos(t*speed+p.x*noise.y*100.)*.2;\n    p.x+=cos(t*speed+p.x*noise.z*100.)*.2;\n    return p;\n}\n\nvoid main(){\n    vec3 p=position;\n    \n    p=distort(p);\n    \n    vec4 mvPosition=modelViewMatrix*vec4(p,1.);\n    \n    gl_Position=projectionMatrix*mvPosition;\n    \n    vUv=uv;\n    \n    gl_PointSize=size*uPixelRatio*25.;\n    gl_PointSize*=(1./-mvPosition.z);\n    \n    vColor=color;\n    vOpacity=opacity;\n}\n",fragmentShader:"\nuniform float iTime;\nuniform vec2 iResolution;\nuniform vec2 iMouse;\n\nvarying vec2 vUv;\n\nvarying vec3 vColor;\nvarying float vOpacity;\n\nfloat spot(vec2 p,float r,float offset){\n    float center=distance(p,vec2(.5));\n    float strength=r/center-offset;\n    return strength;\n}\n\nvoid main(){\n    vec2 p=vUv;\n    \n    vec3 col=vColor;\n    \n    float alpha=spot(gl_PointCoord,.05,.1)*vOpacity;\n    \n    gl_FragColor=vec4(col,alpha);\n}\n",uniforms:{...v.shadertoyUniforms,uPixelRatio:{value:this.base.renderer.getPixelRatio()}},transparent:!0,blending:h,depthWrite:!1}),x=new sl(u,y);this.sparkles=x,this.base.resizer.on("resize",(()=>{x.material.uniforms.uPixelRatio.value=Math.min(window.devicePixelRatio,2)}))}addExisting(){this.container.add(this.sparkles)}update(e){if(this.sparkles){const e=this.sparkles.material;this.uj.injectShadertoyUniforms(e.uniforms)}}},e.SphubeGeometry=class extends aM{constructor(e,t){super(rC,e,t)}},e.Stage=class extends Zu{group;center;shadow;presetData;ambientLight;spotLight;pointLight;contactShadows;constructor(e,t={}){super(e);const{preset:n="rembrandt",shadow:i="contact",intensity:r=.5}=t;this.shadow=i;const s=new Na;this.group=s;const a=new xC(this.base);this.center=a;const o="string"==typeof n?cM[n]:n;this.presetData=o;const l=new Ph(16777215,r/3);this.ambientLight=l;const c=new Mh(16777215,2*r,0,Math.PI/3,1);this.spotLight=c,this.spotLight.castShadow=!!i,this.spotLight.shadow.bias=-1e-4,this.spotLight.shadow.mapSize.set(1024,1024);const h=new Rh(16777215,r);this.pointLight=h,this.adjustAll()}addExisting(){this.container.add(this.ambientLight),this.container.add(this.spotLight),this.container.add(this.pointLight),this.container.add(this.group),this.center.addExisting(),this.center.add(this.group),this.adjustAll()}add(...e){this.group.add(...e),this.adjustAll()}adjustAll(){this.adjustLightPositions(),this.adjustShadow()}adjustLightPositions(){const{presetData:e}=this;this.center.adjustPosition();const t=this.center.bound,{boundingSphere:n,height:i}=t,{radius:r}=n;this.spotLight.position.set(e.main[0]*r,e.main[1]*r,e.main[2]*r),this.pointLight.position.set(e.fill[0]*r,e.fill[1]*r,e.fill[2]*r)}adjustShadow(){this.center.adjustPosition();const e=this.center.bound,{boundingSphere:t,height:n}=e,{radius:i}=t;if("contact"===this.shadow){this.contactShadows&&(this.contactShadows.group.clear(),this.contactShadows=null);const e=new lM(this.base,{scale:4*i,far:i,blur:2});this.contactShadows=e,this.contactShadows.group.position.set(0,-n/2,0),this.contactShadows.addExisting()}}},e.Stats=class extends Zu{stats;constructor(e){super(e);const t=new ob;this.stats=t,this.base.container.appendChild(this.stats.dom)}update(e){this.stats.update()}},e.Text3D=class extends dR{constructor(e,t,n,i={size:.5,height:.2,curveSegments:12,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:5},r={}){super(e,{geometry:new sm(t,{...i,font:n}),...r})}},e.TextMesh=TD,e.ThinFilmFresnelMap=class extends To{_filmThickness;_refractiveIndexFilm;_refractiveIndexBase;_size;_data;constructor(e=380,t=2,n=3,i=64){const r=new Uint8Array(4*i);super(r,i,1,F,M,h,A,A,E,b),this._filmThickness=e,this._refractiveIndexFilm=t,this._refractiveIndexBase=n,this._size=i,this._data=r,this._updateData(),this.generateMipmaps=!0,this.needsUpdate=!0}get filmThickness(){return this._filmThickness}set filmThickness(e){this._filmThickness=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}get refractiveIndexFilm(){return this._refractiveIndexFilm}set refractiveIndexFilm(e){this._refractiveIndexFilm=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}get refractiveIndexBase(){return this._refractiveIndexBase}set refractiveIndexBase(e){this._refractiveIndexBase=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}updateSettings(e,t,n){this._filmThickness=e||380,this._refractiveIndexFilm=t||2,this._refractiveIndexBase=n||3,this._updateData()}_fresnelRefl(e,t,n,i,r,s){var a=1-n*n,o=e/t;if(o*o*a>1){r.x=1,r.y=1;var l=o*o;s.x=2*Math.atan(-l*Math.sqrt(a-1/l)/n),s.y=2*Math.atan(-Math.sqrt(a-1/l)/n)}else{var c=(t*n-e*i)/(t*n+e*i),h=(e*n-t*i)/(e*n+t*i);s.x=c<0?Math.PI:0,s.y=h<0?Math.PI:0,r.x=c*c,r.y=h*h}}_updateData(){var e=this._filmThickness,t=this._refractiveIndexFilm,n=this._refractiveIndexBase,i=this._size;function r(e){var t=(e-568.8)*(e<568.8?.0213:.0247),n=(e-530.9)*(e<530.9?.0613:.0322);return.821*Math.exp(-.5*t*t)+.286*Math.exp(-.5*n*n)}function s(e){var t=(e-437)*(e<437?.0845:.0278),n=(e-459)*(e<459?.0385:.0725);return 1.217*Math.exp(-.5*t*t)+.681*Math.exp(-.5*n*n)}for(var a,o,l,c,h=this._data,u=new ot,d=new ot,p=new ot,f=new ot,m=new ot,A=new ot,g=new ot,v=new ot,y=new ot,x=new ot,_=new ot,E=new ot,w=1/(t*t),C=t*t/(n*n),b=0;b<i;++b){var M=b/i,S=Math.sqrt(1-w*(1-M*M)),I=Math.sqrt(1-C*(1-S*S)),B=2*t*e*S,T=2*Math.PI*B;this._fresnelRefl(1,t,M,S,f,u),m.x=1-f.x,m.y=1-f.y,d.x=Math.PI-u.x,d.y=Math.PI-u.y,this._fresnelRefl(t,n,S,I,A,p),g.x=Math.sqrt(A.x*f.x),g.y=Math.sqrt(A.y*f.y),v.x=Math.sqrt(m.x*m.x),v.y=Math.sqrt(m.y*m.y),y.x=m.x*m.x*A.x/(1-A.x*f.x),y.y=m.y*m.y*A.y/(1-A.y*f.y),x.x=g.x*g.x,x.y=g.y*g.y,_.x=f.x+y.x,_.y=f.y+y.y,E.x=y.x-v.x,E.y=y.y-v.y;for(var R=0,D=0,L=0,P=0,F=0,U=0,O=0;O<64;++O){var N=380+O/63*400,k=T/N,G=Math.cos(k+p.x+d.x),Q=Math.cos(k+p.y+d.y),z=.5*(_.x+2*(g.x*G-x.x)/(1-2*g.x*G+x.x)*E.x+(_.y+2*(g.y*Q-x.y)/(1-2*g.y*Q+x.y)*E.y)),H=(o=void 0,l=void 0,c=void 0,o=((a=N)-442)*(a<442?.0624:.0374),l=(a-599.8)*(a<599.8?.0264:.0323),c=(a-501.1)*(a<501.1?.049:.0382),.362*Math.exp(-.5*o*o)+1.056*Math.exp(-.5*l*l)-.065*Math.exp(-.5*c*c)),V=r(N),W=s(N);P+=H,F+=V,U+=W,R+=H*z,D+=V*z,L+=W*z}var j=3.2406*(R/=P)-1.5372*(D/=F)-.4986*(L/=U),X=-.9689*R+1.8758*D+.0415*L,J=.0557*R-.204*D+1.057*L;j=at.clamp(j,0,1),X=at.clamp(X,0,1),J=at.clamp(J,0,1),j=Math.sqrt(j),X=Math.sqrt(X),J=Math.sqrt(J);var q=b<<2;h[q]=Math.floor(255*j),h[q+1]=Math.floor(255*X),h[q+2]=Math.floor(255*J),h[q+3]=255}this.needsUpdate=!0}},e.ThirdPersonCamera=class extends Zu{target;camera;currentPosition;currentLookAt;offset;lookAt;enabled;constructor(e,t,n={}){super(e),this.target=t;const{camera:i=this.base.camera,offset:r=new Ot(0,0,-2),lookAt:s=t.position.clone()}=n;this.camera=i,this.offset=r,this.lookAt=s,this.currentPosition=new Ot,this.currentLookAt=new Ot,this.enabled=!0}get idealOffset(){const e=this.offset.clone();return e.applyQuaternion(this.target.quaternion),e.add(this.target.position),e}get idealLookAt(){const e=this.lookAt.clone();return e.applyQuaternion(this.target.quaternion),e.add(this.target.position),e}update(e){if(!this.enabled)return;const{idealOffset:t,idealLookAt:n}=this,i=this.base.clock.deltaTime,r=1-Math.pow(.001,i);this.currentPosition.lerp(t,r),this.currentLookAt.lerp(n,r),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt)}},e.UniformInjector=wC,e.Viewer=iR,e.WheelScroller=class{scroll;enabled;constructor(){this.scroll={current:0,target:0,ease:.05,last:0,delta:0,direction:""},this.enabled=!0}enable(){this.enabled=!0}disable(){this.enabled=!1}listenForScroll(){window.addEventListener("wheel",(e=>{if(!this.enabled)return;const t=e.deltaY;this.scroll.target+=t}))}syncScroll(){this.scroll.current=at.lerp(this.scroll.current,this.scroll.target,this.scroll.ease),this.scroll.delta=this.scroll.current-this.scroll.last,this.scroll.direction=this.scroll.delta>0?"down":"up",this.scroll.last=this.scroll.current}},e.adaptMobileDOM=e=>{const t=document.documentElement.clientWidth,n=document.documentElement.clientHeight;t>n?(e.style.webkitTransform=e.style.transform="rotate(0deg)",e.style.width=`${t}px`,e.style.height=`${n}px`,e.style.webkitTransformOrigin=e.style.transformOrigin="center"):(e.style.webkitTransform=e.style.transform="rotate(90deg)",e.style.width=`${n}px`,e.style.height=`${t}px`,e.style.webkitTransformOrigin=e.style.transformOrigin=t/2+"px center")},e.applyViewScissor=(e,t)=>{const n=e.renderer.domElement.getBoundingClientRect(),i=t.getBoundingClientRect();if(i){const{position:{left:t,bottom:r,width:s,height:a}}=((e,t)=>{const{right:n,top:i,left:r,bottom:s,width:a,height:o}=t,l=t.bottom<0||i>e.height||n<0||t.left>e.width,c=e.top+e.height-s;return{position:{width:a,height:o,left:r-e.left,top:i,bottom:c,right:n},isOffscreen:l}})(n,i),o=s/a;e.camera.aspect=o,e.camera.updateProjectionMatrix(),e.renderer.setViewport(t,r,s,a),e.renderer.setScissor(t,r,s,a),e.renderer.setScissorTest(!0)}},e.beautifyRender=e=>{Xw(e)},e.calcObjectPosition=lC,e.calcPerspectiveScreenSize=(e=0,t,n)=>{let i=1,r=1;const s=at.degToRad(t.fov/2);return r=(t.position.z-e)*Math.tan(s)*2,i=r*n,{width:i,height:r}},e.calcTransformFov=pC,e.cloneUniform=Kg,e.cloneUniforms=$g,e.computeCurl=(e,t,n)=>{let i=1e-4,r=new Ot,s=nC(e,t+i,n),a=nC(e,t-i,n),o=(s-a)/(2*i);s=nC(e,t,n+i),a=nC(e,t,n-i);let l=(s-a)/(2*i);return r.x=o-l,s=nC(e,t,n+i),a=nC(e,t,n-i),o=(s-a)/(2*i),s=nC(e+i,t,n),a=nC(e+i,t,n),l=(s-a)/(2*i),r.y=o-l,s=nC(e+i,t,n),a=nC(e-i,t,n),o=(s-a)/(2*i),s=nC(e,t+i,n),a=nC(e,t-i,n),l=(s-a)/(2*i),r.z=o-l,r},e.computeViewWindowScale=e=>{const t=e.getBoundingClientRect(),{width:n,height:i}=t;return{xScale:n/window.innerWidth,yScale:i/window.innerHeight}},e.convertBufferAttributeToVector=(e,t=3)=>{const n={2:new ot,3:new Ot,4:new Rt};return Array.from({length:e.array.length/t},((i,r)=>n[t].clone().fromBufferAttribute(e,r)))},e.convertGeometryToShape=e=>{switch(e.type){case"BoxGeometry":case"BoxBufferGeometry":{const{width:t=1,height:n=1,depth:i=1}=e.parameters,r=new oy(t/2,n/2,i/2);return new Sy(r)}case"PlaneGeometry":case"PlaneBufferGeometry":return new p_;case"SphereGeometry":case"SphereBufferGeometry":{const{radius:t}=e.parameters;return new u_(t)}case"CylinderGeometry":case"CylinderBufferGeometry":{const{radiusTop:t,radiusBottom:n,height:i,radialSegments:r}=e.parameters;return new d_(t,n,i,r)}default:{let t=new bi;t.setAttribute("position",e.getAttribute("position")),t=ed(t);const n=t.attributes.position.array,i=t.index.array,r=[];for(let e=0;e<n.length;e+=3)r.push(new oy(n[e],n[e+1],n[e+2]));const s=[];for(let e=0;e<i.length;e+=3)s.push([i[e],i[e+1],i[e+2]]);return new Ey({vertices:r,faces:s})}}},e.createPolygonShape=(e,t={})=>{const n=new Hl,{scale:i=1}=t,r=e[0];for(let t=0;t<e.length;t++){const s=e[t],a=(s.x-r.x)*i,o=-1*(s.y-r.y)*i;0===t?n.moveTo(a,o):n.lineTo(a,o)}return n},e.detectDeviceType=Ow,e.downloadBlob=Jw,e.enableRealisticRender=e=>{jw(e),e.toneMapping=2,e.toneMappingExposure=3,e.shadowMap.enabled=!0,e.shadowMap.type=2,e.physicallyCorrectLights&&(e.physicallyCorrectLights=!0)},e.enableSRGBColorSpace=jw,e.enableShadow=e=>{e.shadowMap.enabled=!0,e.shadowMap.type=2},e.epsilon=fC,e.expandColor=zw,e.exportGLTF=(e,{filename:t="scene",trs:n=!1,onlyVisible:i=!0,binary:r=!1,maxTextureSize:s=4096}={})=>{(new ud).parse(e,(e=>{if(e instanceof ArrayBuffer)Zw(e,`${t}.glb`);else{const n=JSON.stringify(e,null,2);console.log(n),Kw(n,`${t}.gltf`)}}),(e=>{console.log("An error happened during parsing",e)}),{trs:n,onlyVisible:i,binary:r,maxTextureSize:s})},e.extendMaterial=kg,e.fixShapeGeometryUV=e=>{const t=(new Gt).setFromObject(e),n=new Ot;t.getSize(n);const i=new Ot,r=e.geometry.attributes.position,s=e.geometry.attributes.uv;for(let e=0;e<r.count;e++)i.fromBufferAttribute(r,e),s.setXY(e,(i.x-t.min.x)/n.x,(i.y-t.min.y)/n.y)},e.flatModel=e=>{const t=[];return e.traverse((e=>{t.push(e)})),t},e.getBaryCoord=e=>{const t=e.attributes.position.array.length/3,n=[];for(let e=0;e<t;e++)n.push(0,0,1,0,1,0,1,0,0);const i=new Float32Array(n);e.setAttribute("aCenter",new fi(i,3))},e.getBound=qw,e.getBoundsVertices=Yw,e.getCSSMatrix=mC,e.getCameraCSSMatrix=AC,e.getEnvmapFromHDRTexture=(e,t)=>{const n=new Pr(e);n.compileEquirectangularShader();const i=n.fromEquirectangular(t).texture;return n.dispose(),i},e.getEnvmapFromScene=(e,t)=>new Pr(e).fromScene(t).texture,e.getObjectCSSMatrix=vC,e.getPointsInPath=(e,t=4)=>{const n=[],i=e.getTotalLength(),r=Math.floor(i/t);for(let t=0;t<r;t++){const s=i*t/r,a=e.getPointAtLength(s);n.push(a)}return n},e.getPositionCentroids=(e,t="position",n="aCenter")=>{const i=e.attributes[t],r=i.count,s=i.array,a=Nw(r,(e=>e));for(let e=0;e<r;e+=3){let t=s[3*e],n=s[3*e+1],i=s[3*e+2],r=s[3*e+3],o=s[3*e+4],l=s[3*e+5],c=s[3*e+6],h=s[3*e+7],u=s[3*e+8];const d=(new Ot).add(new Ot(t,n,i)).add(new Ot(r,o,l)).add(new Ot(c,h,u)).divideScalar(3);a.set([d.x,d.y,d.z],3*e),a.set([d.x,d.y,d.z],3*(e+1)),a.set([d.x,d.y,d.z],3*(e+2))}return e.setAttribute(n,new fi(a,3)),a},e.getUniformFromAsset=QD,e.getViewport=e=>{const t=new Ot,n=new Ot,i=e.getWorldPosition(t).distanceTo(n),r=e.fov*Math.PI/180,s=2*Math.tan(r/2)*i;return{width:s*(window.innerWidth/window.innerHeight),height:s}},e.hyperbolicHelicoidFunction=iC,e.isFloat32Array=Qw,e.isObjectBehindCamera=cC,e.isObjectVisible=hC,e.isVector=kw,e.iterateBuffer=(e,t,n,i=3)=>{for(let r=0;r<t;r++){const t=r*i;n(e,{x:t,y:t+1,z:t+2,w:t+3},r)}},e.loadCubemapFromImgs=GD,e.loadFBX=e=>new Promise((t=>{(new mm).load(e,(e=>{t(e)}),(()=>{}),(()=>{t(null)}))})),e.loadFont=(e="https://unpkg.com/three@0.77.0/examples/fonts/helvetiker_regular.typeface.json")=>new Promise((t=>{(new Um).load(e,(e=>{t(e)}))})),e.loadGLTF=(e,t={})=>{const{useDraco:n=!0}=t;return new Promise((t=>{const i=new of;n&&(Ww=new BA,Ww.setDecoderPath("string"==typeof n?n:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),i.setDRACOLoader(Ww)),i.load(e,(e=>{t(e)}),(()=>{}),(()=>{t(null)}))}))},e.loadHDR=e=>new Promise((t=>{(new pA).load(e,(e=>{t(e)}),(()=>{}),(()=>{t(null)}))})),e.loadTextureFromImg=kD,e.loadVideoTexture=Vw,e.makeBuffer=Nw,e.mapShader=function(e,t){const n=Vg[e];return xg[n.id+"_"+("vertex"===t?"vert":"frag")]},e.normalizeVector=Gw,e.objectScale=dC,e.objectZIndex=uC,e.optimizeModelRender=Xw,e.patchShader=sv,e.polySort=e=>{const t=(e,t)=>[Math.atan2(e[1]-t[1],e[0]-t[0]),(e[0]-t[0])**2+(e[1]-t[1])**2],n=e.map((e=>[e.x,e.y]));let i=[n.reduce(((e,t)=>e+t[0]),0)/n.length,n.reduce(((e,t)=>e+t[1]),0)/n.length];for(let e of n)e.push(...t(e,i));n.sort(((e,t)=>e[2]-t[2]||e[3]-t[3]));for(let e of n)e.length-=2;return n.map((e=>({x:e[0],y:e[1]})))},e.preloadImages=Fw,e.preloadSDFFont=(e="https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff")=>new Promise((t=>{!function({font:e,characters:t,sdfGlyphSize:n},i){iD({font:e,sdfGlyphSize:n,text:Array.isArray(t)?t.join("\n"):""+t},i)}({font:e},(()=>{t(!0)}))})),e.preventDefaultAndStopBubble=Uw,e.printModel=(e,t="modelParts")=>{const n=e.map(((e,n)=>`const ${e.name} = ${t}[${n}];`)),i=n.join("\n");return console.log(i),i},e.range=function*(e,t,n=1){let i=e;for(;i<t;)yield i,i+=n},e.roundedRect=(e,t=0,n=0,i=1,r=1,s=.05)=>(e.moveTo(t,n+s),e.lineTo(t,n+r-s),e.quadraticCurveTo(t,n+r,t+s,n+r),e.lineTo(t+i-s,n+r),e.quadraticCurveTo(t+i,n+r,t+i,n+r-s),e.lineTo(t+i,n+s),e.quadraticCurveTo(t+i,n,t+i-s,n),e.lineTo(t+s,n),e.quadraticCurveTo(t,n,t,n+s),e),e.sample=e=>e[Math.floor(Math.random()*e.length)],e.sampleParticlesPositionFromMesh=(e,t=1e4)=>{const n=new ai,i=new Hi(e,n),r=new Rp(i).build(),s=new Float32Array(3*t);for(let e=0;e<t;e++){const t=new Ot;r.sample(t),s.set([t.x,t.y,t.z],3*e)}return s},e.saturate=e=>at.clamp(e,0,1),e.saveArrayBuffer=Zw,e.saveString=Kw,e.sleep=e=>new Promise((t=>setTimeout(t,e))),e.smoothNormal=e=>{e.geometry=ed(e.geometry),e.geometry.computeVertexNormals()},e.sphubeFunction=rC,e.usePropAsIsOrAsAttribute=Hw}));
